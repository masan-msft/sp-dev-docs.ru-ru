---
title: "OneDrive для бизнеса настройки в объектная модель SharePoint"
ms.date: 11/03/2017
ms.openlocfilehash: ac42f49468f78619ba0b53c82eb711392fa9a35d
ms.sourcegitcommit: ad9b18a3fc81d9561383413644120e7255d31d61
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/17/2018
---
<a name="onedrive-for-business-customization-in-the-sharepoint-add-in-model"></a>OneDrive для бизнеса настройки в объектная модель SharePoint
==================================================================

<a name="summary"></a>Summary
-------

Выбор подхода для настройки OneDrive для бизнеса сайтов в новой модели надстройки SharePoint отличаться от полного доверия кодом.  В типичных полного доверия кода (FTC) / сценарий решения фермы, задания таймера SharePoint были созданы с помощью объектной модели SharePoint Server со стороны кода, развернутые с помощью решений фермы и управления в веб-сайта центра администрирования SharePoint.  SharePoint обрабатывает планирование и выполнение задания таймера в этом сценарии. 

В SharePoint надстройки модели сценарии задания таймера создаются и вне SharePoint.  SharePoint не отвечает за планирование и выполнение задания таймера в этом сценарии.

<a name="why-would-you-customize-onedrive-for-business-sites"></a>Почему бы настроить OneDrive для бизнеса сайтов
----------------------------------------------------
Существует множество различных аспектов на применение параметров к OneDrive для бизнеса (OD4B) сайтов. Эти сайты определенно можно настроить параметры с момента их сайты SharePoint, но в то же время всегда необходимо учитывать влияние короткие и длинные терминов настройки.

<a name="high-level-guidelines"></a>Рекомендации по высокого уровня
---------------------

Как правило эскиз мы хотели бы предоставить со следующими рекомендациями высокого уровня для настройки сайтов OD4B.

- Применение фирменной настройки, с помощью Office 365 тем или модуль темы сайта SharePoint
- Обработчики темы, не достаточно, можно настроить некоторые параметры CSS с помощью альтернативного варианта CSS
- Избегайте Настройка OD4B сайтов, с помощью настраиваемых главных страниц, так как это приведет к вам дополнительные долгосрочные затраты и проблемы, связанные с будущими обновлениями
    + В большинстве случаев можно достичь все распространенные сценарии фирменной настройки с тем и альтернативной таблицы CSS, поэтому это не действительно, ограничивающим фактором
    + Если вы решили использовать настраиваемые главные страницы, подготовленного для применения изменений на веб-сайты, когда основные функциональные обновления применяются к Office 365
- Можно использовать JavaScript, внедрение для изменения или скрыть функциональные возможности на сайте
- CSOM можно использовать для управления например языка и региональных параметров на сайтах OD4B (увидеть [новые интерфейсы API](http://blogs.msdn.com/b/vesku/archive/2014/12/15/latest-api-updates-in-client-side-object-model-dec-2014-cu-for-sp2013.aspx))
- Мы не рекомендуем использования типов контента и столбцы сайта на сайтах OD4B, чтобы избежать проблем с обязательные поля или другие элементы, которые могут вызвать проблемы, возникающие при обычной варианты с сайтами, OD4B
    + Представить OD4B сайтов как для личного неструктурированных данных и документов. Сайты рабочих групп и совместной работы документа, а затем для данных компании и документов, где можно определенно использовать любые политики управления сведениями и метаданных.

В сводке настройки определенно поддерживается в Office 365 и вы можно хранить в их использования с сайтами, OD4B. Только что действительно необходимо рассмотреть влияние на короткие и длинные терминов Перспектива обслуживания и настройки из эксплуатации. Это не конкретно для SharePoint, а не как правило для построения решения любой ИТ с любой платформы.

Ниже приведен пример OD4B узла, который был настроен с помощью выше рекомендаций. В этом случае конечный результат достигнут с тем Office 365, тему сайта и использование так называемое JavaScript, внедрение шаблон.

![Представление по завершении работы пользовательского OD4B сайта.](media/Recipes/OD4BCustomization/OD4B-branded.png)

<a name="challenge-with-applying-onedrive-for-business-site-customizations"></a>Вызов с применение OneDrive для настройки сайта бизнеса
-----------------------------------------------------------------

Начнем с определения возможности проблемой и что мы пытаетесь решить здесь. Технически каждого OneDrive для бизнеса сайта в текущий момент использует идентичные архитектуры как личные или личные узлы, используемые в SharePoint 2007 или 2010 версии. Это означает, технически каждого OneDrive для бизнеса сайта является собственные семейства веб-сайтов и мы не можем любой централизованное расположение для применения фирменной настройки или другие настроек.

![Каждый OneDrive для бизнеса сайта — это собственный семейства сайтов в разделе личные управляемого пути и каждого URL-адреса создан на основе профилей пользователей. Например если contoso-my.sharepoint.com основного сайта, пользователя John сайта будет contoso-my.sharepoint.com/personal/john_contoso_com.](media/Recipes/OD4BCustomization/OD4B-topolgy.png)

Классический решение, которое требуется применить необходимые настройки в OneDrive для бизнеса сайты (включая Мои или личные сайты) основана на [ассоциации возможности на уровне фермы](http://cks.codeplex.com/releases/view/2824). Это означает, что вы развернуть решение фермы в ферме SharePoint используется структура компонентов для связи вашего пользовательского компонента активируется при каждом создано личный сайт, которой затем отвечал применения необходимых настроек. Такой же подход не работает в Office 365, поскольку требуется следует развертывать решение фермы и это невозможно просто с сайтами на Office 365. Поэтому мы должны выглядеть альтернативы для применения необходимые изменения на веб-сайты.

В Office 365 централизованного событие не возникает, который мы может присоединить наших пользовательского кода, чтобы при создании сайта OD4B. Это означает, что необходимо учитывать альтернативных решений будет весьма подходов модели приложения. Не войти на старой модели, подумайте, как добиться же конечный результат с помощью новые интерфейсы API и технологии. С точки зрения чисто требования, он не имеет значения как мы применить ее на веб-сайты, до тех пор, пока они применяются, поскольку не следует применять ассоциации возможности бизнес-требованиям, где о применении необходимо с помощью поддерживается независимо от существующих настроек Технические механизм.

<a name="different-options-for-applying-customization"></a>Различные варианты применения настройки
============================================

На практике у нас есть четыре различных механизмов для применения централизованного развертывания сайтов OD4B в Office 365. Кроме того, можно вручную вариант, пятый, но в случае необходимости сотни или тысячи OD4B сайтов, с помощью вручную параметры не действительно реалистичной параметр. Вот различных параметрах, у нас есть.

1. Office 365 набора параметров уровня (Office 365 темы и другие параметры)
2. Веб-часть скрытые приложения с помощью контекста пользователя
3. Предварительное создание и применение конфигурации
4. Задание таймера удаленного, на основании изменения профиля пользователя

Все параметры имеют преимущества и недостатки в их и правом параметр зависит от подробные бизнес-требования. Некоторые параметры применяются на уровне набора приложений Office 365, но часто может нужна некоторые дополнительные особенности, необходимых действительных настроек. Очевидно, что все сводится на точное требования и вариантов анализа бизнеса на их влияние на короткие и длинные терминов.

<a name="office-365-suite-level-settings"></a>Параметры уровня набора приложений Office 365
-------------------------------

Office 365 — это не только SharePoint, как вы знаете. Можно найти более дополнительные службы, которые не основаны на даже архитектуры SharePoint, как Delve, Yammer и многие предстоящие службы. Это означает, что корпоративной фирменной символики и конфигурации не используется только для управления имеют на сайтах SharePoint, а мы следует подумать общий конечного пользователя взаимодействия и как мы предоставляем согласованные конфигурации пересекать различных служб.

Фирменная символика классический пример этим требованиям предприятия и для, у нас есть еще темы Office 365 введена, которую можно использовать для управления определенный уровень фирменной символики. У нас есть также других новыми возможностями, которые позволяют управлять вашего сайта управления и другие параметры из централизованное расположение за пределами параметры семейства сайтов, как предстоящие центре соответствия требованиям для Office 365, которая указана в настоящее время в [ Схема для Office 365](http://office.microsoft.com/en-us/products/office-365-roadmap-FX104343353.aspx).

На рисунке ниже показаны различные параметры на данный момент темы Office 365, который затем применяется на нескольких всех служб Office 365.

![Сайт отображает Office 365, отображение вкладки настраиваемой темы, право управление пользовательских тем для вашей организации, Настройка Office 365 в соответствии с марки вашей организации. Параметры доступны для эмблема, URL-адрес для активной логотип, фонового изображения, контрастный цвет, цвет фона панели навигации, цвет текста и значков и цвет значков меню приложения.](media/Recipes/OD4BCustomization/O365-theme-settings.png)

Поскольку по умолчанию параметры темы Office 365, для управления панель набора OD4B сайта, вероятнее всего использовании этого параметра вместе с другими вариантами чтобы убедиться, что можно указать по крайней мере правом элементы фирменной настройки кросс-OD4B сайтов. Обратите внимание на то, что при внесении изменений для примера настройки темы Office 365 в средство администрирования Office 365, занимает весьма много времени для получения параметров, примененных для сайтов OD4B, поэтому быть Терпение.

<a name="hidden-app-part-with-user-context"></a>Веб-часть скрытые приложения с помощью контекста пользователя
---------------------------------

Это подход, в которых использование централизованного целевая страница по для начала необходимые настройки. Это означает, что необходимо иметь один централизованное расположение, как страница переднего интрасети компании, где пользователи всегда Главная при открытии их браузера. Это очень типовой процесс с среднего и более крупным предприятиям где корпоративной целевая страница — это, затем управляются с помощью параметров групповой политики в AD. Это гарантирует, что конечные пользователи не могут переопределить начальная страница по умолчанию браузеров домену компании.

Когда пользователь попадает в интрасети, мы будет скрытым веб-части приложения в страницы, который будет запущен процесс настройки. Его можно фактически отвечает всей OD4B создания сайтов также, так как обычно пользователь должен будет узле OD4B времени, прежде чем будет запущен процесс создания сайта. Веб-часть приложения скрытых фактически размещается на страницу с размещением у поставщика приложений, размещенных в Azure. На этой странице отвечает затем начальных процесс настройки.

Взглянем более подробно на логической структуры этого подхода.

![Схема для отображения отношений. Создайте экземпляр веб-части приложения на сайте используется SharePoint переход на приложений, размещенных в поставщик. Приложений, размещенных в поставщик использует добавить сообщение переход на хранилища очереди. Создайте экземпляр очереди использует хранилище переход на WebJob. Переход на сайт OD4B WebJob использует применить изменения.](media/Recipes/OD4BCustomization/hidden-app-part-logical-diagram.png)

1. Поместите веб-часть приложения скрытых централизованного сайт, где будет располагаться конечных пользователей. Обычно это на первой странице корпоративной интрасети.
2. Веб-часть приложения размещается на страницу с размещением у поставщика приложений, где в кода на стороне сервера мы начать процесс настройки, добавив необходимые метаданные в очередь хранилища azure. Это означает, что только будет получать запрос настройки на этой странице, но фактически не применяется все изменения для хранения обычных времени обработки.
3. Это очереди azure хранения, который будет получать сообщений в очередь для обработки. На первой странице интрасети остается таким образом, мы может обрабатывать настройки асинхронно управление процесса, чтобы он не имеет значения как долго конечного пользователя. Если процесс настройки может быть синхронные, мы бы зависит от конечного пользователя для оставьте браузер открытым на странице переднего интрасети только после завершения выполнения страницы. Это не будет определенно оптимальной и была проблемой с [исходной OD4B процессе настройки](http://blogs.msdn.com/b/vesku/archive/2013/11/25/office365-apply-automatically-custom-branding-to-personal-site-skydrive-pro.aspx), которых я блоге во время отказа.
4. WebJob подключен к выполните очереди хранилища, который вызывается, когда новый элемент ставится в очередь хранилища. В этом WebJob будет получать необходимые параметры и метаданные из сообщения в очереди для доступа к коллекции правом сайта. WebJob с помощью приложения только маркеров и предоставлены необходимые разрешения для работы с семейств веб-сайтов на уровне клиента.
5. Действительных настроек, примененные по одному на сайты тем пользователям, у которых посетите страницу переднего интрасети для начала процесса.
Это определенно самый надежный процесс становится правой конфигураций на сайтах OD4B. Логика настройки управления версиями можно легко добавить к процессу, который также применяет все необходимые обновления сайтов OD4B, при необходимости обновления и посещении на первой странице интрасети следующий раз. Этот параметр, однако требуют наличия этого централизованное расположение, где главная конечных пользователей.

Если вы знакомы классический моделей разработки SharePoint с решениями для фермы, это очень аналогичный процесс как один раз, выполнение задания таймера.

<a name="pre-create-and-apply-configuration"></a>Предварительное создание и применение конфигурации
----------------------------------

Этот параметр использует перед созданием сайтов OD4B перед пользователи будут получать доступ к их. Это можно сделать с помощью [относительно новых API](https://github.com/SharePoint/PnP/tree/master/Samples/Provisioning.OneDriveProvisioning) содержащей "мне нравится" нет на месте для создания сайтов OD4B для конкретных пользователей в процесс пакетной обработки с помощью CSOM или REST. Требуется код может запускаться с помощью скрипта PowerShell или путем написания фактический код, который вызывает API удаленного.

![Администраторы используют, предварительное создание и настройка для создания сайта OD4B.](media/Recipes/OD4BCustomization/pre-create-and-apply.png)

1. Администратор с помощью удаленного создания API-интерфейсы для создания сайтов OD4B для пользователей и применяет необходимых настроек сайтов OD4B как часть процесса скрипта.
2. Фактический OD4B сайтов создаются в Office 365 для конкретных пользователей и связанных профилей

В некотором смысле это действительно надежный процесс, но необходимо управлять новых лиц и обновления «вручную» которого означает больше работы, затем с помощью подхода *веб-части скрытых приложения* . Это определенно допустимый подход, который может быть съемки и особенно полезна, если выполняется миграция некоторые другие решения для OD4B общего доступа к файлам и хотите избежать необходимости конечных пользователей для доступа к сайту OD4B один раз, до начала создания сайтов фактических данных.

<a name="remote-timer-job-based-on-user-profile-updates"></a>Задание таймера удаленного, на основании изменения профиля пользователя
----------------------------------------------

Этот подход означает, что сканирования через профилей пользователей для проверки, для которого был создан сайт OD4B, а затем применять изменения на веб-сайты, при необходимости. Это означает, что запланированное задание под управлением за пределами SharePoint, которое будет периодически проверить состояние и выполнить необходимые настройки. Запланированное задание может быть работает как WebJob в Azure или просто сценарий PowerShell, запланированного в планировщик windows. Очевидно, что масштаб развертывания имеет огромную воздействия на выбранный флажок.

![Задание таймера удаленного использует, цикл по семейств веб-сайтов, для настройки каждого сайта.](media/Recipes/OD4BCustomization/remote-timer-job.png)

1. Запланированная задача инициируется которого будут получать доступ к профилям пользователей, для проверки того, кто имеет сайта OD4B подготовить к работе
2. Фактические сайты, настроенный с одной основанных на требованиях бизнеса

Одним из ключевых недостатков этого параметра является, что четко возможны ситуации, в котором пользователь может получить доступ сайты OD4B до применения настроек. В то же время этот параметр используется интересных дополнительный компонент для других параметры, чтобы убедиться, что конечные пользователи не были изменены любые необходимые параметры на сайтах или для проверки содержимого узла OD4B коммерческим политик компании.

<a name="enhanced-app-part-based-customization"></a>Веб-часть расширенного приложения на основе настройки
-------------------------------------

Здесь более подробное описание расширенные приложения части на основе настроек, в которой кажется необходимые настройки сайтов OD4B типичный подход для применения и управления ими. Исходного кода и Дополнительные сведения об этом решении доступен из [руководство и рекомендации и шаблоны для разработчиков Office 365](http://aka.ms/officedevpnp).

Фактические логической структуры следует подход часть скрытые приложения, упоминалось ранее в [этой записи блога](http://blogs.msdn.com/b/vesku/archive/2013/11/25/office365-apply-automatically-custom-branding-to-personal-site-skydrive-pro.aspx). Это означает, что подразумевается, что централизованного интрасети в среде Office 365, где размещен веб-части необходимые приложения и будет, что главная конечных пользователей для этой страницы при открытии их браузера. Чаще всего у каждого браузера компании же домашней страницы, задаются с помощью групповой политики, чтобы конечные пользователи всегда начинается из одного расположения централизованного при открытии их браузера. Это расположение, где находится веб-часть приложения, который может иметь значение размера как 0 пиксель ширины и высоты. Здесь суть использовать контекст конечного пользователя для выполнения веб-части приложения, который содержит страницу из надстройки размещением у поставщика.

**Рекомендации по оптимизации и обслуживание производительности**

Поскольку эта веб-часть приложения будет выполняться каждый раз пользователь перемещает к началу страницы интрасети, необходимо учитывать влияет на производительность this или как сделать кода для эффективной работы и ключевые элементы выполнение кода, когда это действительно необходимо выполнять только. Во-вторых оптимизации также является где мы поместить фактические ресурсы, которые используются в каждой из этих сайтах. Это довольно типичные задачи к решению с копирование настроек. Ниже приведен список short факторы, которые рассматриваются в реализации модели приложения.

- Расположение средств – централизованного сети (CDN) решение, в каждом семействе сайтов или в корневого семейства веб-сайтов?
- Обновление скорости активами или как убедиться, что независимо от того, кэширование браузера на стороне клиента мы можно убедитесь, что мы выполнения последних версий скриптов (JavaScript) или отображение последние версии изображений?
- Сокращение выполнения кода, чтобы избежать лишних нагрузку так, чтобы служба Office 365 и Azure
- Версия настройки, применяемые к OD4B сайта

**Расположение активами**

Существует несколько различных решений для этого. В коде ссылку примере мы используем внедрения JavaScript в каждой из OD4B-сайтов для обеспечения компании сообщение политики и удаление возможность создания sub-сайтов (или скрыть ссылку). В этом конкретного решения мы Отправка нужный файл JavaScript для корневого семейства сайтов onedrive для бизнеса адрес схемы и напрямую из этого одного расположения в отдельных сайтов OD4B мы ссылку на этот файл. Это означает, что имеется только одного расположения для обслуживания и обновления файла JavaScript, при необходимости все изменения.

В этом Эталонная реализация мы фактически также обновить файл при каждом выполнении WebJob, которой определенно не требуется, но пример кода был должен быть рабочее так же легко, без любые дополнительные действия и возможные. Точно так же вы отправляете файл JavaScript вручную для корневого семейства веб-сайтов, а затем задайте ссылки, из него. Альтернативного решения можно также использовать некоторые CND для хранения нужный файл или ссылки JavaScript из приложения с размещением у поставщика стороны. Если у вас есть только одну копию файла, будут иметь

![Каждый OneDrive для бизнеса сайта — это собственный семейства сайтов в разделе личные управляемого пути и каждого URL-адреса создан на основе профилей пользователей. Например если contoso-my.sharepoint.com основного сайта, пользователя John сайта будет contoso-my.sharepoint.com/personal/john_contoso_com.](media/Recipes/OD4BCustomization/asset-locations.png)

**Кэширование запросов и способы устранения, на стороне клиента**

Одной из проблем с реализацией на основе JavaScript на стороне клиента — кэширование. Когда браузеры будет загрузить используемые файлы JavaScript, они будут кэширование эти файлы для сокращения объема загруженного активов для следующих запросов. Это очень полезно с точки зрения оптимизации производительности, но вызывает сложную задачу, когда необходимо обновить файл JavaScript. В наихудшем случай кэшированный файл JavaScript приведет к исключения с другими обновлениями, представленной в обновленной версии.

Чтобы удалить эту проблему, можно начать, с помощью атрибута версии с помощью JavaScript URL-адрес ссылки. Когда мы связать пользовательского настраиваемого действия на сайте OD4B, мы включить URL-адрес JavaScript, чтобы уникальный идентификатор GUID в URL-адрес. Ниже приведен пример ссылку, которая будет указывать на корневой сайт семейства веб-сайтов. Обратите внимание на то дополнительный идентификатор GUID, который был добавлен после атрибута rev в URL-адрес. Каждом выполнении настройщика для отдельного сайта OD4B, этот атрибут будет обновления. На практике это означает, что этот файл JavaScript помещена в браузере до новой версии добавлен OD4B сайт, который будет изменять URL-адрес и поэтому браузера будет загрузить новую версию и кэширование, после следующего обновления.

- /OneDriveCustomization/OneDriveConfiguration.js?Rev=4bb89029e7ba470e893170d4cba7de00

Ниже приведен код, который используется для формирования URL-адреса JavaScript для дополнительного действия пользователя.
    
    /// <summary>
    /// Just to build the JS path which can be then pointed to the OneDrive site.
    /// </summary>
    /// <returns></returns>
    public string BuildJavaScriptUrl(string siteUrl)
    {
        // Solve root site collection URL
        Uri url = new Uri(siteUrl);
        string scenarioUrl = String.Format("{0}://{1}:{2}/{3}", 
                               url.Scheme, url.DnsSafeHost, 
                               url.Port, JSLocationFolderName);
       // Unique rev generated each time JS is added, so that we force browsers to 
       // refresh JS file wiht latest version
       string revision = Guid.NewGuid().ToString().Replace("-", "");
       return string.Format("{0}/{1}?rev={2}", scenarioUrl, JSFileName, revision);
    }

**Сокращение выполнение кода**

Так как этот процесс основан на скрытых часть приложения на первой странице интрасети, он означает, что код будет выполняться каждый раз пользователь будет обновлять их браузера или они перейти на страницу. Поскольку эта страница переднего часто настройке в качестве домашней страницы по умолчанию браузера для корпоративных пользователей, код будет выполняться каждый раз при запуске сеанса браузера.

Поскольку мы тем не менее не обновлять процедура в первую очередь обновления настроек, применяемые к сайтам OD4B, что часто нет действительно точки запуск всей настройки. В этом случае мы сократить использования очередей хранения и выполнение задания web, который будет снизить расходы, связанные с размещением у поставщика приложения стороны, поскольку мы не будет использоваться как объем ресурсов ЦП и другие ресурсы, в нашем разработки.

Убедитесь, что наш обработка не выполняется на каждый запрос проще использовать классический браузер файла cookie, где будут храниться определенный файл cookie в клиентском браузере с помощью определенного срока. Проверьте наличие этот файл cookie, мы можно пропустить выполнение, пока не истек файл cookie и тогда мы повторно проверьте состояние фактический настройки на веб-сайтах OD4B.

Вот, что у нас есть в метод load страницы для веб-части приложения. Этот вызов метода будет проверять наличие файла cookie, и если файл cookie существует, мы пропустит фактический бизнес код до выполнения снова необходимые.

    // Check if we should skip this check. We do this only once per hour to avoid 
    // perf issues and there's really no point even hitting the user profile 
    // in every request.
    if (CookieCheckSkip())
        return;

Фактический файл cookie состояния и параметров файла cookie выполняется следующим образом.

    /// <summary>
    /// Checks if we need to execute the code customization code again. 
    /// Timer set to 60 minutes to avoid constant execution of the code for nothing.
    /// </summary>
    /// <returns></returns>
    private bool CookieCheckSkip()
    {
        // Get cookie from the current request.
        HttpCookie cookie = Request.Cookies.Get("OneDriveCustomizerCheck");
    
       // Check if cookie exists in the current request.
       if (cookie == null)
       {
           // Create cookie.
           cookie = new HttpCookie("OneDriveCustomizerCheck");
           // Set value of cookie to current date time.
           cookie.Value = DateTime.Now.ToString();
           // Set cookie to expire in 60 minutes.
           cookie.Expires = DateTime.Now.AddMinutes(60);
           // Insert the cookie in the current HttpResponse.
           Response.Cookies.Add(cookie);
           // Output debugging information
           WriteDebugInformationIfNeeded(
               string.Format(@"Cookie did not exist, adding new cookie with {0} 
                               as expiration. Execute code.",
                               cookie.Expires));
           // Since cookie did not existed, let's execute the code, 
           // so skip is false.
           return false;
       }
       else
       {
           // Output debugging information
           WriteDebugInformationIfNeeded(string.Format(@"Cookie did existed, 
                                       with {0} as expiration. Skipping code.", 
                                       cookie.Expires));
           //  Since cookie did existed, let's skip the code
           return true;
       }
    }

При наличии внимательно на код на странице частей приложения вы увидите, при каждом вызове, что мы проверьте existences OD4B сайта для конечного пользователя. Поскольку только можно, обратившись к профиля пользователя, код будет иметь влияние на производительность. С помощью выше файл cookie для проверки, мы можно улучшить взаимодействия конечного пользователя, и мы избежать обращения к службе профилей пользователей постоянно без фактические требования. Также рекомендуется Обратите внимание на то, что мы размещен этот файл cookie для проверки в качестве первого шага в метод *Page_Load* , чтобы мы пропустить все обработки при необходимости. Здесь приводится краткое фрагмент метод *Page_Load* из *Customizer.aspx* для отображения кода процесса. 

    protected void Page_Load(object sender, EventArgs e)
    {
        // Check if we should skip this check. We do this only once per hour to avoid 
        // perf issues and there's really no point even hitting the user profile 
        // in every request.
        if (CookieCheckSkip())
            return;
     
        var spContext = 
           SharePointContextProvider.Current.GetSharePointContext(Context);
       using (ClientContext clientContext = 
           spContext.CreateUserClientContextForSPHost())
       {
           // Get user profile
           ProfileLoader loader = ProfileLoader.GetProfileLoader(clientContext);
           UserProfile profile = loader.GetUserProfile();
           Microsoft.SharePoint.Client.Site personalSite = profile.PersonalSite;
    
           clientContext.Load(profile, prof => prof.AccountName);
           clientContext.Load(personalSite);
           clientContext.ExecuteQuery();
    
           // Let's check if the site already exists
           if (personalSite.ServerObjectIsNull.Value)
           {

**Версия настройки, применяемые к OD4B сайта**

Второй уровень оптимизации на наш код обработки осуществляется управление версиями специально настроек, которые мы развертывание на веб-сайты OD4B. Это означает, что мы хранения версии настройки в контейнер свойств сайта OD4B и только обновления файлы и ресурсы при необходимости. Это означает, что в ходе выполнения WebJob мы сравнения в настоящее время версии настройки в OD4B до версии, который мы о развертывании и только в том случае, если не существует на сайте OD4B odes версии центра развертывания мы Загрузите необходимые ресурсы и применить другие параметры.

Такой подход будет также значительно сократить необходимые ресурсы из Microsoft Azure, поскольку мы избежать обновления или выполнение кода фактический настройки, если не требуется. Это означает, что сокращение расходов на загрузку ЦП и другие использования ресурсов в Microsoft Azure и менее запросы к Office 365.

Все настройки логики хранится в это пример находится в метод *ApplySiteConfiguration* в классе *OD4B.Configuration.Async.Common.SiteModificationManager* . Этот метод также вызывается WebJob с правом параметрами, чтобы начать процесс настройки. Прежде чем мы фактически выполнять любые операции, выполняется проверка, значения контейнера свойств с помощью ключа «Contoso_OneDriveVersion» и выполнение только будет продолжена, если текущая версия на сайте меньше, чем версия, которая планируется применить.  Вот фактический код, который использует [компонент PnP ядро Microsoft Office](https://github.com/SharePoint/PnP-Sites-Core/tree/master/Core) для упрощения кода.

    // Check current site configuration status - is it already in right version?
    if (ctx.Web.GetPropertyBagValueInt(
        SiteModificationManager.OneDriveMarkerBagID, 0) 
        < SiteModificationManager.BrandingVersion)
    {

При настройке применяется к сайту, будут заданы версии применяемые настройки в контейнер свойств для выполнения следующей.

    // Save current branding applied indicator to site
    ctx.Web.SetPropertyBagValue(SiteModificationManager.OneDriveMarkerBagID, SiteModificationManager.BrandingVersion);

Это относительно простой процесс, но значительно сократить необходимые ресурсы с Azure, и уменьшает unnecesasrey удаленных операций к Office 365, который будет влиять на производительность положительное.

<a name="needed-configuration-in-azure"></a>Необходимые настройки в Azure
-----------------------------

Ключевые требования для правильной работы в этом примере — это, что вы создали служба хранилища данных Azure и обновления строки подключения к хранилищу соответствующим образом для проектов, который они используются. Позволяет создать как служба хранилища с Azure администрирования портала (manage.windowssazure.com), выбрав **новые –> Data Services –> хранения –> быстрое создание**. После этого только нужно определить, местоположение и некоторые другие настройки и имеется достаточно просто.

![Параметры быстрого создания: URL-адрес имеет значение myveryownstorage, расположение/сходства группы задано значение Западная США, подписки задано значение MSDN Ultimate и репликации задано значение географически избыточных.](media/Recipes/OD4BCustomization/azure-config-1.png)

При создании хранилища необходимо перейти и скопируйте ключ, который необходим для строки подключения. При перемещении страница сведений о хранилище можно получить доступ к основные сведения, нажав кнопку «*Управления ключами доступа*» в нижней части страницы.

![Ссылки на управление сочетания клавиш, будет выделена в нижней части страницы.](media/Recipes/OD4BCustomization/azure-config-2.png)

Необходимо обновить файл App.config для следующих проекты в решении Visual Studio. Каждый из проектов являются более подробное описание описано далее в этой записи блога.

OD4B. Configuration.Async.WebJob OD4B. Проект Configuration.Async.Console.SendMessage WebJob имеет два ключи, которые могут обновляться для указания на то же подключение и SendMessage имеет только один ключ для обновления.

![Файл App.config открыт в Visual Studio в элементе appSettings. Два дочерних элементов с именем Add, перечислены в элементе appSettings. Для первого элемента добавить атрибут ключа = ClientId и значение атрибута равно пары двойные кавычки. Для второй элемент добавить атрибут ключа = ClientSecret и значение атрибута также равен пары двойные кавычки.](media/Recipes/OD4BCustomization/app-config.png)

<a name="reference-solution-structure"></a>Справочник по структура решения
----------------------------

В этом Visual Studio, решение состоит из довольно много решений, но каждый из них имеет довольно разумных причин он там был. Здесь приводится введение в каждый из проектов в решение и почему они существует, или они являются для.

![В обозревателе решений отображаются папку с именем следуют шесть проектов, которые ниже подробно описаны в документации.](media/Recipes/OD4BCustomization/solution-explorer.png)

**OD4B. Configuration.Async**

Это фактический проекта приложения SharePoint, которой будут представлены размещением у поставщика приложений для SharePoint и запрашивает, необходимых разрешениях. Обратите внимание, что несмотря на то, что мы фактически не выполняйте операции уровня клиента из приложения часть его self, просим довольно высокого разрешения для надстройки. Это так, как мы используем же идентификатор клиента и секрет из этого файла приложения в нашем WebJob выполнения. Этим способом, вам не нужно вручную зарегистрировать идентификатор приложения и секрет к SharePoint, мы довольно просто используйте же идентификатора и секрета перекрестные решения.

![Список разрешений: область клиент имеет разрешение Полный доступ. Область профили пользователей (социальные) имеет разрешение Полный доступ. Установлен флажок Разрешить приложению выполнять вызовы только для приложений в SharePoint.](media/Recipes/OD4BCustomization/app-permissions.png)

Этот проект также содержит часть определения приложения, который затем развертываются на хост-сайт.

**OD4B.Configuration.Async.Common**

Этот проект содержит все фактические бизнес-логики и общий код кросс-проекты как определение для данных объекта, которое будет произведен для хранения очередей и фактических бизнес-логики для настройки сайтов OD4B. Причина для размещения кода в здесь — просто предоставляет простой способ разработки и тестирования операций при создании проекта. Как с Общая разработка не следует помещать действительно вашего кода бизнес-логики непосредственно к WebJob или веб-часть приложения, а для поиска, в бизнес-логики уровень для упрощения тестирования и кода повторного использования.

Все фактические операции к сайтам OD4B, находятся в класс *OD4B.Configuration.Async.Common.SiteModificationManager* .

**OD4B. Configuration.Async.Console.Reset**

Этот проект является наших тестирования и отладки проект для действительных настроек. Его можно использовать для вручную применить ее желаемую на любой сайт OD4B. Во время разработки этот проект был тестирования проекта для тестирования в процессе настройки перед его был подключен к WebJob. Проекта также используется для сброса настроек из любого сайта OD4B демонстрации или тестирования. Так как фактический бизнес-логики, находится в проект common, этот проект будут использовать один и тот же класс *SiteModificationManager* от остальных Применение или сброс настроек на этих сайтах.

При проверке настроек можно просто изменить код в метод Main между применить и Reset, чтобы изменить желаемую операции.

    static void Main(string[] args)
    {
     
        Uri url = 
            new Uri("https://vesaj-my.sharepoint.com/personal/vesaj_veskuonline_com");
     
            //get the new site collection
        string realm = TokenHelper.GetRealmFromTargetUrl(url);
        var token = TokenHelper.GetAppOnlyAccessToken(
                       TokenHelper.SharePointPrincipal, 
                       url.Authority, realm).AccessToken;
       using (var ctx = 
           TokenHelper.GetClientContextWithAccessToken(url.ToString(), 
           token))
       {
           // Uncomment the one you need for testing/reset
           // Apply(ctx, url);
           Reset(ctx);
       }
    }

Обратите внимание, что необходимо убедиться, что идентификатор приложения и секрет для этого проекта в файле app.config соответствующих те, которые вы предоставили необходимые разрешения для вашего клиента. Можно легко выполнять проекта, щелкните правой кнопкой мыши проект и выбор **Отладка — запустить новый экземпляр**, таким образом, можно просматривать фактический код, который является выполняется построчно.

**OD4B. Configuration.Async.Console.SendMessage**

Этот проект был добавлен в решение, которое требуется проверить очередь механизм хранения перед он был подключен к веб-части приложения. Проект может использоваться с передавать процесс части приложения для добавления новых сообщений в очередь хранилища. Обратите внимание, что необходимо обновить строку подключения очереди хранилища соответствующим образом в файле app.config, чтобы сделать проект работать должным образом.

Можно легко выполнять проекта, щелкните правой кнопкой мыши проект и выбор отладка — запустить новый экземпляр таким образом, можно просматривать фактический код, который является выполняется построчно.

**OD4B. Configuration.Async.WebJob**

Это фактический WebJob проект, который был создан с помощью шаблона проекта WebJob, введенные в Visual Studio 2013 обновлений 4. Этот шаблон упрощает создание проектов WebJob путем добавления правом ссылки на месте, а также приводится автоматизации замечательно развертывания с поддержкой вправо для проекта. Можно просто развертывание первоначальной версии или нового проекта в Azure, щелкните правой кнопкой мыши и выбрав опубликовать как задание Web Azure... которого будет открыть мастер опубликования.

![Диалоговое окно Публикация веб-сайта отображается и отображает вкладку подключение. В поле сервер содержит значение vesaj-od4bconf.scm.azurewebsites.net:443, в поле имя узла содержит значение vesaj-0d4bconf, исправленный в поле имя пользователя, в поле пароль скрывается, установлен флажок Сохранить пароль, а URL-адрес назначения поле содержит значения http://vesaj-od4bconf.azurewebsites.net.](media/Recipes/OD4BCustomization/publish-to-azure.png)

В этом WebJob создается как непрерывная WebJob, который необходим для обработки на основе очереди. Это означает, что в методе Main мы только процесс выполнение непрерывного следующим образом.

    class Program
    {
        // Please set the following connection strings in app.config for this 
        // WebJob to run: AzureWebJobsDashboard and AzureWebJobsStorage
        static void Main()
        {
            var host = new JobHost();
            // The following code ensures that the WebJob will be 
            // running continuously
           host.RunAndBlock();
       }
    }

Обработка очереди — простой с WebJobs. Только, что для этого необходимо — для установки атрибутов вправо для метода и убедитесь, что соответствующим образом обновлены строки подключения Azure хранилища в файле конфигурации приложения и соответствующие хранилища очереди создания в Microsoft Azure. Ниже приведен метод *ProcessQueueMessage* из класса functions.cs. Обратите внимание на то, как использовать приложение только маркеров модели для доступа к SharePoint из WebJob. Чтобы выполнить эту операцию, необходимо убедиться, что были скопированы правом кода и секрета приложения в app.config проекта. Фактические бизнес-логика находится в классе *SiteModificationManager* , мы просто вызовите, с правом клиентского контекста и параметры.

    // This function will get triggered/executed when a new message is written 
    // on an Azure Queue called queue.
    public static void ProcessQueueMessage(
        [QueueTrigger(SiteModificationManager.StorageQueueName)] 
        SiteModificationData request, TextWriter log)
    {
        Uri url = new Uri(request.SiteUrl);
     
        //Connect to the OD4B site sing App Only access
       string realm = TokenHelper.GetRealmFromTargetUrl(url);
       var token = TokenHelper.GetAppOnlyAccessToken(
           TokenHelper.SharePointPrincipal, url.Authority, realm).AccessToken;
    
       using (var ctx = TokenHelper.GetClientContextWithAccessToken(
           url.ToString(), token))
       {
           // Set configuration object properly for setting the config
           SiteModificationConfig config = new SiteModificationConfig()
           {
               SiteUrl = url.ToString(),
               JSFile = Path.Combine(Environment.GetEnvironmentVariable
                   ("WEBROOT_PATH"), "Resources\\OneDriveConfiguration.js"),
               ThemeName = "Garage",
               ThemeColorFile = Path.Combine(Environment.GetEnvironmentVariable
                   ("WEBROOT_PATH"), "Resources\\Themes\\Garage\\garagewhite.spcolor"),
               ThemeBGFile = Path.Combine(Environment.GetEnvironmentVariable
                   ("WEBROOT_PATH"), "Resources\\Themes\\Garage\\garagebg.jpg"),
               ThemeFontFile = "" // Ignored in this case, but could be also obviously set
           };
    
           new SiteModificationManager().ApplySiteConfiguration(ctx, config);
       }
    }

Что еще надо отметить — это, необходимо убедиться, что свойство *Copy Local* свойство ссылки на сборку SharePoint CSOM для проекта, чтобы все зависимые сборки должным образом копируются в Azure при развертывании задания web . Это просто так как эти сборки не находится в обычном Azure веб-сайта по умолчанию, поэтому назначить этому свойству *значение True*, будет гарантирует, что эти сборки копируются в облако также.

**OD4B. Configuration.AsyncWeb**

Это фактический размещением у поставщика приложения, которая размещается в Microsoft Azure. Он содержит страницы, laded веб-части приложения, который размещается на первой странице интрасети. Страница Default.aspx этого приложения фактически не содержит какие-либо операции, показывает, содержит сведения о том, как использовать приложение.

*Обратите внимание на то. Если будет зачастую сталкиваются с необходимостью отказ в разрешении проблемы, связанные с WebJob или приложение доступ только к в целом, убедитесь в том, что обновления клиента кода и секрета приложения в файле app.config в соответствие со значениями в файл web.config из этого проекта. Visual Studio можно изменить эти значения в определенных ситуациях.* 

<a name="queue-processing-in-webjob"></a>Очередь обработки в WebJob
--------------------------

С помощью хранилища очередей прост действительно с помощью интерфейсов API, доступные из Azure. — Это самый простой способ начать использование пакетов Nuget «*Windows Azure хранилища*», который будет связать все необходимые интерфейсы API и других пакетов в проект. После добавления этого пакета Nuget просто воспользоваться хранилища очереди API-интерфейсы для обработки. Ниже приведен фрагмент из *OD4B. Configuration.Async.Common* проекта (AddConfigRequestToQueue метод в классе SiteModificationManager), который содержит код обработки очереди сообщений и использования из множество проектов (отмеченными упрощения разработки Отладка).

    public void AddConfigRequestToQueue(
                string account, string siteUrl, string storageConnectionString)
    {
        CloudStorageAccount storageAccount = 
                            CloudStorageAccount.Parse(storageConnectionString);
     
        // Get queue... create if does not exist.
        CloudQueueClient queueClient = storageAccount.CreateCloudQueueClient();
        CloudQueue queue = 
           queueClient.GetQueueReference(SiteModificationManager.StorageQueueName);
       queue.CreateIfNotExists();
    
       // Pass in data for modification
       var newSiteConfigRequest = new SiteModificationData()
       {
           AccountId = account,
           SiteUrl = siteUrl
       };
    
       // Add entry to queue
       queue.AddMessage(
           new CloudQueueMessage(
               JsonConvert.SerializeObject(newSiteConfigRequest)));
    }

В этом случае обработки очереди было выполнено с WebJob проекта. В случае WebJob можно просто использовать определенные атрибуты для автоматизации обработки очереди. Только, необходимо убедитесь в том, что это, что мы используем же хранилища строки и постановки в очередь имя подключения и отправки и получения части.

    // This function will get triggered/executed when a new message is written 
    // on an Azure Queue called queue.
    public static void ProcessQueueMessage(
        [QueueTrigger(SiteModificationManager.StorageQueueName)] 
        SiteModificationData request, TextWriter log)
    {
        Uri url = new Uri(request.SiteUrl);

Действительно не получает более простой способ. Обратите внимание на то, что мы используем *SiteModificationManager.StorageQueueName* в обе стороны чтобы гарантировать, что имя очереди соответствие.

**Применение фактический конфигураций к сайту**

В этой реализации ссылку выполняются после настройки для каждого сайта OD4B.

- Добавление сообщения политики компании, которое отображается все время на сайтах OD4B
- Скрыть Создание sub сайта ссылку со страницы контента сайта
- Применение пользовательской темы к сайту OD4B в соответствии с фирменной символики компании

Политика компании и скрытие ссылку Создать sub сайтов являются достигнуть с помощью поэтому вызов JavaScript, внедрение шаблон, где мы Добавление пользовательского настраиваемого действия на уровне сайта со ссылкой на конкретных файл JavaScript, который затем выполняется в каждом запросе страницы. Это означает, что мы можно управлять с помощью технологий со стороны клиента путем добавления, удаления или обновления любой элемент в любую страницу обработки страницы. Применение этого подхода необходимо перечислить настраиваемой главной страницы, что может привести к "мне нравится" более значительные затраты на техническое обслуживание конечном счете, особенно если необходимые изменения довольно минимальны.

Второй операции с помощью пользовательских тем требуется мы загрузки некоторых дополнительных файлов на сайт и задайте его тем для использования в качестве параметров темы. Мы строго CSOM передачи используйте все необходимые файлы на веб-сайты во избежание любой будущем со связями элемент framework компонента. С момента отправки файла в SharePoint, с помощью CSOM действительно простой, это определенно это самый простой способ выполнения автоматизации и не требуется для выполнения любой зависимости конкретных настроек xml для изолированных решений. Вот метод настройки фактических сайта от класса OD4B.Configuration.Async.Common.SiteModificationManager. Обратите внимание на то, что мы используем Office 365 для разработчиков PnP компонент основной для упрощения некоторые необходимые операции.

Рекомендуется также Обратите внимание, что действительно загружаем новой версии JS для корневого семейства веб-сайтов каждый раз личного сайта OD4B настройки. Это определенно не оптимальным решением, а не существует для простоты целей для этого решения Справочник по. Может рекомендуется добавить эту операцию отправки файла JavaScript событие установленные приложения, таким образом, чтобы он выполняется только один раз при установке приложения, но в этом случае необходимо выполнить дополнительные действия с обновлений на JS-файла.

    // This function will get triggered/executed when a new message is written 
    // on an Azure Queue called queue.
    public static void ProcessQueueMessage(
        [QueueTrigger(SiteModificationManager.StorageQueueName)] 
        SiteModificationData request, TextWriter log)
    {
        Uri url = new Uri(request.SiteUrl);
     
        //Connect to the OD4B site using App Only token
       string realm = TokenHelper.GetRealmFromTargetUrl(url);
       var token = TokenHelper.GetAppOnlyAccessToken(
           TokenHelper.SharePointPrincipal, url.Authority, realm).AccessToken;
    
       using (var ctx = TokenHelper.GetClientContextWithAccessToken(
           url.ToString(), token))
       {
           // Set configuration object properly for setting the config
           SiteModificationConfig config = new SiteModificationConfig()
           {
               SiteUrl = url.ToString(),
               JSFile = Path.Combine(Environment.GetEnvironmentVariable
                   ("WEBROOT_PATH"), "Resources\\OneDriveConfiguration.js"),
               ThemeName = "Garage",
               ThemeColorFile = 
                   Path.Combine(Environment.GetEnvironmentVariable
                   ("WEBROOT_PATH"), "Resources\\Themes\\Garage\\garagewhite.spcolor"),
               ThemeBGFile = 
                   Path.Combine(Environment.GetEnvironmentVariable
                   ("WEBROOT_PATH"), "Resources\\Themes\\Garage\\garagebg.jpg"),
               ThemeFontFile = "" // Ignored in this case, but could be also set
           };
    
           new SiteModificationManager().ApplySiteConfiguration(ctx, config);
       }
    }

Очевидно, что необходимые операции выполняются сильно зависит от потребностей бизнеса. Можно найти несколько разных шаблонов и операции с [Office 365 для разработчиков шаблоны и рекомендации](http://aka.ms/officedevpnp)на основе подходов к CSOM.

<a name="additional-notes-on-webjob-based-solutions"></a>Дополнительные замечания о решениях на базе WebJob
==========================================

Вот несколько Дополнительные примечания, связанные с на разработку WebJob в Azure. Это очень эффективным методом которого будет определенно широко используются на нескольких настроек Office 365. Конечно, вы увидите новые и расширенные решения на основе технологии WebJob в Office 365 для разработчиков шаблонов & Practices программы также добавляется.

<a name="debugging-webjob-and-customization-process"></a>Отладка процесса WebJob и параметры настройки
------------------------------------------

Один из рекомендуемые методы для кода в общем найдите фактические операции за пределами окончательный выполняющийся процесс, а необходимые таким образом, вы можете первого сосредоточены на тестирования кода легко просто с помощью консольного приложения или для примера с тестовых проектов в Visual Studio. Таким образом, можно гарантировать, что фактический бизнес-логики полностью функциональные возможности перед фактически зондами, в последнем процесс, в данном случае означает WebJob. В данном случае решение ссылку описано бизнес код в класс OD4B.Configuration.Async.Common.SiteModificationManager и, который вызывается из различных мест.

Это означает, что во время разработки можно использовать OD4B. Configuration.Async.Console.Reset консольного приложения для тестирования и сброс настроек столько раз, сколько требуется узлов убедитесь, что бизнес-логика полностью сплошной. Это действительно никак не связан с помощью модели надстройки SharePoint или Azure разработки, по разработке вместо практические пошаговые независимо от того, какие технологии использовать. Периоды времени, когда я была динамика в Специалист по сертификации обучение SharePoint, я ссылается на этот как [метод NKOTB](https://www.youtube.com/watch?v=iCrargw1rrM), но это не Стандартные термины отрасли :-)

Одно из замечательных улучшения с точки зрения отладки для WebJobs была введена в Visual Studio 2014 обновлений 4. С помощью новых подключений Azure и шаблоны проектов можно выполнить удаленная отладка с WebJob в Azure со стороны. Необходимо развернуть WebJob в Azure и после, можно начать сеанс отладки, справа щелкните WebJob экземпляра в *Обозревателе серверов* и выберите *Присоединение отладчика* в контекстном меню.

![В обозревателе серверов расширена вложенных объектов веб-сайтов, vesaj-od4bconf WebJobs, непрерывно, OD4BConfigurationAsyncWebJob. Контекстное меню появляется над OD4BConfigurationAsyncWebJob и пункта контекстного меню, которое будет выделена присоединение отладчика.](media/Recipes/OD4BCustomization/server-explorer.png)

Имеется даже инженер-испытатель для отправки правильно форматированных сообщений в очередь в решении ссылку. *OD4B. Configuration.Async.Console.SendMessage* проект был создан просто, чтобы иметь возможность отладки процесса WebJob без риска для развертывания веб-части приложения в любом месте. Это был получен еще раз на отладки и тестирования пошаговые весь процесс.

<a name="webjob-environment-variables"></a>Переменные среды WebJob
----------------------------

Одно из интересных аспектов WebJobs, что они выполняются от имени Azure веб-сайтов, но место их выполнения отличается от обычных веб-сайтов в Azure. Я понимаю с этой —, что при развертывании дополнительных файлов или средств вместе с WebJob Azure возникновения проблемы, связанные с Если предполагается, что можно ссылаться на эти ресурсы, непосредственно с использованием классической относительных путей в коде WebJob.

В этом случае имеется один файл JavaScript и несколько файлов для пользовательской темы, которые были развернуты для веб-сайта Azure, поэтому может будут загружаться на сайты SharePoint, при необходимости. Для просмотра этих файлов в Azure расширение филиала файлы в разделе определенного веб-сайта.

![В обозревателе серверов при развертывании вложенных объектов веб-сайтов, vesaj od4bconf, файлы, ресурсы, тем, видео и отображение файлов в папке «видео».](media/Recipes/OD4BCustomization/azure-web-site.png)

Обычно в Azure веб-сайтов можно было ссылаться на эти файлы, с помощью следующего формата

    string path = HostingEnvironment.MapPath(
        string.Format("~/{0}", "Resources/OneDriveConfiguration.js"));

Поскольку WebJobs тем не менее, выполняются в другую папку, а не в контексте служб IIS, над ссылку на файл не будет работать, поскольку сопоставление произойдет сбой в контексте процесса WebJob. Здесь указывается, где может помочь WebJob определенные переменные среды.  В случае решение ссылку мы использовали переменную заданной среды WebJob WEBROOT_PATH для получения доступа для папки, связанной веб-сайта.

    string jsFile = Path.Combine(
        Environment.GetEnvironmentVariable("WEBROOT_PATH"), 
        "Resources\\OneDriveConfiguration.js");

Существует также несколько переменные среды для WebJobs, которая может помочь. Чтобы проверить переменные разные среды, с помощью кода и в репозиториев для [этой](https://gist.github.com/sayedihashimi/831d8883cdf1d23823f3)хороший ссылки.

<a name="video-demonstrating-the-solution-and-the-actions"></a>Видеоролик, демонстрирующий решения и действия
================================================

[Вот видео](http://video.ch9.ms/ch9/053b/3496f324-dc88-4e1f-937f-e1a177fc053b/OD4BCustomizer_high.mp4) отображение решения на практике, включая описание структуры решения и как будет использовать его в среде Office 365 для изменения OneDrive для бизнеса сайтов.

<a name="related-links"></a>Ссылки по теме
=============
- [Настройка OneDrive для бизнеса фирменного стиля сайтов](Customization-Options-For-OD4B-Sites.md)
- Статьи, посвященные в [http://aka.ms/OfficeDevPnPGuidance] (http://aka.ms/OfficeDevPnPGuidance "Руководств")
- Справочные материалы в библиотеке MSDN по [http://aka.ms/OfficeDevPnPMSDN] (http://aka.ms/OfficeDevPnPMSDN "Справочные материалы в библиотеке MSDN")
- Видеозаписи по [http://aka.ms/OfficeDevPnPVideos] (http://aka.ms/OfficeDevPnPVideos "видео")

<a name="related-pnp-samples"></a>Примеры связанных с ними PnP
===================

- [OD4B. Configuration.Async (O365 PnP образец)](https://github.com/SharePoint/PnP/tree/master/Solutions/OD4B.Configuration.Async)
- [Provisioning.OneDriveProvisioning (O365 PnP образец)](https://github.com/SharePoint/PnP/tree/master/Samples/Provisioning.OneDriveProvisioning)
- [Компонент основной PnP Office](https://github.com/SharePoint/PnP-Sites-Core/tree/master/Core)
- Примеры и контентhttps://github.com/SharePoint/PnP

<a name="applies-to"></a>Применимо к
==========
- Office 365 нескольких клиентов (MT)
- Office 365 выделенных (D) *частично*
- SharePoint 2013 в локальной — *частично*

*Шаблоны для выделенных и локальной идентичны с помощью надстройки SharePoint методики модели, но возможных технологий, которые могут использоваться отличаются.*
