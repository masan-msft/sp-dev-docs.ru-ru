---
title: "Настройки поиска для SharePoint"
ms.date: 11/03/2017
ms.openlocfilehash: c8afb3e0589e65e100ca3512926e931e966e510a
ms.sourcegitcommit: 65e885f547ca9055617fe0871a13c7fc85086032
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/06/2017
---
# <a name="search-customizations-for-sharepoint"></a>Настройки поиска для SharePoint

Создание настраиваемого SharePoint 2013 и SharePoint Online сценарии поиска с помощью каталога сайтов на основе поиска, персонализированные поиска или поиска конфигурации мобильности. 

_**Применимо к:** Office 365 | SharePoint 2013 | Надстройки SharePoint | SharePoint Online_

## <a name="search-based-site-directory"></a>Каталог сайтов на основе поиска

Поиск SharePoint позволяет создавать каталог сайтов на основе поиска без какого-либо пользовательского кода. 

Создание каталога сайтов:

1. Создайте сайт каталога шаблонов отображения.
    
2. Определите тип результата каталога сайтов.
    
3. Создание страницы результатов.
    
4. Изменение свойств веб-части результатов.
    
Чтобы создать сайт каталога шаблонов отображения:

**Примечание:**  В этой процедуре используются шаблоны отображения, связанные с сайта без изменений. Если вы хотите изменить способ отображения результатов каталог сайтов, изменять шаблоны отображения, созданные вами.

1. Откройте сопоставление сетевого диска **Коллекции главных страниц**. Дополнительные сведения можно [как: сопоставление сетевого диска коллекции главных страниц SharePoint 2013](http://msdn.microsoft.com/en-us/library/office/jj733519%28v=office.15%29.aspx).
    
2. Сделайте копии шаблона отображения HTML-файлы, которые лучше сопоставить вы пытаетесь выполнить. Для сценария, каталог сайтов это будет Item_Site.html и Item_Site_HoverPanel.html. Оба файла располагаются в `\Display Templates\Search` папки в сопоставление сетевого диска.
    
3. Переименование копии, которые вы внесли файлов Item_SiteDirectory.html и Item_SiteDirectory_HoverPanel.html, как показано.
    
    **На рисунке 1. Шаблоны отображения каталога сайтов**

    ![Шаблоны отображения каталога сайтов](media/search-customizations-for-sharepoint/4c084d31-bad4-45f0-950b-ba214f9487f7.png)

4. Откройте файл Item_SiteDirectory.html и внесите следующие изменения:
    
    - Изменение `<title>` значение из «Узла элемента», «Каталог узлов» тега.
    
    - Изменение первого `<div>` тег после открывающего `<body>` тега из `<div id="Item_Site">` для `<div id="Item_SiteDirectory">`.
    
    - Изменение меняющейся панели JavaScript имя файла шаблона отображения из: `var hoverUrl = "~sitecollection/_catalogs/masterpage/Display Templates/Search/Item_Site_HoverPanel.js";`для:`var hoverUrl = "~sitecollection/_catalogs/masterpage/Display Templates/Search/Item_SiteDirectory_HoverPanel.js";`
    
5. Откройте файл Item_SiteDirectory_HoverPanel.html и внесите следующие изменения:
    
    - Изменение `<div>` следующий открывающий тег `<body>` тега из: `<title>Site Hover Panel Test</title>`для:`<title>Site Directory Hover Panel</title>`
    
    - Изменение `<title>` тега из: `<div id="Item_Site_HoverPanel">`для:`<div id="Item_SiteDirectory_HoverPanel">`
    
Чтобы определить тип результатов каталога сайта:

1. Последовательно выберите пункты **Параметры сайта** > **поиска** > **Типы результатов**, а затем выберите **Новый тип результата**.
    
2. Имя нового типа результата «Основные каталог сайтов».
    
3. В **как должны выглядеть эти результаты?** выберите **Каталога сайтов**.
    
    **На рисунке 2. Конфигурация сайта результатов**

    ![Пример конфигурации сайта результатов](media/search-customizations-for-sharepoint/4f42a7c4-326b-4508-b9a7-e030ef34cd33.png)

4. Выберите команду **Сохранить**.
    
Создание страницы результатов:

1. В меню **Параметры сайта** выберите **контент сайта**.
    
2. Выберите **страницы**.
    
3. Выберите **файлы**в библиотеке **страниц**  > **Новый документ** > **страницы**.
    
4. На странице " **Создание страницы** " укажите «Каталог сайтов» для **заголовка** и «каталог_сайтов» для **URL-имя**.
    
5. Нажмите кнопку **Создать**.
    
Чтобы изменить свойства веб-части результатов:

1. На странице **Каталога веб-сайтов** выберите **Параметры** > **Изменить страницу**.
    
2. В **Веб-части результатов поиска**выберите в меню **Веб-части** и выберите **Изменить веб-часть**.
    
    **На рисунке 3. Меню веб-части**

    ![Рис 3](media/search-customizations-for-sharepoint/1b01ac59-3bc1-42eb-a63d-61c2ad15cee4.png)

3. В области инструментов веб-части нажмите кнопку **Изменить запрос** , чтобы открыть построитель запросов.
    
4. В поле **текст запроса** введите следующие значения.`ContentClass:STS_Web OR ContentClass:STS_Site path:http://<YourServer>`
    
5. Подтвердите правильность синтаксиса выберите **Пробный запрос** . В области **Предварительного просмотра результатов поиска** должны отображать дочерних сайтов на сайте, выбранные для _пути_ в **тексте запроса**.
    
    **На рисунке 4. Построитель запросов веб-части результатов поиска**

    ![Построитель запросов части web результатов поиска](media/search-customizations-for-sharepoint/7b55c821-4772-4874-bbcb-c757e2723599.png)

6. Нажмите **кнопку ОК** , чтобы закрыть построитель запросов.
    
7. В области **Шаблоны отображения**выберите **типы результатов используется для отображения элементов**.
    
8. Выберите в раскрывающемся списке **тип результатов для элемента** **Базового каталога сайтов** .
    
9. В разделе **внешний вид** изменения **заголовка** «Сайты ли включить доступ».
    
10. Нажмите **кнопку ОК** , чтобы сохранить изменения в веб-часть закрыть панель инструментов веб-части. На следующем рисунке показан пример страницы каталога сайтов на основе поиска.
    
    **На рисунке 5. Пример каталога сайтов на основе поиска Contoso**

    ![Пример каталога сайтов на основе поиска Contoso](media/search-customizations-for-sharepoint/5d1317d5-2e82-4819-b5a4-5bb515898a7b.png)

## <a name="personalized-search-results"></a>Результаты поиска индивидуально настроенных

Показать результаты поиска, предназначенных для пользователя, отправившего запрос поиска при индивидуально настроенных поиска. В этом разделе описываются некоторые сценарии для настраиваемого поиска и как их можно реализовать.

### <a name="your-news-scenario"></a>Новости сценария

В этом сценарии создания надстройки поиска, который отображает соответствующий контент, например новости и события, предназначенных для пользователя.

**На рисунке 6. Новости сценария настраиваемого поиска**

![Новости сценария настраиваемого поиска](media/search-customizations-for-sharepoint/188af4d1-b8bb-4212-bfdb-c29a13f30286.png)

Для реализации сценария новости, используйте веб-части результатов поиска SharePoint и шаблоны для отображения по умолчанию для отображения информации новости, включая заголовок, описание и отображаемое изображение. Отображение первых 10 элементов новостей. При выборе пользователем отображаемое изображение, заголовок или чтение более ссылки, загружается страница статьи новостей.

Кроме того можно создать поиска надстройки с помощью запроса API (CSOM или REST). Можно сделать номер новостей для отображения настраивается с помощью свойства поиска надстройки.

Другая возможность — это использовать API запросов для добавления запроса кода API, которое извлекает непосредственно для макета страницы результатов поиска.

Чтобы отобразить новости и события сведения, относящиеся к пользователю:

1. Измените запрос для фильтрации результатов новости и события на основе свойств профиля пользователя как бизнес-единицы, региона и языка.
    
2. Извлечь заголовок, описание, отображаемое изображение и свойства URL-адрес для элементов, новостей и событий.
    
3. Реализация логики сортировки объединенный новости и события на основе свойства **Дата последнего изменения** .

### <a name="upcoming-events-scenario"></a>Сценарий Предстоящие мероприятия

В этом сценарии надстройка поиска отображает соответствующие события, нацелено на пользователя.

**На рисунке 7. Предстоящие события сценария настраиваемого поиска**

![Предстоящие события сценария настраиваемого поиска](media/search-customizations-for-sharepoint/35afac63-b4e9-4d94-abc1-a5fa11cc2dbf.png)

Чтобы реализовать этот сценарий, можно настроить веб-части, чтобы изменить запрос для извлечения сведений о предстоящих событиях только результаты поиска SharePoint. Чтобы сделать это, укажите `ContentClass:STS_ListItem_Events` для текста запроса в веб-части. Чтобы изменить способ отображения результатов события, создайте пользовательское отображаемое шаблоны для отображения сведений о событиях.

Можно изменить шаблон отображения элемента, чтобы при выборе пользователем изображения, заголовок или чтение более ссылки, загрузки страницы данные события. Можно также изменить шаблон отображения элемента управления, чтобы при выборе **Более видеть**, Далее результаты 10 событий отображаются в веб-части.

Можно также создать надстройки поиска, которая используется для получения даже результаты запроса API. Можно настроить надстройки поиска для отображения по умолчанию только 10 последних предстоящие события, этот параметр настраивается через свойства поиска надстройки. 

### <a name="featured-news-scenario"></a>Основные новости сценария

В этом сценарии в поиска показаны результаты поиска, как основные содержимое, предназначенное для пользователей в местах, такие как корпоративной интрасети и подразделений целевые страницы. Вы можете реализовать с частью надстройки, которая содержит подключаемый модуль jQuery с HTML, которое использует службы поиска REST или запроса CSOM для получения результатов поиска из SharePoint и отобразить результаты.

### <a name="code-sample-for-personalized-search"></a>Пример кода для настраиваемого поиска

[SharePoint 2013: результатов поиска в личные настройки в SharePoint Add-in](http://code.msdn.microsoft.com/SharePoint-2013-Personalizi-fb6ddcf9) приведен пример базового поиска и индивидуально настроенных результатов, использующего запрос поиска CSOM. Пример базового поиска позволяет пользователю предоставлять поисковый фильтр для поиска на уровне клиента. Сайты выполняется на этот фильтр пользовательские основе.

В примере сначала возвращается контекста SharePoint с помощью класса **SharePointContextProvider** .

```
var spContext = SharePointContextProvider.Current.GetSharePointContext(Context);
```

Затем создает запрос, основанный на ввод пользователя. Ограничивает запрос для семейств веб-сайтов и затем вызывает метод **ProcessQuery** , передав контекст и запроса в вызове метода. Он возвращает результаты **ProcessQuery** в результате таблицы, который затем анализируется с помощью метода **FormatResults** .

```
using (var clientContext = spContext.CreateUserClientContextForSPHost())
{
    string query = searchtext.Text + " contentclass:\"STS_Site\"";
    ClientResult<ResultTableCollection> results = ProcessQuery(clientContext, query);
    lblStatus1.Text = FormatResults(results);
}
```

Метод **ProcessQuery** создает **KeywordQuery** объект, представляющий поисковый запрос.

```
KeywordQuery keywordQuery = new KeywordQuery(ctx);
keywordQuery.QueryText = keywordQueryValue;
keywordQuery.RowLimit = 500;
keywordQuery.StartRow = 0;
keywordQuery.SelectProperties.Add("Title");
keywordQuery.SelectProperties.Add("SPSiteUrl");
keywordQuery.SelectProperties.Add("Description");
keywordQuery.SelectProperties.Add("WebTemplate");
keywordQuery.SortList.Add("SPSiteUrl", Microsoft.SharePoint.Client.Search.Query.SortDirection.Ascending);
```

Затем в поисковый запрос отправляется SharePoint путем вызова метода **ExecuteQuery_Client(Query)** . Результаты передаются в **ClientResult < T&gt; ** объектов.

```
SearchExecutor searchExec = new SearchExecutor(ctx);
ClientResult<ResultTableCollection> results = searchExec.ExecuteQuery(keywordQuery);
ctx.ExecuteQuery();
```

Метод **FormatResults** выполняется итерация по результатам и создает HTML-таблицы для отображения значений результатов.

```
string responseHtml = "<h3>Results</h3>";
responseHtml += "<table>";
responseHtml += "<tr><th>Title</th><th>Site URL</th><th>Description</th><th>Template</th></tr>";
if (results.Value[0].RowCount > 0)
{
 foreach (var row in results.Value[0].ResultRows)
 {
   responseHtml += "<tr>";
   responseHtml += string.Format("<td>{0}</td>", row["Title"] != null ? row["Title"].ToString() : "");
   responseHtml += string.Format("<td>{0}</td>", row["SPSiteUrl"] != null ? row["SPSiteUrl"].ToString() : "");
   responseHtml += string.Format("<td>{0}</td>", row["Description"] != null ? row["Description"].ToString() : "");
   responseHtml += string.Format("<td>{0}</td>", row["WebTemplate"] != null ? row["WebTemplate"].ToString() : "");
   responseHtml += "</tr>";
 }
}
responseHtml += "</table>";
```

Метод **ResolveAdditionalFilter** проверяет «Apptest». Если он найден, список шаблонов сайтов любого типа возвращается в результатах поиска. Если он не найден, только службы маркеров безопасности веб-шаблоны возвращаются в результатах поиска.

```
private string ResolveAdditionalFilter(string aboutMeValue)
{
    if (!aboutMeValue.Contains("AppTest"))
    {
        return "WebTemplate=STS";
    }
    return "";
}
```

Затем создает запрос и вызывает методы **ProcessQuery** и **FormatResults** для извлечения, формат и отображения результатов поиска.

```
string query = "contentclass:\"STS_Site\" " + templateFilter;
ClientResult<ResultTableCollection> results = ProcessQuery(clientContext, query);
lblStatus2.Text = FormatResults(results);
```

Вы можете увидеть пользовательского интерфейса в данном примере на следующем рисунке.

**На рисунке 8. Пример результатов поиска индивидуально настроенных пользовательского интерфейса**

![Пример результатов поиска индивидуально настроенных пользовательского интерфейса](media/search-customizations-for-sharepoint/8e1c412b-71a7-42e2-b9f3-b7d045df3bde.png)

## <a name="search-configuration-portability"></a>Переносимость конфигурации поиска

В SharePoint 2013 и SharePoint Online можно экспортировать и импортировать параметров конфигурации настраиваемого поиска между сайтов и семейств сайтов. Можно экспортировать только параметров конфигурации настраиваемого поиска на уровне приложения (SSA) службы поиска и вам следует использовать API-интерфейсы поиска для этого программными средствами. Параметр экспорта недоступен в Интерфейсе пользователя SharePoint.

[SharePoint 2013: Импорт и экспорт параметры поиска для SharePoint Online](http://code.msdn.microsoft.com/SharePoint-2013-Import-and-6287b5ac) пример показано, как импортировать и экспортировать параметры поиска для сайта SharePoint Online с помощью CSOM поиска в консольное приложение.

### <a name="configuration-settings-that-are-portable"></a>Параметры конфигурации, которые можно переносить

При экспорте параметров конфигурации настраиваемого поиска SharePoint 2013 создает файл конфигурации поиска в формате XML. Этот файл конфигурации поиска включает в себя все параметры конфигурации экспортируемый настраиваемого поиска на SSA, семейства веб-сайтов или уровне сайтов, из которой начать экспорт. Файл конфигурации поиска для семейства веб-сайтов не содержит параметров конфигурации поиска из отдельных сайтов в пределах семейства веб-сайтов.

При импорте файла конфигурации поиска SharePoint 2013 создает и включает каждый параметр конфигурации настраиваемого поиска в семейства веб-сайтов или сайта, с которой начать импорт.

В таблице 1 перечислены параметры, которые можно экспортировать и импортировать, а также любые зависимости от других параметров конфигурации настраиваемого поиска. Параметров конфигурации настраиваемого поиска зависит от параметр конфигурации настраиваемого поиска на другом уровне, необходимо экспортировать и импортировать параметры все соответствующие уровни.

**В таблице 1. Параметры поиска, которые можно экспортировать и импортировать**

|**Параметр конфигурации**|**Зависимости**|
|:-----|:-----|
|Правила запросов, включая blocs результатов, результатов повышенного уровня и сегменты пользователей|Источники результатов, типы результатов, схема поиска, модель ранжирования|
|Источники результатов|Схема поиска|
|Типы результатов|Схема поиска, источники результатов, шаблоны отображения|
|Схема поиска|Нет|
|Модель ранжирования|Схема поиска|

Можно экспорт параметров конфигурации настраиваемого поиска из SSA и импорта параметров для сайтов и семейств веб-сайтов. Однако нельзя импортировать параметров конфигурации настраиваемого поиска для SSA. Невозможно экспортировать параметры конфигурации поиска по умолчанию.

На сайте или уровне семейства сайтов можно экспортировать или импорта параметров конфигурации поиска с помощью пользовательского интерфейса SharePoint. Эти параметры находятся в разделе " **Поиск** " на странице **Параметры сайта** .

**Параметры веб - поиска**

![Параметры веб - поиска](media/search-customizations-for-sharepoint/ada14bf4-d721-4974-ad50-a1f8ce01933f.png)

Эти параметры также доступны в разделе **Администрирование семейства веб-сайтов** . Кроме того можно программно импорта и экспорта эти параметры с помощью CSOM поиска SharePoint 2013.

### <a name="search-configuration-files"></a>Файлы конфигурации поиска

В следующей таблице перечислены файлы схемы, которые поддерживают конфигурации поиска. Сведения о формате схемы см [общий ресурс поиска параметры мобильности схемы](http://msdn.microsoft.com/en-us/library/office/dn627953%28v=office.15%29.aspx).

**Примечание:**  Файлы схемы можно загрузить из [http://download.microsoft.com/download/1/2/2/12204CDE-56A6-4B2F-9719-4EA25FDA7743/SP15_search_settings_portability_schema.zip](http://download.microsoft.com/download/1/2/2/12204CDE-56A6-4B2F-9719-4EA25FDA7743/SP15_search_settings_portability_schema.zip). 

**В таблице 2. Переносимость схем параметры поиска**

|**Схемы**|**Описание**|
|:-----|:-----|
|[SPS15XSDSearchSet1](http://msdn.microsoft.com/en-us/library/office/dn639116%28v=office.15%29.aspx)|Задает XML, представляющий источники результатов.|
|[SPS15XSDSearchSet2](http://msdn.microsoft.com/en-us/library/office/dn639118%28v=office.15%29.aspx)|Задает XML, представляющий административные типы и члены для управления к экземпляру поиска SSA. Включает параметры правила свойства и типы элементов результатов.|
|[SPS15XSDSearchSet3](http://msdn.microsoft.com/en-us/library/office/dn639120%28v=office.15%29.aspx)|Задает XML, представляющий параметры, которые включают правила запросов, источники результатов, управляемых свойств, свойств для обхода и моделей ранжирования.|
|[SPS15XSDSearchSet4](http://msdn.microsoft.com/en-us/library/office/dn639117%28v=office.15%29.aspx)|Задает XML, представляющий перечисления, используемые в другие схемы.|
|[SPS15XSDSearchSet5](http://msdn.microsoft.com/en-us/library/office/dn639119%28v=office.15%29.aspx)|Задает XML, представляющий перечисления как **ResultType** , используемые в другие схемы.|
|[SPS15XSDSearchSet6](http://msdn.microsoft.com/en-us/library/office/dn639115%28v=office.15%29.aspx)|Задает XML, представляющий перечисления, используемые в схеме **Microsoft.Office.Server.Search.Administration** .|

### <a name="using-csom-to-port-configuration-settings"></a>С помощью CSOM к параметрам конфигурации порта

CSOM API, которые необходимы для импорта и экспорта параметров конфигурации поиска находятся в **SearchConfigurationPortability** классов в пространстве имен **Microsoft.SharePoint.Client.Search.Portability** .

В следующем примере кода показано, как для экспорта параметров конфигурации поиска с сайта.

```
private static void ExportSearchSettings(ClientContext context, string settingsFile)
{
   SearchConfigurationPortability sconfig = new SearchConfigurationPortability(context);
   SearchObjectOwner owner = new SearchObjectOwner(context, SearchObjectLevel.SPWeb);
   ClientResult<string> configresults = sconfig.ExportSearchConfiguration(owner);
   context.ExecuteQuery();
   string results = configresults.Value;
   System.IO.File.WriteAllText(settingsFile, results);
}
```

Следующий код демонстрирует Импорт параметров конфигурации поиска с сайта.

```
private static void ImportSearchSettings(ClientContext context, string settingsFile)
{
   SearchConfigurationPortability sconfig = new SearchConfigurationPortability(context);
   SearchObjectOwner owner = new SearchObjectOwner(context, SearchObjectLevel.SPWeb);
   sconfig.ImportSearchConfiguration(owner, System.IO.File.ReadAllText(settingsFile));
   context.ExecuteQuery();            
}
```

## <a name="additional-resources"></a>Дополнительные ресурсы
<a name="bk_addresources"> </a>

- [Решения для поиска в SharePoint 2013 и SharePoint Online](search-solutions-in-sharepoint-2013-and-sharepoint-online.md)
    
- [SharePoint 2013: Импорт и экспорт параметры поиска для SharePoint Online](http://code.msdn.microsoft.com/SharePoint-2013-Import-and-6287b5ac)
    
- [SharePoint 2013: Настройка поиска результатов в SharePoint Add-in](http://code.msdn.microsoft.com/SharePoint-2013-Personalizi-fb6ddcf9)
