---
title: "Повышенными привилегиями в SharePoint надстройки"
ms.date: 11/03/2017
ms.openlocfilehash: 1408ea8317d59a9e1408a2e7ebd1b88946cf0042
ms.sourcegitcommit: 0a94e0c600db24a1b5bf5895e6d3d9681bf7c810
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/07/2017
---
# <a name="elevated-privileges-in-sharepoint-add-ins"></a>Повышенными привилегиями в SharePoint надстройки

Повысить уровень привилегий в SharePoint надстройки с помощью политики только для приложений или учетные записи служб.

_**Применимо к:** приложений для SharePoint | SharePoint 2013 | Надстройки SharePoint | SharePoint Online_

Повысить уровень привилегий в решениях SharePoint надстройки и фермы используются различные методы. Решения фермы повышать привилегии с помощью RunWithElevatedPrivileges(SPSecurity.CodeToRunElevated), которому принадлежит к модели объектов на сервере SharePoint. Надстройки SharePoint использовать политики только для приложений или учетные записи служб.

Может потребоваться использовать повышенными привилегиями в надстройке при:

* Надстройка выполняет действия для пользователей, которые пользователи не имеют достаточное количество отдельных разрешений для выполнения. Администраторы могут не назначить пользователям определенные разрешения из-за слишком высокого уровня разрешений.

   Вашей организации, например реализовать решения, пользователи должны использовать для создания семейств веб-сайтов по подготовке семейства настраиваемых веб-сайтов. Организации могут указать, что все новые семейства сайтов должен иметь определенные списки, типы контента или поля, связанные с ними. Если пользователи создают семейство сайтов на свое усмотрение, они могут или может не забудьте для создания этих объектов на его нового семейства сайтов. В этом сценарии пользователи создают семейство сайтов с помощью надстройки, но пользователям не назначены разрешения на создание семейств веб-сайтов по отдельности.

* Надстройка не выполняется от имени любого пользователя; Например, для управления или управление процесс.

## <a name="app-only-policy-authorization"></a>Авторизация политики только для приложений

Политика только для приложений использует OAuth для проверки подлинности надстройки. Когда надстройки используется политика только для приложений, SharePoint проверяет разрешения надстройка субъекта только. Это разрешений, предоставленных для надстройки. Авторизация выполняется успешно, если надстройка имеет достаточные разрешения для выполнения задач, вне зависимости от разрешений, связанный с текущим пользователем. После успешного выполнения авторизации для добавления в возвращается маркер доступа. Добавьте в будет использовать этот маркер доступа для выполнения любых операций, необходимые для вашего кода.

Для получения дополнительных сведений см [типы политик авторизации приложений в SharePoint 2013](https://msdn.microsoft.com/library/office/fp179892.aspx).

> [!NOTE] 
> Политика только для приложений доступен только для провайдера надстройками SharePoint хостингом надстроек, что доступ к хост-сети необходимо использовать для пользователя и политики приложения.

Преимущества использования политики только для приложений в вашей надстройки include:

* Необходимо предоставить отдельный пользовательской лицензии. Учетные записи служб требуются отдельные пользовательской лицензии.

* Получить более детальный контроль над разрешениями, чем доступно с помощью учетных записей служб. Например могут применять разрешения на полный доступ на веб-узел, который не возможно при использовании учетных записей служб.

Политика только для приложений нельзя использовать вместе с следующие интерфейсы API:

* Профиль пользователя

* Поиск

* Таксономия (применяется только к сценариям, которые ведут к службе управляемых метаданных)

Чтобы использовать политики только для приложений, сначала необходимо предоставить разрешения для надстройки с помощью appinv.aspx. Следующий код из файла AppManifest.xml показано, как установить разрешения для добавления в и политики только для приложений.

```xml
 <AppPermissionRequests AllowAppOnlyPolicy="true">
   <AppPermissionRequest Scope="http://sharepoint/content/sitecollection/web" Right="FullControl" />
 </AppPermissionRequests>
```

С помощью политики только для приложений необходимо добавить в использовать авторизации низким или высоким уровнем доверия. Политика не может применяться к междоменной библиотеки JavaScript SharePoint, которая предоставляет третий способ получения авторизованный доступ к ресурсам SharePoint.

### <a name="low-trust-authorization"></a>Авторизации с низким уровнем доверия

Добавьте в можно использовать авторизации с низким уровнем доверия, при использовании Microsoft Azure Access Control Service (ACS) для установления отношения доверия между надстройка размещением у поставщика и узла Office 365 или в локальной ферме SharePoint. Дополнительные сведения по [три системы авторизации для SharePoint 2013 надстройки](https://msdn.microsoft.com/en-us/library/office/dn790706.aspx). Чтобы получить ссылку на объект [ClientContext](https://msdn.microsoft.com/en-us/library/office/microsoft.sharepoint.client.clientcontext.aspx) , добавьте в выполнить следующие действия:

1. Получите маркер доступа с помощью TokenHelper.GetAppOnlyAccessToken.

2. Используйте TokenHelper.GetClientContextWithAccessToken, чтобы получить объект ClientContext.

> [!NOTE] 
> Файл TokenHelper является исходный код, созданное инструменты разработчика Microsoft Office для Visual Studio. Нет справочной документации по его не, но есть широкое комментарии в класс TokenHelper. Чтобы просмотреть комментарии в коде, создания у поставщика надстройки в Visual Studio.

> [!NOTE] 
> он кода в этой статье предоставляется-без никаких гарантий, явных или подразумеваемых, включая никаких гарантий соответствие для определенной задачи, окупаемость или не нарушения прав.

```cs
Uri siteUrl = new Uri(ConfigurationManager.AppSettings["MySiteUrl"]);
try
{
    // Connect to a site using an app-only token.
    string realm = TokenHelper.GetRealmFromTargetUrl(siteUrl);
    var token = TokenHelper.GetAppOnlyAccessToken(TokenHelper.SharePointPrincipal, siteUrl.Authority, realm).AccessToken;

    using (var ctx = TokenHelper.GetClientContextWithAccessToken(siteUrl.ToString(), token))
    {
        // Perform operations on the ClientContext object, which uses the app-only token. 
    }
}
catch (Exception ex)
{
    Console.WriteLine("Error in execution: " + ex.Message);
}
```

### <a name="high-trust-authorization"></a>Авторизации с высоким уровнем доверия

Если надстройка использует системы авторизации с высоким уровнем доверия (также известной как протокол S2S), он вызывает другой метод **TokenHelper** : **TokenHelper.GetS2SAccessTokenWithWindowsIdentity**.

**Важные:** **TokenHelper.GetS2SAccessTokenWithWindowsIdentity** используется для них только для приложений и вызывает для пользователя и приложения. Второй параметр метод, который содержит удостоверение пользователя, определяет, какая политика используется. Передайте **значение null,** чтобы с помощью политики только для приложений.

## <a name="service-accounts"></a>Учетные записи служб

Используйте учетные записи служб повысить уровень привилегий для добавления в только в том случае, если политика только для приложений не предоставляет достаточные разрешения на выполнение задачи. Кроме того в некоторых сценариях учетная запись пользователя является обязательным. Например необходимо использовать учетные записи служб, когда код работает с любой из следующих приложений-служб SharePoint:

* Служба профилей пользователей с помощью клиентской объектной модели (CSOM)

* Служба управляемых метаданных

* Поиск

При планировании использования учетных записей служб в надстройке, необходимо учитывайте следующее:

* Учетные записи служб требуются отдельные пользовательской лицензии.

* Создайте либо одну учетную запись службы каждого надстройки или используйте одну учетную запись службы для всех надстроек в среде SharePoint.

* Во время проверки подлинности необходимо указать имя пользователя и пароль. Убедитесь, учетные данные учетной записи службы, хранятся или безопасно извлечен.

* Прежде чем добавлять в можно выполнить действие на сайте, учетные записи служб сначала необходимо предоставить разрешение для доступа к сайту.

> [!NOTE] 
> Надстройки, приобретенных у магазина Office нельзя использовать учетные записи служб.

Ниже показано, как выполнить проверку подлинности с помощью [SharePointOnlineCredentials](https://msdn.microsoft.com/en-us/library/office/microsoft.sharepoint.client.sharepointonlinecredentials.aspx) с учетной записью службы.

```cs
using (ClientContext context = new ClientContext("https://contoso.sharepoint.com"))
{

    // Use default authentication mode.
    context.AuthenticationMode = ClientAuthenticationMode.Default;  

    // Specify the credentials for the service account.
    context.Credentials = new SharePointOnlineCredentials("User Name", "Password");
}
```

## <a name="see-also"></a>См. также

- [Office 365 development шаблоны и рекомендации руководство по решениям](Office-365-development-patterns-and-practices-solution-guidance.md).
- [Add-in типы политик авторизации в SharePoint 2013](https://msdn.microsoft.com/en-us/library/office/fp179892.aspx).
- [Использовать сайт Office 365 SharePoint для авторизации у поставщика надстройки на сайте SharePoint в локальной](https://msdn.microsoft.com/en-us/library/office/dn155905.aspx).
