# <a name="alternative-model-for-web-app-policies-in-sharepoint-online"></a>Альтернативная модель для политик web app в SharePoint Online

Политики в отношении приложений Web — это понятие, который администраторы SharePoint могут предоставить или запретить разрешения для пользователей и групп для всех сайтов внутри веб-приложения. Эти разрешения предоставляет и не дает предпочтений взять за разрешения, установленные на сайтах в веб-приложении, таким образом механизм, обычно используется в сценариях следующие:
 - Разрешение учетной записи службы ко всем сайтам, так как эту учетную запись службы используется для запуска в фоновом режиме, необходимые для работы с данными на всех сайтах. Учетная запись службы можно также использовать рабочим процессом для достижения в SharePoint
 - Предоставить поддержку группы доступ только для чтения ко всем сайтам, чтобы сотрудник службы поддержки можно просматривать на сайте с конечным пользователем
 - Запретить доступ пользователей (например, после выхода из компании) ко всему контенту

Политики веб-приложений больше не существует в SharePoint Online и отсутствует идентичные альтернативный реализация возможно, но с помощью существующей модели безопасности SharePoint можно получить такой же результат. В этой статье и видео вы узнаете о дополнительных сведений.

> [!Video https://www.youtube.com/embed/zcmngkgQdTU]

## <a name="granting-access"></a>Предоставление доступа

### <a name="whats-the-business-reason-for-this-permission-grant"></a>Что такое бизнес причина этой разрешений, предоставленных?
Перед началом работы для реализации предоставляет разрешения важно понять, почему требовалось grant. Вопросы себя являются:
 - Предоставляет доступ ко **всем** данным в SharePoint Online необходимо клиенту? Push-обратно и убедитесь, что доступ ко **всем** данным, что абсолютный необходимо для поддержки бизнес-сценарий
 - — Это «один» с помощью разрешения, предоставленные приложения или пользователя? Если это приложение затем могут быть доступны для работы с субъект приложения с SharePoint Online клиентов широкий разрешения, особенно в том случае, если это приложение свои внутренние разработанных

Ниже блок-схема записываемых ответы на следующие вопросы:

![Блок-схема, отражающая логику для определения приложения только политики или нет](media/webapppolicies/flowchart1.png)

> [!IMPORTANT]
>Только в случае предоставления доступа будет использоваться пользователем или приложение, которое несовместимо с участников приложения должен предоставить доступ через пользователей или групп. Если это возможно так как ниже приведена участников приложения над пользователей и групп:
> - Участников приложения предоставляются с областью действия всех сайтов, то есть если участника приложения автоматически имеет доступ к нему также получает добавлен сайта. В случае доступа пользователя или группы соответствующих пользователей или группы сначала необходимо добавить для нового веб-сайта
> - Участников приложения «переопределить» параметр наследование разрешений. Предположим, что веб-узла нарушено наследование разрешений и таким образом предоставление владельцем пользователя или группы, contribute или просмотр доступа к корневому сайту предоставить доступ к веб-узла при участника приложения всегда получают доступ.

### <a name="granting-access-using-app-principals"></a>Предоставление доступа с помощью участников приложения
Для всех доступа не человека рекомендуется использовать участников приложения, как описано выше. Существует два подхода к таким образом: 
 - С помощью приложения Azure AD: этот метод является предпочтительным при использовании SharePoint Online, так как вы также можете предоставить разрешения на другие службы Office 365 (при необходимости) + был добавлен пользовательский интерфейс (портала управления Azure) для поддержки участников вашего приложения.
 - С помощью участник только для приложений SharePoint: этот метод работе старых и только для доступа к SharePoint, но по-прежнему относится. Этот метод также является рекомендованной моделью при по-прежнему работе в SharePoint в локальной с момента работает эту модель в SharePoint в локальной как SharePoint Online.

Обе модели подробно рассмотрены в статье [доступ к SharePoint с помощью контекст приложения, также известной как доступный только для приложений](https://docs.microsoft.com/en-us/sharepoint/dev/solution-guidance/security-apponly) .

### <a name="granting-access-via-users-and-groups"></a>Предоставление доступа с помощью пользователей и групп
Если вы хотите предоставить доступ ко всем сайтам вам потребуется предоставить пользователь или группа доступа ко всем сайтам по отдельности. В этой модели, отличается от позволяет иметь с политиками веб-приложения, но это единственный модели, которые можно использовать для предоставления пользователю учетную запись или группу доступ ко всем сайтам. 

#### <a name="permissions-that-can-be-granted"></a>Разрешения, которые могут быть предоставлены
С помощью политик web app, был добавлен параметр либо предоставление «Полный доступ» или «Полное чтение», которая преобразуется в разрешений SharePoint сводится к это:

|**Предоставление политики Web App**|**Эквивалентный разрешений SharePoint**|
|:-----|:-----|
| Полный доступ | Добавление администраторов семейства сайтов
| Полное чтение | Добавление с помощью уровень разрешений «Чтение» (= посетители сайта)
| | Добавление с помощью уровень разрешений «Полный доступ» (владельцы веб-сайтов (=)
| | Добавление с помощью уровня разрешений «Edit» (участники сайта (=)

Мы намеренно решил использовать роль администратора семейства сайтов для разрешения «Полный доступ», поскольку в этом случае мы избежать проблемы наследование разрешений. В SharePoint пользователи могут нарушение наследования разрешений и таким образом предоставить уникальные разрешения на объекты (например sub сайты, списки, элементы списков). Если например добавление пользователя в группу владельцев сайта семейства сайтов, которое было выполнено, затем этого пользователя будет не обладает разрешениями на объектов с уникальными разрешениями.

> [!IMPORTANT]
>Если бизнес-сценарий, который вы реализуете можно live с ограничениями наследование разрешений, затем можно использовать любой из описанных разрешений SharePoint. Если требуется гарантировать, что доступа к 100% по всему контенту, только хороший разрешений SharePoint является роль администратора семейства сайтов.

#### <a name="granting-by-adding-a-user-or-a-group"></a>Предоставление путем добавления пользователя или группы?
Тем же можно достичь, либо предоставление разрешений пользователю или группе, но у обеих моделей pro пользователя и его Кон

| |**Group**|**Пользователь**|
|:-----|:-----|:-----|
| Наглядности | Группа может содержать на или несколько учетных записей, обычно не видны в другой веб-сайтов Администраторы семейства сайтов | Всегда отображается учетной записи пользователя, несомненно о нем
| Обслуживание | Можно легко предоставить доступ путем добавления новых членов в группу | Новые элементы, которые необходимо добавить ко всем сайтам
| Защищены от повреждений | Группы можно защитить фактический учетные записи с доступ к (например юридических учетная запись) и другие «Администраторы» являются скорее всего удалить разрешения для группы | Полный прозрачность, другие администраторы могут быть более вероятно удалить «странные» пользователей из веб-узла

> [!IMPORTANT]
> Предоставление разрешений с помощью группы — это более гибкая модель.

#### <a name="what-about-modern-team-sites-aka-group-sites"></a>Как насчет современная сортировка сайты рабочих групп (известной как группы сайтов)?
Веб-сайтов современных групп, сайтов групп SharePoint, подключенных к группе Office 365. Эта группа Office 365 выступает в качестве центра модели для предоставления доступа ко всем службам на основе этой группы (например сайт SharePoint, почтовым ящиком Exchange, планировщик работы,...). Для таких сайтов имеется два варианта для предоставления доступа:
 - Добавление учетных записей пользователей (не группы) члены или владельцев группы Office 365, подключенные к сайту современных группы. Преимущества этого подхода — это разрешения, предоставленные применяется ко всем службам, которые эта группа используется, что при оценке политики в отношении приложений web это обычно не относится
 - Обрабатывать сайт современных группы как «обычный» веб-узел и предоставить разрешение, как описано в предыдущей главы

> [!IMPORTANT]
> Мы рекомендуем предоставление разрешений на уровне SharePoint, поэтому угроз сайтов современных группы как регулярные классический сайтов группы SharePoint. Такой подход выравнивает с политиками веб-приложений, которые предоставление.

#### <a name="granting-permissions-using-pnp-powershell"></a>Предоставление разрешений с помощью PnP PowerShell
Ниже сценарии отобразить легко предоставлять доступ через с помощью PnP PowerShell, и они могут быть достаточно начала данных для внедрения. Ниже сценарии не вступят в учетной записи следующее:
 - Get-PnPTenantSite в настоящее время не перечисление сайтов современных группы
 - Get-PnPTenantSite не является Multi-географически принять во внимание
 - Производительность не является оптимальной, так как сценарии выполняются последовательно, нет Запретить параллельное выполнение

Так как пользователи постоянно создания новых семейств сайтов важно для выполнения этих сценариев на регулярной основе оптимальным является размещение, как запланированная задача.

> [!IMPORTANT]
> Если клиент имеет много семейств веб-сайтов, подход, с помощью настраиваемых разработанных приложения является лучшим решением для вас.

##### <a name="full-control"></a>Полный доступ
Чтобы предоставить пользователям полный доступ для конкретных (или всех) сайтов SharePoint, можно использовать SharePoint PowerShell внесение к конечным пользователям администраторов семейства веб-сайтов из конечных веб-сайта (включая все). Это можно сделать с глобального администратора или администратора службы SharePoint.
Рекомендуется добавить доступ на основе по необходимости и нажмите Удалить. Например приведенный ниже сценарий назначает список администраторов для всех семейств веб-сайтов в клиент. В примере [SharePoint шаблоны и рекомендации (PnP) команд PowerShell](http://aka.ms/sppnp-powershell) чтобы сделать двух администраторов пользователей всех семейств веб-сайтов в клиента.

```PowerShell
# comma separated list of users and groups to be added
$adminAccounts = "admin1@contoso.onmicrosoft.com","admin21@contoso.onmicrosoft.com"

# Specify the tenant here
$tenant = "contoso"

# Note: This example assumes that you are managing your credentials in Windows as documented here:
# https://github.com/SharePoint/PnP-PowerShell/wiki/How-to-use-the-Windows-Credential-Manager-to-ease-authentication-with-PnP-PowerShell
write-host "Connecting to https://$($tenant)-admin.sharepoint.com"
Connect-PnPOnline -Url "https://$($tenant)-admin.sharepoint.com"


#Note: we are only fetching the root site collection and any site collection in the /sites path
#Update filters here accordingly to match your requirements
write-host "Getting list of site collections"
$sitecollections = Get-PnPTenantSite | where {($_.Url -like "*$($tenant).sharepoint.com/") -or ($_.Url -like "*$($tenant).sharepoint.com/sites/*")}
foreach($sitecollection in $sitecollections) {
    write-host "Adding administrators to $($sitecollection.Url)"
    Set-PnPTenantSite -Url $sitecollection.Url -Owners $adminAccounts
}
```

##### <a name="full-read"></a>Полное чтение
Чтобы предоставить пользователям полный чтение для конкретных (или всех) сайтов SharePoint, можно использовать SharePoint PowerShell для добавления к конечным пользователям для семейства веб-сайтов роль чтения. Это можно сделать с глобального администратора или администратора службы SharePoint.
Общие действия входит определение роли чтения SharePoint для семейства веб-сайтов или повторного использования имеющегося и затем назначение роли пользователей или групп. Чтобы использовать группы Azure AD, включая динамические члены для управления доступом к ресурсам обратитесь к: [Управление доступом к ресурсам с группами Azure Active Directory](https://docs.microsoft.com/en-us/azure/active-directory/active-directory-manage-groups#https%3A%2F%2Fchannel9.msdn.com%2FSeries%2FAzure-Active-Directory-Videos-Demos%2FAzure-AD--Introduction-to-Dynamic-Memberships-for-Groups%2Fplayer). В примере [SharePoint шаблоны и рекомендации (PnP) из команды PowerShell](http://aka.ms/sppnp-powershell) для создания новой роли чтения для всех семейств веб-сайтов в клиента.

```PowerShell
# Specify the tenant here
$tenant = "contoso"

# Note: This example assumes that you are managing your credentials in Windows as documented here:
# https://github.com/SharePoint/PnP-PowerShell/wiki/How-to-use-the-Windows-Credential-Manager-to-ease-authentication-with-PnP-PowerShell
write-host "Connecting to https://$($tenant)-admin.sharepoint.com"
Connect-PnPOnline -Url "https://$($tenant)-admin.sharepoint.com"

# Note: we are only fetching the root site collection and any site collection in the /sites/ path
# Update filters here accordingly to match your requirements
write-host "Getting list of site collections"
$sitecollections = Get-PnPTenantSite | where {($_.Url -like "*$($tenant).sharepoint.com/") -or ($_.Url -like "*$($tenant).sharepoint.com/sites/*")}
foreach($sitecollection in $sitecollections) {
    write-host "Set FullRead for MyGroup to $($sitecollection.Url)" 
    Connect-PnPOnline -Url $($sitecollection.Url)
    New-PnPGroup -Title 'FullReader' 
    Set-PnPGroupPermissions -Identity 'FullReader' -RemoveRole 'Full Control' -AddRole 'Read'
}
```

#### <a name="granting-permissions-using-a-custom-developed-application"></a>Предоставление разрешений с помощью настраиваемых разработанных приложения
Альтернативная модель для подход PowerShell является создание приложения фон, который перечисляет все семейства сайтов (включая сайты современных групп, OneDrive для бизнеса сайтов в подразделениях при использовании нескольких Geo), проверяет наличие необходимых пользователя или группы Access и, если не добавляет его. Архитектура такого приложения может быть сложнее, чем указанному ниже:
1. Начать с определение приложения в Azure AD, для которого настраивается только об использовании (см. «[Настройка приложения Azure AD для доступа только для приложений](https://docs.microsoft.com/en-us/sharepoint/dev/solution-guidance/security-apponly-azuread)») и предоставить ей права полного доступа на всех семейств веб-сайтов
2. Создание приложения C#, авторизует самого с помощью приложения Azure AD, который был определен на шаге 1 и выполняет итерацию всех семейств веб-сайтов (может включать OD4B семейств веб-сайтов) для добавления требуемых учетных записей и групп, если они не указан
3. C# выберите приложению требуется размещенных и на равные промежутки времени по расписанию. С использованием задания Azure web является хорошим модели для этого, но также можно осуществить путем запуска приложения как запланированная задача на сервере

![пользовательское приложение подход описано](media/webapppolicies/customapp1.png)

Как часть этого руководства мы создали приложение, чтобы приступить к работе с этим. Образец называется [Governance.EnsurePolicy](https://github.com/SharePoint/PnP/tree/master/Solutions/Governance.EnsurePolicy) и может быть в репозитории PnP SharePoint.

> [!NOTE]
> Этот сценарий может быть развернут далее в приложение, которое предоставляет условно и удаляет разрешения. Например сотрудники службы поддержки могут запрашивать доступ для конкретного сайта с помощью Создание элемента списка SharePoint, приложение видит это и предоставляет доступ для x... часов и удаляет разрешения более поздней версии. Это приложение также поддерживает журнал, содержащий, который был предоставлен доступ к сайта, а также время.

## <a name="denying-access"></a>Отказ в доступе
### <a name="replace-deny-all-policy-using-office-365-and-sharepoint-access-controls"></a>Замена запретить все политики, с помощью Office 365 и элементов управления доступа к SharePoint
Отсутствуют политики «Запретить все» в Office 365, а наш рекомендуется для управления разрешениями, с помощью политик управления доступом O365 SharePoint. Среда должна включать пользователей, приложений и устройств. Ниже описаны некоторые из этих политик управления доступом.

Чтобы заблокировать определенным пользователям доступ к ресурсам Office 365, SharePoint, включая выполните инструкции, указанные здесь: [Удаление предыдущих версий сотрудников с Office 365](https://support.office.com/en-us/article/Remove-a-former-employee-from-Office-365-44d96212-4d90-4027-9aa9-a95eddb367d1). Например, чтобы вырезать отключение доступа к сотрудник покидает организацию. Это можно сделать с помощью глобальный администратор или администратор управления пользователями с помощью центра администрирования Office 365 или сценарий с помощью PowerShell.

Чтобы ограничить внешний общий доступ, чтобы поставщики, клиенты или клиенты имеют доступ только к определенным ресурсам, следуйте рекомендациям в статье здесь: [Управление внешним общего доступа для среды SharePoint Online](https://support.office.com/en-us/article/Manage-external-sharing-for-your-SharePoint-Online-environment-c8a462eb-0723-4b0b-8d0a-70feafe4be85). Например можно настроить SharePoint Online сайта экстрасети, ориентированный на внешней совместной работы. 

Чтобы блокировать или разрешить общий доступ для внешних пользователей от определенных доменов на уровне семейства клиента или сайта, следуйте указаниям ниже: [ограниченных доменов, совместное использование в SharePoint Online и OneDrive для бизнеса](https://support.office.com/en-us/article/Restricted-domains-sharing-in-SharePoint-Online-and-OneDrive-for-Business-5d7589cd-0997-4a00-a2ba-2320ec49c4e9?ui=en-US&rs=en-US&ad=US). Например, чтобы предоставить общий доступ для только определенных деловых партнеров в известном доменов. Это можно настроить глобальный администратор или администратор службы SharePoint. 

С помощью безопасности Office 365 и центре соответствия требованиям можно использовать функции аудит отслеживать активность файла. Дополнительные сведения со следующими статьями: 
 - Аудит всех вашей семейств сайтов SharePoint с помощью центра Office 365 безопасность и соответствие требованиям: [поиска журнала аудита в Office 365 безопасности & центре соответствия требованиям](https://support.office.com/en-us/article/Search-the-audit-log-in-the-Office-365-Security-Compliance-Center-0d4d0f35-390b-4518-800e-0c7ec95e946c?ui=en-US&rs=en-US&ad=US). Такой подход позволяет вести аудит всех сайтов, гибкой модели отчетов и его можно использовать [API's настраиваемой обработки данных аудита](https://msdn.microsoft.com/en-us/office-365/office-365-management-activity-api-reference).
 - Использование [Безопасности Office 365 облаке приложения](https://support.office.com/en-us/article/Overview-of-Office-365-Cloud-App-Security-81f0ee9a-9645-45ab-ba56-de9cbccab475): приложения облаке Безопасность в Office 365 предоставляет вам понимание подозрительные действия в Office 365, могут исследовать ситуаций, которые являются проблемы и при необходимости выполнять действия по устранению проблем безопасности. С Office 365 облачных приложений безопасности выполните следующие действия.
    - Узнайте, как получить доступ и использовать данных организации в Office 365
    - Определение политик, которые активируют оповещений для необычных или подозрительные операций
    - Приостановка ящиков подозрительные действия учетных записей пользователей
    - Необходимо войти в Office 365 приложениям запускаться оповещение

С помощью безопасности Office 365 и центре соответствия требованиям, также можно заблокировать внешних совместное использование конфиденциальных документов путем определения типов конфиденциальной, находящихся в вашей организации (выберите один из многих шаблонов или создать собственные настраиваемые типы конфиденциальной). Типы встроенных конфиденциальных здесь: типы конфиденциальной информации. Сведения о создании собственного здесь: [Создание конфиденциальные сведения нестандартные](https://support.office.com/en-us/article/Create-a-custom-sensitive-information-type-82c382a5-b6db-44fd-995d-b333b3c7fc30). 

Чтобы использовать группы Azure AD, включая динамические члены для управления доступом к ресурсам обратитесь к: [Управление доступом к ресурсам с группами Azure Active Directory](https://docs.microsoft.com/en-us/azure/active-directory/active-directory-manage-groups#https%3A%2F%2Fchannel9.msdn.com%2FSeries%2FAzure-Active-Directory-Videos-Demos%2FAzure-AD--Introduction-to-Dynamic-Memberships-for-Groups%2Fplayer). Например группы можно настроить для удаления членов, учетную запись которого не включен. Кроме того, [Azure Active Directory удостоверения защиты](https://docs.microsoft.com/en-us/azure/active-directory/active-directory-identityprotection) (часть Azure AD Premium) позволяет администраторам определить рискованный войти в систему и либо заблокировать или требуют многофакторной проверки подлинности.

Для блокировки или ограничение доступа на устройствах несовместимым или неуправляемые функциональные возможности в ближайшее время которого используются преимущества [политик условного доступа Azure Active Directory](https://docs.microsoft.com/en-us/azure/active-directory/active-directory-conditional-access-azure-portal). С помощью этой политики, можно заблокируйте доступ к расширенным приложений на устройствах неуправляемые и разрешить доступ только браузера без возможности для загрузки, печатать или синхронизации. Это предотвращает утечки данных на неуправляемые устройства. Это будет настраивается глобального администратора или администратора службы SharePoint.

Чтобы заблокировать на ненадежные сетевых расположений, можно использовать политики на основе местоположения для настройки списка надежных IP-адресов, с которых доступ разрешен. Следуйте инструкциям,: [Управление доступом к SharePoint и OneDrive на основании расположения в сети](https://support.office.com/en-us/article/Control-access-to-SharePoint-Online-and-OneDrive-data-based-on-defined-network-locations-b5a5f1f1-1174-4c6b-91d0-9273a6b6971f).


