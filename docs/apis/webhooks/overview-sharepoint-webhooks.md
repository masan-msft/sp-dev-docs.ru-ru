---
title: "Обзор веб-перехватчиков SharePoint"
ms.date: 09/25/2017
ms.prod: sharepoint
ms.openlocfilehash: fa9edc4423c4e6ab7e1f3ff97dab8be10ff6d7f0
ms.sourcegitcommit: 0d04831f6f30e5fbcf38d6509d602628552d0b28
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/17/2017
---
# <a name="overview-of-sharepoint-webhooks"></a>Обзор веб-перехватчиков SharePoint

[Веб-перехватчики](http://en.wikipedia.org/wiki/Webhook) SharePoint позволяют разработчикам создавать приложения, которые подписываются на уведомления о событиях, происходящих в SharePoint. При вызове события SharePoint отправляет подписчику полезные данные HTTP POST. Веб-перехватчики легче разрабатывать и использовать, чем службы Windows Communication Foundation (WCF), используемые удаленными приемниками событий в надстройках SharePoint. Это связано с тем, что веб-перехватчики представляют собой обычные HTTP-службы (веб-API).

В настоящее время веб-перехватчики поддерживаются только для элементов списков SharePoint. Веб-перехватчики элементов списков SharePoint обрабатывают события, связанные с изменением элементов списков для списка или библиотеки документов SharePoint. Веб-перехватчики SharePoint предоставляют простой канал уведомлений, чтобы приложение узнавало об изменениях списка SharePoint, не выполняя опрос службы. Дополнительные сведения см. в статье [Веб-перехватчики для списков SharePoint](./lists/overview-sharepoint-list-webhooks.md). 

## <a name="creating-webhooks"></a>Создание веб-перехватчиков
Чтобы создать веб-перехватчик SharePoint, необходимо добавить подписку на определенный ресурс SharePoint, например список SharePoint. 

Для создания подписки необходимы следующие сведения:

- Ресурс — URL-адрес конечной точки ресурса, для которого создается подписка. Например, это может быть URL-адрес API списков SharePoint.
- URL-адрес уведомления сервера — URL-адрес конечной точки службы. SharePoint будет отправлять запрос HTTP POST к этой конечной точке, когда в указанном ресурсе происходят события.
- Конечная дата — дата окончания срока действия подписки. Срок действия не должен превышать 6 месяцев. По умолчанию срок действия подписки завершается спустя 6 месяцев после ее создания. 

При необходимости вы также можете указать дополнительные сведения:

- Состояние клиента — непрозрачная строка, возвращаемая клиенту при всех уведомлениях. Ее можно использовать для проверки уведомлений, добавления тегов к разным подпискам и других целей.

## <a name="handling-webhook-validation-requests"></a>Обработка запросов на проверку веб-перехватчиков

При создании подписки SharePoint проверяет, может ли URL-адрес получать уведомления веб-перехватчиков. Эта проверка выполняется при запросе на создание подписки. Подписка будет создана, только если служба своевременно отправит отклик с маркером проверки.

### <a name="example-validation-request"></a>Пример запроса на проверку

При создании подписки SharePoint отправляет запрос HTTP POST на зарегистрированный URL-адрес в формате, подобном следующему:


```http
POST https://contoso.azurewebsites.net/your/webhook/service?validationToken={randomString}
Content-Length: 0
```

### <a name="response"></a>Отклик

Чтобы подписка была успешно создана, служба должна ответить на запрос, возвращая значение параметра строки запроса **validationToken** в виде обычного текстового отклика.

```http
HTTP/1.1 200 OK
Content-Type: text/plain

{randomString}
```

Если приложение возвращает код состояния, отличный от `200`, или не возвращает значение параметра **validationToken**, запрос на создание подписки не выполняется.

## <a name="receiving-notifications"></a>Получение уведомлений
Полезные данные уведомления сообщают приложению, что в определенном ресурсе для той или иной подписки произошло событие. Несколько уведомлений для приложения могут быть объединены в один запрос, если за один период времени в ресурсе произошло несколько событий.

Кроме того, полезные данные уведомления содержат состояние клиента, если он использовался при создании подписки.

### <a name="webhook-notification-resource"></a>Ресурс уведомлений веб-перехватчиков

В ресурсе уведомлений определяется форма данных, предоставляемых службе при отправке запроса уведомления веб-перехватчика SharePoint на зарегистрированный URL-адрес уведомлений.

#### <a name="json-representation"></a>Представление JSON

Каждое уведомление, созданное службой, сериализуется в экземпляр **webhookNotifiation**:

```json
{
    "subscriptionId":"91779246-afe9-4525-b122-6c199ae89211",
    "clientState":"00000000-0000-0000-0000-000000000000",
    "expirationDateTime":"2016-04-30T17:27:00.0000000Z",
    "resource":"b9f6f714-9df8-470b-b22e-653855e1c181",
    "tenantId":"00000000-0000-0000-0000-000000000000",
    "siteUrl":"/",
    "webId":"dbc5a806-e4d4-46e5-951c-6344d70b62fa"
}
```

Так как в одном запросе службе может отправляться несколько уведомлений, они объединяются в объект с одним массивом **value**:

```json
{
   "value":[
      {
         "subscriptionId":"91779246-afe9-4525-b122-6c199ae89211",
         "clientState":"00000000-0000-0000-0000-000000000000",
         "expirationDateTime":"2016-04-30T17:27:00.0000000Z",
         "resource":"b9f6f714-9df8-470b-b22e-653855e1c181",
         "tenantId":"00000000-0000-0000-0000-000000000000",
         "siteUrl":"/",
         "webId":"dbc5a806-e4d4-46e5-951c-6344d70b62fa"
      }
   ]
}
```

#### <a name="properties"></a>Свойства

| Имя свойства          | Тип              | description                                                                                                                         |
|:-----------------------|:------------------|:------------------------------------------------------------------------------------------------------------------------------------|
| **resource**           | String            | Уникальный идентификатор списка, в котором зарегистрирована подписка.                                                                 |
| **subscriptionId**     | String            | Уникальный идентификатор ресурса подписки                                                                                 |
| **clientState**        | String (необязательный) | Необязательное строковое значение, возвращаемое в сообщении уведомления для подписки.                                     |
| **expirationDateTime** | DateTime          | Дата и время окончания срока подписки, если она не будет обновлена или возобновлена.                                                      |
| **tenantId**           | String            | Уникальный идентификатор клиента, создавшего уведомление.                                                                 |
| **siteUrl**            | String            | Относительный (от сервера) URL-адрес сайта, на котором зарегистрирована подписка.                                                               |
| **webId**              | String            | Уникальный идентификатор сети, в которой зарегистрирована подписка.                                                                  |

#### <a name="example-notification"></a>Пример уведомления
Текст HTTP-запроса на URL-адрес уведомлений службы содержит уведомление веб-перехватчика. В следующем примере показаны полезные данные одного уведомления:

```json
{
   "value":[
      {
         "subscriptionId":"91779246-afe9-4525-b122-6c199ae89211",
         "clientState":"00000000-0000-0000-0000-000000000000",
         "expirationDateTime":"2016-04-30T17:27:00.0000000Z",
         "resource":"b9f6f714-9df8-470b-b22e-653855e1c181",
         "tenantId":"00000000-0000-0000-0000-000000000000",
         "siteUrl":"/",
         "webId":"dbc5a806-e4d4-46e5-951c-6344d70b62fa"
      }
   ]
}
```

Уведомление не включает сведения о вызвавших его изменениях. Ожидается, что при получении уведомления приложение будет использовать для списка [API GetChanges](https://msdn.microsoft.com/ru-RU/library/office/dn531433.aspx#bk_ListGetChanges), чтобы запросить коллекцию изменений из журнала изменений и сохранить значение маркера изменений для последующих вызовов.

## <a name="event-types"></a>Типы событий
Веб-перехватчики SharePoint поддерживают только асинхронные события. Это означает, что веб-перехватчики вызываются только после изменения (подобно событиям **-ed**), поэтому использовать синхронные события (**-ing**) невозможно.

## <a name="error-handling"></a>Обработка ошибок
Если при отправке уведомления приложению возникает ошибка, SharePoint повторно пытается его доставить (до пяти раз). Любой ответ с кодом состояния HTTP, который не находится в диапазоне 200–299, или с истекшим временем ожидания выполняется повторно через пять минут. Если все пять попыток успешно выполнить запрос ни к чему не привели, уведомление отменится. В дальнейшем попытки доставить уведомления приложению будут повторяться.

## <a name="expiration"></a>Срок действия
По умолчанию срок действия подписок на веб-перехватчики истекает спустя 6 месяцев, если не указано значение **expirationDateTime**. 

При создании подписки необходимо указать дату окончания срока действия. Срок действия подписки должен быть меньше 6 месяцев. Ожидается, что приложение будет обрабатывать дату окончания срока действия в соответствии со своими потребностями, периодически обновляя подписку. 

## <a name="retry-mechanism"></a>Механизм повторных попыток

Если в SharePoint происходит событие, а конечная точка службы недоступна (например, во время технического обслуживания), SharePoint повторит попытку отправки уведомления. SharePoint повторяет попытку **5 раз с 5-минутными интервалами**. Если по какой-либо причине служба отключается на продолжительное время, то при следующем включении и вызове от SharePoint метод `GetChanges()` восстановит изменения, пропущенные, пока служба была недоступна.
