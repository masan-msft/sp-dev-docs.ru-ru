---
title: "Типы политик авторизации надстроек в SharePoint"
ms.date: 09/25/2017
ms.prod: sharepoint
ms.openlocfilehash: 1a5d59656cb15f023b57b912c0cd248352931b2e
ms.sourcegitcommit: 1cae27d85ee691d976e2c085986466de088f526c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/13/2017
---
# <a name="add-in-authorization-policy-types-in-sharepoint"></a>Политики авторизации надстроек в SharePoint
Узнайте о различных политиках авторизации надстроек в SharePoint: только для надстроек, для пользователей и надстроек и только для пользователей. В ней также представлены рекомендации по использованию политики только для надстроек.
 

 **Примечание.** В настоящее время идет процесс замены названия "приложения для SharePoint" названием "надстройки SharePoint". Во время этого процесса в документации и пользовательском интерфейсе некоторых продуктов SharePoint и средств Visual Studio может по-прежнему использоваться термин "приложения для SharePoint". Дополнительные сведения см. в статье [Новое название приложений для Office и SharePoint](new-name-for-apps-for-sharepoint.md#bk_newname).
 

Прежде чем изучать эту статью, следует ознакомиться со статьями [Разрешения надстроек в SharePoint](add-in-permissions-in-sharepoint.md) и [Поток OAuth маркера контекста для надстроек SharePoint](context-token-oauth-flow-for-sharepoint-add-ins.md).
 

## <a name="get-an-overview-of-add-in-authorization-policies-types"></a>Обзор типов политик авторизации для надстроек
<a name="Overview"> </a>

В SharePoint есть три типа политик авторизации:
 

 

-  **Политика только для пользователей**. При ее использовании SharePoint проверяет только разрешения пользователя. SharePoint применяет эту политику, когда пользователь получает доступ непосредственно к ресурсам, не используя надстройку, например если пользователь впервые открывает домашнюю страницу веб-сайта SharePoint или получает доступ к API SharePoint из PowerShell.
    
    
    
 
-  **Политика для пользователей и надстроек**. При использовании этой политики SharePoint проверяет разрешения как пользователя, так и надстройки. Авторизация успешна, только если текущий пользователь и надстройка имеют разрешения на выполнение необходимых действий.
    
    Например, эта политика используется, когда надстройке SharePoint необходимо получить доступ к ресурсам пользователя в SharePoint. Код в удаленных компонентах надстройки SharePoint должен быть реализован так, чтобы можно было выполнять вызовы для пользователей и надстроек к SharePoint.
    
    
    
 
-  **Политика только для надстроек**. При использовании этой политики SharePoint проверяет только разрешения надстройки. Авторизация успешна, только если текущая надстройка имеет достаточно разрешений для выполнения необходимый действий, независимо от разрешений, имеющихся у текущего пользователя (если они имеются).
    
    Примером использования этой политики может служить надстройка для утверждения расходов. С ее помощью пользователи, которые не имеют возможности утверждать расходы меньше определенной суммы, могут выполнять такие действия. Дополнительные сведения см. в сценарии ниже. 
    
    
    
     **Примечание.** Некоторым API требуется контекст пользователя, и они не могут выполняться при использовании политики только для надстроек. К ним относятся многие API для взаимодействия с Project Server 2013 и выполнения поисковых запросов.

### <a name="see-an-example-scenario-of-an-add-in-that-uses-the-add-in-only-policy"></a>Пример сценария с надстройкой, использующей политику только для надстроек
<a name="Scenario"> </a>

Предположим, менеджер по продажам в Contoso Сергей покупает надстройку по предоставлению документов о расходах, в которой используется политика только для надстроек. При покупке надстройки Сергею предлагается разрешить ей работать с разрешениями более высокого уровня (надстройка может выполнять вызовы только для надстроек в SharePoint). Допустим, что Сергей предоставил надстройке такие разрешения. Затем он покупает достаточное количество лицензий надстройки для всех продавцов Contoso и устанавливает ее на веб-сайте SharePoint отдела продаж.
 

 
Вскоре продавцы начинают отправлять отчеты о расходах с помощью новой надстройки. Обычно продавцам не предоставляется возможность утверждать их собственные отчеты о расходах, но они могут это сделать с помощью надстройки для отчетов, сумма в которых не превышает 50 рублей. Сергей настроил автоматическое утверждение подобных отчетов. Надстройка автоматически назначает ему задачу по утверждению отчетов, сумма в которых меньше 50 рублей. Это можно реализовать, предоставив надстройке SharePoint разрешение на запись в список утвержденных расходов SharePoint. Но среди пользователей разрешение на запись в список имеется только у руководителей отдела кадров. Код в надстройке реализован так, что расходы в список добавляются с помощью вызова к SharePoint только для надстроек в том случае, если сумма расходов составляет меньше 50 рублей. Так как разрешения пользователя не проверяются, любые отчеты пользователя, не превышающие 50 рублей, автоматически добавляются в список утвержденных расходов, даже если у пользователя нет разрешения на запись в список.
 

 

 

 

### <a name="learn-how-add-ins-get-permission-to-use-the-add-in-only-policy"></a>Сведения о том, как надстройки получают разрешение на использование политики только для надстроек
<a name="Approve"> </a>

Чтобы получить возможность выполнять вызовы к SharePoint только для надстроек, в манифесте надстройки следует запросить разрешение на использование политики только для надстроек. Для этого добавьте атрибут **AllowAppOnlyPolicy** к элементу **AppPermissionRequests** и задайте для него значение **true**, как показано в приведенной ниже части кода.
 

 

```XML
<AppPermissionRequests AllowAppOnlyPolicy="true">
    ...
</AppPermissionRequests>
```


 **Примечание.** Предыдущее название надстроек SharePoint — "приложения для SharePoint". Для поддержания обратной совместимости схема манифеста приложения осталась без изменений, поэтому строка "app" присутствует в именах многих элементов и атрибутов.
 

Пользователю, устанавливающему надстройку, будет предложено утвердить этот запрос. Если надстройка запрашивает клиентские разрешения, то разрешить использование политики только для надстроек может только администратор клиента, поэтому только он может установить надстройку. Если надстройка не запрашивает никакие разрешения, область которых выше семейства веб-сайтов, то установить ее может администратор семейства веб-сайтов. Дополнительные сведения об областях разрешений см. в разделе  [Разрешения для надстроек в SharePoint](add-in-permissions-in-sharepoint.md).
 

 

### <a name="learn-how-add-ins-make-add-in-only-calls"></a>Узнайте, как надстройки выполняют вызовы только для надстроек
<a name="AppOnlyCalls"> </a>

Различие между вызовом к SharePoint только для надстроек и вызовом для пользователей и надстроек заключается в типе маркера доступа, который включен в вызов. В примере кода ниже показано, как создать и получить маркеры доступа для пользователей и надстроек и маркеры доступа только для надстроек в управляемом коде. Готовый код представлен в файле TokenHelper.cs (или с расширением VB), который Инструменты разработчика Office для Visual Studio автоматически добавляет в проект надстройки SharePoint в Visual Studio.
 

 

```C#
string contextTokenString = TokenHelper.GetContextTokenFromRequest(Request);
if (contextTokenString != null)
{
     //Get context token.
     SharePointContextToken contextToken =
          TokenHelper.ReadAndValidateContextToken(contextTokenString, Request.Url.Authority);
     Uri sharepointUrl = new Uri(Request.QueryString["SPHostUrl"]);

     //Get user+add-in access token.
     string accessToken =
          TokenHelper.GetAccessToken(contextToken, sharepointUrl.Authority).AccessToken;

      ClientContext clientContext =
           TokenHelper.GetClientContextWithAccessToken(sharepointUrl.ToString(), accessToken);

      //Do something. 
       ...
    
      //Get add-in-only access token.
       string addinOnlyAccessToken = 
            TokenHelper.GetAppOnlyAccessToken(contextToken.TargetPrincipalName, 
                              sharepointUrl.Authority, contextToken.Realm).AccessToken;
         //Do something.
         ...
}
```


 **Примечание.** В надстройках, которые не поддерживают вызовы с проверкой подлинности OAuth (например, надстройки, представляющие собой только код JavaScript, выполняющийся на сайте надстройки), невозможно использовать политику только для надстроек. Такие надстройки запрашивают разрешение, но не могут им воспользоваться, так как при этом им необходимо обрабатывать токен OAuth только для надстроек. Только надстройки с веб-приложениями, выполняющиеся за пределами SharePoint, могут создавать и обрабатывать маркеры только для надстроек.
 

Как правило, для выполнения вызова требуется наличие текущего пользователя. В случае политики только для надстроек SharePoint создает пользователя SHAREPOINT\APP (аналогично существующему пользователю SHAREPOINT\SYSTEM). Все запросы только для надстроек отправляются от имени пользователя SHAREPOINT\APP. Выполнить проверку подлинности на основе пользователя от имени SHAREPOINT\APP невозможно.
 

 

### <a name="get-guidelines-for-using-the-add-in-only-policy"></a>Рекомендации по использованию политики только для надстроек
<a name="GuidelinesFor"> </a>

Поскольку вызовы только для надстроек позволяют эффективно повысить уровень прав пользователя, следует с осторожностью создавать надстройки, которые запрашивают такие разрешения. Вызовы должны использовать политики только для надстроек исключительно в указанных ниже случаях.
 

 

- Надстройке необходимо повысить уровень своих разрешений по сравнению с пользователем для выполнения определенного вызова (например, чтобы надстройка могла самостоятельно утвердить отчет о расходах).
    
 
- Надстройка не выполняется от имени любого пользователя (например, надстройка, выполняющая задачи по ночному обслуживанию библиотеки документов SharePoint.
    
 

## <a name="additional-resources"></a>Дополнительные ресурсы
<a name="AR"> </a>


-  [Авторизация и проверка подлинности для надстроек в SharePoint](authorization-and-authentication-of-sharepoint-add-ins.md)
    
 
-  [Разрешения для надстроек в SharePoint](add-in-permissions-in-sharepoint.md)
    
 
-  [Поток OAuth токена контекста для надстроек SharePoint](context-token-oauth-flow-for-sharepoint-add-ins.md)
    
 
-  [Надстройки SharePoint](sharepoint-add-ins.md)
    
 
-  [Знакомство с созданием надстроек SharePoint с размещением у поставщика](get-started-creating-provider-hosted-sharepoint-add-ins.md)
    
 

