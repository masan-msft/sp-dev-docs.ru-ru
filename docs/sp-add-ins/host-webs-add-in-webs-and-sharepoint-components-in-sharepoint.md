
# <a name="host-webs-add-in-webs-and-sharepoint-components-in-sharepoint"></a>Хост-сайты, сайты надстроек и компоненты SharePoint в SharePoint
Изучите различия между сайтами надстроек и хост-сайтами. Узнайте также, какие компоненты SharePoint могут быть включены в Надстройка SharePoint, которые разворачиваются на хост-сайте, на сайте надстройки, и о порядке развертывания сайта надстройки в изолированном домене.
 

 **Примечание.** Название "приложения для SharePoint" меняется на "надстройки SharePoint". Пока изменения не будут внесены полностью, в документации и пользовательском интерфейсе некоторых продуктов SharePoint и средств Visual Studio по-прежнему может встречаться термин "приложение". Дополнительные сведения см. в статье [Название "приложения для Office и SharePoint" изменилось на "надстройки Office и SharePoint"](new-name-for-apps-for-sharepoint#bk_newname).
 


## <a name="host-webs-add-in-webs-and-the-isolated-domain"></a>Хост-сайты, сайты надстроек и изолированный домен
<a name="IsolatedDomain"> </a>

Когда надстройка, включающая компоненты SharePoint, устанавливается на веб-сайте, она включается в список на странице **содержания**, откуда его можно запустить. Этот список, являющийся точкой запуска надстройки, представляет единственное обязательное добавление на веб-сайт, хотя могут также быть добавлены и другие элементы, например, дополнительное действие или веб-часть надстройки. Сведения об этих возможностях см. в разделе [Доступ к надстройке из пользовательского интерфейса](important-aspects-of-the-sharepoint-add-in-architecture-and-development-landscap#AccessingApp). Компоненты Надстройка SharePoint, отличные от этих элементов пользовательского интерфейса, такие как списки, типы контента, рабочие процессы и страницы, разворачиваются на другом веб-сайте в специальном изолированном домене. Этот факт во многом скрыт от пользователя. Специальный сайт, на котором *разворачивается* надстройка, называется сайтом надстройки. Веб-сайт, на котором *устанавливается* надстройка, называется хост-сайтом. Хотя сайт надстройки имеет собственный изолированный домен, он находится в том же семействе сайтов, что и хост-сайт. (Единственным исключением из этого правила является установка надстройки с областью клиента. В этом случае сайт надстройки находится в семействе сайтов корпоративного каталога надстроек.) 
 

 
На рисунке 1 показан хост-сайт с двумя установленными Надстройки SharePoint. В надстройке 1 имеются удаленные компоненты, но нет компонентов SharePoint, поэтому оно не имеет сайта надстройки. В надстройке 2 отсутствуют удаленные компоненты, но имеются два списка и рабочий процесс SharePoint. Они развернуты на изолированном дочернем сайте. (Надстройка SharePoint может иметь как удаленные компоненты, так и компоненты, размещенные в SharePoint, хотя ни одна показанная на этом рисунке надстройка не имеет сразу оба вида компонентов.)
 

 

**Рис. 1. Хост-сайт с надстройкой, размещенной на ресурсах поставщика, и надстройкой с размещением в SharePoint**

 

 
![Хостинговые сети, сети приложений и их компоненты.](../../images/HostWebAndAppWeb.png)
 
Например, предположим, что надстройка с компонентами SharePoint, включающими не только элементы пользовательского интерфейса, которые могут быть развернуты на хост-сайте, устанавливается на хост-сайте со следующим URL-адресом:
 

 
 `https://www.fabrikam.com/sites/Marketing`
 

 
Надстройка SharePoint будет развертываться на заново созданном веб-сайте с URL-адресом, аналогичным следующему:
 

 
 `http://add-in-bdf2016ea7dacb.fabrikamadd-ins.com/sites/Marketing/Scheduler`
 

 
Обратите внимание, что этот URL-адрес имеет следующую структуру:
 

 
 `https://` _Префикс_надстройки_ `-` _ИД_надстройки_ `.` _Базовый_домен_надстройки_ `/` _URL-адрес_хост-сайта_относительно_домена_ `/` _Имя_надстройки_
 

 
Данные заполнители имеют следующие значения:
 

 

 

-  _Префикс_надстройки_ это любая строка, установленная администратором фермы в центре администрирования. Значение по умолчанию "default". В данном примере администратор изменил его на "add-in".
    
 
-  _ИД_надстройки_ — это шестнадцатеричное число, которое генерируется внутри надстройки после ее установки.
    
 
-  _Базовый_домен_надстройки_ — это строка, установленная администратором фермы в Центре администрирования или с помощью командной консоли SharePoint. Его *не* следует устанавливать как поддомен веб-приложения SharePoint, иначе цель изоляции надстройки не будет выполнена. В этом примере администратор удалил префикс "www." и добавил "add-ins" к имени компании. Таким образом, `fabrikamadd-ins.com` — базовый домен приложения.
    
 
-  _URL-адрес_хост-сайта_относительно_домена_ — это относительный URL-адрес родительского хост-сайта, в данном случае `sites/Marketing`.
    
 
-  _Имя_надстройки_ — это значение для атрибута **Name** элемента **App** в файле appmanifest.xml.
    
 
Существует две основные причины, по которым компоненты SharePoint развертываются на сайтах надстроек, а не на хост-сайта. Обе они связаны с безопасностью.
 

 

 

-  **Обеспечение выполнения разрешений надстройки.** В Модель для надстроек SharePoint надстройка имеет собственное удостоверение, а также разрешения, которые могут не совпадать с разрешениями пользователя, выполняющего надстройку. Эти разрешения надстройки запрашиваются при установке надстройки и предоставляются лицом, устанавливающим её, а также лицом, имеющим все разрешения, которые запрашивает надстройка. (Если пользователь, устанавливающий надстройку, не имеет все разрешения, запрашиваемые надстройкой, то он не может установить её.) Предоставляя каждой надстройке собственный домен, SharePoint может надежно идентифицировать запросы, которые делает надстройка, и проверять разрешения надстройки. Дополнительные сведения о разрешениях надстроек см. в разделе [Разрешения надстроек](important-aspects-of-the-sharepoint-add-in-architecture-and-development-landscap#AppPermissions).
    
 
-  **Безопасность междоменных скриптов.** Современные браузеры поддерживают "политику единого домена" по отношению к вызовам методов JavaScript. При развертывании каждого Надстройка SharePoint в собственном домене, SharePoint использует преимущества политики единого домена браузера, чтобы JavaScript в Надстройка SharePoint не мог выполнять никакой JavaScript из другого домена, включая домен, в котором с точки зрения пользователя установлена надстройка.
    
    SharePoint также предоставляет средства безопасного преодоления ограничений политики. Помимо прочего, удаленным компонентам Надстройка SharePoint разрешается запрашивать данные с любого веб-сайта в рамках общей родительской принадлежности сайта надстройки и хост-сайта. Дополнительные сведения см. в статье  [Обращение к данным SharePoint из надстроек с помощью междоменной библиотеки](access-sharepoint-2013-data-from-add-ins-using-the-cross-domain-library).
    
 

## <a name="types-of-sharepoint-components-that-can-be-in-a-sharepoint-add-in"></a>Типы компонентов SharePoint, встречающиеся в надстройке SharePoint
<a name="TypesOfSPComponentsInApps"> </a>

В целом надстройка SharePoint может содержать один или несколько компонентов из приведенного ниже списка. С некоторыми исключениями, эти компоненты должны разворачиваться в компонентах уровня **веб-сайта**, находящихся в файле пакета решения SharePoint (WSP-файле).
 

 

 **Примечание.** ***** Компоненты, помеченные звездочкой (*), более подробно рассматриваются в разделе [Предостережения для развертывания компонентов SharePoint](#SpecialCases) ниже в этой статье.
 


- Компоненты (только уровня **веб-сайта**)
    
 
- Дополнительные действия (в том числе пункты контекстного меню и настройки ленты)*
    
 
- Удаленные приемники событий*
    
 
- Разметка, которая ссылается на веб-части, в том числе веб-части надстроек, которые включены в SharePoint (но не настраиваемые веб-части)*
    
 
- Пользовательские файлы таблиц стилей (CSS) для использования страницами SharePoint
    
 
- Пользовательские файлы JavaScript для использования страницами SharePoint
    
 
- Модули (наборы файлов)
    
 
- Страницы
    
 
- Шаблоны списка
    
 
- Экземпляры списков и библиотек
    
 
- Настраиваемые формы списков
    
 
- Настраиваемые представления списков
    
 
- Настраиваемые типы контента
    
 
- Поля (относящиеся к типам полей, встроенным в SharePoint)
    
 
- Модели службы Microsoft Business Connectivity Services (только уровня **веб-сайта**), основанные на модели типы внешнего контента и внешние списки, использующие типы контента*
    
 
- Рабочие процессы*
    
 
- Контейнеры свойств
    
 
- Шаблоны сайтов (но не определения сайтов)*
    
 
Никакие другие виды компонентов SharePoint не могут разворачиваться в Надстройка SharePoint. Дополнительные сведения об ограничениях того, что можно включать в Надстройка SharePoint, см. в статье  [Сравнение надстроек SharePoint с решениями SharePoint](http://msdn.microsoft.com/library/0e9efadb-aaf2-4c0d-afd5-d6cf25c4e7a8%28Office.15%29.aspx).
 

 

## <a name="caveats-for-deploying-sharepoint-components"></a>Условия для развертывания компонентов SharePoint
<a name="SpecialCases"> </a>

Ознакомьтесь с условиями и подробными сведениями, касающимися развертывания определенных компонентов SharePoint в надстройке: 
 

 

-  **Дополнительные действия.** Дополнительные действия можно добавлять как на сайт надстройки, так и на хост-сайт. Чтобы добавить дополнительное действие на сайт надстройки, его следует включить в компонент уровня **веб-сайта**, находящийся в WSP-файле, как это делается с любым другим компонентом, который добавляется на сайт надстройки. Чтобы добавить дополнительное действие на хост-сайт, можно включить (даже в надстройке с внешним размещением) разметку **CustomAction** в компонент, который находится в пакете надстройки, но вне WSP-файла. Компоненты в таком "свободном" компоненте относятся к хост-сайту, а не к сайту надстройки, поэтому такой тип компонентов называется компонентом хост-сайта. 
    
 
-  **Веб-части.** Одну разновидность веб-частей, веб-часть надстройки, можно разворачивать в надстройке, и эта веб-часть может вести либо на сайт надстройки, либо на хост-сайт. На все остальные типы веб-частей можно ссылаться в надстройках, но они не могут разворачиваться в надстройках. Если веб-часть надстройки разворачивается на хост-сайте, ее необходимо включить в компонент хост-сайта.
    
 
-  **Удаленные приемники событий.** Удаленные приемники событий появились в SharePoint. Они похожи на классические приемники событий SharePoint, за исключением того, что код выполняется в облаке. Эти приемники событий недоступны в надстройках, размещенных в SharePoint.
    
 
-  **Рабочие процессы.** Рабочие процессы в SharePoint используют среду выполнения workflow-процессов, размещенную в Microsoft Azure, которая появилась в SharePoint. Закодированные рабочие процессы, которые используют среду выполнения workflow-процессов, размещенную в SharePoint, не могут включаться в Надстройка SharePoint. Разрешены только декларативные рабочие процессы или рабочие процессы, использующие новейшую среду выполнения.
    
 
-  **Модели службы Microsoft Business Connectivity Services (BCS), типы внешнего контента и внешние списки.** Модели службы подключения к бизнес-данным (BDC) обычно имеют область, которая шире, чем семейство сайтов. Однако когда модель службы подключения к бизнес-данным разворачивается в надстройке, ее область ограничивается областью сайта надстройки. Когда модель службы подключения к бизнес-данным включается в надстройку, она хранится не в хранилище общих служб BDC, а в виде файла на сайте надстройки.
    
 
-  **Шаблоны сайтов.** В большинстве случаев вам будет требоваться, чтобы сайт надстройки устанавливал новую встроенную конфигурацию определений сайта **APP#0**, оптимизированную для сайтов надстройки. (Дополнительные сведения об этом см. в разделе [Доступ к надстройке из пользовательского интерфейса](important-aspects-of-the-sharepoint-add-in-architecture-and-development-landscape#AccessingApp).) SharePoint автоматически использует **APP#0**, если пакет надстройки не включает элемент [WebTemplate](http://msdn.microsoft.com/library/ff4ba91a-cc5f-47ff-9101-a7651f452185%28Office.15%29.aspx).
    
    Кроме того, можно задать тип настраиваемого сайта для сайта надстройки. Для этого необходимо выполнить два основных действия:
    
      - Включите настраиваемый  [Элемент WebTemplate (веб-шаблон)](http://msdn.microsoft.com/library/ff4ba91a-cc5f-47ff-9101-a7651f452185%28Office.15%29.aspx), файл onet.xml и возможно другие связанные файлы в компонент сайта надстройки для вашей надстройки. Разверните шаблон сайта в компоненте уровня сайта в WSP-файле в пакете надстройки обычным образом.
    
 
  - Добавьте  [Элемент WebTemplate (PropertiesDefinition complexType) (Manifest SharePoint Add-in)](http://msdn.microsoft.com/library/62302903-e97a-a9a3-a64e-13176a7c4e1e%28Office.15%29.aspx) в манифест надстройки в качестве потомка элемента **Properties** и установите для его атрибута **Id** значение GUID компонента сайта надстройки и значение **Name** атрибута [Элемент WebTemplate (веб-шаблон)](http://msdn.microsoft.com/library/ff4ba91a-cc5f-47ff-9101-a7651f452185%28Office.15%29.aspx). Обратите внимание, что GUID должен быть заключен в фигурные скобки и содержать дефисы, а также отделяться от имени шаблона символом "#". Вот пример такого значения:
    
```XML
  <WebTemplate Id="{81dd4ae5-873b-4759-9838-4ad9c3dd2952}#NewSiteType" />
```


     **Note**  The new  [WebTemplate](http://msdn.microsoft.com/library/62302903-e97a-a9a3-a64e-13176a7c4e1e%28Office.15%29.aspx) element for add-in manifests is not the same markup as the [WebTemplate](http://msdn.microsoft.com/library/ff4ba91a-cc5f-47ff-9101-a7651f452185%28Office.15%29.aspx) element that can be included in Features. The **WebTemplate** element that can be included in Features defines a type of site, but the **WebTemplate** element for add-in manifests simply identifies what type of site to use. For more information about the add-in manifest of a SharePoint Add-in, see [Add-in package structure](important-aspects-of-the-sharepoint-add-in-architecture-and-development-landscape#SPAppModelArch_Package).

     **Caution**  Do not use the  **WebTemplate** element in the add-in manifest to designate any of the built-in SharePoint site definition configurations as the add-in web's site type. We do not support using any of the built-in site definition configurations, other than **APP#0**, for add-in webs. 

    For more information about site definition configurations and web templates, see  [Working with Site Templates and Definitions](http://msdn.microsoft.com/library/1edf6d4d-eddb-4cb5-9034-ed394e8a3e01%28Office.15%29.aspx).
    
 

## <a name="additional-resources"></a>Дополнительные ресурсы
<a name="SP15hostedwebs_bk_addlresources"> </a>


-  [Важные аспекты архитектуры и разработки надстроек SharePoint](important-aspects-of-the-sharepoint-add-in-architecture-and-development-landscape)
    
 
-  [Надстройки SharePoint в сравнении с решениями для SharePoint](http://msdn.microsoft.com/library/0e9efadb-aaf2-4c0d-afd5-d6cf25c4e7a8%28Office.15%29.aspx)
    
 

 

 

