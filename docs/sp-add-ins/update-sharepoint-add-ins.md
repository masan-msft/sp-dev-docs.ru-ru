---
title: "Обновление надстроек SharePoint"
description: "Создание и развертывание обновления надстройки SharePoint."
ms.date: 11/02/2017
ms.prod: sharepoint
ms.openlocfilehash: a1ff2202cba1fd9c85203ee335848f8894051f59
ms.sourcegitcommit: c57fc0e802661b0771f8b022964b6956ab4f6caf
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/23/2017
---
# <a name="update-sharepoint-add-ins"></a>Обновление надстроек SharePoint

Вы можете обновить свою надстройку SharePoint, используя встроенную в SharePoint систему обновления. В течение 24 часов после отправки обновленной версии надстройки в каталог надстроек организации или приема надстройки в Магазин Office рядом с надстройкой на странице **Контент сайта** каждого веб-сайта, на котором она установлена, появится уведомление о доступном обновлении. Как видно на рисунке 1, пользователи могут немедленно установить обновление по предоставленной ссылке.
 
*Рис. 1. Процесс обновления надстройки SharePoint*

![Руководство по обновлению приложения в пользовательском интерфейсе](../images/UpdatingApp_AppTileUpdateNotice.png)
 
Пользователь может установить обновление, не удаляя предыдущую версию. Инфраструктура обновления проверяет установку обновления и выполняет ее откат в случае каких-либо ошибок.
 
> [!IMPORTANT]
> С помощью системы обновления нельзя изменить *тип надстройки*. Например, надстройку с размещением в SharePoint невозможно преобразовать в надстройку с размещением у поставщика. Чтобы изменить тип, необходимо [перенести данные из старой надстройки в новую](sharepoint-add-ins-update-process.md#Major). В частности, так как [программа тестирования надстроек с автоматически размещением закрыта](http://blogs.office.com/2014/05/16/update-on-autohosted-apps-preview-program/.md), надстройку с автоматически размещением нельзя обновить до надстройки с размещением у поставщика. Преобразуйте надстройку SharePoint согласно инструкциям в [этой статье](convert-an-autohosted-sharepoint-add-in-to-a-provider-hosted-add-in.md).

<a name="Prerequisites"> </a>
## <a name="prerequisites-for-updating-a-sharepoint-add-in"></a>Необходимые условия для обновления надстройки SharePoint

Для обновления надстройки SharePoint необходимы вот какие компоненты:

- Тестовая установка SharePoint, которая поддерживает изоляцию. Инструкции по настройке Сайта разработчика Office 365 см. в статье [Настройка среды для разработки надстроек SharePoint в Office 365](set-up-a-development-environment-for-sharepoint-add-ins-on-office-365.md).

- Инструменты, используемые для создания надстройки SharePoint, которые, как правило, также используются для ее обновления. Например, для создания надстроек SharePoint многие разработчики используют Visual Studio и Инструменты разработчика Microsoft Office для Visual Studio.

### <a name="core-concepts-to-know-to-update-a-sharepoint-add-in"></a>Основные понятия, касающиеся обновления надстройки SharePoint

Прежде чем обновлять надстройку, ознакомьтесь с понятиями в приведенной ниже таблице.

|**Название статьи**|**Описание**|
|:-----|:-----|
| [Выбор шаблонов для разработки и размещения надстройки SharePoint](choose-patterns-for-developing-and-hosting-your-sharepoint-add-in.md)|Сведения о различных типах надстроек SharePoint. Процесс обновления для разных типов отличается.|
| [Процесс обновления надстроек SharePoint](sharepoint-add-ins-update-process.md)|Описание процесса обновления надстроек SharePoint.|
| [Обновление компонентов](http://msdn.microsoft.com/library/e917f709-6491-4d50-adbe-2ab8f35da990%28Office.15%29.aspx)|Узнайте, как обновлять компоненты (пакет SDK SharePoint 2010).|
| [Развертывание и установка надстроек SharePoint: методы и параметры](deploying-and-installing-sharepoint-add-ins-methods-and-options.md)|Сведения о методах публикации, установки и удаления надстроек SharePoint.|
| [Обработка событий в надстройках SharePoint](handle-events-in-sharepoint-add-ins.md)|Сведения о приемниках удаленных событий в SharePoint.|

<a name="MajorAppUpgradeSteps"> </a>
## <a name="major-steps-for-updating-an-add-in"></a>Основные шаги по обновлению надстройки

Ниже описаны основные шаги по созданию обновления для надстройки SharePoint. Каждый шаг подробно описан в разделах или статьях, на которые указывают ссылки. Не все они являются обязательными в каждом проекте обновления. Необходимые действия зависят от того, какие компоненты уже содержатся в надстройке, а какие нужно добавить. Обязательными являются только действия, отмеченные знаком `**`.

- Обновите манифест надстройки.

   - `**` Увеличьте номер **Version** в элементе [App](http://msdn.microsoft.com/library/d5f30dfe-7500-5f85-0f08-f4f220c0c692%28Office.15%29.aspx) файла appmanifest.xml (в первом выпуске схемы надстройки назывались "приложениями"). *Не* изменяйте номер **ProductID**.
   
   - Измените раздел [AppPermissionRequests](http://msdn.microsoft.com/library/4e617622-78d3-3d23-677d-9957eb1fb107%28Office.15%29.aspx) файла appmanifest.xml.
   
   - Измените раздел [AppPrerequisites](http://msdn.microsoft.com/library/7622b55f-01a1-2c39-9daa-7cfb1a3c890f%28Office.15%29.aspx) файла appmanifest.xml.
    
   Дополнительные сведения см. в разделе [Обновление версии надстройки, запросов разрешений и необходимых условий](#UpdateManifest).

- Добавьте или обновите разметку для компонентов сайта надстройки. Дополнительные сведения см. в статье [Обновление компонентов сайта с надстройкой в SharePoint](update-add-in-web-components-in-sharepoint.md).

- Добавьте или обновите разметку для компонентов хост-сайта. Дополнительные сведения см. в статье [Обновление компонентов хост-сайта с надстройкой в SharePoint](update-host-web-components-in-sharepoint.md).

- Добавьте пользовательскую логику в [UpgradedEventEndpoint](http://msdn.microsoft.com/library/09a93d44-d295-47bb-f91c-d243178b0f53%28Office.15%29.aspx) и зарегистрируйте ее в файле appmanifest.xml. Дополнительные сведения см. в статье [Создание обработчика для события обновления надстройки SharePoint](create-a-handler-for-the-update-event-in-sharepoint-add-ins.md).
    
- Обновите удаленные компоненты.
    
   - Для надстройки с размещением у поставщика обновите удаленные компоненты с помощью методов, соответствующих платформам, которые используются для размещения. 
   
   Дополнительные сведения см. в статье [Обновление удаленных компонентов в надстройках SharePoint](update-remote-components-in-sharepoint-add-ins.md).
    
- `**` Отправьте пакет надстройки в Магазин Office или каталог надстроек организации.

<a name="BestUpdatePractices"> </a>
## <a name="best-practices-for-add-in-updates"></a>Рекомендации по обновлению надстроек

В следующих разделах рассматриваются процедуры, которым нужно следовать, и важные вопросы, на которые следует обратить внимание при планировании обновления.

### <a name="decide-whether-you-really-have-to-update"></a>Решите, действительно ли нужно обновление

Улучшить надстройку SharePoint с размещением у поставщика можно и без обновления. Если изменения касаются только удаленных компонентов и не должны отражаться в компонентах SharePoint, можно изменить удаленные компоненты, не обновляя надстройку. Если URL-адреса и строки, используемые компонентами SharePoint для доступа к удаленным компонентам, не изменяются, надстройка SharePoint продолжает работать. 

Допустим, вы добавили кнопку в удаленное веб-приложение, которая считывает столбец из нового списка SharePoint. Если столбец уже существует в списке, вам не нужно ничего менять в SharePoint. Вы можете отправить измененную веб-страницу, измененный код или данные JavaScript в удаленное веб-приложение. Новые функции мгновенно станут доступны пользователям при запуске надстройки SharePoint.

### <a name="remember-that-updating-is-optional-for-users"></a>Помните, что обновление не является обязательным для пользователей

Когда новая версия надстройки SharePoint становится доступна в Магазине Office или каталоге надстроек организации, на плитке надстройки на странице **Контент сайта** появляется сообщение о доступном обновлении. Оно появляется в течение 24 часов. Но обновление не является обязательным. Поэтому изменения, которые вы вносите в удаленные компоненты, не должны нарушать работу предыдущих версий надстройки. Общее, но не универсальное, правило гласит: *добавляйте* новые элементы в удаленные компоненты, но не удаляйте, не переименовывайте, не перемещайте и не изменяйте схему, строку подключения или URL-адрес существующего компонента.

Если удаленному компоненту нужна версия экземпляра надстройки, который его вызывает, вы можете отправить эти сведения из SharePoint. Например, можно добавить версию надстройки как параметр запроса в URL-адрес элемента [StartPage](http://msdn.microsoft.com/library/3092674c-a6c3-9021-3d7e-e716562a4a4f%28Office.15%29.aspx) надстройки.

<a name="DebugFirst"> </a>
### <a name="create-and-debug-the-new-version-as-if-it-were-a-brand-new-add-in"></a>Создайте и отладьте новую версию, как будто это новая надстройка

Следует отделять разработку и отладку новой версии надстройки от отладки разметки и логики обновления. Для этого удалите предыдущую версию надстройки из тестового сайта SharePoint для разработки. Сохраните резервную копию файла пакета надстройки для предыдущей версии. Необходимым образом добавьте и измените компоненты надстройки, а затем проверьте и отладьте их с использованием тестового сайта, как будто это новая надстройка, созданная с нуля.

### <a name="test-the-update-with-each-earlier-version-of-the-add-in"></a>Протестируйте обновление с каждой предыдущей версией надстройки

Когда новая версия надстройки будет правильно работать как "новая" надстройка, измените код и разметку так, чтобы проект представлял собой обновление старой надстройки. Например, увеличьте номер версии надстройки, как указано в разделе [Основные шаги по обновлению надстройки](#MajorAppUpgradeSteps). Дополнительные сведения о преобразовании проекта в обновление см. в разделах этой статьи.

Когда вы будете готовы проверить свое обновление, уберите новую версию с тестового сайта и повторно разверните предыдущую версию, чтобы проверить логику обновления. Если существует несколько предыдущих версий надстройки, установите каждую из них на отдельный дочерний веб-сайт тестового сайта. Затем отправьте последнюю версию надстройки в каталог надстроек тестового сайта и обновите каждый экземпляр надстройки. Убедитесь, что каждый из них имеет последний номер версии и новейшие версии всех компонентов. Если в надстройке используется сайт надстройки, убедитесь, что его компоненты развернуты в соответствии с процедурой, описанной в разделе [Проверка развертывания веб-компонентов надстройки](update-add-in-web-components-in-sharepoint.md#VerifyDeployAppWebComp).

<a name="ImmediateUpdateNotice"> </a>
### <a name="update-an-add-in-without-waiting-24-hours"></a>Обновите надстройку раньше чем через 24 часа

Разрабатывая обновление для надстройки на тестовом сайте SharePoint, нет смысла ждать 24 часа между обновлениями. Вы (и пользователи производственного сайта SharePoint) можете обновить надстройку сразу после ее отправки в Магазин Office или каталог надстроек организации. Для этого выполните указанные ниже действия.

#### <a name="to-immediately-update-an-add-in"></a>Немедленное обновление надстройки

1. Отправив последнее обновление в каталог надстроек, откройте страницу **Контент сайта** на веб-сайте, на котором установлена надстройка, и нажмите кнопку **...** на плитке надстройки.

2. В появившейся выноске выберите вкладку **О программе**. На открывшейся странице **О программе** отобразится сообщение о доступности новой версии.

3. Нажмите кнопку **Получить**. Снова откроется страница **Контент сайта**, а на плитке надстройки появится сообщение о текущем обновлении надстройки.

Эти действия показаны на рисунке 2.

*Рис. 2. Процесс мгновенного обновления надстройки SharePoint*

![Процесс немедленного обновления надстройки](../images/UpdatingApp_ImmediateUpgradeProcess.png)

> [!NOTE]
> Чтобы сообщение о доступности обновления на плитке надстройки отображалось чаще, чем каждые 24 часа, вы можете использовать метод, описанный в статье [Процесс обновления надстройки SharePoint](sharepoint-add-ins-update-process.md#Minor), чтобы оно появлялось мгновенно.

<a name="UpdateManifest"> </a>
## <a name="update-the-add-in-version-permission-requests-and-prerequisites"></a>Обновление версии надстройки, запросов разрешений и необходимых условий

Создав резервную копию папки проекта Visual Studio, откройте проект надстройки. Откройте манифест надстройки и на вкладке **Общие** конструктора манифеста увеличьте номер версии.

Если обновленной версии надстройки требуется больше (или меньше) разрешений для компонентов хост-сайта, внесите необходимые изменения в разделе надстройки [AppPermissionRequests](http://msdn.microsoft.com/library/4e617622-78d3-3d23-677d-9957eb1fb107%28Office.15%29.aspx). В Visual Studio откройте вкладку **Разрешения** конструктора манифеста. 

После обновления надстройки пользователю всегда предлагается предоставить разрешения, независимо от того, изменились ли они по сравнению с предыдущей версией. Если в новой версии требуется *меньше* разрешений по сравнению с предыдущей, дополнительные разрешения *не отзываются*. Чтобы отозвать эти разрешения, после обновления надстройки пользователь должен перейти на страницу *{SharePointDomain}* `/_layouts/15/appinv.aspx` и вручную ввести разрешения, соответствующие схеме [AppPermissionRequests](http://msdn.microsoft.com/library/4e617622-78d3-3d23-677d-9957eb1fb107%28Office.15%29.aspx).

Если обновленной версии надстройки требуются определенные компоненты, которых не было в предыдущей версии (или отсутствуют компоненты, которые были в предыдущей версии), внесите необходимые изменения в разделе надстройки [AppPrerequisites](http://msdn.microsoft.com/library/7622b55f-01a1-2c39-9daa-7cfb1a3c890f%28Office.15%29.aspx). В Visual Studio откройте вкладку **Необходимые компоненты** в конструкторе манифеста.

## <a name="next-steps"></a>Дальнейшие действия
<a name="Next"> </a>

Перейдите к следующему пункту в разделе [Основные шаги по обновлению надстройки](#MajorAppUpgradeSteps) или непосредственно к одной из следующих статей:

-  [Обновление компонентов сайта надстройки в SharePoint](update-add-in-web-components-in-sharepoint.md)
-  [Обновление компонентов хост-сайта в SharePoint](update-host-web-components-in-sharepoint.md)
-  [Создание обработчика событий обновления в надстройках SharePoint](create-a-handler-for-the-update-event-in-sharepoint-add-ins.md)
-  [Обновление удаленных компонентов в надстройках SharePoint](update-remote-components-in-sharepoint-add-ins.md) 
    
## <a name="see-also"></a>См. также
<a name="bk_addresources"> </a>

-  [Разработка надстроек SharePoint](develop-sharepoint-add-ins.md)
-  [Процесс обновления надстроек SharePoint](sharepoint-add-ins-update-process.md) 
    
 

