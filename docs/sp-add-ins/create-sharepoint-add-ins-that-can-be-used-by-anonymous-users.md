---
title: "Создание надстроек SharePoint, которые могут использовать анонимные пользователи"
ms.date: 09/25/2017
ms.prod: sharepoint
ms.openlocfilehash: 55d3a96a340e62ae27fbcd89dca3e9edc57d116b
ms.sourcegitcommit: 1cae27d85ee691d976e2c085986466de088f526c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/13/2017
---
# <a name="create-sharepoint-add-ins-that-can-be-used-by-anonymous-users"></a>Создание надстроек SharePoint, которые могут использовать анонимные пользователи
Узнайте, как создавать надстройки SharePoint, которые могут использовать анонимные пользователи на общедоступных веб-сайтах Microsoft SharePoint.
 

 **Примечание.** В настоящее время идет процесс замены названия "приложения для SharePoint" названием "надстройки SharePoint". Во время этого процесса в документации и пользовательском интерфейсе некоторых продуктов SharePoint и средств Visual Studio может по-прежнему использоваться термин "приложения для SharePoint". Дополнительные сведения см. в статье [Новое название приложений для Office и SharePoint](new-name-for-apps-for-sharepoint.md#bk_newname).
 


 **Важно!** При использовании термина "*локальная среда* SharePoint" в этой статье предполагается, что установлен пакет обновления 1 (SP1) для SharePoint.
 


## <a name="prerequisites-for-creating-anonymously-accessible-sharepoint-add-ins"></a>Предварительные требования для создания надстроек SharePoint с анонимным доступом

Анонимный доступ возможен для Надстройки SharePoint, размещенных в SharePoint и у поставщика. В зависимости от типа приложения изучите один из следующих наборов требований:
 
-  [Знакомство с созданием надстроек SharePoint с размещением в SharePoint](get-started-creating-sharepoint-hosted-sharepoint-add-ins.md)
    
-  [Знакомство с созданием надстроек SharePoint с размещением у поставщика](get-started-creating-provider-hosted-sharepoint-add-ins.md)
    
 
Вам также потребуется семейство сайтов в тестовой установке SharePoint, настроенной для анонимного доступа. Если у вас есть Сайт разработчиков Office 365, то уже существует связанное общедоступное семейство сайтов, использующее специальное определение общедоступного веб-сайта. (Дополнительные сведения об использовании общедоступных веб-сайтов в Microsoft SharePoint Online см. в статье  [Справка по общедоступному веб-сайту для Office 365](http://office.microsoft.com/en-gb/office365-sharepoint-online-enterprise-help/public-website-help-for-office-365-HA102891740.aspx?CTT=1).) Данное определение сайта недоступно для локальных установок SharePoint, поэтому если ваша тестовая установка находится в локальной среде, вам потребуются следующие компоненты:
 

 

- Веб-приложение SharePoint, настроенное для предоставления анонимного доступа. Его необходимо настроить после установки тестируемого Надстройка SharePoint.
    
 
- Семейство веб-сайтов в веб-приложении, которое также настроено для предоставления анонимного доступа. Его необходимо настроить после установки тестируемого Надстройка SharePoint.
    
 
- Если ваша надстройка размещается в SharePoint и имеет доступ к списку SharePoint, это значит, что список в семействе веб-сайтов настроен для анонимного доступа.
    
 
Инструкции для этих задач находятся в разделе [Настройка веб-приложения, семейства веб-сайтов и списка SharePoint для анонимного доступа](#Configuring).
 

 

## <a name="limitations-on-the-use-of-sharepoint-add-ins-by-anonymous-users"></a>Ограничения на использование надстроек SharePoint анонимными пользователями

При разработке надстройки SharePoint учитывайте следующие факты:
 

 

- Если Надстройка SharePoint запускается из SharePoint, оно должно содержать дополнительное действие, часть надстройки или должно запускаться с помощью настраиваемой ссылки на странице. Это связано с тем, что анонимные пользователи не могут запускать надстройку с помощью ее плитки. Для запуска надстроек с помощью плитки используется специальная  [страница приложения](http://msdn.microsoft.com/library/685c8e01-b163-4b5e-888c-421d9ecbb25e%28Office.15%29.aspx), недоступная анонимным пользователям. Другой вариант позволить запускать надстройку за пределами SharePoint, при этом требуется использовать политику авторизации только для надстройки.
    
 
- Анонимные пользователи могут только запускать надстройки SharePoint, установленные другими. Это связано с тем, что анонимные пользователи не могут открывать страницу **Добавление надстройки**.
    
 
- Когда вошедший в систему пользователь переходит на веб-сайт в локальном веб-приложении SharePoint, настроенном для анонимного доступа, удостоверение пользователя меняется на **системную учетную запись**. С помощью этого удостоверения устанавливать надстройки SharePoint нельзя. Так как анонимные пользователи также не могут устанавливать надстройки, это означает, что если веб-приложение настроено для анонимного доступа, никто не сможет установить надстройки SharePoint. Соответственно, следует установить надстройки SharePoint на веб-сайты в веб-приложении SharePoint до настройки анонимного доступа в веб-приложении. Чтобы установить другие надстройки позже, необходимо временно отключить анонимный доступ в веб-приложении. Это позволит устанавливать надстройки пользователю, вошедшему в систему.
    
 
- Чтобы разрешить использование интерфейсов API REST службы поиска SharePoint на локальном веб-сайте SharePoint, необходимо настроить XML запроса. Дополнительные сведения см. в статье о  [включении анонимных запросов поиска REST](http://msdn.microsoft.com/library/office/jj163876.aspx#bk_AnonymousREST).
    
 
- Данные на сайте надстройки не обходятся индексаторами поиска, поэтому пользовательские данные необходимо развернуть удаленно или на хост-сайте. Это относится ко всем Надстройки SharePoint, но мы решили упомянуть об этом, так как в приложениях с анонимным доступом часто требуются функции поиска.
    
 

## <a name="creating-provider-hosted-add-ins-that-are-anonymously-accessible"></a>Создание надстроек, размещенных у поставщика, которые доступны анонимным пользователям
<a name="Cloud-hosted"> </a>

Чтобы сделать размещаемую у поставщика надстройку доступной анонимным пользователям, нужно просто настроить ее для использования политики авторизации только для надстройки. При применении этой политики SharePoint даже не включает пользовательский контекст, поэтому не имеет значения, являются ли пользователи анонимными. Администратор клиента, который устанавливает надстройку, должен предоставить субъекту надстройки разрешения для хост-сайта (и любые разрешения для родительского семейства сайтов или родительского клиента). Как и для любых других надстроек, разрешения для доступа к хост-сайту запрашиваются в манифесте надстройки.
 

 

 **Примечание.** Если сайт SharePoint доступен анонимным пользователям, то обычно на нем разрешен доступ по протоколу HTTP, а не HTTPS. В этом сценарии при использовании политики только для надстроек существуют потенциальные проблемы для безопасности. Дополнительные сведения и описание способа устранения таких проблем см. в записи блога [Что каждый разработчик должен знать о приложениях SharePoint, CSOM и анонимных сайтах публикации](http://blogs.msdn.com/b/kaevans/archive/2013/10/24/what-every-developer-needs-to-know-about-sharepoint-apps-csom-and-anonymous-publishing-sites.aspx).
 

Для разработки надстройки, использующей политику только для надстроек, необходимо выполнить две вещи:
 

 

- Вы должны добавить строку `AllowAppOnlyPolicy="true"` в элемент **AppPermissionRequests**, находящийся в манифесте надстройки.
    
 
- Код должен запрашивать маркер доступа только для надстроек с сервера авторизации OAuth. Если вы работаете с управляемым кодом, существуют API-интерфейсы, предназначенные специально для этой цели и размещенные в файлах кода, созданных Инструменты разработчика Microsoft Office для Visual Studio: SharePointContext.cs (или с расширением VB) и TokenHelper.cs (или с расширением VB).
    
 
Дополнительные сведения о политике только для надстройки (с фрагментами кода), разрешениях для надстроек и манифесте надстройки см. в следующих темах:
 

 

-  [Типы политик авторизации надстроек в SharePoint](add-in-authorization-policy-types-in-sharepoint.md)
    
 
-  [Разрешения для надстроек в SharePoint](add-in-permissions-in-sharepoint.md)
    
 
-  [Изучение структуры манифеста приложения и пакета надстройки SharePoint](explore-the-app-manifest-structure-and-the-package-of-a-sharepoint-add-in.md)
    
 

## <a name="creating-sharepoint-hosted-add-ins-that-are-anonymously-accessible"></a>Создание надстроек, размещенных в SharePoint, которые доступны анонимным пользователям
<a name="SP-hosted"> </a>

Для создания размещенной в SharePoint надстройки, которую могут запускать анонимные пользователи, не требуются специальные методики. Ее можно создать так же, как любую другую надстройку, размещенную в SharePoint. Дополнительные сведения см. в статьях  [Знакомство с созданием надстроек SharePoint с размещением в SharePoint](get-started-creating-sharepoint-hosted-sharepoint-add-ins.md) и [Выполнение базовых операций с использованием кода библиотеки JavaScript в SharePoint](complete-basic-operations-using-javascript-library-code-in-sharepoint.md).
 

 
Для предоставления анонимным пользователям доступа к надстройке, размещенной в SharePoint, важно то, что семейство сайтов SharePoint Online настраивает администратор клиента, чтобы разрешить анонимный доступ. Разработчик надстройки не может выполнить такую настройку в надстройке, удаленном приемнике событий надстройки или в инфраструктуре установке надстройки для SharePoint. Вы можете добавить настраиваемый список или библиотеку в надстройку, но Язык CAML не предоставляет возможностей для предварительной настройки анонимного доступа. Поэтому его придется настроить после установки надстройки.
 

 
Если для продажи своей надстройки вы используете Магазин Office, и существенная часть потенциальных клиентов сочтет ее полезной при наличии доступа для анонимных пользователей, то в этом случае следует указать это требование в описании надстройки. Кроме того, рекомендуется добавить указанную ниже версию процедуры **настройки семейства веб-сайтов SharePoint Online для анонимного доступа** на страницу поддержки вашей надстройки.
 

 
Если ваша надстройка использует объектную модель JavaScript (JSOM) в SharePoint, существует одно очень важное требование к конфигурации. По умолчанию анонимным пользователям доступна только малая часть API JSOM. Для доступа к другим API у пользователей должно быть разрешение **Использование удаленных интерфейсов**, которое отсутствует у анонимных пользователей. Это требование необходимо отключить в родительском семействе веб-сайтов или родительском веб-приложении SharePoint веб-сайта, на котором установлена надстройка, как описано в разделе [Настройка веб-приложения, семейства веб-сайтов и списка SharePoint для анонимного доступа](#Configuring).
 

 

 **Примечание.** Отключение требования наличия разрешения **Использование удаленных интерфейсов** у пользователей влияет на конфиденциальность информации. Дополнительные сведения см. в записи блога [о том, что каждый разработчик должен знать о приложениях SharePoint, CSOM и анонимных сайтах публикации](http://blogs.msdn.com/b/kaevans/archive/2013/10/24/what-every-developer-needs-to-know-about-sharepoint-apps-csom-and-anonymous-publishing-sites.aspx).
 


## <a name="limitations-of-sharepoint-hosted-add-ins-for-anonymous-users"></a>Ограничения, налагаемые на надстройки, размещенные в SharePoint и доступные для анонимных пользователей
<a name="SP-hosted"> </a>

Будем честны: надстройки, размещаемые в SharePoint и доступные для анонимных пользователей, имеют несколько важных ограничений, которые необходимо учитывать:
 

 

- Невозможно сделать список или библиотеку в SharePoint Online доступными анонимным пользователям. Соответственно, API-интерфейсы JSOM, взаимодействующие со списками и библиотеками, не работают в SharePoint Online для анонимных пользователей.
    
 
- Размещенная в SharePoint надстройка, установленная на  *локальном*  веб-сайте SharePoint, может использовать все API JSOM. Тем не менее необходимо *вручную*  настроить веб-приложение, семейство сайтов и его списки и библиотеки для анонимного доступа, а требование наличия разрешения на **использование удаленных интерфейсов** следует отключить. Если надстройка устанавливает настраиваемые списки и библиотеки на сайт надстройки, то пользователям необходимо вручную настроить их для анонимного доступа после установки надстройки.
    
 
- Так как данные на сайте надстройки не обходятся индексаторами поиска и не существует способа установки настраиваемых списков или библиотек на хост-сайте, а у размещенных в SharePoint надстроек не может быть удаленных компонентов или приемников событий, пользовательские данные в размещенной в SharePoint надстройке недоступны для поиска.
    
 

## <a name="configuring-an-sharepoint-web-application-and-site-collection-and-list-for-anonymous-access"></a>Настройка веб-приложения, семейства веб-сайтов и списка SharePoint для анонимного доступа
<a name="Configuring"> </a>

Если тестовая установка SharePoint расположена в локальной среде, необходимо выполнить первые две процедуры, представленные ниже, чтобы проверить, доступно ли ваше Надстройка SharePoint анонимным пользователям. Пользователи, устанавливающие ваше Надстройка SharePoint, также должны выполнить эти процедуры для родительского семейства сайтов и веб-приложения любого веб-сайта, на котором установлено ваше Надстройка SharePoint.
 

 

 **Важно!** Если это возможно, установите надстройку SharePoint на веб-сайт *до* выполнения первых двух процедур. Невозможно установить надстройки на какой-либо веб-сайт в локальном веб-приложении SharePoint, если это веб-приложение было настроено для анонимного доступа. Если оно уже настроено для анонимного доступа, то чтобы установить надстройку, необходимо временно отключить анонимный доступ.
 


### <a name="to-configure-the-parent-web-application-for-anonymous-access"></a>Настройка родительского веб-приложения для анонимного доступа 


1. В **центре администрирования** выберите **Управление приложениями**, а затем — **Управление веб-приложениями**.
    
 
2. (Необязательно) Если вы не хотите разрешать анонимный доступ для существующих веб-приложений SharePoint, создайте новое веб-приложение. (Хотя на форме создания веб-приложения можно разрешить анонимный доступ,  *не используйте соответствующий параметр*  . Анонимный доступ следует включать только *после*  установки Надстройка SharePoint.) Дополнительные сведения см. в статье [Create a web application in SharePoint](http://msdn.microsoft.com/library/121c8d83-a508-4437-978b-303096aa59df.aspx).
    
 
3. В списке веб-приложений выберите приложение, которое необходимо сделать доступным для анонимных пользователей, и выберите на ленте команду **Поставщики проверки подлинности**.
    
 
4. В открывшейся выноске выберите зону, для которой следует включить анонимный доступ. Как правило, это зона **Интернет** или **По умолчанию**. После этого откроется форма **Изменение параметров проверки подлинности**.
    
 
5. Установите флажок **Разрешить анонимный доступ**, если это еще не сделано. Этот параметр задает настройку по умолчанию, которую можно отключить для определенных семейств веб-сайтов. Но если не включить данный параметр для веб-приложения, вы не сможете разрешить анонимный доступ для какого-либо семейства веб-сайтов.
    
 
6. (Необязательно.) Снимите флажок **Требовать разрешения на использование удаленных интерфейсов**. Это позволит коду и сценариям, выполняемым в контексте анонимного пользователя, совершать вызовы клиентской объектной модели SharePoint в каждом семействе веб-сайтов. Повторно включить это требование для семейств веб-сайтов невозможно. Если оставить флажок установленным, то по умолчанию анонимные пользователи не смогут получить доступ к клиентским объектным моделям, но вы можете отключить это требование (и предоставить доступ) для определенных семейств веб-сайтов.
    
     **Примечание.** Если вы разрабатываете надстройки SharePoint для анонимных пользователей, этот параметр имеет значение только для надстроек, размещенных в SharePoint. Надстройки SharePoint, размещенные у поставщика и предназначенные для анонимного доступа, используют способ, не зависящий от разрешений пользователей. Дополнительные сведения см. в разделе [Создание надстроек, размещенных у поставщика, которые доступны анонимным пользователям](#Cloud-hosted) выше.
7. Чтобы закрыть форму, нажмите кнопку **Сохранить**.
    
 
8. С выделенным веб-приложением выберите на ленте пункт **Политика анонимного доступа**.
    
 
9. В форме **Ограничения для анонимного доступа** выберите зону и убедитесь, что переключатель **Нет** активирован. Если тестируемой надстройке SharePoint требуются права на доступ к данным SharePoint, выберите переключатель **Запретить запись**.
    
     **Примечание.** Если вы разрабатываете надстройки SharePoint для анонимных пользователей, то это еще один параметр, который имеет значение только для надстроек, размещенных в SharePoint.
10. Если на этапе 2 вы создали новое веб-приложение, вам необходимо создать в нем семейство веб-сайтов.
    
 

### <a name="to-configure-an-on-premises-site-collection-for-anonymous-access"></a>Настройка локального семейства веб-сайтов для анонимного доступа


1. На домашней странице семейства веб-сайтов в веб-приложении выберите значок шестеренки, а затем — пункт **Параметры сайта**.
    
 
2. В разделе **Пользователи и разрешения** на странице **Параметры сайта** выберите пункт **Разрешения для сайта**.
    
 
3. На ленте выберите **Анонимный доступ**.
    
 
4. На форме **Анонимный доступ** выберите **Разрешен ко всему сайту** или **Списки и библиотеки** в зависимости от уровня доступа, необходимого для тестируемой надстройки. (Независимо от выбранного параметра анонимные пользователи не смогут получить доступ к списку или библиотеке в надстройке, размещенной в SharePoint, если список или библиотека не были отдельно настроены для анонимного доступа. Ниже показано, как это сделать.)
    
 
5. Если тестируемой надстройке требуется доступ к клиентской объектной модели SharePoint, убедитесь, что флажок **Требовать разрешения на использование удаленных интерфейсов** *не* установлен. Если флажок недоступен, это значит, что требование было отключено на уровне веб-приложения, что равносильно снятию флажка. (Как было указано в предыдущей процедуре, если вы разрабатываете надстройки SharePoint для анонимных пользователей, то этот параметр имеет значение только для приложений, размещенных в SharePoint.)
    
 

 **Важно!** Следующую процедуру можно выполнить на общедоступном веб-сайте в SharePoint Online. (Дополнительные сведения об использовании общедоступных веб-сайтов в Microsoft SharePoint Online см. в статье [Сведения об общедоступных веб-сайтах в Office 365](http://office.microsoft.com/en-gb/office365-sharepoint-online-enterprise-help/public-website-help-for-office-365-HA102891740.aspx?CTT=1).)
 


### <a name="to-configure-a-sharepoint-online-site-collection-for-anonymous-access"></a>Настройка семейства веб-сайтов SharePoint Online для анонимного доступа


1. Выполните вход в Office 365 с правами администратора клиента.
    
 
2. В верхнем правом углу домашней страницы семейства веб-сайтов выберите пункт **Сделать веб-сайт общедоступным**. Это действие также отключает параметр **Требовать разрешение на использование удаленных интерфейсов**.
    
 
Если вы разрабатываете размещенную в SharePoint надстройку, которая получает доступ к списку SharePoint, необходимо выполнить указанную ниже процедуру в тестовом семействе сайтов. Пользователи надстройки также должны сделать это на любом веб-сайте, где она установлено. Не существует программного или описательного способа настройки анонимного доступа для списка. Надстройки могут устанавливать настраиваемые списки, но невозможно предварительно настроить анонимный доступ для списков. Настройка выполняется вручную после установки надстройки. Если вы создаете размещенное у поставщика Надстройка SharePoint для анонимных пользователей, эта процедура не требуется.
 

 

 **Примечание.** Данную процедуру невозможно выполнить в семействе веб-сайтов SharePoint Online, поэтому размещенные в SharePoint надстройки, которые установлены в SharePoint Online и предназначены для анонимных пользователей, не смогут получать доступ к спискам и библиотекам.
 


### <a name="to-configure-an-list-or-library-for-anonymous-access"></a>Настройка списка или библиотеки для анонимного доступа


1. Перейдите к списку или библиотеке, к которым обращается тестируемая надстройка SharePoint, и откройте **Параметры списка** или **Параметры библиотеки**. Для сайта SharePoint Online необходимо войти в систему в качестве администратора клиента.
    
 
2. Выберите **Разрешения для этого списка или библиотеки**.
    
 
3. На открывшейся странице выберите **Прекратить наследование разрешений** на вкладке **Разрешения** и нажмите **ОК** в запросе подтверждения.
    
 
4. Выберите **Анонимный доступ** на вкладке **Разрешения**.
    
 
5. В открывшейся форме **Анонимный доступ** выберите все разрешения, необходимые пользователям надстройки SharePoint. Вы можете разрешить просмотр, изменение, добавление и удаление элементов. Однако предоставить полный доступ не удастся; это сделано для того, чтобы анонимные пользователи не могли изменить схему или параметры списка.
    
 

## <a name="additional-resources"></a>Дополнительные ресурсы
<a name="bk_addresources"> </a>


-  [Разработка надстроек SharePoint](develop-sharepoint-add-ins.md)
    
 

