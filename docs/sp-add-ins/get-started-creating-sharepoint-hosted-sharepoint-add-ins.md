# <a name="get-started-creating-sharepoint-hosted-sharepoint-add-ins"></a>Знакомство с созданием надстроек SharePoint с размещением в SharePoint
Узнайте, как настроить среду разработки и создать свою первую надстройку SharePoint с размещением в SharePoint.
 

 **Примечание.** В настоящее время идет процесс замены названия "приложения для SharePoint" названием "надстройки SharePoint". Во время этого процесса в документации и пользовательском интерфейсе некоторых продуктов SharePoint и средств Visual Studio может по-прежнему использоваться термин "приложения для SharePoint". Дополнительные сведения см. в статье [Новое название приложений для Office и SharePoint](new-name-for-apps-for-sharepoint#bk_newname).
 

Надстройки с размещением в SharePoint — это один из двух основных типов надстроек SharePoint. Обзор надстроек SharePoint и этих основных типов см. в статье [Надстройки SharePoint](sharepoint-add-ins). Ниже представлен обзор надстроек с размещением в SharePoint.
 

- Они содержат списки SharePoint, веб-части, рабочие процессы, пользовательские страницы и другие компоненты, каждый из которых установлен на дочернем сайте (сайте надстройки) того веб-сайта SharePoint, на котором установлена надстройка.
    
 
- Единственный код, который они содержат, — JavaScript пользовательских страниц SharePoint.
    
 
- [Этап 1. Настройка среды разработки](get-started-creating-sharepoint-hosted-sharepoint-add-ins#Setup) 

- [Этап 2. Создание проекта приложения](get-started-creating-sharepoint-hosted-sharepoint-add-ins#Create) 

- [Этап 3. Написание кода приложения](get-started-creating-sharepoint-hosted-sharepoint-add-ins#Code)
 

## <a name="set-up-your-dev-environment"></a>Настройка среды разработки
<a name="Setup"> </a>

Существует множество способов настройки среды разработки для Надстройки SharePoint. Здесь приведен самый простой способ. Остальные см. в разделе  [Дополнительные ресурсы](#bk_addresources).
 

 

### <a name="get-the-tools"></a>Получение инструментов


- Если у вас еще не установлена среда **Visual Studio** 2013 или более поздней версии, установите ее, следуя инструкциям на странице [Установка Visual Studio](http://msdn.microsoft.com/library/da049020-cfda-40d7-8ff4-7492772b620f.aspx). Рекомендуем использовать [последнюю версию из Центра загрузки Майкрософт](https://www.visualstudio.com/downloads/download-visual-studio-vs).
    
 
- В состав Visual Studio входят **Инструменты разработчика Microsoft Office для Visual Studio**. Иногда выпуск новой версии инструментов не совпадает с выходом обновлений Visual Studio. Чтобы убедиться, что у вас установлена последняя версия инструментов, запустите [установщик Инструментов разработчика Office для Visual Studio 2013](http://aka.ms/OfficeDevToolsForVS2013) или [установщик Инструментов разработчика Office для Visual Studio 2015](http://aka.ms/OfficeDevToolsForVS2015). 
    
 

### <a name="sign-up-for-an-office-365-developer-site"></a>Получение Сайта разработчика для Office 365
<a name="o365_signup"> </a>


 **Примечание.** Возможно, у вас уже есть доступ к Сайту разработчика для Office 365. **Вы являетесь подписчиком MSDN?** Visual Studio Ultimate и Visual Studio Premium с подпиской на MSDN включают бесплатную подписку разработчика приложений для Office 365. [Воспользуйтесь этим преимуществом прямо сегодня.](https://msdn.microsoft.com/subscriptions/manage/default.aspx) **У вас есть один из указанных ниже планов подписки на Office 365?** **В этом случае администратор подписки на Office 365 может создать Сайт разработчика, ** используя [Центр администрирования Office 365](https://portal.microsoftonline.com/admin/default.aspx). Дополнительные сведения см. в статье [Создание сайта разработчика для существующей подписки на Office 365](create-a-developer-site-on-an-existing-office-365-subscription). 
 

Получить план Office 365 можно тремя способами. 
 

 

- Бесплатно зарегистрируйте учетную запись разработчика Office 365 через программу для разработчиков Office 365 сроком на один год.  [Узнайте больше на сайте программы ](http://dev.office.com/devprogram) или заполните [форму регистрации](https://profile.microsoft.com/RegSysProfileCenter/wizardnp.aspx?wizid=14b845d0-938c-45af-b061-f798fbb4d170). После регистрации в программе для разработчиков вы получите сообщение электронной почты со ссылкой для входа в учетную запись разработчика. Затем следуйте приведенным ниже инструкциям.
    
 
- Начните с [бесплатной 30-дневной пробной версии](https://portal.microsoftonline.com/Signup/MainSignUp.aspx?OfferId=6881A1CB-F4EB-4db3-9F18-388898DAF510&amp;DL=DEVELOPERPACK) с лицензией для одного пользователя.
    
 
- Приобретите [подписку разработчика приложений для Office 365](https://portal.microsoftonline.com/Signup/MainSignUp.aspx?OfferId=C69E7747-2566-4897-8CBA-B998ED3BAB88&amp;DL=DEVELOPERPACK). 
    
 

 **Совет.** Откройте эти ссылки в новом окне или на новой вкладке, чтобы работать с ними было удобнее.
 


**Рис. 1. Доменное имя Сайта разработчика Office 365**

 

 
![Страница 2 регистрационной формы для учетной записи Office 365](../../images/ff384c69-56bf-4ceb-81c3-8b874e2407f0.png)
 

 

 

 

1. Первая страница (не показана) регистрационной формы не требует объяснений. Укажите нужные сведения и нажмите кнопку **Далее**.
    
 
2. На второй странице (рис. 1) укажите ИД администратора подписки.
    
 
3. Создайте поддомен **.onmicrosoft.com**, например contoso.onmicrosoft.com.
    
    После регистрации необходимо использовать полученные учетные данные (в формате _ИД_пользователя_@ _ваш_домен_.onmicrosoft.com) для входа на сайт портала Office 365, используемый для администрирования учетной записи. Сайт разработчика для SharePoint Online будет установлен на новом домене: **http:// _ваш_домен_.sharepoint.com**.
    
 
4. Нажмите кнопку **Далее** и заполните последнюю страницу формы. Если вы хотите указать номер телефона, чтобы получить код подтверждения, можно ввести номер мобильного или стационарного телефона, но *не* номер VoIP.
    
 

    
 **Примечание.** Если при попытке зарегистрировать учетную запись разработчика выполнен вход в другую учетную запись Майкрософт, может появиться следующее сообщение: "Введен неправильный ИД пользователя. Возможно, он недействителен. Убедитесь, что вы вводите ИД пользователя, назначенный вам организацией. Он должен выглядеть так: *proverka@example.com* или *proverka@example.onmicrosoft.com*". Если появляется такое сообщение, выйдите из текущей учетной записи Майкрософт и повторите попытку. Если сообщение продолжает появляться, очистите кэш браузера или выберите режим **Просмотр InPrivate**, а затем заполните форму.
 

По завершении регистрации в браузере откроется страница установки Office 365. Щелкните значок администратора, чтобы открыть страницу Центра администрирования.
 

 

**Рис. 2. Страница Центра администрирования Office 365**

 

 
![Снимок экрана с изображением Центра администрирования Office 365.](../../images/SP15_Office365AdminInset_border.png)
 

 

1. Подождите, пока завершится настройка Сайта разработчика. После этого обновите страницу центра администрирования в браузере.
    
 
2. Затем перейдите по ссылке **Создание надстроек** в левом верхнем углу страницы, чтобы открыть Сайт разработчика. Должен открыться сайт, показанный на рис. 3. На странице отображается список **Тестируемые надстройки**, подтверждающий, что веб-сайт был создан с помощью шаблона Сайта разработчика SharePoint. Если вместо него вы видите обычный сайт группы, подождите несколько минут и откройте сайт заново.
    
 
3. Запишите URL-адрес сайта. Он используется при создании проектов надстроек SharePoint в Visual Studio.
    
 

**Рис. 3. Домашняя страница Сайта разработчика со списком "Тестируемые надстройки"**

 

 
![Снимок экрана с изображением домашней страницы Сайта разработчика.](../../images/SP15_DeveloperSiteHome_border.png)
 

 

 

## <a name="create-the-add-in-project"></a>Создание проекта надстройки
<a name="Create"> </a>


1. Запустите Visual Studio, выбрав команду **Запуск от имени администратора**.
    
 
2. Последовательно выберите элементы **Файл** > **Создать** > **Новый проект**.
    
 
3. В диалоговом окне **Новый проект** последовательно разверните узлы **Visual C#** и **Office/SharePoint**, а затем выберите элементы **Надстройки** > **Надстройка для SharePoint**.
    
 
4. Присвойте проекту имя EmployeeOrientation, а затем нажмите кнопку **ОК**.
    
 
5. В первом диалоговом окне **Укажите параметры надстройки для SharePoint** введите полный URL-адрес сайта SharePoint, который вы собираетесь использовать для отладки надстройки. Это URL-адрес Сайта разработчика. Укажите в URL-адресе протокол HTTPS, а не HTTP. В диалоговом окне **Как требуется разместить надстройку SharePoint?** выберите вариант **Размещено в SharePoint** и нажмите кнопку **Готово**.
    
 
6. Вам может потребоваться войти на свой Сайт разработчика. В этом случае используйте учетные данные администратора подписки.
    
 
7. После создания проекта откройте файл **/Pages/Default.aspx** из корневой папки проекта. Помимо прочего, этот созданный файл загружает один или оба сценария, размещенные в SharePoint: sp.runtime.js и sp.js. Часть кода для загрузки этих файлов можно найти в элементе управления **Content** в начале файла с идентификатором **PlaceHolderAdditionalPageHead**. Часть кода зависит от используемой версии **Инструментов разработчика Microsoft Office для Visual Studio**. Согласно руководствам из этой серии необходимо загрузить оба файла с обычными HTML-тегами **\<script\>**, а не с тегами **\<SharePoint:ScriptLink\>**. Убедитесь, что приведенные ниже строки присутствуют в элементе управления **PlaceHolderAdditionalPageHead** *над* строкой `<meta name="WebPartPageExpansion" content="full" />`.
    
```
  <script type="text/javascript" src="/_layouts/15/sp.runtime.js"></script> 
  <script type="text/javascript" src="/_layouts/15/sp.js"></script> 

```


Проверьте файл на наличие другой разметки, загружающей один или оба файла сценария и удалите ее. Сохраните и закройте файл.
    
 

## <a name="code-your-add-in"></a>Написание кода надстройки
<a name="Code"> </a>

Для вашей первой надстройки SharePoint с размещением в SharePoint мы включим классическое расширение SharePoint: настраиваемый список и его экземпляр.
 

 

1. В **обозревателе решений** откройте файл AppManifest.xml.
    
 
2. Когда откроется конструктор манифеста, измените значение в поле **Заголовок** на "Employee Orientation" (Обучение сотрудников). *Не* меняйте значение в поле **Имя** .
    
 
3. Сохраните и закройте файл.
    
 
4. Щелкните проект правой кнопкой мыши в **обозревателе решений** и выберите пункты **Добавить** > **Новая папка**. Укажите для папки имя "Lists" (Списки).
    
 
5. Щелкните новую папку правой кнопкой мыши и выберите пункты **Добавить** > **Новый элемент**. Откроется диалоговое окно **Добавление нового элемента** для узла **Office/SharePoint**.
    
 
6. Выберите элемент **Список**. Задайте для него имя NewEmployeeOrientation и нажмите кнопку **Добавить**. 
    
 
7. На странице **Выберите параметры списка** в **мастере настройки SharePoint** оставьте заданное по умолчанию отображаемое имя списка **NewEmployeeOrientation**, нажмите кнопку **Создать настраиваемый шаблон списка и экземпляр списка на его основе** и в раскрывающемся списке выберите **По умолчанию (настраиваемый список)**. Затем нажмите кнопку **Готово**.
    
 
8. Мастер создаст шаблон списка **NewEmployeeOrientation** с дочерним экземпляром списка под названием **NewEmployeeOrientationInstance**. При этом может открыться конструктор списков, который понадобится на следующем этапе.
    
 
9. Разверните узел **NewEmployeeOrientationInstance** в **обозревателе решений**, если вы еще не сделали этого, чтобы вам было легко отличать файл elements.xml, являющийся дочерним элементом *экземпляра* списка, от файла elements.xml, который представляет собой дочерний элемент *шаблона* списка.
    
    **Узел списков в обозревателе решений**

 

  ![Содержимое папки с дочерним шаблоном NewEmployeeOrientation, у которого есть три дочерних элемента (NewEmployeeOrientationInstance, файл elements.xml и файл schema.xml). У экземпляра есть дочерний элемент elements.xml.](../../images/10e5d116-d24b-4a44-bfff-cfbf2f971b1e.PNG)
 

    
    
 
10. Откройте дочерний элемент elements.xml в шаблоне списка **NewEmployeeOrientation**.
    
 
11. Измените значение атрибута **DisplayName** (не атрибута **Name**), чтобы имя стало более понятным: "Обучение новых сотрудников".
    
 
12. Задайте для атрибута **Description** значение "Orientation information about new employees" (Сведения об адаптации новых сотрудников).
    
 
13. Оставьте для других атрибутов значения по умолчанию, сохраните и закройте файл.
    
 
14. Если конструктор списков не открыт, выберите узел **NewEmployeeOrientation** в **обозревателе решений**.
    
 
15. Откройте вкладку **Список** конструктора. Эта вкладка используется для установки определенных значений *экземпляра* (не *шаблона*) списка, но она содержит некоторые значения по умолчанию, унаследованные от шаблона.
    
 
16. Замените значения на этой вкладке следующими:
    
      -  **Заголовок**: "New Employees in Seattle" (Новые сотрудники в Сиэтле).
    
 
  -  **URL-адрес списка**: Lists/NewEmployeesInSeattle.
    
 
  -  **Описание**: "New Employees in Seattle" (Новые сотрудники в Сиэтле).
    
 

     Не меняя состояние флажков, сохраните файл и закройте конструктор.
    
 
17. В **обозревателе решений** может отображаться старое имя экземпляра списка. В этом случае откройте контекстное меню узла **NewEmployeeOrientationInstance**, выберите пункт **Переименовать** и измените имя на NewEmployeesInSeattle.
    
 
18. Откройте файл schema.xml.
    
 
19. В элементе **View**, значение **BaseViewID** которого равно 0, замените имеющийся элемент **ViewFields** на приведенную ниже часть кода. Используйте именно этот GUID для параметра **FieldRef** с именем `Title`.
    
     *В этом автоматически созданном файле schema.xml могут встречаться странные разрывы строк. Проверьте наличие соответствующих открывающих и закрывающих тегов для элемента **ViewFields**. Добавьте разрывы строк для удобочитаемости.* 
    


```
  <ViewFields>
  <FieldRef Name="Title" ID="{fa564e0f-0c70-4ab9-b863-0177e6ddd247}" DisplayName="Employee" />
  </ViewFields>
```

20. Не закрывая файл schema.xml, в элементе **View**, значение **BaseViewID** которого равно 1, замените элемент **ViewFields** на приведенную ниже часть кода. Используйте именно этот GUID для параметра **FieldRef** с именем `LinkTitle`.
    
```
  <ViewFields>
  <FieldRef Name="LinkTitle" ID="{82642ec8-ef9b-478f-acf9-31f7d45fbc31}" DisplayName="Employee" />
  </ViewFields>
```

21. Сохраните и закройте файл schema.xml.
    
 
22. Откройте файл elements.xml, который представляет собой дочерний элемент *экземпляра* списка **NewEmployeesInSeattle** (а не *шаблона* списка **NewEmployeeOrientation**).
    
 
23. В этом файле заполните список начальными данными. Для этого добавьте приведенную ниже часть кода с элементом **Data** в качестве дочернего элемента **ListInstance**.
    
```
  <Data>
  <Rows>
    <Row>
      <Field Name="Title">Tom Higginbotham</Field>
    </Row>
    <Row>
      <Field Name="Title">Satomi Hayakawa</Field>
    </Row>
    <Row>
      <Field Name="Title">Cassi Hicks</Field>
    </Row>
    <Row>
      <Field Name="Title">Lertchai Treetawatchaiwong</Field>
    </Row>
  </Rows>
</Data>
```

24. Сохраните и закройте файл.
    
 
25.  В **обозревателе решений** дважды щелкните элемент **Компонент1**, чтобы открыть конструктор компонентов. В конструкторе укажите для параметра **Заголовок** значение "New Employee Orientation Components" (Компоненты для обучения новых сотрудников), а для параметра **Описание** — значение "Lists and other components for getting employees oriented to the company" (Списки и другие компоненты для обучения сотрудников в компании). Сохраните файл и закройте конструктор.
    
 
26. Если элемент **Компонент1** в **обозревателе решений** не был переименован автоматически, откройте его контекстное меню, выберите пункт **Переименовать** и укажите имя NewEmployeeOrientationComponents.
    
 
27. Откройте файл Default.aspx.
    
 
28. Найдите элемент **Content** ASP.NET с идентификатором **PlaceHolderPageTitleInTitleArea**. Замените заданную по умолчанию строку "Page Title" (Заголовок страницы) на "New Employees by Location" (Новые сотрудники по месту работы).
    
 
29. Найдите элемент **Content** ASP.NET с идентификатором **PlaceHolderMain**. *Замените* его содержимое на приведенную ниже часть кода. ` _spPageContextInfo` — это объект JavaScript, который SharePoint автоматически добавляет на страницу. Его свойство `webAbsoluteUrl` возвращает URL-адрес сайта надстройки.
    
```XML
    <p><asp:HyperLink runat="server" 
    NavigateUrl="JavaScript:window.location = _spPageContextInfo.webAbsoluteUrl + '/Lists/NewEmployeesInSeattle/AllItems.aspx';" 
    Text="New Employees in Seattle" /></p>
```


## <a name="run-the-add-in-and-test-the-list"></a>Запуск надстройки и тестирование списка
<a name="Code"> </a>


 

 

1. Нажмите клавишу F5, чтобы развернуть и запустить надстройку. Visual Studio выполнит временную установку и немедленный запуск надстройки на тестовом сайте SharePoint. (Сведения о том, как пользователи запускают установленное Надстройка SharePoint, см. в разделе  [Дальнейшие действия](#Nextsteps).)
    
 
2. Когда откроется страница надстройки, используемая по умолчанию, перейдите по ссылке **New Employees in Seattle** (Новые сотрудники в Сиэтле), чтобы открыть экземпляр настраиваемого списка.
    
    **Страница по умолчанию и страница представления списка**

 

  ![Отображается страница по умолчанию надстройки, озаглавленная "Новые сотрудники по расположению". Ссылка "Новые сотрудники в Сиэтле". Стрелка от этой ссылки указывает на страницу списка. Она называется "Новые сотрудники в Сиэтле", список приведен ниже.](../../images/9dc5cefe-083a-4807-bee6-473001f23db9.png)
 

    
    
 
3. Добавьте и удалите элементы в списке.
    
 
4. Для завершения сеанса отладки закройте окно браузера или остановите отладку в Visual Studio. При каждом нажатии клавиши F5 Visual Studio отзовет предыдущую версию надстройки и установит самую последнюю.
    
 
5. Эти надстройка и решение Visual Studio будут рассматриваться и в других статьях, поэтому при перерывах в работе рекомендуется отзывать надстройку. В **обозревателе решений** щелкните проект правой кнопкой мыши и выберите пункт **Отозвать**.
    
 

## 
<a name="Nextsteps"> </a>

Пока в списке указано немного сведений об адаптации. Мы добавим некоторые из них в новых статьях из этой серии. А пока отвлекитесь слегка от написания кода и почитайте о том, как развертывать Надстройки SharePoint, в статье  [Развертывание и установка надстроек для SharePoint](deploy-and-install-a-sharepoint-hosted-sharepoint-add-in).
 

 

