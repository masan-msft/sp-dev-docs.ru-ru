
# <a name="important-aspects-of-the-sharepoint-add-in-architecture-and-development-landscape"></a>Важные аспекты разработки и архитектуры для надстроек SharePoint
Изучите аспекты архитектуры Надстройки SharePoint и Модель для надстроек SharePoint, включая варианты размещения надстроек, параметры пользовательского интерфейса, систему развертывания, систему безопасности и жизненный цикл. В этой статье содержатся сведения, дополняющие статью  [Надстройки SharePoint](sharepoint-add-ins).
 

 **Примечание.** Название "приложения для SharePoint" изменилось на "надстройки SharePoint". В процессе перехода с одного названия на другое в документации и пользовательском интерфейсе некоторых продуктов SharePoint и средств Visual Studio может по-прежнему использоваться термин "приложения для SharePoint". Дополнительные сведения см. в статье [Новое название приложений для Office и SharePoint](new-name-for-apps-for-sharepoint#bk_newname).
 


## <a name="sharepoint-add-ins-hosting-options"></a>Варианты размещения для надстроек SharePoint
<a name="SPAppModelArch_SPCenteredVsCloudCentered"> </a>

Модель надстроек SharePoint предусматривает следующие способы для размещения компонентов надстройки: 
 

 

-  **Размещение у поставщика.** Надстройки, которые содержат по крайней мере один удаленный компонент и могут содержать компоненты SharePoint, разворачиваются в соответствии с вашей логикой на вашем оборудовании или в учетной записи облака, либо разворачиваются на оборудовании клиента или в его учетной записи облака с помощью предоставленных вами программ установки и инструкций.
    
 
-  **Размещение в SharePoint.** Надстройки, содержащие только компоненты SharePoint и логику, которая выполняется на клиенте.
    
 
Дополнительные сведения о вариантах размещения и некоторые рекомендации по их выбору см. в статье  [Выбор шаблонов для разработки и размещения надстройки SharePoint](choose-patterns-for-developing-and-hosting-your-sharepoint-add-in).
 

 

## <a name="add-in-webs-host-webs-features-and-sharepoint-components-in-add-ins"></a>Сайты надстроек, хост-сайты, функции и компоненты SharePoint в надстройках
<a name="SPComponents"> </a>

Веб-сайт, на котором устанавливается надстройка SharePoint, называется хост-сайтом. Однако некоторые важные части надстройки SharePoint (будь то компоненты SharePoint или внешние компоненты) не разворачиваются на хост-сайте. Внешние веб-части разворачиваются на внешних серверах или в облачных учетных записях. Компоненты SharePoint разворачиваются на специальном веб-сайте в его собственном домене. Он называется сайтом надстройки. На хост-сайте разворачивается только ограниченный набор элементов пользовательского интерфейса, которые предоставляют пользователям доступ к другим компонентам надстройки, развернутым на хост-сайте. Эти компоненты пользовательского интерфейса на хост-сайте разворачиваются как часть компонента хост-сайта — компонента, который свободно располагается в пакете надстройки, а не в WSP-файле. Компоненты, которые разворачиваются на сайте надстройки, всегда являются компонентами, входящими в WSP-файл. Оба типа компонентов должны иметь область **Web**. Другие области невозможны для компонентов в надстройках SharePoint.
 

 
Как правило, любой компонент SharePoint, не включающий пользовательский код, который работает на серверах SharePoint, можно включать в Надстройка SharePoint (и разворачивать на сайте надстройки). Однако имеются некоторые исключения и нюансы того, как и где разворачиваются компоненты. Дополнительные сведения об этих нюансах, а также о хост-сайтах, изолированных сайтах надстройки и компонентах в надстройках см. в статье  [Хост-сайты, сайты надстроек и компоненты SharePoint в SharePoint](host-webs-add-in-webs-and-sharepoint-components-in-sharepoint-2013).
 

 

## <a name="accessing-the-add-in-from-the-ui"></a>Доступ к надстройке из пользовательского интерфейса
<a name="AccessingApp"> </a>

Когда надстройка SharePoint устанавливается на веб-сайте, эта надстройка указывается на странице **содержания** хост-сайта. Пользователи могут запускать надстройку с этой страницы. При таком запуске надстройка открывается в полноэкранном режиме.
 

 
Можно также вызвать надстройку SharePoint в веб-части надстройки. Веб-часть такого типа представлена классом **ClientWebPart** и, в сущности, является оболочкой для IFrame, где будет размещаться страница надстройки. В самом простом случае единственным существенным свойством этой веб-части является URL-адрес, который указывает на страницу. Но веб-части могут иметь настраиваемые свойства, которые пользователи могут устанавливать в инструментальной части. Эти свойства можно использовать, например, для установки сведений о контексте, таких как почтовый индекс пользователя. Чтобы включить такую веб-часть в надстройку, следует создать в надстройке компонент хост-сайта и добавить декларативную разметку веб-части. Как и другие веб-части, она появляется в пользовательском интерфейсе SharePoint, из которого пользователи добавляют веб-части. Если требуется еще большая степень изменчивости, то можно развернуть в надстройке несколько веб-частей надстройки. Например, надстройка со сводкой погоды может иметь одну веб-часть, в которой показывается текущая погода, и вторую веб-часть для недельного прогноза. Эти две части могут иметь разные размеры и функциональность.
 

 

 **Примечание.** Веб-части надстройки можно также разворачивать на сайте надстройки. Для этого разметка веб-части должна быть частью компонента в WSP-файле пакета надстройки, а не компонента хост-сайта.
 

Рекомендуется стараться придавать своим надстройкам внешний вид SharePoint, насколько это возможно, хотя это необязательно, и не всегда будет лучшим вариантом. Дополнительные сведения о рекомендациях по взаимодействию с пользователем см. в статье  [Проектирование пользовательского интерфейса для надстроек SharePoint](ux-design-for-sharepoint-add-ins). 
 

 
Например, существует специальная главная страница с именем app.master. Она оптимизирована для использования страницами надстроек. Страница app.master является частью нового определения сайта, включенного в SharePoint. 
 

 
Другим средством, которое можно использовать для поддержания целостного с SharePoint внешнего вида надстроек, является элемент управления хрома, который поставляется с SharePoint. Этот элемент управления позволяет добавлять область верхнего колонтитула с элементами навигации SharePoint на страницы надстройки, включая страницы с внешним размещением. Дополнительные сведения по проектированию взаимодействия с пользователями в Надстройки SharePoint см. в статье  [Проектирование пользовательского интерфейса для надстроек SharePoint](ux-design-for-sharepoint-add-ins). Подробнее об элементе управления хрома можно узнать в статье  [Использование клиентского элемента управления хрома в надстройках для SharePoint](use-the-client-chrome-control-in-sharepoint-add-ins).
 

 

## <a name="add-in-package-structure"></a>Структура пакета надстройки
<a name="SPAppModelArch_Package"> </a>

Пакет Надстройка SharePoint это файл с расширением APP, который соответствует  [новому стандарту упаковки данных (OPC)](http://msdn.microsoft.com/en-us/magazine/cc163372.aspx). (Чтобы открыть этот файл, следует добавить к его имени дополнительное расширение ZIP, а затем открыть его в проводнике.) Он содержит манифест надстройки, указывающий разные свойства надстройки инструкции для инфраструктуры установки SharePoint. Дополнительные сведения о манифесте и пакете надстройки см. в статье  [Изучите структуру манифеста надстройки и пакет надстройки для SharePoint](explore-the-app-manifest-structure-and-the-package-of-a-sharepoint-add-in).
 

 

## <a name="permissions-authentication-and-authorization-for-sharepoint-add-ins"></a>Разрешения, аутентификация и авторизация для надстроек SharePoint
<a name="SPAppModelArch_Running"> </a>

В SharePoint используется новая система безопасности и разрешений для надстроек.
 

 

### <a name="add-in-permissions"></a>Разрешения для надстроек
<a name="AppPermissions"> </a>

Надстройки SharePoint имеют разрешения, как пользователи и группы. Это позволяет надстройке иметь набор разрешений, отличных от разрешений пользователя, который выполняет надстройку. 
 

 
В файле манифеста надстройки необходимо запрашивать разрешения, которые требуются надстройке для запуска. Пользователь, который добавляет надстройку, должен удовлетворить эти запросы, и он может предоставить только те разрешения, которые имеет сам как пользователь. Предоставление должно быть для всех запрошенных разрешений или ни для одного из них, чтобы упростить управление разрешениями для пользователей и разработчиков. (Субъект надстройки всегда имеет права полного доступа на сайте надстройки, так что ему достаточно запросить разрешения для ресурсов SharePoint на хост-сайте или в других расположениях вне сайта надстройки.)
 

 
Подробнее см. в статье [Разрешения для надстроек в SharePoint](add-in-permissions-in-sharepoint-2013).
 

 

### <a name="selective-delegation-and-authorization"></a>Выборочное делегирование и авторизация
<a name="SelectiveAuthorization"> </a>

Ни пользователям, запускающим надстройку, ни владельцам ресурсов, предоставляющим надстройке разрешения для доступа к ресурсам, не требуется предоставлять надстройке свои учетные данные или пароль. Вместо этого SharePoint дает пользователям и владельцам ресурсов возможность предоставлять только конкретные разрешения, которые запрашивает надстройка. Это возможно благодаря использованию SharePoint протокола транзакций  [OAuth 2.0](http://tools.ietf.org/html/draft-ietf-oauth-v2-22). Дополнительные сведения о протоколе OAuth в SharePoint см. в статье  [Поток маркеров контекста OAuth для надстроек в SharePoint](context-token-oauth-flow-for-sharepoint-add-ins).
 

 

### <a name="cross-domain-access"></a>Междоменный доступ
<a name="SelectiveAuthorization"> </a>

Надстройка SharePoint, включающее удаленное веб-приложение, которое использует JavaScript в своей логике доступа к данным, может использовать междоменную библиотеку JavaScript для получения авторизованного доступа к данным SharePoint в пределах арендованной области, в которой установлена надстройка. Дополнительные сведения см. в статье  [Обращение к данным SharePoint из надстроек с помощью междоменной библиотеки](access-sharepoint-2013-data-from-add-ins-using-the-cross-domain-library).
 

 

## <a name="add-in-lifecycle"></a>Жизненный цикл надстроек
<a name="SPAppModelArch_Lifecycle"> </a>

Жизненный цикл Надстройка SharePoint включает публикацию, установку, обновление и удаление. Дополнительные сведения по этим темам см. в статьях  [Публикация надстроек для SharePoint](publish-sharepoint-add-ins),  [Развертывание и установка надстроек для SharePoint: методы и параметры](deploying-and-installing-sharepoint-add-ins-methods-and-options) и [Процедура обновления надстроек для SharePoint](sharepoint-add-ins-update-process). Кроме того, следует отметить, что имеется механизм, с помощью которого администраторы клиента могут выполнять пакетную установку Надстройка SharePoint на несколько веб-сайтов. Дополнительные сведения см. в статье  [Сроки аренды и области развертывания надстроек для SharePoint](tenancies-and-deployment-scopes-for-sharepoint-add-ins).
 

 

## <a name="data-storage-in-sharepoint-add-ins"></a>Хранение данных в надстройках SharePoint
<a name="Data"> </a>

Надстройки SharePoint может создавать и получать доступ к любому типу данных, включая структурированные данные, документы и файлы мультимедиа. Эти данные могут храниться в SharePoint или во внешнем расположении. 
 

 

### <a name="structured-data-storage-options"></a>Параметры хранилища структурированных данных
<a name="StructuredData"> </a>

Надстройка SharePoint может использовать практически любой тип хранилища структурированных данных, как в составе решения SharePoint, так и вне его, как на платформах Майкрософт, так и на платформах других производителей. Далее представлены  *некоторые*  места хранения структурированных данных для Надстройка SharePoint:
 

 

- Списки SharePoint на сайте надстроек
    
 
- SQL Azure
    
 
- Внешние источники данных, подключенные к SharePoint, со службами Службы Microsoft Business Connectivity Services (BCS)
    
 
- Облачная служба сторонних поставщиков
    
 
- База данных на собственном сервере
    
 

 **Совет.** Вероятно, однажды вам понадобится обновить свою надстройку SharePoint. Если надстройка SharePoint содержит компоненты SharePoint, расположенные на сайте надстройки, в процессе обновления будет создаваться полная копия веб-приложения. Поэтому если на сайте надстройки хранятся очень большие списки SharePoint, обновление будет выполняться длительное время и потреблять много процессорной мощности сервера базы данных содержимого. Не следует помещать "большие данные" в списки SharePoint на сайте надстройки.
 


### <a name="unstructured-data-storage-options"></a>Параметры хранилища неструктурированных данных
<a name="UnStructuredData"> </a>

Документы, изображения, видеозаписи, аудиофайлы и другие виды неструктурированных данных, которые производятся или используются Надстройка SharePoint, можно хранить в составе решения SharePoint или вне его. Библиотеки документов это прекрасный вариант для хранения документов, которые становятся доступными для поиска с помощью системы поиска SharePoint. Библиотека ресурсов сайта, как правило, отлично подходит для хранения мультимедийных файлов. 
 

 
Другие варианты включают хранилище BLOB-объектов в учетной записи Microsoft Azure или на ваших серверах. Вы также можете хранить файлы на некоторых сторонних платформах или в сторонних облачных службах.
 

 

### <a name="add-in-settings-and-other-metadata-storage-options"></a>Параметры надстроек и другие варианты хранения метаданных
<a name="AppMetadata"> </a>

Метаданные для Надстройка SharePoint, например предпочтения пользователей, сведения о расположении и другие настройки, можно хранить в различных местах. Иногда для этого отлично подходит скрытый список SharePoint. Вы также можете использовать контейнер свойств сайта надстройки. Другой вариант, доступный для надстройки с размещением у поставщика, использование табличного хранилища Microsoft Azure. 
 

 

### <a name="secure-data-access-options"></a>Варианты безопасного доступа к данным
<a name="DataAccess"> </a>

Варианты безопасного доступа к данным, конечно же, зависят от выбранного вами хранилища. Поиск данных и доступ к ним рассматриваются более подробно в других разделах. Дополнительные сведения см. в статье  [Безопасный доступ к данным и клиентские объектные модели для надстроек SharePoint](secure-data-access-and-client-object-models-for-sharepoint-add-ins).
 

 

## <a name="managing-add-ins"></a>Управление надстройками
<a name="SPAppModelArch_Managing"> </a>

Администраторы семейства сайтов и администраторы клиента могут выполнять мониторинг надстроек и изменять выделенные для них ресурсы. Кроме того, персонал Microsoft магазина надстроек может помечать надстройки и отключать их.
 

 
Подробнее об управлении надстройками см. в статье [Установка надстроек SharePoint и управление ими](http://msdn.microsoft.com/en-us/library/733647a3-a5d3-475b-967d-3bb627c2a0c2) на сайте TechNet.
 

 

### <a name="monitoring-add-ins"></a>Отслеживание надстроек
<a name="SPAppModelArch_Monitoring"> </a>

SharePoint предоставляет возможность наблюдения за работоспособностью надстроек и делает эту информацию доступной в пользовательском интерфейсе для владельцев веб-сайта, администраторов клиентов и администраторов фермы. Большая часть документации по мониторингу системы находится на веб-сайте TechNet; например,  [Мониторинг надстроек SharePoint](http://technet.microsoft.com/library/3adafdd2-f276-4a9d-8a74-e06b8916bbc2). В этом разделе даются только краткие вводные сведения, чтобы объяснить, как осуществляется мониторинг продаваемых вами надстроек.
 

 
Отчеты по одним видам данных создаются на уровне приложения, а по другим видам данных на уровне экземпляра приложения. Отчеты инфраструктуры мониторинга включают следующие основные элементы.
 

 

- Использование надстройки, например, количество ее установок (созданий нового экземпляра). 
    
 
- Потребление серверных ресурсов каждым экземпляром надстройки.
    
 
- Ошибки установки, обновления и времени выполнения каждого экземпляра надстройки.
    
 
- Общий индикатор работоспособности каждого экземпляра надстройки, имеющий зеленый, желтый или красный цвет.
    
 
Если в надстройке имеются компоненты Веб-сайт Azure, то инфраструктура мониторинга также проводит ежечасные опросы Microsoft Azure для сбора сведений об ошибках и сообщает данные о критически важных ошибках и квоте хранилища в пользовательском интерфейсе SharePoint. Сведения об ошибках База данных SQL Microsoft Azure не сообщаются.
 

 
Сведения, предоставляемые инфраструктурой мониторинга, позволяют администраторам определять, насколько разумно был потрачен бюджет на приобретение надстроек, следует ли развернуть дополнительные ресурсы для надстроек, и следует ли отключить надстройку, которая работает неправильно.
 

 

## <a name="registering-add-in-dependencies"></a>Регистрация зависимостей надстроек
<a name="RegisterDependency"> </a>

Если ваша Надстройка SharePoint зависит от возможности SharePoint, которая сейчас недоступна и которую нельзя включить через сайт надстройки, пользователи будут жаловаться на неправильную работу. Можно сделать так, чтобы ваша надстройка не устанавливалось там, где отсутствуют необходимые возможности и функции, регистрируя зависимости надстройки в манифесте. Инфраструктура установки Надстройки SharePoint будет проверять эти зависимости, блокируя установку надстройки при их отсутствии.
 

 
Для таких служб, как Excel, Access или Visio, инфраструктура будет проверять установку и наличие лицензий.
 

 
Для таких функций, как список задач, инфраструктура будет проверять, развернута ли функция, а также одно из двух:
 

 
— активирована ли функция в области **Farm**, **WebApplication** или **Site** (семейство веб-сайтов);
 

 
или
 

 
— возможно ли ее активировать в области **Web** на сайте надстройки, создаваемом при ее установке.
 

 

 **Примечание.** Инфраструктура установки автоматически включает такие функции на сайте надстройки при его создании.
 

В следующих разделах описано, как зарегистрировать необходимые компоненты.
 

 

### <a name="implicitly-register-dependencies-with-permission-requests"></a>Неявная регистрация зависимостей с запросами разрешений
<a name="PermAsPreq"> </a>

Если вашей надстройке нужен доступ к компонентам SharePoint вне сайта надстройки, то она должна запросить разрешения на них в разделе **AppPermissionRequests** манифеста приложения. Эти запросы также служат для регистрации зависимостей, так как SharePoint определит по запрошенным разрешениям, какие возможности SharePoint нужны вашей надстройке. В ряде случаев SharePoint может определить все нужные возможности, и оставшиеся разделы статьи использовать не потребуется. Тем не менее, избыточность при регистрации зависимостей не повредит.
 

 

### <a name="explicitly-register-dependencies-with-appprerequisites"></a>Явная регистрация зависимостей с помощью AppPrerequisites
<a name="Explicit"> </a>

Если ваша надстройка имеет зависимость, которая не выводится по запросам разрешений, ее следует зарегистрировать в элементе **AppPrerequisite** манифеста надстройки. У этого элемента есть три атрибута: **Type**, **ID** и (необязательный) **MinimumVersion**. 
 

 
Существует три возможных значения необходимых компонентов для **Type**: `Feature`, `Capablility` и `AutoProvisioning`. Необходимый компонент Feature — это просто функция SharePoint, которая должна быть развернута и активирована на сайте надстройки или в более широкой области, включающей этот сайт. Capability — это набор связанных функций и служб, который должен быть доступен на сайте надстройки. (`AutoProvisioning` рассматривается далее.)
 

 
Необязательный атрибут **MinimumVersion** задает минимальную версию функции или возможности, необходимой надстройке, в формате n.n.n.n, например `15.0.0.0`.
 

 
**ID** указывает, какая функция или возможность необходима. Если **Type** — это `Feature`, то **ID** — это GUID функции с разделителями-дефисами в скобках, например `{151D22D9-95A8-4904-A0A3-22E4DB85D1E0}`. Если же **Type** — это `Capability`, то **ID** — это GUID возможности. Все возможности перечислены ниже. Сведения о получении GUID возможности см. в статье [Элемент AppPrerequisite (AppPrerequisiteCollection complexType) (Manifest SharePoint Add-in)](http://msdn.microsoft.com/library/791be402-981f-519e-fcde-f24cc3cb4139%28Office.15%29.aspx).
 

 

- Службы Access 2010
    
 
- Службы Access
    
 
- Веб-служба управляемых метаданных
    
 
- Службы PowerPoint
    
 
- Службы Secure Store
    
 
- Служба машинного перевода
    
 
- Служба профилей пользователей
    
 
- Служба графики Visio
    
 
- Служба управления работой
    
 
- Duet
    
 
- Рабочий процесс
    
 
- Поиск
    
 
- EDU
    
 
Далее приведен пример необработанной разметки **AppPrerequisites**, в которой регистрируется возможность Workflow. Если вы используете Visual Studio, то манифест надстройки редактируется в конструкторе.
 

 



```
<AppPrerequisites>
  <AppPrerequisite Type="Capability" ID="{CDD8F991-B459-4512-8048-03D5A03FF27E}" MinimumVersion="15.0.0.0" />
</ AppPrerequisites>
```


## <a name="in-this-section"></a>В этом разделе:
<a name="RegisterDependency"> </a>


-  [Выбор шаблонов для разработки и размещения надстройки SharePoint](choose-patterns-for-developing-and-hosting-your-sharepoint-add-in)
    
 
-  [Размещение сайтов, сайтов надстроек и компонентов SharePoint в SharePoint](host-webs-add-in-webs-and-sharepoint-components-in-sharepoint-2013)
    
 

## <a name="additional-resources"></a>Дополнительные ресурсы
<a name="SPAppModelArch_AdditionalResources"> </a>


-  [Надстройки SharePoint](sharepoint-add-ins)
    
 
-  [Надстройки SharePoint в сравнении с решениями для SharePoint](http://msdn.microsoft.com/library/0e9efadb-aaf2-4c0d-afd5-d6cf25c4e7a8%28Office.15%29.aspx)
    
 
-  [Разрешения для надстроек в SharePoint](add-in-permissions-in-sharepoint-2013)
    
 
-  [Поток OAuth токена контекста для надстроек SharePoint](context-token-oauth-flow-for-sharepoint-add-ins)
    
 
-  [Разработка пользовательского интерфейса для надстроек SharePoint](ux-design-for-sharepoint-add-ins)
    
 
-  [IFrame](http://www.w3schools.com/tags/tag_iframe.asp)
    
 
-  [Изучение структуры манифеста приложения и пакета надстройки SharePoint](explore-the-app-manifest-structure-and-the-package-of-a-sharepoint-add-in)
    
 
-  [Развертывание и установка надстроек SharePoint: методы и параметры](deploying-and-installing-sharepoint-add-ins-methods-and-options)
    
 
-  [Процесс обновления надстроек SharePoint](sharepoint-add-ins-update-process)
    
 
-  [Области клиентов и области развертывания для надстроек SharePoint](tenancies-and-deployment-scopes-for-sharepoint-add-ins)
    
 

