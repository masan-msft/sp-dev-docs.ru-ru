---
title: "Важные аспекты разработки и архитектуры для надстроек SharePoint"
description: "Архитектура и модель надстроек SharePoint, в том числе варианты пользовательского интерфейса и размещения надстроек, система развертывания, система безопасности и жизненный цикл."
ms.date: 11/02/2017
ms.prod: sharepoint
ms.openlocfilehash: d401f031535aca9d022fd74b1a1d6210c80d456e
ms.sourcegitcommit: 655e325aec73c8b7c6b5e3aaf71fbb4d2d223b5d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/03/2017
---
# <a name="important-aspects-of-the-sharepoint-add-in-architecture-and-development-landscape"></a>Важные аспекты разработки и архитектуры надстроек SharePoint


<a name="SPAppModelArch_SPCenteredVsCloudCentered"> </a> Сведения в этой статье дополняют статью [Надстройки SharePoint](sharepoint-add-ins.md).

Способы размещения компонентов надстройки SharePoint: 

-  **Размещение у поставщика.** Надстройки, которые содержат по крайней мере один удаленный компонент и могут содержать компоненты SharePoint, разворачиваются в соответствии с вашей логикой на вашем оборудовании или в учетной записи облака, либо разворачиваются на оборудовании клиента или в его учетной записи облака с помощью предоставленных вами программ установки и инструкций.

-  **Размещение в SharePoint.** Надстройки, содержащие только компоненты SharePoint и логику, которая выполняется на клиенте.

Дополнительные сведения о вариантах размещения и некоторые рекомендации по их выбору см. в статье [Выбор шаблонов для разработки и размещения надстройки SharePoint](choose-patterns-for-developing-and-hosting-your-sharepoint-add-in.md).

<a name="SPComponents"> </a>
## <a name="add-in-webs-host-webs-features-and-sharepoint-components-in-add-ins"></a>Сайты надстроек, хост-сайты, функции и компоненты SharePoint в надстройках

Веб-сайт, на котором устанавливается надстройка SharePoint, называется хост-сайтом. Однако компоненты SharePoint и внешние компоненты не развертываются на хост-сайте. Внешние компоненты развертываются на внешних серверах или в облачных учетных записях. Компоненты SharePoint развертываются на специальном веб-сайте с собственным доменом. Он называется сайтом надстройки. 

На хост-сайте развертывается только часть элементов пользовательского интерфейса, которые предоставляют пользователям доступ к другим компонентам надстройки, развернутым на хост-сайте. Эти компоненты пользовательского интерфейса на хост-сайте развертываются в составе компонента хост-сайта — компонента, входящего в пакет надстройки, а не в WSP-файл. Компоненты, которые развертываются на сайте надстройки, всегда входят в WSP-файл. Оба типа компонентов должны иметь область **Web**. Другие области невозможны для компонентов в надстройках SharePoint.

Как правило, любой компонент SharePoint без пользовательского кода, который выполняется на серверах SharePoint, можно включить в надстройку SharePoint (и развернуть на сайте надстройки). Однако существуют некоторые нюансы и исключения в отношении способа и места развертывания компонентов. Дополнительные сведения об этих нюансах, а также о хост-сайтах, изолированных сайтах надстройки и компонентах в надстройках см. в статье [Хост-сайты, сайты надстроек и компоненты SharePoint в SharePoint](host-webs-add-in-webs-and-sharepoint-components-in-sharepoint.md).

<a name="AccessingApp"> </a>
## <a name="accessing-the-add-in-from-the-ui"></a>Доступ к надстройке из пользовательского интерфейса

Когда Надстройка SharePoint устанавливается на веб-сайте, эта надстройка указывается на странице **содержания** хост-сайта. Пользователи могут запускать надстройку с этой страницы. При таком запуске надстройка открывается в полноэкранном режиме.

Надстройку SharePoint можно также вызвать через веб-часть надстройки. Веб-часть такого типа представлена классом **ClientWebPart** и, по сути, является оболочкой для IFrame, в котором размещается страница надстройки. В самом простом случае единственным важным свойством веб-части является URL-адрес, который указывает на страницу. 

Но у веб-части могут быть специальные свойства, которые пользователи задают в инструментальной части. Эти свойства можно использовать, например, для установки сведений о контексте, таких как почтовый индекс пользователя. Чтобы включить такую веб-часть в надстройку, создается компонент хост-сайта в надстройке и добавляется декларативная разметка веб-части. Как и другие веб-части, она отображается в окне SharePoint для добавления веб-частей. При необходимости с надстройкой можно развернуть несколько веб-частей. Например, в случае надстройки о погоде одна веб-часть может показывать текущую погоду, а вторая — недельный прогноз. Эти две веб-части могут иметь разные размеры и функции.

> [!NOTE]
> Веб-части надстройки можно также разворачивать на сайте надстройки. Для этого разметка веб-части должна быть частью компонента в WSP-файле пакета надстройки, а не компонента хост-сайта.

Рекомендуем оформлять надстройки в одном стиле с SharePoint, хотя это необязательно и не всегда будет лучшим вариантом. Дополнительные сведения о проектировании взаимодействия с пользователями в надстройках SharePoint см. в [этой статье](ux-design-for-sharepoint-add-ins.md). 

Например, существует специальная главная страница с именем app.master. Она оптимизирована для использования страницами надстроек. Страница app.master является частью нового определения сайта, включенного в SharePoint. 

Чтобы надстройки выглядели как одно целое с SharePoint, также можно использовать элемент управления хрома, который поставляется вместе с SharePoint. Этот элемент позволяет добавить область навигации SharePoint на страницы надстройки, в том числе внешние. Дополнительные сведения о проектировании взаимодействия с пользователями в надстройках SharePoint см. в [этой статье](ux-design-for-sharepoint-add-ins.md). Дополнительные сведения об элементе управления хрома см. в [этой статье](use-the-client-chrome-control-in-sharepoint-add-ins.md).

<a name="SPAppModelArch_Package"> </a>
## <a name="add-in-package-structure"></a>Структура пакета надстройки

Пакет надстройки SharePoint — это файл с расширением APP, который соответствует стандарту [Open Packaging Conventions (OPC)](http://msdn.microsoft.com/ru-RU/magazine/cc163372.aspx). (Чтобы открыть этот файл, добавьте к его имени расширение ZIP, а затем откройте его в проводнике.) Он содержит манифест надстройки, в котором указываются свойства надстройки и инструкции для инфраструктуры установки SharePoint. Дополнительные сведения о манифесте и пакете надстройки см. в [этой статье](explore-the-app-manifest-structure-and-the-package-of-a-sharepoint-add-in.md).

<a name="SPAppModelArch_Running"> </a>
## <a name="permissions-authentication-and-authorization-for-sharepoint-add-ins"></a>Разрешения, аутентификация и авторизация для надстроек SharePoint

В SharePoint реализована новая система безопасности и разрешений для надстроек.

<a name="AppPermissions"> </a>
### <a name="add-in-permissions"></a>Разрешения для надстроек

Надстройки SharePoint имеют разрешения, как пользователи и группы. Это позволяет надстройке иметь набор разрешений, отличных от разрешений пользователя, который выполняет надстройку. 

В файле манифеста надстройки необходимо запрашивать разрешения, которые требуются надстройке для запуска. Пользователь, который добавляет надстройку, должен удовлетворить эти запросы, и он может предоставить только те разрешения, которые имеет сам как пользователь. Предоставление должно быть для всех запрошенных разрешений или ни для одного из них, чтобы упростить управление разрешениями для пользователей и разработчиков. (Субъект надстройки всегда имеет права полного доступа на сайте надстройки, так что ему достаточно запросить разрешения для ресурсов SharePoint на хост-сайте или в других расположениях вне сайта надстройки.)

Дополнительные сведения см. в статье [Разрешения для надстроек SharePoint](add-in-permissions-in-sharepoint.md).

<a name="SelectiveAuthorization"> </a>
### <a name="selective-delegation-and-authorization"></a>Выборочное делегирование и авторизация

Ни пользователям, которые запускают надстройку, ни владельцам ресурсов, которые предоставляют надстройке доступ, не нужно предоставлять ей свои учетные данные или пароль. SharePoint позволяет пользователям и владельцам ресурсов предоставлять только конкретные разрешения, которые запрашивает надстройка. Это возможно благодаря протоколу транзакций [OAuth 2.0](http://tools.ietf.org/html/draft-ietf-oauth-v2-22). Дополнительные сведения о протоколе OAuth в SharePoint см. в статье [Использование токенов контекста для авторизации надстроек SharePoint](context-token-oauth-flow-for-sharepoint-add-ins.md).

<a name="cross-domain-access"> </a>
### <a name="cross-domain-access"></a>Междоменный доступ

Надстройка SharePoint, которая включает удаленное веб-приложение с доступом к данным через JavaScript, может использовать междоменную библиотеку JavaScript для получения авторизованного доступа к данным SharePoint в клиенте, в котором она установлена. Дополнительные сведения см. в статье [Обращение к данным SharePoint из надстроек с помощью междоменной библиотеки](access-sharepoint-data-from-add-ins-using-the-cross-domain-library.md).

<a name="SPAppModelArch_Lifecycle"> </a>
## <a name="add-in-lifecycle"></a>Жизненный цикл надстроек

Жизненный цикл надстройки SharePoint включает публикацию, установку, обновление и удаление. Дополнительные сведения по этим темам см. в статьях [Публикация надстроек для SharePoint](publish-sharepoint-add-ins.md), [Развертывание и установка надстроек для SharePoint: методы и параметры](deploying-and-installing-sharepoint-add-ins-methods-and-options.md) и [Процедура обновления надстроек для SharePoint](sharepoint-add-ins-update-process.md). 

Также учтите, что с помощью определенного механизма администраторы клиента могут выполнять пакетную установку надстройки SharePoint на нескольких веб-сайтах. Дополнительные сведения см. в статье [Клиенты и области развертывания для надстроек SharePoint](tenancies-and-deployment-scopes-for-sharepoint-add-ins.md).

<a name="Data"> </a>
## <a name="data-storage-in-sharepoint-add-ins"></a>Хранение данных в надстройках SharePoint

Надстройки SharePoint может создавать и получать доступ к любому типу данных, включая структурированные данные, документы и файлы мультимедиа. Эти данные могут храниться в SharePoint или во внешнем расположении. 

<a name="StructuredData"> </a>
### <a name="structured-data-storage-options"></a>Способы хранения структурированных данных

Структурированные данные для надстройки SharePoint можно хранить как в SharePoint, так и за его пределами, как на платформе Майкрософт, так и на других платформах. Ниже представлены *некоторые* места хранения структурированных данных для надстройки SharePoint.

- Списки SharePoint на сайте надстройки
- SQL Azure
- Внешние источники данных, подключенные к SharePoint, со службами Службы Microsoft Business Connectivity Services (BCS)
- Облачная служба сторонних поставщиков
- База данных на собственном сервере

> [!TIP]
> Вероятно, однажды вам понадобится обновить свою надстройку SharePoint. Если надстройка SharePoint включает компоненты SharePoint на сайте надстройки, при обновлении будет создана полная копия сайта надстройки. Поэтому если на нем хранятся очень большие списки SharePoint, для обновления потребуется много времени и ресуров процессора на сервере базы данных контента. Не следует помещать большие данные в списки SharePoint на сайте надстройки.

<a name="UnStructuredData"> </a>
### <a name="unstructured-data-storage-options"></a>Способы хранения неструктурированных данных

Документы, изображения, видеозаписи, аудиофайлы и другие виды неструктурированных данных, которые производятся или используются Надстройка SharePoint, можно хранить в составе решения SharePoint или вне его. Библиотеки документов это прекрасный вариант для хранения документов, которые становятся доступными для поиска с помощью системы поиска SharePoint. Библиотека ресурсов сайта, как правило, отлично подходит для хранения мультимедийных файлов. 

Другие варианты включают хранилище BLOB-объектов в учетной записи Microsoft Azure или на ваших серверах. Вы также можете хранить файлы на некоторых сторонних платформах или в сторонних облачных службах.

<a name="AppMetadata"> </a>
### <a name="add-in-settings-and-other-metadata-storage-options"></a>Параметры надстроек и другие способы хранения метаданных

Метаданные для надстройки SharePoint, например настройки пользователей, сведения о расположении и другие параметры, можно хранить в различных местах. Иногда для этого отлично подходит скрытый список SharePoint. Вы также можете использовать контейнер свойств сайта надстройки. Для надстройки с размещением у поставщика также можно использовать Хранилище таблиц Azure. 

<a name="DataAccess"> </a>
### <a name="secure-data-access-options"></a>Способы безопасного доступа к данным

Способы безопасного доступа к данным, конечно же, зависят от выбранного вами хранилища. Поиск данных и доступ к ним более подробно рассматриваются в других статьях. Дополнительные сведения см. в статье [Безопасный доступ к данным и клиентские объектные модели для надстроек SharePoint](secure-data-access-and-client-object-models-for-sharepoint-add-ins.md).

<a name="SPAppModelArch_Managing"> </a>
## <a name="managing-add-ins"></a>Управление надстройками

Администраторы семейства сайтов и администраторы клиента могут выполнять мониторинг надстроек и изменять выделенные для них ресурсы. Кроме того, персонал Microsoft магазина надстроек может помечать надстройки и отключать их.

Дополнительные сведения см. в статье [Установка надстроек SharePoint и управление ими](http://msdn.microsoft.com/ru-RU/library/733647a3-a5d3-475b-967d-3bb627c2a0c2) на сайте TechNet.

<a name="SPAppModelArch_Monitoring"> </a>
### <a name="monitoring-add-ins"></a>Отслеживание надстроек

SharePoint позволяет отслеживать работоспособность надстроек. Просматривать соответствующую информацию могут владельцы веб-сайта, администраторы клиентов и администраторы фермы. Документация по системе мониторинга (например, статья [Мониторинг надстроек SharePoint](http://technet.microsoft.com/library/3adafdd2-f276-4a9d-8a74-e06b8916bbc2)) находится на веб-сайте TechNet. В этом разделе приводится краткое описание мониторинга продаваемых надстроек.

Отчеты по одним видам данных создаются на уровне приложения, а по другим видам данных на уровне экземпляра приложения. Отчеты инфраструктуры мониторинга включают следующие основные элементы.

- Использование надстройки, например, количество ее установок (созданий нового экземпляра). 
- Потребление серверных ресурсов каждым экземпляром надстройки.
- Ошибки установки, обновления и времени выполнения каждого экземпляра надстройки.
- Общий индикатор работоспособности каждого экземпляра надстройки, имеющий зеленый, желтый или красный цвет.

Если надстройка включает компоненты веб-сайта Azure, инфраструктура мониторинга также проводит ежечасные опросы Azure для сбора данных об ошибках и сообщает о критически важных ошибках и квоте хранилища в пользовательском интерфейсе SharePoint. Ошибки базы данных SQL Azure не отображаются.

Сведения, предоставляемые инфраструктурой мониторинга, позволяют администраторам определять, насколько разумно был потрачен бюджет на приобретение надстроек, следует ли развернуть дополнительные ресурсы для надстроек, и следует ли отключить надстройку, которая работает неправильно.

<a name="RegisterDependency"> </a>
## <a name="registering-add-in-dependencies"></a>Регистрация зависимостей надстроек

Если ваша Надстройка SharePoint зависит от возможности SharePoint, которая сейчас недоступна и которую нельзя включить через сайт надстройки, пользователи будут жаловаться на неправильную работу. Можно сделать так, чтобы ваша надстройка не устанавливалось там, где отсутствуют необходимые возможности и функции, регистрируя зависимости надстройки в манифесте. Инфраструктура установки Надстройки SharePoint будет проверять эти зависимости, блокируя установку надстройки при их отсутствии.

Для служб, таких как Excel, Access или Visio инфраструктура проверяет установку и наличие лицензий.

Для компонентов, таких как список задач, инфраструктура проверяет, развернут ли компонент, а также одно из двух:

- активирован ли компонент в области **Farm**, **WebApplication** или **Site** (семейство веб-сайтов);

или

- можно ли активировать его в области **Web** на сайте надстройки, создаваемом при ее установке.
 
> [!NOTE]
> Инфраструктура установки автоматически активирует такие компоненты на сайте надстройки при его создании.

Ниже описано, как зарегистрировать необходимые компоненты.

<a name="PermAsPreq"> </a>
### <a name="implicitly-register-dependencies-with-permission-requests"></a>Неявная регистрация зависимостей с помощью запросов разрешений

Если вашей надстройке нужен доступ к компонентам SharePoint вне сайта надстройки, то она должна запросить разрешения на них в разделе **AppPermissionRequests** манифеста приложения. Эти запросы также служат для регистрации зависимостей, так как SharePoint определит по запрошенным разрешениям, какие возможности SharePoint нужны вашей надстройке. В ряде случаев SharePoint может определить все нужные возможности, и оставшиеся разделы статьи использовать не потребуется. Тем не менее, избыточность при регистрации зависимостей не повредит.

<a name="Explicit"> </a>
### <a name="explicitly-register-dependencies-with-appprerequisites"></a>Явная регистрация зависимостей с помощью элемента AppPrerequisites

Если у надстройки есть зависимость, которую не указывают запросы разрешений, ее следует зарегистрировать в элементе **AppPrerequisite** манифеста надстройки. В этом элементе три атрибута: **Type**, **ID** и (необязательный) **MinimumVersion**. 

Возможные значения необходимых компонентов для атрибута **Type** — `Feature`, `Capablility` и `AutoProvisioning`. Необходимый компонент Feature — это просто компонент SharePoint, который требуется развернуть и активировать на сайте надстройки или в более широкой области, включающей этот сайт. Capability — это набор связанных компонентов и служб, который должен быть доступен на сайте надстройки. (Значение `AutoProvisioning` рассматривается в следующем разделе.)

Необязательный атрибут **MinimumVersion** задает минимальную версию функции или возможности, необходимой надстройке. Формат n.n.n.n, например `15.0.0.0`.

Атрибут **ID** указывает необходимый компонент или возможность. Если атрибут **Type** имеет значение `Feature`, то **ID** — это GUID компонента с разделителями-дефисами в скобках, например `{151D22D9-95A8-4904-A0A3-22E4DB85D1E0}`. Если же атрибут **Type** имеет значение `Capability`, то **ID** — это GUID возможности. Возможности перечислены ниже. Чтобы узнать, как получить GUID возможности, см. статью [Элемент AppPrerequisite (AppPrerequisiteCollection complexType) (манифест надстройки SharePoint)](http://msdn.microsoft.com/library/791be402-981f-519e-fcde-f24cc3cb4139%28Office.15%29.aspx).

- Службы Access 2010
- Службы Access
- Веб-служба управляемых метаданных
- Службы PowerPoint
- Службы Secure Store
- Служба машинного перевода
- Служба профилей пользователей
- Служба графики Visio
- Служба управления работой
- Duet
- Рабочий процесс
- Поиск
- EDU

Далее приведен пример необработанной разметки **AppPrerequisites**, в которой регистрируется возможность Workflow. Если вы используете Visual Studio, то манифест надстройки редактируется в конструкторе.

```
<AppPrerequisites>
  <AppPrerequisite Type="Capability" ID="{CDD8F991-B459-4512-8048-03D5A03FF27E}" MinimumVersion="15.0.0.0" />
</ AppPrerequisites>
```

## <a name="in-this-section"></a>В этой статье
<a name="RegisterDependency"> </a>

- [Выбор шаблонов для разработки и размещения надстройки SharePoint](choose-patterns-for-developing-and-hosting-your-sharepoint-add-in.md)
- [Хост-сайты, сайты надстроек и компоненты SharePoint в SharePoint](host-webs-add-in-webs-and-sharepoint-components-in-sharepoint.md)

## <a name="additional-resources"></a>Дополнительные ресурсы
<a name="SPAppModelArch_AdditionalResources"> </a>

-  [Надстройки SharePoint](sharepoint-add-ins.md)
-  [Надстройки SharePoint в сравнении с решениями для SharePoint](http://msdn.microsoft.com/library/0e9efadb-aaf2-4c0d-afd5-d6cf25c4e7a8%28Office.15%29.aspx)
-  [Разрешения для надстроек в SharePoint](add-in-permissions-in-sharepoint.md)
-  [Поток OAuth токена контекста для надстроек SharePoint](context-token-oauth-flow-for-sharepoint-add-ins.md)
-  [Разработка пользовательского интерфейса для надстроек SharePoint](ux-design-for-sharepoint-add-ins.md)
-  [IFrame](http://www.w3schools.com/tags/tag_iframe.asp)
-  [Изучение структуры манифеста приложения и пакета надстройки SharePoint](explore-the-app-manifest-structure-and-the-package-of-a-sharepoint-add-in.md)
-  [Развертывание и установка надстроек SharePoint: методы и параметры](deploying-and-installing-sharepoint-add-ins-methods-and-options.md)
-  [Процесс обновления надстроек SharePoint](sharepoint-add-ins-update-process.md)
-  [Области клиентов и области развертывания для надстроек SharePoint](tenancies-and-deployment-scopes-for-sharepoint-add-ins.md)
    
 

