# <a name="create-a-cloud-business-add-in-with-a-social-newsfeed"></a>Создание облачных бизнес-надстроек с каналом новостей из социальных сетей
Используя шаблон **Облачная бизнес-надстройка** в Visual Studio, вы можете создавать надстройки SharePoint, в которых пользователи могут просматривать, добавлять и обновлять данные SharePoint. В типе проекта **Облачная бизнес-надстройка** используются технологии Visual Studio LightSwitch, которые существенно упрощают процесс создания бизнес-надстройки с размещением в SharePoint. В этом руководстве описано, как создать надстройку для отслеживания кандидатов на должность, используя функцию интеграции с социальными сетями SharePoint для Office 365 для предоставления канала новостей.
 
Полный пример приложения можно скачать из коллекции исходных кодов MSDN: [Создание облачной бизнес-надстройки с каналом новостей из социальных сетей](http://code.msdn.microsoft.com/Creating-a-Cloud-Business-8540c0c9)
 

 **Примечание.** Название "приложения для SharePoint" меняется на "надстройки SharePoint". В процессе перехода с одного названия на другое в документации и пользовательском интерфейсе некоторых продуктов SharePoint и средств Visual Studio по-прежнему может встречаться термин "приложения для SharePoint". Дополнительные сведения см. в статье [Новое название приложений для Office и SharePoint](new-name-for-apps-for-sharepoint#bk_newname).
 


## <a name="prerequisites"></a>Необходимые компоненты

Для выполнения действий в этом руководстве требуется Visual Studio 2013.
 

 
Для размещения надстройки вам также понадобится сайт SharePoint или SharePoint разработчика в Office 365, который вы можете получить на странице  [Регистрация на сайте разработчиков для Office 365](http://go.microsoft.com/fwlink/?LinkId=263490).
 

 

## <a name="create-a-cloud-business-add-in-project"></a>Создание проекта облачной бизнес-надстройки
<a name="bk_create"> </a>

 Для создания надстройки начните с шаблона проекта **Облачная бизнес-надстройка** в Visual Studio.
 

 

### <a name="to-create-the-project"></a>Создание проекта


1. В строке меню выберите **Файл** > **Создать** > **Проект**.
    
    Откроется диалоговое окно **Создание проекта**.
    
 
2. В списке шаблонов разверните узел **Visual Basic** или **Visual C#**, затем выберите **Office/SharePoint** > **Надстройки** > **Облачная бизнес-надстройка**, как показано на рисунке 1.
    
    **Рис. 1. Добавление проекта**

 

  ![Шаблон проекта "Облачное бизнес-приложение"](../../images/CBAtemplate.PNG)
 

 

 
3. В текстовом поле **Имя** введите CandidateTracker и нажмите кнопку **ОК**.
    
    Откроется мастер **создания облачной бизнес-надстройки**.
    
 
4. В мастере **создания облачной бизнес-надстройки** введите URL-адрес вашего сайта разработчика Office 365 и нажмите кнопку **Готово**.
    
    URL-адрес должен иметь вид: https://_МойСайт_.sharepoint.com/sites/Developer/.
    
    Решение **CandidateTracker** добавляется в обозреватель решений с четырьмя проектами: проект верхнего уровня **CandidateTracker** и проекты **CandidateTracker.HTMLClient**, **CandidateTracker.Server** и **CandidateTracker.SharePoint**.
    
 

## <a name="add-data-and-screens"></a>Добавление данных и экранов
<a name="bk_add"> </a>

Для надстройки отслеживания кандидатов требуется таблица базы данных, которая создаются в проекте **Сервер**, и экраны для просмотра, добавления и обновления данных, которые создаются в проекте **HTML-клиент**.
 

 

### <a name="to-add-the-database-table"></a>Добавление таблицы базы данных


1. В **обозревателе решений** откройте контекстное меню для узла **CandidateTracker.Server** и выберите **Добавить таблицу**.
    
    Откроется конструктор сущностей.
    
 
2. В окне **Свойства**, в текстовом поле для свойства **Имя**, введите "Кандидат".
    
 
3. В конструкторе сущностей выберите ссылку **<Add Property>** и введите "Имя".
    
 
4. Нажмите клавишу ВВОД, принимая **Тип** по умолчанию **Строка** и оставив флажок **Обязательно**.
    
 
5. Выберите ссылку **<Add Property>** и введите "Телефон", а затем нажмите клавишу **TAB**.
    
 
6. В столбце **Тип** выберите **Номер телефона** и дважды нажмите клавишу TAB.
    
     **Номер телефона** — это пользовательский бизнес-тип, который автоматически форматирует и проверяет номера телефонов.
    
 
7. В следующей строке введите "Электронная почта" в столбце **Имя** и выберите **Адрес электронной почты** в столбце **Тип**.
    
     **Адрес электронной почты** — еще один пользовательский бизнес-тип, который обеспечивает проверку адресов электронной почты.
    
 
8. В следующей строке введите "Кто порекомендовал" в столбце **Имя** и выберите **Пользователь** в столбце **Тип**.
    
    Бизнес-тип **Пользователь** обеспечивает связь со службой профилей пользователей SharePoint, которая извлекает информацию о пользователях из Active Directory.
    
 
9. В следующей строке введите "Дата собеседования" в столбце **Имя** и выберите **Смещение даты и времени** в столбце **Тип**.
    
    Дата и время хранятся в бизнес-типе **Смещение даты и времени** в формате UTC, что позволяет пользователям в различных часовых поясах видеть правильное время.
    
    На рис. 2 показана готовая сущность.
    

    **Рис. 2. Сущность "Кандидаты"**

 

  ![Таблица кандидатов](../../images/CBAentity.PNG)
 

 

 

### <a name="to-create-the-browse-screen"></a>Создание экрана обзора


1. В конструкторе сущностей, в строке **Перспектива**, выберите вкладку **HTML-клиент**, а затем на панели инструментов нажмите **Экран**.
    
    Откроется диалоговое окно **Добавление нового экрана**.
    
 
2. В диалоговом окне **Добавление нового экрана**, в списке **Выберите шаблон экрана**, выберите **Экран обзора данных**.
    
 
3. В списке **Данные экрана** выберите **Кандидаты** и нажмите кнопку **ОК**.
    
    Откроется конструктор экрана с представлением сущности данных в левой панели и представлением макета экрана в правой панели.
    
 
4. В правой панели конструктора экрана выберите узел **Список | Кандидаты**, а затем разверните список **Список** и выберите **Таблица**, как показано на рисунке 3.
    
    **Рис. 3. Элемент управления "Таблица"**

 

  ![Конструктор экрана BrowseCandidates](../../images/CBAscreen.PNG)
 

    В результате информация о **кандидатах** будет отображаться не в формате списка, который используется по умолчанию, а в формате таблицы.
    
    Обратите внимание, что кроме полей, которые вы определили для таблицы, есть еще четыре поля: "Кем создано", "Создано", "Кем изменено" и "Изменено". Эти поля создают журнал аудита, в котором можно посмотреть, когда и кем создан или в последний раз изменен элемент. 
    
 

### <a name="to-create-the-add-screen"></a>Создание экрана добавления


1. В конструкторе экрана откройте контекстное меню для узла **Панель команд** и выберите **Добавить кнопку**.
    
 
2. В диалоговом окне **Добавление кнопки** разверните список **showTab** и выберите **addAndEditNew**, как показано на рисунке 4, и нажмите кнопку **ОК**.
    
    **Рис. 4. Диалоговое окно "Добавление кнопки"**

 

  ![Диалоговое окно "Добавление кнопки"](../../images/CBAadd.PNG)
 

    Откроется диалоговое окно **Добавление нового экрана**.
    
 
3. В диалоговом окне **Добавление нового экрана** примите значения по умолчанию и нажмите кнопку **ОК**.
    
 
Откроется новое окно конструктора экрана.
 

 

### <a name="to-create-the-edit-screen"></a>Создание экрана редактирования


1. Откройте вкладку конструктора **BrowseCandidates.lsml** и в конструкторе экрана выберите узел **Таблица | Кандидаты**.
    
 
2. В окне **Свойства** выберите ссылку **Касание элемента**, как показано на рисунке 5.
    
    **Рис. 5. Ссылка "Касание элемента"**

 

  ![Свойство "Касание элемента"](../../images/CBAproperty.PNG)
 

    Откроется диалоговое окно **Изменить действие касания элемента**.
    
 
3. В диалоговом окне **Изменить действие касания элемента** разверните список **showTab** и выберите **editSelected**, как показано на рисунке 6, и нажмите кнопку **ОК**.
    
    **Рис. 6. Диалоговое окно изменения действия касания элемента**

 

  ![Диалоговое окно "Изменить действие ItemTap"](../../images/CBAaction.PNG)
 

 

 

### <a name="to-test-the-add-in"></a>Тестирование надстройки


1. В строке меню выберите **Отладка** > **Начать отладку**.
    
    При первом запуске надстройки для SharePoint на компьютере вам будет предложено установить сертификат Localhost, потому что облачные бизнес-надстройки всегда используют SSL (Secure Sockets Layer). Если вы примете этот сертификат, предупреждение безопасности не будет появляться при каждом запуске надстройки. Так как сертификат применяется только к Localhost, вашей системе ничего не угрожает.
    
 
2. В диалоговом окне **Оповещение системы безопасности** нажмите кнопку **Да**.
    
 
3. Если откроется диалоговое окно **Предупреждение о безопасности**, нажмите кнопку **Да**.
    
    Откроется веб-браузер.
    
 
4. На странице **входа** нажмите кнопку **Войти**.
    
 
5. Введите пароль и нажмите кнопку **Войти**.
    
 
6. При необходимости нажмите кнопку **Доверять**.
    
 
7. На экране **Обзор кандидатов** нажмите кнопку **Добавить кандидата**.
    
    Откроется экран **Добавление кандидата**.
    
 
8. На экране **Добавление кандидата** введите имя, номер телефона и адрес электронной почты.
    
 
9. Выберите поле **Кто порекомендовал** и введите первые три символа вашего имени.
    
    В списке должно появиться ваше полное имя. Если ваш сайт подключен к Active Directory, вы должны увидеть список все пользователей, чье имя начинается с таких же трех символов.
    
 
10. При необходимости измените дату и время в поле **Дата собеседования** и нажмите кнопку **Сохранить**, чтобы вернуться на экран **Обзор кандидатов**.
    
    Отобразится добавленный кандидат; если вы выберете строку, откроется экран **Добавление и редактирование кандидатов**. Обратите внимание, что некоторые поля наследуют поведение от пользовательских бизнес-типов. Выберите поле **Телефон**, чтобы набрать номер; выберите поле **Адрес электронной почты**, чтобы отправить сообщение; или наведите указатель на поле **Кем создано**, чтобы просмотреть свою контактную информацию.
    
 
11. Закройте окно браузера, чтобы остановить выполнение надстройки.
    
 

## <a name="add-a-newsfeed"></a>Добавление канала новостей
<a name="bk_feed"> </a>

Одна из возможностей SharePoint для Office 365 состоит в добавлении каналов новостей, позволяющих пользователи отслеживать действия в списке и добавлять комментарии. Облачные бизнес-надстройки упрощают создание канала новостей для вашей надстройки.
 

 

### <a name="to-enable-social-integration"></a>Включение интеграции с социальными сетями


1. Откройте вкладку конструктора **Кандидаты.lsml**, а затем на панели **Перспектива** выберите вкладку **Сервер**.
    
 
2. В окне **Свойства** установите флажки **Размещать при создании** или **Размещать при обновлении**, как показано на рисунке 7.
    
    **Рис. 7. Свойства интеграции с социальными сетями**

 

  ![Свойства интеграции с социальными сетями](../../mages/CBAsocial.PNG)
 

 

 
3. Перейдите по ссылке **Выбор триггеров записи**.
    
    Откроется диалоговое окно **Выбор триггеров записи**.
    
 
4. В диалоговом окне **Выбор триггеров записи** снимите флажок **Все поля**, установите флажок **Дата собеседования** и нажмите кнопку **ОК**.
    
 

### <a name="to-test-the-add-in"></a>Тестирование надстройки


1. В строке меню выберите **Отладка** > **Начать отладку**.
    
 
2. На экране **Обзор кандидатов** выберите созданного ранее кандидата.
    
 
3. На экране **Добавление и редактирование кандидата** измените значение в поле **Дата собеседования** и нажмите кнопку **Сохранить**.
    
 
4. Нажмите кнопку **Добавить кандидата** и добавьте еще одного кандидата.
    
 
5. На экране **Обзор кандидатов**, в строке хрома SharePoint, выберите ссылку **Канал новостей**.
    
    В новом окне браузера откроется **Канал новостей приложения "Отслеживание кандидатов"** с двумя новыми записями для добавленных и обновленных кандидатов. Вы можете нажать для записи ссылку **Мне нравится** или **Ответить**, чтобы добавить комментарий.
    
 
6. Закройте оба окна браузера, чтобы остановить выполнение надстройки.
    
 

## <a name="add-validation"></a>Добавление проверки
<a name="bk_validate"> </a>

Во многих бизнес-надстройках необходимо ограничивать доступ к определенным функциями, например, разрешая изменять дату собеседования только менеджеру. В облачных бизнес-надстройках это можно сделать, написав логику проверки; в данном случае вы напишете код для проверки того, входит ли текущий пользователь в определенную группу безопасности Active Directory.
 

 

### <a name="to-add-validation"></a>Добавление проверки


1. Откройте вкладку конструктора **Кандидаты.lsml**, а затем на панели **Перспектива** выберите вкладку **Сервер**.
    
 
2. На панели инструментов разверните список **Запись кода** и выберите метод **Candidates_Validate**.
    
    Откроется редактор кода.
    
 
3. В редакторе кода добавьте в метод **Candidates_Validate** следующий код:
    
```VB.net
  If Not Application.User.Department = "Hiring Managers" Then
                results.AddEntityError("Permission denied")
            End If
```


```C#
  if (!(Application.User.Department == "Hiring Managers")) {
results.AddEntityError("Permission denied");
}
```


    The  **Validate** method is run when a user tries to save a record. If the user is a member of the Hiring Managers security group, the record is saved, otherwise a "Permission denied" error message is displayed and the record is discarded.
    
 
Если сейчас вы запустите надстройку и добавите нового кандидата, скорее всего, вы увидите сообщение об ошибке, если только не являетесь участником действительной группы безопасности "Менеджеры по найму". Замените "Менеджеры по найму" на имя группы безопасности, к которой вы принадлежите, и попробуйте еще раз. Теперь у вас должно быть разрешение на добавление кандидата.
 

 

## <a name="next-steps"></a>Дальнейшие действия
<a name="bk_validate"> </a>

Поздравляем! Вы создали свою первую облачную бизнес-надстройку. Если вы хотите поделиться ей с пользователями, вашим следующем шагом должна стать публикация надстройки. См. статью  [Практическое руководство. Публикация облачной бизнес-надстройки в Office 365](http://msdn.microsoft.com/en-us/library/vstudio/dn454601.aspx) или [Публикация надстроек для SharePoint](http://msdn.microsoft.com/en-us/library/office/apps/jj164070.aspx).
 

 
Конечно, это только простой пример; есть намного больше возможностей для создания полнофункциональных надстроек. Так как шаблон облачной бизнес-надстройки основан на технологиях LightSwitch, возможно, вы найдете для себя интересные идеи в документации по LightSwitch. См. статью  [Надстройки LightSwitch для SharePoint](http://msdn.microsoft.com/en-us/library/vstudio/jj969620.aspx).
 

 

## <a name="additional-resources"></a>Дополнительные ресурсы
<a name="bk_addresources"> </a>


-  [Создание облачных бизнес-надстроек](create-cloud-business-add-ins)
    
 

