# <a name="create-a-sharepoint-add-in-that-contains-a-document-template-and-a-task-pane-add-in"></a>Создание надстройки SharePoint, содержащей шаблон документов и надстройку области задач
Разработка надстройки Office, которая отображается в документе, открытом из надстройки SharePoint, с помощью Visual Studio.
 

 **Примечание.** Название "приложения для SharePoint" меняется на "надстройки SharePoint". Пока изменения не будут внесены полностью, в документации и пользовательском интерфейсе некоторых продуктов SharePoint и средств Visual Studio по-прежнему может встречаться термин "приложение". Дополнительные сведения см. в разделе [Новое название приложений для Office и SharePoint](new-name-for-apps-for-sharepoint#bk_newname).
 

Вы можете создать надстройку SharePoint, которая включает в себя шаблон документа (например, авансовый отчет). Этот документ может содержать надстройку области задач, взаимодействующую с данными SharePoint. Например, пользователи могут заполнить поля счета, используя данные из Business Connectivity Services (BCS), или создать авансовый отчет, выбрав категорию расходов из списка SharePoint.
 

В этом пошаговом руководстве показано, как создать надстройку SharePoint, которая включает в себя книгу Excel. Книга Excel содержит надстройку области задач, использующую интерфейс REST, предоставленный SharePoint, для заполнения поля раскрывающегося списка данными SharePoint.
 


## <a name="prerequisites"></a>Необходимые компоненты
<a name="Prerequisites"> </a>

Установите следующие компоненты перед началом работы:
 

 

 

 

- Среда разработки для SharePoint:
    
      - О разработке надстроек SharePoint для Office 365 см. в статье[ Настройка среды для разработки надстроек SharePoint в Office 365](http://msdn.microsoft.com/ru-ru/library/office/apps/fp161179%28v=office.15%29).
    
 
  - Если вы собираетесь создавать надстройки SharePoint, предназначенные для локальной установки SharePoint, см. статью [Настройка локальной среды разработки надстроек SharePoint](http://msdn.microsoft.com/ru-ru/library/office/apps/fp179923%28v=office.15%29).
    
 
-  [Visual Studio 2015 и Инструменты разработчика Microsoft Office](https://www.visualstudio.com/features/office-tools-vs)
    
 
- Excel 2013 или учетная запись Office 365.
    
 

## <a name="create-a-sharepoint-add-in-project-in-visual-studio"></a>Создание проекта надстройки SharePoint в Visual Studio
<a name="Create"> </a>


1. Запустите Visual Studio.
    
 
2. В строке меню выберите пункты **Файл**, **Создать** и **Проект**.
    
    Откроется диалоговое окно **Создание проекта**.
    
 
3. Перейдите к области шаблонов и в узле необходимого языка разверните узел **Office/SharePoint**, затем выберите элемент **Office Add-ins** (Надстройки Office).
    
 
4. В списке типов проектов выберите элемент **Надстройка SharePoint**, назовите проект OfficeEnabledAddin и нажмите кнопку **ОК**.
    
    Откроется диалоговое окно **Создание надстройки SharePoint**.
    
 
5. В раскрывающемся списке **Какой сайт SharePoint использовать для отладки надстройки?** выберите или введите URL-адрес сайта SharePoint.
    
 
6. В раскрывающемся списке **Как разместить надстройку SharePoint?** выберите **Размещено в SharePoint** и нажмите кнопку **Далее**.
    
     **Примечание**. Этот сценарий подходит только для вариантов размещения в SharePoint и у поставщика, указанных в раскрывающемся списке **Как требуется разместить надстройку SharePoint?**.
7. На следующей странице выберите **SharePoint**, а затем нажмите кнопку **Готово**, чтобы закрыть диалоговое окно.
    
 

## <a name="add-a-task-pane-add-in-item"></a>Добавление надстройки области задач
<a name="Add"> </a>

Затем добавьте в проект надстройку Office. Вы можете добавить надстройку любого типа. В этом руководстве мы добавим надстройку области задач.
 

 

1. В **обозревателе решений** выберите узел проекта **OfficeEnabledAddin**.
    
 
2. В меню **Проект** выберите пункт **Добавить новый элемент**.
    
 
3. В диалоговом окне **Добавление нового элемента** последовательно выберите элементы **Office/SharePoint** и **Надстройка Office**.
    
 
4. Назовите надстройку области задач MyTaskPaneAddin и нажмите кнопку **Добавить**.
    
    Откроется диалоговое окно **Создание надстройки для Office**.
    
 
5. В диалоговом окне **Создание надстройки для Office** выберите **Область задач** и нажмите кнопку **Далее**. На следующей странице снимите флажки **Word** и **PowerPoint** и нажмите кнопку **Далее**.
    
 
6. На странице  **Добавить надстройку Office в новый или существующий документ?** выберите вариант **Создать документ и вставить надстройку** и нажмите кнопку **Готово**.
    
    Visual Studio добавляет библиотеку документов и шаблон книги для библиотеки. Книга содержит надстройку области задач.
    
 

## <a name="add-a-document-library"></a>Добавление библиотеки документов
<a name="Library"> </a>

В этом разделе описано, как добавить библиотеку документов и сделать книгу шаблоном по умолчанию для этой библиотеки.
 

 

1. В **обозревателе решений** выберите узел проекта **OfficeEnabledAddin**.
    
 
2. В меню **Проект** выберите пункт **Добавить новый элемент**.
    
 
3. В диалоговом окне **Добавление нового элемента** последовательно выберите элементы **Office/SharePoint** и **Список**. Назовите список MyDocumentLibrary и нажмите кнопку **Добавить**.
    
 
4. В **мастере настройки SharePoint** выберите параметр **Создать шаблон настраиваемого списка и отобразить его экземпляр в списке**.
    
 
5. В раскрывающемся списке под этим параметром выберите **Библиотека документов**, а затем нажмите кнопку **Далее**.
    
 
6. На странице **Выбор шаблона для библиотеки документов. Документы, создаваемые в библиотеке, будут основаны на этом шаблоне** выберите **Использовать следующий документ в качестве шаблона для библиотеки**, а затем нажмите кнопку **Обзор**.
    
 
7. В диалоговом окне **Открыть** откройте папку **OfficeDocuments**, выберите файл **MyTaskPaneApp.xlsx**, нажмите кнопку **Открыть**, затем нажмите кнопку **Готово** и закройте конструктор списка.
    
 
8. В **обозревателе решений** выберите узел проекта **OfficeEnabledAddin**.
    
 
9. В меню **Вид** выберите пункт **Окно свойств**.
    
 
10. В **обозревателе решений** выберите файл **AppManifest.xml**.
    
 
11. Выберите **Вид**, **Конструктор**.
    
 
12. В конструкторе манифестов задайте для элемента **Начальная страница** значение ~appWebUrl/Lists/MyDocumentLibrary. Оно будет преобразовано в значение OfficeEnabledAddin/Lists/MyDocumentLibrary.
    
     **Примечание.** Этот URL-адрес относится к библиотеке документов. В начале любого URL-адреса в манифесте надстройки Office, указывающего на элементы веб-сайта надстройки, необходимо указывать токен ~appWebUrl. Дополнительные сведения о токенах URL-адреса в проекте надстройки SharePoint см. в статье [Токены и строки URL-адресов в надстройках SharePoint](url-strings-and-tokens-in-sharepoint-add-ins).
13. Закройте конструктор манифестов, чтобы сохранить изменения.
    
 

## <a name="consume-sharepoint-data-in-the-task-pane"></a>Использование данных SharePoint в области задач
<a name="Consume"> </a>

В этом разделе описано, как показать список пользователей сайта с помощью интерфейса REST, доступного в SharePoint.
 

 
В этом примере отображаются только данные списка SharePoint, но вы можете использовать их в надстройке утверждения документа. Когда пользователь выбирает имя из этого списка, код устанавливает значение столбца "Рецензент" в списке отслеживания документа. Этому пользователю может быть отправлено уведомление о проверке. Кроме того, вы можете сохранить выбранное имя в параметрах документа. Тогда элементы управления в надстройке области задач будут отображаться, только если документ откроет пользователь, указанный в параметрах документа. Дополнительные сведения:
 

 

-  [Выполнение базовых операций с использованием конечных точек SharePoint REST](complete-basic-operations-using-sharepoint-2013-rest-endpoints)
    
 
-  [Выполнение базовых операций с использованием кода библиотеки JavaScript в SharePoint](complete-basic-operations-using-javascript-library-code-in-sharepoint-2013)
    
 
-  [Сохранение состояния и параметров надстройки](http://msdn.microsoft.com/library/407df6e8-c237-4d6a-b357-3000fe3de9ff%28Office.15%29.aspx)
    
 

1. В **обозревателе решений** последовательно откройте папки **MyTaskPaneAddin** и **Home**, а затем выберите файл **Home.html**.
    
    Файл Home.html откроется в редакторе кода.
    
 
2. Добавьте следующий HTML-код под кнопкой `get-data-from-selection`.
    
```HTML
  <p>Select Reviewer:</p> <select class="select" id="select-reviewer" name="D1"> </select>
```

3. Выберите файл **Home.js**, чтобы открыть его в редакторе кода.
    
 
4. В начало файла Home.js добавьте следующие объявления.
    
```
  var appWebURL; var web;
```

5. Замените функцию `Initialize` следующим кодом.
    
    Этот код выполняет такие задачи:
    
      - Загрузка файлов SP.Runtime.js и SP.js с помощью функции `getScript` в jQuery. После загрузки файлов программа получит доступ к объектной модели JavaScript для SharePoint.
    
 
  - Загрузка текущего объекта веб-сайта.
    
 
  - Вызов функции, получающей всех пользователей сайта. Код для этой функции будет добавлен на следующем этапе.
    
 



```JS
   // The initialize function must be run each time a new page is loaded 
   Office.initialize = function (reason) { $(document).ready(function () { app.initialize(); var scriptbase = "/_layouts/15/"; $.getScript(scriptbase + "SP.Runtime.js", function () { $.getScript(scriptbase + "SP.js", function () { getAppWeb(function () { getSPUsers(populateUsersDropDown); }); }); }); function getAppWeb(functionToExecuteOnReady) { var context = SP.ClientContext.get_current(); web = context.get_web(); context.load(web); context.executeQueryAsync(onSuccess, onFailure); function onSuccess() { appWebURL = web.get_url(); functionToExecuteOnReady(); } function onFailure(sender, args) { app.initialize(); app.showNotification("Failed to connect to SharePoint. Error: " + args.get_message()); } } $('#get-data-from-selection').click(getDataFromSelection); }); };
```

6. Добавьте следующий код в конец файла Home.js.
    
    This code obtains a list of website users by using the REST interface provided by SharePoint. Then, this code populates a drop-down list with the name and ID of each user.
    


```JS
  function getSPUsers(functionToExecuteOnReady) { var url = appWebURL + "/../_api/web/siteUsers"; jQuery.ajax({ url: url, type: "GET", headers: { "ACCEPT": "application/json;odata=verbose" }, success: onSuccess, error: onFailure }); function onSuccess(data) { var results = data.d.results; functionToExecuteOnReady(results); } function onFailure(jaXHR, textStatus, errorThrown) { var error = textStatus + " " + errorThrown; app.showNotification(error); } } function populateUsersDropDown(results) { for (var i = 0; i < results.length; i++) { var IDTemp = results[i].Id; $('#select-reviewer').append("<option value='" + IDTemp + "'>" + results[i].Title + "</option>"); } }
```

7. В **обозревателе решений** откройте контекстное меню файла **AppManifest.xml** и выберите пункт **Конструктор представлений**.
    
 
8. В конструкторе перейдите на страницу **Разрешения**.
    
 
9. В раскрывающемся списке в столбце **Область** выберите элемент **Интернет**.
    
 
10. В раскрывающемся списке в столбце **Разрешения** выберите элемент **Чтение**.
    
 

## <a name="debug-the-task-pane-add-in"></a>Отладка надстройки области задач
<a name="debug"> </a>

Чтобы отладить надстройку области задач, откройте документ или запустите надстройку SharePoint, а затем откройте документ из библиотеки документов.
 

 

### <a name="debugging-your-task-pane-add-in-by-starting-the-document"></a>Отладка надстройки области задач с помощью открытия документа


 

 

 **Примечание**. Так как эта процедура открывает Microsoft Excel, она работает только в том случае, если на компьютере установлен пакет Office. В противном случае возникает ошибка "Приложение, связанное с этим типом проекта, не установлено на компьютере".
 


1. Откройте файл Home.js в редакторе кода, а затем задайте точку останова рядом с методом `getDataFromSelection`.
    
 
2. В **обозревателе решений** выберите узел проекта **OfficeEnabledApp**.
    
 
3. В меню **Вид** выберите пункт **Окно свойств**.
    
 
4. В окне свойств в раскрывающемся списке **Действие при запуске** выберите элемент **Настольный клиент Office**. При этом появится новое свойство, **Документ при запуске**.
    
 
5. В раскрывающемся списке **Документ при запуске** выберите элемент **OfficeDocuments\TaskPaneApp.xlsx**.
    
 
6. В меню **Отладка** выберите команду **Начать отладку**.
    
    Это приведет к тому, что при запуске надстройки области задач в ней отобразится книга. Откроется книга, и появится надстройка области задач.
    
 
7. В надстройке области задач щелкните раскрывающийся список **Выбор рецензента**, чтобы просмотреть список пользователей SharePoint.
    
 
8. В книге Excel выберите любую ячейку.
    
 
9. В надстройке области задач нажмите кнопку **Получение данных из выделения**.
    
    Выполнение остановится в месте точки останова, указанной для метода `getDataFromSelection`.
    
 

### <a name="debugging-your-task-pane-add-in-by-starting-sharepoint"></a>Отладка надстройки области задач путем запуска SharePoint


 

 

 **Примечание.** При выполнении инструкций из этого раздела открывается Excel Online, поэтому обязательно наличие учетной записи Office 365. См. статью [Настройка среды для разработки надстроек SharePoint в Office 365](http://msdn.microsoft.com/ru-ru/library/office/apps/fp161179%28v=office.15%29).
 


1. Откройте файл Home.js в редакторе кода, а затем задайте точку останова рядом с методом `getDataFromSelection`.
    
 
2. В **обозревателе решений** выберите узел проекта **OfficeEnabledApp**.
    
 
3. В меню **Вид** выберите пункт **Окно свойств**.
    
 
4. В окне свойств в раскрывающемся списке **Действие при запуске** выберите элемент **Internet Explorer**.
    
 
5. В меню **Отладка** выберите команду **Начать отладку**.
    
    Visual Studio откроет SharePoint и отобразит библиотеку **MyDocumentLibrary**.
    
 
6. В SharePoint на вкладке **Файлы**, выберите команду **Создать документ**. 
    
 
7. Перейдите к книге в проекте MyTaskPaneApp.xlsx.
    
    Откроется книга, и появится надстройка области задач.
    
 
8. Проверьте, что в браузере включена отладка скриптов. Чтобы включить отладку в Internet Explorer, откройте диалоговое окно **Свойства обозревателя**, перейдите на вкладку **Дополнительно** и снимите флажки **Отключить отладку сценариев (Internet Explorer)** и **Отключить отладку сценариев (другие)**.
    
 
9. В Visual Studio откройте меню **Отладка** и выберите команду **Присоединиться к процессу**.
    
 
10. В диалоговом окне **Присоединение к процессу** выберите все доступные процессы **iexplore.exe**, а затем нажмите кнопку **Присоединиться**.
    
 
11. В надстройке области задач щелкните раскрывающийся список **Выбор рецензента**, чтобы просмотреть список пользователей SharePoint.
    
    Данные в списке извлекаются из SharePoint с помощью вызова REST.
    
 
12. В книге Excel выберите любую ячейку.
    
 
13. В надстройке области задач нажмите кнопку **Получение данных из выделения**.
    
    Выполнение остановится в месте точки останова, указанной для метода `getDataFromSelection`.
    
     **Примечание**. Если книга не содержит данных, вы можете добавить их, выбрав элементы **Изменить книгу**, **Изменить в Excel Online** на панели инструментов в книге.

## <a name="package-and-publish-the-add-in"></a>Упаковка и публикация надстройки
<a name="Package"> </a>

Когда надстройка будет готова к упаковке для публикации, откройте мастер **публикации надстроек Office и SharePoint**.
 

 

- В  **обозревателе решений** откройте контекстное меню для проекта надстройки SharePoint и выберите элемент **Опубликовать**.
    
    Откроется **мастер публикации надстроек для Office и SharePoint**. Дополнительные сведения см. в статье [Публикация надстройки для SharePoint с помощью Visual Studio](publish-sharepoint-add-ins-by-using-visual-studio).
    
 

## <a name="additional-resources"></a>Дополнительные ресурсы
<a name="AdditionalResources"> </a>


-  [Надстройки области задач и контентные надстройки для Office 2013](http://msdn.microsoft.com/library/baf73b23-4429-4b7f-bcb9-a99a9618ae38%28Office.15%29.aspx)
    
 
-  [Рекомендации по разработке надстроек для Office](http://msdn.microsoft.com/library/d5b2ab2e-dfc8-47c8-919c-e9c23358d70c%28Office.15%29.aspx)
    
 
-  [Жизненный цикл разработки надстроек Office](http://msdn.microsoft.com/library/c35b4b2b-7869-4501-9f10-888c8e74c98c%28Office.15%29.aspx)
    
 
-  [Публикация надстройки Office](http://msdn.microsoft.com/library/7f3ae6a0-06e9-438c-8899-bd9f605e6d9e%28Office.15%29.aspx)
    
 
-  [Общие сведения об интерфейсе API JavaScript для Office](http://msdn.microsoft.com/library/01180dae-ca45-40c8-b3dd-fd2a85651c0c%28Office.15%29.aspx)
    
 
-  [XML-манифест надстроек для Office](http://msdn.microsoft.com/library/4139ff24-afac-472a-af7d-9d069587ac9b%28Office.15%29.aspx)
    
 
-  [Справка по API и схеме надстроек для Office](http://msdn.microsoft.com/library/afcc2908-1e1b-4297-b554-11e6eb404804%28Office.15%29.aspx)
    
 

