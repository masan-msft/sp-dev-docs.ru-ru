# <a name="add-in-permissions-in-sharepoint"></a>Разрешения для надстроек SharePoint
Сведения о разрешениях для надстроек SharePoint, в том числе о типах разрешений, областях запросов и управлении разрешениями. В этой статье также рассматриваются отличия между правами для надстроек, пользователей и приложений Магазина Office.
 

 **Примечание.** В настоящее время идет процесс замены названия "приложения для SharePoint" названием "надстройки SharePoint". Во время этого процесса в документации и пользовательском интерфейсе некоторых продуктов SharePoint и средств Visual Studio может по-прежнему использоваться термин "приложения для SharePoint". Дополнительные сведения см. в статье [Новое название приложений для Office и SharePoint](new-name-for-apps-for-sharepoint#bk_newname).
 

Прежде чем читать эту статью, необходимо ознакомиться со статьей [Авторизация и проверка подлинности надстроек SharePoint](authorization-and-authentication-of-sharepoint-add-ins). 

## <a name="get-an-overview-of-add-in-permissions-in-sharepoint"></a>Общие сведения о разрешениях для надстроек SharePoint
<a name="Perm_intro"> </a>

Надстройка SharePoint запрашивает разрешения, необходимые во время установки, у пользователя, который выполняет установку. Разработчик надстройки должен запрашивать разрешения, которые нужны надстройке для запуска, с помощью файла манифеста. Пользователь, запускающий надстройку, должен предоставить разрешения устройствам и веб-приложениям, которые получают доступ к SharePoint, но не установлены на веб-сайтах SharePoint, в среде выполнения. Дополнительные сведения можно узнать в статье  [Общие сведения о надстройках, запрашивающих разрешение на доступ из SharePoint во время выполнения](authorization-code-oauth-flow-for-sharepoint-add-ins#Overview). Пользователи могут предоставлять только те разрешения, которыми обладают. Пользователь может предоставить надстройке либо все необходимые разрешения, либо никаких. Выборочное предоставление разрешений невозможно. Если надстройка запрашивает разрешения в ходе выполнения, ее может запускать только пользователь с разрешениями уровня "Управление" на ресурсы SharePoint, даже если надстройке требуются разрешения более низкого уровня, например "Чтение".
 

 
Предоставленные надстройке разрешения также хранятся в базе данных контента для фермы SharePoint или области клиента SharePoint Online. Они не хранятся в службе токенов безопасности, например Служба контроля доступа Microsoft Azure (ACS). Когда пользователь впервые предоставляет надстройке разрешения, SharePoint получает сведения о надстройке из службы контроля доступа. Затем SharePoint сохраняет основные сведения о надстройке и ее разрешения в службе управления надстройками и базе данных контента. Дополнительные сведения о службе контроля доступа можно узнать в статье  [Создание надстроек для SharePoint, которые используют авторизацию с низким уровнем доверия](creating-sharepoint-add-ins-that-use-low-trust-authorization).
 

 
Если объект, на доступ к которому надстройке было предоставлено разрешение, удаляется, соответствующее разрешение также удаляется. Если же такой объект помещается в корзину, SharePoint не изменяет соответствующее разрешение. Это нужно для того, чтобы в случае восстановления объекта из корзины разрешение сохранилось.
 

 
При удалении надстройки отзываются все разрешения, предоставленные ей для области, из которой она удаляется. Это необходимо для того, чтобы надстройка не могла использовать свои учетные данные для удаленного доступа к защищенным ресурсам SharePoint после того, как пользователь удалит ее из SharePoint.
 

 

## <a name="understand-the-types-of-add-in-permissions-and-permission-scopes"></a>Основные сведения о типах и областях разрешений надстройки
<a name="Perm_types"> </a>

С помощью запросов Надстройка SharePoint получает разрешения, необходимые для ее правильной работы. В запросах разрешений указываются как права, требуемые надстройке, так и область их действия. Разрешения запрашиваются в рамках манифеста надстройки.
 

 

 **Примечание.** Области, описываемые в этом разделе, применимы к только содержимому списков и библиотек. Сведения об областях для других компонентов см. в разделе [Основные сведения о типах и областях разрешений надстройки](#Perm_types) этой статьи.
 

Области запросов разрешений указывают расположение в иерархии SharePoint, на которое распространяется запрос разрешений.
 

 

 **Примечание.** Надстройка SharePoint обладает собственным удостоверением и является субъектом безопасности, который называется субъектом надстройки. Аналогично пользователям и группам, субъект надстройки располагает определенными разрешениями или правами. У него есть права на полный доступ к сайту надстройки, поэтому ему требуется запрашивать разрешения на доступ к ресурсам SharePoint только на хост-сайте и в других расположениях вне сайта надстройки. Дополнительные сведения о сайте надстройки см. в статьях [Важные аспекты разработки и архитектуры для надстроек SharePoint](important-aspects-of-the-sharepoint-add-in-architecture-and-development-landscape) и [Хост-сайты, сайты надстроек и компоненты SharePoint в SharePoint](host-webs-add-in-webs-and-sharepoint-components-in-sharepoint-2013).
 

SharePoint поддерживает четыре различных области разрешений для базы данных контента и области клиента, как показано в таблице 1. Названия областей разрешений совпадают с кодами URI, включая префикс http:, но они не являются URL-адресами и не содержат заполнителей. Области разрешений, перечисленные в этих статье и таблице, строки литералов.
 

 

**Таблица 1. URI и описания областей запросов разрешений для надстроек SharePoint**

|**Область**|**URI области**|**Описание**|
|:-----|:-----|:-----|
|Клиент| http://sharepoint/content/tenant|Клиент, в котором установлена надстройка. Включает все дочерние элементы этой области.|
|Семейство веб-сайтов| http://sharepoint/content/sitecollection|Семейство веб-сайтов, в котором установлена надстройка. Включает все дочерние элементы этой области.|
|Веб-сайт| http://sharepoint/content/sitecollection/web|Веб-сайт, на котором установлена надстройка. Включает все дочерние элементы этой области.|
|Список| http://sharepoint/content/sitecollection/web/list|Представляет собой единый список веб-сайта, на котором установлена надстройка. Когда пользователю, который устанавливает надстройку, предлагается предоставить разрешения, в диалоговом окне он может выбрать один список, для которого надстройке предоставляются разрешения. Если надстройка требует разрешения более чем для одного списка, необходимо запрашивать разрешение для веб-области. Поскольку у разработчиков нет возможности контролировать выбор списков пользователями, равно как и сообщать последним, какой список следует выбрать, необходимо использовать веб-область, если есть такой список, для которого у вашей надстройки  *должно*  быть разрешение. (Тем не менее, существует возможность ограничить выбор пользователей определенными подмножествами списков. См. раздел [Область запроса разрешений со связанными свойствами](#AssociatedProperties) ниже.) |

Если надстройке предоставлено разрешение на одну из областей, оно применяется ко всем дочерним элементам в этой области. Например, если надстройке предоставлено разрешение на доступ к веб-сайту, ей также предоставляется разрешение на доступ ко всем спискам на веб-сайте и всем элементам этих списков.
 

 
Поскольку запросы разрешений выполняются безотносительно к топологии семейства веб-сайтов, в котором установлена надстройка, область указывается как тип, а не как URL-адрес определенного экземпляра. Эти типы областей выражаются в виде универсальных кодов ресурсов (URI). Разрешения для ресурсов, которые хранятся в базе данных контента SharePoint, упорядочены по следующему URI:  `http://sharepoint/content`.
 

 

## <a name="understand-the-differences-between-add-in-permission-rights-and-user-rights"></a>Различия между правами, связанными с разрешениями надстройки, и правами пользователя
<a name="Perm_diff"> </a>

Разрешения определяют действия, которые надстройке разрешено выполнять в рамках данной области. SharePoint поддерживает четыре уровня прав на доступ к базе данных контента. В каждой области надстройка может иметь следующие права:
 

 

- Чтение
    
 
- Запись
    
 
- Управление
    
 
- FullControl
    
 

 **Примечание.** Дополнительные сведения о составе прав Read, Write, Manage и FullControl см. в статье [Планирование управления разрешениями надстроек](http://technet.microsoft.com/en-us/library/jj219576%28office.15%29.aspx).
 


 **Примечание.** Эти права соответствуют стандартным уровням разрешений для пользователей SharePoint: "Читатель", "Участник", "Разработчик" и "Полный доступ". Дополнительные сведения об уровнях разрешений для пользователей см. в статье [Разрешения и уровни разрешений для пользователей](http://technet.microsoft.com/en-us/library/cc288074.aspx). Имена прав для надстроек не совпадают с названиями прав для ролей пользователей SharePoint, чтобы их невозможно было перепутать друг с другом. Настройка разрешений, связанных с ролями пользователей SharePoint, не влияет на уровни разрешений для надстроек, поэтому имена прав для надстроек не совпадают с названиями соответствующих ролей пользователей SharePoint (за исключением разрешения "Полный доступ", которое невозможно настраивать с помощью пользовательского интерфейса управления разрешениями).
 

Кроме того:
 

 

- Надстройка может иметь право на выполнение запросов только в области поиска.
    
 
- Для некоторых областей Microsoft Project Server 2013 также имеются права на отправку состояния и повышение прав. Для большинства областей Project Server 2013 доступны только права на чтение и запись. Подробнее можно узнать в разделе  [Основные сведения о типах и областях разрешений надстройки](#Perm_types) этой статьи.
    
 
- Для таксономии доступны только права на чтение и запись.
    
 

 **Примечание.** В отношении прав, которые могут запрашивать надстройки из Магазина Office, действуют некоторые ограничения. Дополнительные сведения см. в разделе [Основные сведения о типах и областях разрешений надстройки](#Perm_types) этой статьи.
 

В отличие от ролей пользователей SharePoint, эти уровни прав недоступны для настройки. Это позволяет гарантировать, что если надстройка запрашивает разрешения, ей предоставляется предсказуемый набор возможностей. При этом надстройке не нужно учитывать возможность того, что ей будет предоставлен более низкий уровень разрешений, чем требуется.
 

 
Пользователь не может предоставить надстройке разрешения, которых у него нет. При попытке установить надстройку, которой требуется больше разрешений, чем есть у пользователя, отображается соответствующее сообщение об ошибке.
 

 
Разрешения, которые неизвестны системе SharePoint, игнорируются. Это означает, что если надстройка запрашивает разрешение, которое не распознается системой SharePoint, эту надстройку можно установить, но она не запрашивает разрешение у пользователя и не получает его.
 

 

## <a name="learn-about-the-available-scopes-and-permissions-and-about-the-restrictions-on-office-store-apps-permissions"></a>Сведения о доступных областях и разрешениях, а также ограничениях, связанных с разрешениями надстроек Магазин Office
<a name="Perm_rightlist"> </a>

Различные области имеют разные наборы прав, которые может запросить надстройка. В этом разделе описываются наборы прав, доступные для каждой области. В нем также рассматриваются ограничения на Надстройки SharePoint, которые продаются через Магазин Office.
 

 

### <a name="office-store-apps-rights"></a>Права надстроек Магазин Office

Для надстроек из Магазин Office доступны только права на чтение, запись и управление. Если вы попытаетесь отправить в Магазин Office надстройку, требующую права на полный доступ, отправка будет заблокирована. Поскольку блокировка происходит в процессе отправки в Магазин Office, надстройки, которые запрашивают уровень разрешений выше, чем "Управление", можно развертывать через каталог надстроек.
 

 

### <a name="permission-request-scopes-for-list-content-and-library-content"></a>Области запроса разрешений для содержимого списков и библиотек
<a name="PermissionsForLists"> </a>

В таблице 2 показаны области запроса разрешений для содержимого списков и библиотек. В ней также перечислены права, которые можно указать для универсального кода ресурса (URI) каждой области.
 

 

 **Примечание.** URI, используемые в таблице 2, являются литералами.
 


**Таблица 2. URI областей разрешений для надстроек SharePoint и доступные права**

|**URI области**|**Доступные права**|
|:-----|:-----|
|http://sharepoint/content/sitecollection|Чтение, запись, управление, полный доступ|
|http://sharepoint/content/sitecollection/web|Чтение, запись, управление, полный доступ|
|http://sharepoint/content/sitecollection/web/list|Чтение, запись, управление, полный доступ|
|http://sharepoint/content/tenant|Чтение, запись, управление, полный доступ|
В следующем фрагменте кода демонстрируется использование областей разрешений и прав в файле AppManifest.xml. В первом примере надстройка запрашивает разрешение на чтение для области списка.
 

 



```XML
<?xml version="1.0" encoding="utf-8" ?>
<App xmlns="http://schemas.microsoft.com/sharepoint/2012/app/manifest"
     ProductID="{4a07f3bd-803d-45f2-a710-b9e944c3396e}"
     Version="1.0.0.0"
     SharePointMinVersion="15.0.0.0"
     Name="MySampleAddIn"
>
  <Properties>
    <Title>My Sample Add-in</Title>
    <StartPage>~remoteAppUrl/Home.aspx?{StandardTokens}</StartPage>
  </Properties>

  <AppPrincipal>
    <RemoteWebApplication ClientId="1ee82b34-7c1b-471b-b27e-ff272accd564" />
  </AppPrincipal>

  <AppPermissionRequests>
    <AppPermissionRequest Scope="http://sharepoint/content/sitecollection/web/list" Right="Write"/>
  </AppPermissionRequests>
</App>
```

В следующем фрагменте кода надстройка запрашивает разрешение на чтение для области сайта и разрешение на запись для области списка.
 

 



```XML
<?xml version="1.0" encoding="utf-8" ?>
<App xmlns="http://schemas.microsoft.com/sharepoint/2012/app/manifest"
     ProductID="{4a07f3bd-803d-45f2-a710-b9e944c3396e}"
     Version="1.0.0.0"
     SharePointMinVersion="15.0.0.0"
     Name="MySampleAddIn"
>
  <Properties>
    <Title>My Sample Add-in</Title>
    <StartPage>~remoteAppUrl/Home.aspx?{StandardTokens}</StartPage>
  </Properties>

  <AppPrincipal>
    <RemoteWebApplication ClientId="6daebfdd-6516-4506-a7a9-168862921986" />
  </AppPrincipal>

  <AppPermissionRequests>
    <AppPermissionRequest Scope="http://sharepoint/content/sitecollection/web" Right="Read"/>
    <AppPermissionRequest Scope="http://sharepoint/content/sitecollection/web/list" Right="Write"/>
  </AppPermissionRequests>
</App>
```


### <a name="permission-request-scopes-for-other-sharepoint-features"></a>Области запроса разрешений для других компонентов SharePoint
<a name="PermissionsForLists"> </a>

В приведенных ниже таблицах перечислены области разрешений для других компонентов SharePoint. 
 

 

 **Примечание.** URI в этих таблицах являются литералами.
 

В таблице 3 показана область запроса разрешений для Службы Business Connectivity Services (BCS). В ней также перечислены права, которые можно указать для универсального кода ресурса (URI) этой области.
 

 

**Таблица 3. Коды URI области запроса разрешений надстройки для Business Connectivity Services и доступные права**

|**URI области**|**Доступные права**|
|:-----|:-----|
|http://sharepoint/bcs/connection|Чтение|

 **Примечание.** Дополнительные сведения об области разрешений служб BCS для надстроек см. в статье [Business Connectivity Services в SharePoint](http://msdn.microsoft.com/library/64b7d032-4b83-4e9e-bc08-f0a161af5457%28Office.15%29.aspx).
 


 

 
В таблице 4 показана область разрешений для службы поиска. В ней также перечислены права, которые можно задать для этого URI области.
 

 

**Таблица 4. Коды URI области запроса разрешений надстройки для поиска и доступные права**

|**URI области**|**Доступные права**|
|:-----|:-----|
|http://sharepoint/search|QueryAsUserIgnoreAppPrincipal|

 **Примечание.** Дополнительные сведения об области разрешений службы поиска для надстроек см. в статье [Поиск в SharePoint](http://msdn.microsoft.com/library/59220f81-0e5e-4945-8056-cf0a116446cb%28Office.15%29.aspx).
 


 

 
В таблице 5 показана область запроса разрешений для Project Server 2013. В ней также перечислены права, которые можно указать для универсального кода ресурса (URI) каждой области.
 

 

 **Примечание.** Надстройку с использованием компонентов и служб Project Server 2013 следует тестировать в среде, содержащей необходимые компоненты и службы Project Server. Сборка поставщика разрешений Project Server 2013, включающая сведения об областях разрешений Project Server 2013, не устанавливается в SharePoint Server по умолчанию. Дополнительные сведения см. в документации по Project Server 2013 для разработчиков.
 


**Таблица 5. URI областей разрешений и доступные права для надстроек Project Server**

|**Область**|**Доступные права**|
|:-----|:-----|
|http://sharepoint/projectserver|Управление|
|http://sharepoint/projectserver/projects|Чтение, запись|
|http://sharepoint/projectserver/projects/project|Чтение, запись|
|http://sharepoint/projectserver/enterpriseresources|Чтение, запись|
|http://sharepoint/projectserver/statusing|SubmitStatus|
|http://sharepoint/projectserver/reporting|Чтение|
|http://sharepoint/projectserver/workflow|Повышение прав|

 

 
В таблице 6 показана область запроса разрешений для социальных функций. В ней также перечислены права, которые можно указать для универсального кода ресурса (URI) каждой области.
 

 

**Таблица 6. Коды URI области запроса разрешений надстройки для социальных функций и доступные права**

|**URI области**|**Доступные права**|
|:-----|:-----|
|http://sharepoint/social/tenant|Чтение, запись, управление, полный доступ|
|http://sharepoint/social/core|Чтение, запись, управление, полный доступ|
|http://sharepoint/social/microfeed|Read, Write, Manage, FullControl|

 **Примечание.** Дополнительные сведения об области запроса разрешений надстройки для социальных функций см. в разделе [Добавление разрешений надстроек для доступа к социальным функциям](http://msdn.microsoft.com/library/8852ce36-8309-45a7-a141-2e10ac17a123%28Office.15%29.aspx#bkmk_AppPerms).
 


 

 
В таблице 7 показана область разрешений для таксономии. В ней также перечислены права, которые можно задать для этого URI области.
 

 

**Таблица 7. Коды URI области запроса разрешений надстройки для таксономии и доступные права**

|**URI области**|**Доступные права**|
|:-----|:-----|
|http://sharepoint/taxonomy|Read, Write|

 **Примечание.** Дополнительные сведения об области разрешений надстроек для таксономии см. в статье [Добавление возможностей SharePoint](http://msdn.microsoft.com/library/11ecb65e-6dc5-4cf1-80ca-3c16418697b6%28Office.15%29.aspx).
 


### <a name="permission-request-scope-with-associated-properties"></a>Область запроса разрешений с соответствующими свойствами
<a name="AssociatedProperties"> </a>

Область запроса разрешений для списков содержит дополнительное необязательное свойство. Для области списка может быть определено свойство с именем **BaseTemplateId** и целочисленным значением, соответствующим базовому шаблону списка, как показано в приведенном ниже примере части кода. Если оно не задано, пользователь, устанавливающий надстройку, может предоставить разрешение для *одного из списков* на сайте. Если задать идентификатор базового шаблона, пользователю будет доступен только набор списков, соответствующих значению свойства **BaseTemplateId**.
 

 
Свойство **BaseTemplateId** — это дочерний элемент, а не атрибут элемента **AppPermissionRequest**. В приведенном ниже коде демонстрируется использование свойства **BaseTemplateId**.
 

 



```XML
<AppPermissionRequest Scope="http://sharepoint/content/sitecollection/web/list" Right="Write">
  <Property Name="BaseTemplateId" Value="101"/>
</AppPermissionRequest>
```


**Таблица 7. Область запроса разрешений с соответствующими свойствами**

|**URI области**|**Свойство**|**Тип**|
|:-----|:-----|:-----|
|http://sharepoint/content/sitecollection/web/list|**BaseTemplateId**|Целое число. **Примечание.** Дополнительные сведения о свойстве **BaseTemplateId** и соответствующем целочисленном значении для базового шаблона списка см. в описании атрибута **Type** [элемента List](http://msdn.microsoft.com/library/b2b26fee-eb45-48ac-99f1-65f725da293f%28Office.15%29.aspx). |

## <a name="manage-and-troubleshoot-add-in-permissions"></a>Управление разрешениями для надстроек и устранение связанных с ними неполадок
<a name="Perm_manage"> </a>

Надстройки SharePoint, установленные в SharePoint, получают разрешения во время своей установки. Надстройки, установленные на других платформах, но запрашивающие доступ к SharePoint, получают разрешения в ходе выполнения от пользователя, запустившего надстройку. Иногда надстройки первого типа могут терять разрешения. Чтобы повторно предоставить им разрешения, необходимо выполнить следующие действия.
 

 

1. На веб-сайте, где надстройка могла потерять разрешения, откройте страницу **Содержимое сайта** и нажмите кнопку **???** на плитке надстройки. Откроется выноска с еще одной кнопкой **???** или со ссылкой **Разрешения**.
    
 
2. Если ссылка **Разрешения** отображается, перейдите по ней и пропустите следующий этап. В противном случае нажмите кнопку **???**.
    
 
3. Перейдите по ссылке **Разрешения**.
    
 
4. На открывшейся странице перейдите по ссылке **здесь** в последнем предложении. Надстройке будут заново назначены ее разрешения, и снова откроется страница **Содержимое сайта**.
    
 

 
![Повторное предоставление разрешений приложению](../../images/RegrantPermissionsToAnApp.png)
 
Иногда во время разработки надстройки или устранения неполадок в ней требуется изменить или повторно предоставить разрешения уже установленной надстройке. Для этого выполните следующие действия.
 

 

 

1. Перейдите по адресу `http://<SharePointWebSite>/_layouts/15/AppInv.aspx`, где _<SharePointWebSite>_ — это URL-адрес веб-сайта, где установлена надстройка. Не добавляйте к URL-адресу никаких параметров запроса. Нужная форма отображается на странице только при переходе по указанному выше URL-адресу.
    
 
2. Введите идентификатор надстройки (другое название — идентификатор клиента) в поле **ИД надстройки** и нажмите кнопку **Просмотр**. Остальные поля формы заполнятся сведениями о приложении.
    
 
3. В поле **XML-запрос разрешения** укажите запросы разрешений в том же виде, что и в манифесте надстройки. Примеры можно найти выше в разделе [Области запроса разрешений для содержимого списков и библиотек](#PermissionsForLists). Полные сведения о синтаксисе см. в статье [Элемент AppPermissionRequest](http://msdn.microsoft.com/library/4ad90fb0-33b2-aee5-69c2-5b97ca5334f8%28Office.15%29.aspx).
    
 
4. Нажмите кнопку **Создать**. 
    
 
При удалении надстройки из определенной области отзываются ее разрешения для этой области.
 

 

## <a name="learn-why-add-ins-cannot-be-hidden-from-users"></a>Узнайте, почему надстройки невозможно скрывать от пользователей
<a name="CannotBeHidden"> </a>

Любой пользователь, имеющий права на просмотр веб-сайта SharePoint, может запустить любую надстройку SharePoint, установленную на этом сайте. Действия, которые пользователь может выполнять с надстройкой, зависят от других его разрешений и  [типа политики авторизации](add-in-authorization-policy-types-in-sharepoint-2013), которая используется надстройкой. Если пользователь попытается выполнить с помощью надстройки действие, разрешения на которое у него нет, а при вызове SharePoint будет использоваться политика "пользователь + надстройка", отправить вызов не удастся.
 

 

## <a name="additional-resources"></a>Дополнительные ресурсы
<a name="Filename_AdditionalResources"> </a>


-  [Авторизация и проверка подлинности для надстроек в SharePoint](authorization-and-authentication-of-sharepoint-add-ins)
    
 
-  [Надстройки SharePoint](sharepoint-add-ins)
    
 
-  [Настройка локальной среды разработки надстроек SharePoint](set-up-an-on-premises-development-environment-for-sharepoint-add-ins)
    
 
-  [Знакомство с созданием надстроек SharePoint с размещением у поставщика](get-started-creating-provider-hosted-sharepoint-add-ins)
    
 
-  [Знакомство с созданием надстроек SharePoint с размещением в SharePoint](get-started-creating-sharepoint-hosted-sharepoint-add-ins)
    
 
