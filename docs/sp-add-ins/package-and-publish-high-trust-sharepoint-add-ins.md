
# <a name="package-and-publish-high-trust-sharepoint-add-ins"></a>Упаковка и публикация надстроек SharePoint с высоким уровнем доверия
Узнайте, как упаковать и опубликовать надстройку SharePoint с высоким уровнем доверия для локального использования.
 

 **Примечание.** Название "приложения для SharePoint" меняется на "надстройки SharePoint". Пока изменения не будут внесены полностью, в документации и пользовательском интерфейсе некоторых продуктов SharePoint и средств Visual Studio по-прежнему может встречаться термин "приложение". Дополнительные сведения см. в разделе [Новое название приложений для Office и SharePoint](new-name-for-apps-for-sharepoint#bk_newname).
 


## <a name="prerequisites-for-packaging-and-publishing-high-trust-add-ins"></a>Предварительные требования для упаковки и публикации надстроек с высоким уровнем доверия
<a name="Prereqs"> </a>

Вам понадобится следующее:
 

 

- Локальная среда разработки для SharePoint. Инструкции по ее настройке см. в статье [Настройка локальной среды разработки надстроек SharePoint](set-up-an-on-premises-development-environment-for-sharepoint-add-ins).
    
 
- Веб-сервер IIS для размещения удаленного веб-приложения. На нем должен быть установлен диспетчер IIS.
    
 
- Среда Visual Studio установлена удаленно или на компьютере с SharePoint.
    
 
- Инструменты разработчика Microsoft Office для Visual Studio
    
 
-  [Средство веб-развертывания](http://www.iis.net/downloads/microsoft/web-deploy), установленное на компьютере с Visual Studio, и такая же версия **средства веб-развертывания**, установленная на сервере удаленного веб-приложения.
    
 
В таблице 1 перечислены некоторые полезные статьи, которые помогут вам разобраться в понятиях, используемых при создании надстроек SharePoint.
 

 

**Таблица 1. Основные понятия, связанные с публикацией надстроек с высоким уровнем доверия**


|**Название статьи**|**Описание**|
|:-----|:-----|
| [Знакомство с созданием надстроек SharePoint с размещением у поставщика](get-started-creating-provider-hosted-sharepoint-add-ins)|Узнайте, как создать базовую надстройку SharePoint, размещаемую у поставщика, с помощью Инструментов разработчика Office для Visual Studio.|
| [Создание надстроек SharePoint с высоким уровнем доверия](create-high-trust-sharepoint-add-ins)|Узнайте, как создать простое Надстройка SharePoint с высоким уровнем доверия в Инструменты разработчика Office для Visual Studio с помощью самозаверяющего сертификата и соответствующего идентификатора издателя.|
| [Веб-развертывание](http://www.iis.net/downloads/microsoft/web-deploy)|Веб-развертывание упрощает развертывание веб-приложений и веб-сайтов на серверах IIS.|
| [Цифровые сертификаты](http://msdn.microsoft.com/library/e523b335-0156-4f47-b55c-b80495587c4f.aspx) и [Работа с сертификатами](http://msdn.microsoft.com/library/6ffb8682-8f07-4a45-afbb-8d2487e9dbc3.aspx)|Изучите основы работы с цифровыми сертификатами.|

 **Примечание.** Надстройки SharePoint с высоким уровнем доверия можно устанавливать только в локальной среде SharePoint (но не в Microsoft SharePoint Online). В первую очередь они предназначены для использования с локальными, а не облачными веб-приложениями. В этих статьях описывается публикация надстройки для такого случая. Кроме того, в этой статье понятие "пользователь" относится к организации, в которой устанавливается надстройка SharePoint и размещаются удаленные компоненты надстройки.
 


## <a name="register-the-high-trust-add-in"></a>Регистрация надстройки с высоким уровнем доверия
<a name="Register"> </a>

Перед публикацией надстройки ее необходимо зарегистрировать на ферме SharePoint с помощью службы управления надстройками. Надстройки SharePoint с высоким уровнем доверия всегда регистрируются на ферме SharePoint, на которой установлена надстройка. (Они не могут продаваться через Магазин Office.) Регистрация осуществляется на странице http:// _веб-сайт_SharePoint_/_layouts/15/appregnew.aspx, как это описано в следующей процедуре.
 

 

### <a name="to-register-the-add-in"></a>Регистрация надстройки:


1. Перейдите на страницу http:// _веб-сайт_SharePoint_/_layouts/15/appregnew.aspx. Нажмите кнопки **Создать**, чтобы сгенерировать значения идентификатора и секрета надстройки. В настоящее время секрет не используется в надстройках SharePoint с высоким уровнем доверия, но он требуется для формы. Укажите базовый URL-адрес домена, где будет запущено удаленное веб-приложение надстройки. Не включайте в домен протокол (HTTPS), но укажите порт, который будут использовать удаленные компоненты для HTTPS-запросов, если он отличается от 443 (например, www.contoso.com:5555 или MyAppServer:4444).
    
    Если вам необходим URI перенаправления, также укажите его значение. Ознакомьтесь со статьей  [Поток кода аутентификации OAuth для надстроек в SharePoint](authorization-code-oauth-flow-for-sharepoint-add-ins), чтобы понять, как можно использовать URI перенаправления.
    
    Форма на странице должна выглядеть аналогично рис. 1. В этом примере сервер удаленного веб-приложения прослушивает HTTPS-запросы на порте 443, который является портом по умолчанию, поэтому указывать его в домене надстройки не обязательно.
    

    **Рис. 1. Регистрация надстройки на странице appregnew.aspx**

 

  ![Регистрация приложения на странице appregnew.aspx](../../images/SP15_RegisterApp.png)
 

 

 
2. Нажмите кнопку **Создать**. Указанные сведения будут показаны на следующей странице. Сохраните их, так как они потребуются для средств публикации Visual Studio. Для этого можно сделать снимок экрана со страницей.
    
 

## <a name="choose-a-strategy-for-obtaining-maintaining-and-deploying-certificates-for-high-trust-sharepoint-add-ins"></a>Выбор стратегии получения, обслуживания и развертывания сертификатов для надстроек SharePoint с высоким уровнем доверия
<a name="Certificate"> </a>

Когда разработчик использует клавишу **F5** в Visual Studio для разработки и отладки надстройки SharePoint с высоким уровнем доверия, он может применять самозаверяющий сертификат, как описано в статье [Создание надстроек SharePoint с высоким уровнем доверия](create-high-trust-sharepoint-add-ins). Однако если надстройка *опубликована*, то перед открытием начальной страницы удаленного веб-приложения в браузере появится страница с предупреждением. Пользователю придется решать, стоит ли продолжать. Пример такого предупреждения показан на рис. 2.
 

 

**Рис. 2. Предупреждения о самозаверяющих сертификатах**

 

 
![Предупреждения IE и Chrome о самозаверяющих сертификатах](../../images/BrowserWarnings4SelfSignedCerts.png)
 
Такая помеха может быть приемлема для разработчика, но не для клиентов. Поэтому перед окончательной публикацией в рабочую среду, клиент должен получить сертификат, подписанный доверенной третьей стороной. Это может быть коммерческий или локальный центр сертификации (ЦС). Что касается коммерческих ЦС, помните, что отрасль постепенно сокращает сертификаты для веб-серверов, предназначенные "только для интрасетей". Их по-прежнему можно купить, но срок действия всех подобных сертификатов истекает в ноябре 2016 года или ранее. Использовать такой тип сертификата для Надстройка SharePoint с высоким уровнем доверия необязательно, так как сертификаты для веб-серверов с выходом в Интернет могут использоваться и для веб-серверов интрасети, однако последние обычно стоят дороже. 
 

 
Сертификат должен находиться в двух форматах — в виде файла обмена личной информацией (PFX) и в виде сертификата безопасности (CER). Если изначально при получении один из этих форматов отсутствует, клиент может конвертировать его с помощью служебной программы. Кроме того, после получения версии в формате PFX, PFX-файл можно импортировать в IIS, а затем экспортировать версию CER согласно описанной ниже инструкции.
 

 
Если изначально при получении сертификат находится в формате CER, в нем будут находиться и закрытый, и открытый ключи. Согласно общепринятой практике, CER-файл, используемый SharePoint, не должен содержать закрытый ключ. Попробуйте согласно приведенной ниже инструкции импортировать оригинальный сертификат в IIS, а затем экспортировать новую CER-версию, которая не содержит закрытый ключ. Дополнительную информацию о CER- и PFX-файлах можно узнать в статье  [Сертификат издателя программного обеспечения](http://msdn.microsoft.com/en-us/library/windows/hardware/ff552299%28v=vs.85%29.aspx).
 

 
Кроме того, клиент должен решить, использовать один сертификат для всех Надстройки SharePoint с высоким уровнем доверия или отдельные сертификаты для каждого из них. Дополнительные сведения об этом решении см. в статье  [Выбор между одним или несколькими сертификатами для Надстройки SharePoint с высоким уровнем доверия](creating-sharepoint-add-ins-that-use-high-trust-authorization#Deciding).
 

 

## <a name="configure-the-remote-web-server-with-the-certificate"></a>Настройка удаленного веб-сервера с помощью сертификата
<a name="ConfigureRemote"> </a>

Описанные ниже процедуры выполняются на удаленном веб-сервере, на котором размещено удаленное веб-приложение.
 

 

### <a name="to-configure-the-remote-web-server-and-pfx-certificate"></a>Настройка удаленного веб-сервера и сертификата PFX


1. Задайте для сертификата PFX надежный пароль. Дополнительные сведения см. в статьях [Рекомендации по созданию надежных паролей](http://msdn.microsoft.com/en-us/library/bb416446.aspx) и [Надежные пароли](http://msdn.microsoft.com/en-us/library/ms161962.aspx).
    
 
2. Импортируйте сертификат в IIS на удаленный веб-сервер, выполнив указанные ниже действия.
    
      1. В диспетчере IIS выберите узел _Имя сервера_ в представлении в виде дерева слева.
    
 
  2. Дважды щелкните значок **Сертификаты сервера**.
    
 
  3. Выберите **Импорт** в области **Действия** справа.
    
 
  4. В диалоговом окне **Импорт сертификата** нажмите кнопку "Обзор", найдите PFX-файл, а затем введите пароль сертификата.
    
 
  5. Если вы используете диспетчер служб IIS 8-й версии, в раскрывающемся списке **Выбор хранилища сертификата** выберите пункт **Личное**. (Речь идет о "личном" хранилище сертификатов компьютера, а не пользователя.)
    
 
  6. Если у вас еще нет сертификата CER или он содержит закрытый ключ, установите флажок **Разрешить экспортировать этот сертификат**.
    
 
  7. Нажмите кнопку **ОК**.
    
 

### <a name="to-open-the-windows-certificate-store"></a>Открытие хранилища сертификатов Windows


1. На этом же сервере откройте **консоль управления (MMC)**, как описано в статье [Запуск MMC 3.0](http://technet.microsoft.com/en-us/library/cc766121.aspx).
    
 
2. Добавьте для учетной записи компьютера оснастку **Сертификаты**, как описано в статье [Добавление оснастки "Сертификаты" в консоль MMC](http://technet.microsoft.com/en-us/library/cc754431.aspx). Убедитесь, что вы следуете процедуре, предназначенной для *компьютера*, а не для пользователя или службы. При появлении соответствующего запроса выберите *локальный*, а не "другой" компьютер.
    
 
Если вы используете диспетчер служб ISS 8-й версии, следующую процедуру можно пропустить.
 

 

### <a name="additional-steps-for-iss-manager-7-to-get-the-certificate-into-the-windows-certificate-store"></a>Дополнительные действия для получения сертификата в хранилище сертификатов Windows с помощью диспетчера ISS 7


1. Создайте в файловой системе сервера папку, которая будет использоваться для кратковременного хранения сертификата.
    
 
2. В диспетчере IIS выберите узел _Имя сервера_ в представлении в виде дерева слева.
    
 
3. Дважды щелкните значок **Сертификаты сервера**.
    
 
4. В списке **Сертификаты сервера** щелкните сертификат правой кнопкой мыши и выберите пункт **Экспорт**, как показано на рис. 3.
    
    **Рис. 3. Экспорт сертификата**

 

  ![Экспорт тестового сертификата](../../images/997021de-c60c-46b0-961f-7e1e63c0f619.gif)
 

 

 
5. Экспортируйте файл в созданную вами папку и введите ее пароль.
    
 
6. В **консоли управления (MMC)** импортируйте сертификат, как описано в статье [Импорт сертификата](http://technet.microsoft.com/en-us/library/cc754489.aspx). Не забудьте выбрать **личное** хранилище.
    
 
7. Приступая к следующей процедуре, не закрывайте консоль.
    
 
8.  *Удалите папку, которую вы создали на первом шаге, вместе с файлом, находящимся в ней.*  Если сертификат находится в файловой системе, преимущества безопасности его хранения в хранилище сертификатов аннулируются.
    
 
Следующая процедура применима к диспетчеру служб IIS 7-й и 8-й версий.
 

 

### <a name="to-get-the-serial-number-of-the-certificate"></a>Получение серийного номера сертификата


1. В **консоли управления (MMC)** перейдите к папке **Сертификаты** в папке **Личные** оснастки **Сертификаты (локальный компьютер)**, если она еще не открыта.
    
 
2. Дважды щелкните сертификат для вашей надстройки SharePoint, чтобы открыть его, а затем откройте вкладку **Сведения**.
    
 
3. Выберите поле **Серийный номер**, чтобы серийный номер отображался полностью.
    
 
4. Скопируйте серийный номер *без пробелов* в текстовый файл и передайте его разработчику надстройки SharePoint.
    
     **Совет.** В записях блогов разработчиков и в вопросах на форумах встречаются упоминания о том, что при копировании серийного номера непосредственно в буфер обмена создается строка со скрытыми символами, из-за чего надстройка SharePoint не может распознать серийный номер. Попробуйте не копировать код, а ввести его вручную. Затем создайте CER-версию сертификата. Она содержит закрытый ключ удаленного веб-сервера и используется средой SharePoint, чтобы расшифровывать запросы от удаленного веб-приложения и проверять маркеры доступа в этих запросах. Эта версия создается на удаленном веб-сервере, а затем перемещается в ферму SharePoint.
 

 

### <a name="to-create-the-cer-certificate"></a>Создание CER-файла сертификата


1. В диспетчере IIS выберите узел _Имя сервера_ в представлении в виде дерева слева.
    
 
2. Дважды щелкните элемент **Сертификаты сервера**.
    
 
3. В представлении **Сертификаты сервера** дважды щелкните сертификат, чтобы просмотреть сведения о нем.
    
 
4. На вкладке **Сведения** нажмите кнопку **Копировать в файл**, чтобы запустить **мастер экспорта сертификатов**, а затем нажмите кнопку **Далее**.
    
 
5. Оставьте значение по умолчанию (**Нет, не экспортировать закрытый ключ**) и нажмите кнопку **Далее**.
    
 
6. На следующей странице используйте значения по умолчанию. Нажмите кнопку **Далее**.
    
 
7. Нажмите кнопку **Обзор** и выберите любую папку. (CER-файл будет удален с компьютера в любом случае.) Задайте для этого файла то же имя, что и для PFX-файла, и нажмите кнопку **Сохранить**. Сертификат сохранится в виде CER-файла.
    
 
8. Нажмите кнопку **Далее**.
    
 
9. Нажмите кнопку **Готово**.
    
 

## <a name="configure-sharepoint-to-use-the-certificate"></a>Настройка использования сертификата в SharePoint
<a name="ConfigureSP"> </a>

Процедуры, описанные в этом разделе, можно выполнить на любом сервере SharePoint, на котором установлена **командная консоль SharePoint**.
 

 

### <a name="to-distribute-the-cer-file-to-sharepoint"></a>Размещение CER-файла в SharePoint


1. Создайте папку и убедитесь, что удостоверения следующих пулов надстроек IIS содержат разрешение на ее чтение:
    
      -  **SecurityTokenServiceApplicationPool**.
    
 
  - Пул надстроек, обслуживающий веб-сайт IIS, на котором размещается родительское веб-приложение SharePoint для тестового веб-сайта SharePoint. Пул для веб-сайта IIS **SharePoint - 80** называется **OServerPortalAppPool**.
    
 
2.  *Переместите*  (не просто скопируйте) CER-файл из удаленного веб-сервера в папку, которую вы только что создали на сервере SharePoint. Файл будет временно находиться в этой папке.
    
 
В следующей процедуре описывается настройка сертификата в качестве доверенного поставщика маркеров в SharePoint. Она выполняется только один раз (для каждой надстройки SharePoint с высоким уровнем доверия).
 

 

### <a name="to-configure-the-certificate"></a>Настройка сертификата


1. Если вы этого еще не сделали, создайте скрипт или скрипты настройки высокого уровня доверия для Windows PowerShell, как это описано в статье  [Скрипты настройки высокого уровня доверия для SharePoint](high-trust-configuration-scripts-for-sharepoint-2013).
    
 
2. Скопируйте скрипты на сервер SharePoint.
    
 
3. Откройте **командную консоль SharePoint** от имени администратора и запустите соответствующие скрипты.
    
 
4. Один из скриптов предназначен для использования в случае, когда клиент использует один сертификат для нескольких Надстройки SharePoint. Этот скрипт выводит файл, содержащий GUID для поставщика маркеров. Если вы используете этот скрипт, передайте выходной файл разработчику Надстройка SharePoint с высоким уровнем доверия.
    
 
5.  *Удалите CER-файл из файловой системы сервера SharePoint.* 
    
 

 **Примечание.** Регистрация сертификата в качестве поставщика маркеров не вступает в силу немедленно, и до этого времени надстройка работать не будет. Может потребоваться до 24 часов, чтобы все серверы SharePoint получили сведения о новом поставщике. Если вы уверены, что работа пользователей SharePoint не будет нарушена, выполните команду iisreset на всех серверах SharePoint для немедленной регистрации поставщика.
 


## <a name="modify-the-webconfig-file"></a>Изменение файла web.config
<a name="WebConfig"> </a>


 **Совет.** Пример кода, включающий изменения файла web.config, представлен на странице [PnP / Samples / Core.OnPrem.S2S.WindowsCertStore](https://github.com/OfficeDev/PnP/tree/dev/Samples/Core.OnPrem.S2S.WindowsCertStore).
 

Измените файл web.config так, чтобы узел `appSettings` содержал новые значения для следующих ключей:
 

 

-  **ClientID.** Это идентификатор клиента (GUID) веб-приложения, которое было создано на странице appregnew.aspx.
    
 
-  **ClientSigningCertificateSerialNumber.** *(Вам необходимо добавить этот ключ, если он не был добавлен с помощью Инструменты разработчика Microsoft Office для Visual Studio.)*  Это серийный номер сертификата. В его значении не должно быть никаких пробелов или дефисов.
    
 
-  **IssuerId.** Это GUID поставщика маркера (*который должен быть написан в нижнем регистре*). Это значение зависит от выбранной пользователем стратегии для сертификатов:
    
      - Если Надстройка SharePoint с высоким уровнем доверия имеет собственный сертификат, который не используется совместно с другими Надстройки SharePoint, значение  `IssuerId` совпадает с `ClientId`.
    
 
  - Если Надстройка SharePoint использует тот же сертификат, что и остальные Надстройки SharePoint, значение  `IssuerId` это произвольный GUID. Скрипт для этого сценария можно найти в статье [Скрипты настройки высокого уровня доверия для SharePoint](high-trust-configuration-scripts-for-sharepoint-2013); он создает текстовый файл с данным GUID. ИТ-персонал может передать этот файл разработчику надстройки, чтобы он вставил его в файл web.config в качестве значения  `IssuerId`.
    
 

 **Примечание.** Инструменты разработчика Office для Visual Studio могут содержать дополнительные ключи параметров надстройки **ClientSigningCertificatePath** и **ClientSigningCertificatePassword**. Они не используются надстройкой в рабочей среде и могут быть удалены.
 

Ниже представлен пример. Обратите внимание, что для надстройки SharePoint с высоким уровнем доверия нет ключа **ClientSecret**.
 

 



```XML
<appSettings>
  <add key="ClientID" value="c1c12d4c-4900-43c2-8b89-c05725e0ba30" />
  <add key="ClientSigningCertificateSerialNumber" value="556a1c9c5a5415994941abd0ef2f947b" />
  <add key="IssuerId" value="f94591d5-89e3-47cd-972d-f1895cc158c6" />
</appSettings>

```


## <a name="modify-the-tokenhelper-file"></a>Изменение файла TokenHelper
<a name="WebConfig"> </a>

Чтобы работать с сертификатами, находящимися в хранилище сертификатов Windows, и получать их по их серийному номеру, необходимо изменить файл TokenHelper.cs (возможно расширение VB), созданный Инструменты разработчика Office для Visual Studio. В представленном ниже примере описан один из способов на языке C#.
 

 

 **Совет.** Пример кода, включающий изменения файла tokenhelper.cs, представлен на странице [PnP / Samples / Core.OnPrem.S2S.WindowsCertStore](https://github.com/OfficeDev/PnP/tree/dev/Samples/Core.OnPrem.S2S.WindowsCertStore).
 


### <a name="to-modify-the-tokenhelper"></a>Изменение файла TokenHelper


1. Ближе к концу раздела `#region private fields` файла объявляются параметры `ClientSigningCertificatePath`, `ClientSigningCertificatePassword` и `ClientCertificate`. Удалите все три объявления.
    
 
2. На их месте добавьте следующую строку:
    
```
  private static readonly string ClientSigningCertificateSerialNumber 
    = WebConfigurationManager.AppSettings.Get("ClientSigningCertificateSerialNumber");
```

3. Найдите строку, в которой объявляется поле `SigningCredentials`. Замените ее на следующую строку:
    
```
  private static readonly X509SigningCredentials SigningCredentials 
    = GetSigningCredentials(GetCertificateFromStore());
```

4. Перейдите к разделу `#region private methods` файла и добавьте два следующих метода:
    
```
  private static X509SigningCredentials GetSigningCredentials(X509Certificate2 cert)
{
    return (cert == null) ? null 
                          : new X509SigningCredentials(cert, 
                                                       SecurityAlgorithms.RsaSha256Signature, 
                                                       SecurityAlgorithms.Sha256Digest);
}

private static X509Certificate2 GetCertificateFromStore()
{
    if (string.IsNullOrEmpty(ClientSigningCertificateSerialNumber))
    {
        return null;
    }  

    // Get the machine's personal store
    X509Certificate2 storedCert;
    X509Store store = new X509Store(StoreName.My, StoreLocation.LocalMachine); 

    try
    {
        // Open for read-only access                 
        store.Open(OpenFlags.ReadOnly);

        // Find the cert
        storedCert = store.Certificates.Find(X509FindType.FindBySerialNumber, 
                                             ClientSigningCertificateSerialNumber, 
                                             true)
                       .OfType<X509Certificate2>().SingleOrDefault();
    }
    finally
    {
        store.Close();
    }

    return storedCert;
}
```


## <a name="use-the-visual-studio-wizards-to-package-your-remote-web-application-and-sharepoint-add-in-for-publishing"></a>Упаковка удаленного веб-приложения и надстройки SharePoint для публикации с помощью мастеров Visual Studio
<a name="Package"> </a>


 **Совет.** Корпорация Майкрософт обновляет Visual Studio и Инструменты разработчика Office для Visual Studio чаще, чем раньше, а документация не всегда своевременно отражает эти изменения. Этот раздел был написан с использованием версии Visual Studio, выпущенной в октябре 2013 г., и включенной в нее версии Инструментов разработчика Office для Visual Studio. Если вы работаете с более ранними или более поздними версиями Visual Studio или средств разработчика, возможно, вам придется обратиться к справке Visual Studio или соответствующим записям блогов, чтобы найти действия, эквивалентные описанным в этих процедурах.
 


### <a name="to-package-the-remote-web-application"></a>Упаковка удаленного веб-приложения


1. В **обозревателе решений** щелкните правой кнопкой мыши проект веб-приложения (не проект надстройки SharePoint) и выберите пункт **Опубликовать**. 
    
 
2. На вкладке **Профиль** выберите в раскрывающемся списке пункт **Новый профиль**.
    
 
3. При появлении соответствующего запроса укажите для профиля подходящее имя, например "Надстройка для расчета заработной платы Payroll — удаленное веб-приложение".
    
 
4. На вкладке **Подключение** выберите пункт **Пакет веб-развертывания** в раскрывающемся списке **Публикация**.
    
 
5. В поле **Расположение пакета** укажите любую папку. Чтобы упростить дальнейшие процедуры, используйте пустую папку. Обычно используется вложенная папка в папке bin проекта.
    
 
6. В качестве имени сайта укажите имя веб-сайта служб IIS, на котором будет размещено веб-приложение. Не включайте в имя протокол, порт или знаки косой черты. Пример: "PayrollSite". Если вы хотите, чтобы веб-приложение являлось дочерним по отношению к веб-сайту по умолчанию, используйте шаблон "Веб-сайт по умолчанию_/<website name>_, например "веб-сайт по умолчанию/PayrollSite." (Если веб-сайт IIS еще не существует, он будет создан при выполнении пакета веб-развертывания в процедуре, описанной ниже.)
    
 
7. Нажмите кнопку **Далее**.
    
 
8. На вкладке **Параметры** выберите пункт **Выпуск** или **Отладка** в раскрывающемся списке **Конфигурация**.
    
 
9. Нажмите кнопку **Далее**, а затем — **Опубликовать**. В папке, где находится пакет, будет создан ZIP-файл и другие файлы, которые будут использоваться для установки веб-приложения в последующей процедуре.
    
 

### <a name="to-create-a-sharepoint-add-in-package"></a>Создание пакета надстройки SharePoint


1. Щелкните правой кнопкой мыши проект надстройки SharePoint в решении и выберите пункт **Опубликовать**.
    
 
2. В раскрывающемся списке **Текущий профиль** выберите профиль, созданный в предыдущей процедуре.
    
 
3. Если рядом с кнопкой **Изменить** появится маленький желтый значок предупреждения, нажмите кнопку **Изменить**. Откроется окно с предложением указать некоторые сведения, которые содержатся в файле web.config. Эти сведения не требуются, если вы используете метод публикации **Пакет веб-развертывания**, но оставлять эту форму пустой тоже нельзя. Введите в четырех текстовых полях любые символы и нажмите кнопку **Готово**.
    
 
4. Нажмите кнопку **Упаковать надстройку**. (Не нажимайте кнопку **Развернуть веб-проект**. Она просто повторяет последний этап предыдущей процедуры.) Откроется окно **Упаковка надстройки**.
    
 
5. В текстовом поле **Где размещен ваш веб-сайт?** введите URL-адрес домена удаленного веб-приложения. Обязательно укажите протокол HTTPS, а также порт, если веб-приложение прослушивает HTTPS-запросы на порте, отличном от 443. Пример: https://MyServer:4444. (Инструменты разработчика Office для Visual Studio используют это значение вместо маркера ~remoteAppUrl в манифесте надстройки SharePoint.)
    
 
6. В текстовом поле **Идентификатор клиента надстройки** введите идентификатор клиента, который был создан на странице appregnew.aspx, а также указан в файле web.config.
    
 
7. Нажмите кнопку **Готово**. Будет создан пакет надстройки.
    
 

## <a name="publish-the-remote-web-application-and-install-the-sharepoint-add-in"></a>Публикация удаленного веб-приложения и установка надстройки SharePoint
<a name="PublishRemote"> </a>


 

 

### <a name="to-publish-the-web-application"></a>Публикация веб-приложения


1. Перейдите к папке, которую вы указали в поле **Расположение пакета** при упаковке удаленного веб-приложения, а затем скопируйте все файлы из нее в папку на удаленном сервере.
    
 
2. В этой папке откройте файл _имя_проекта_.deploy-readme.txt (где _имя_проекта_ — это имя проекта веб-приложения vsnv) и следуйте инструкциям в файле, чтобы установить веб-приложение, используя файл _имя_проекта_.deploy.cmd.
    
 

### <a name="to-configure-protocol-binding-for-the-web-application"></a>Настройка привязки протокола для веб-приложения


1. В диспетчере IIS выделите новый веб-сайт в области **Подключения**. (Если новое веб-приложение является дочерним по отношению к **веб-сайту по умолчанию**, выделите **Веб-сайт по умолчанию** и выполните эту процедуру для элемента **Веб-сайт по умолчанию**.)
    
 
2. Нажмите **Привязки** в области **Действия**.
    
 
3. В диалоговом окне **Привязки сайта** нажмите кнопку **Добавить**. В открывшемся диалоговом окне **Добавление привязки сайта** выполните указанные ниже действия.
    
      1. Выберите пункт **HTTPS** в раскрывающемся списке **Тип**.
    
 
  2. Выберите пункт **Все неназначенные** в раскрывающемся списке **IP-адрес**.
    
 
  3. Укажите порт в текстовом поле **Порт**. Если вы указали порт в домене надстройки при регистрации надстройки SharePoint на странице appregnew.aspx (как описано в разделе [Регистрация надстройки с высоким уровнем доверия](#Register)), то здесь необходимо использовать тот же номер. Если вы не указывали его на странице appregnew, введите номер 443.
    
 
  4. В раскрывающемся списке **Сертификат SSL** выберите сертификат, который вы использовали ранее для настройки сервера в разделе [Настройка удаленного веб-сервера с помощью сертификата](#ConfigureRemote).
    
 
  5. Нажмите кнопку **ОК**.
    
 
4. Нажмите кнопку **Закрыть**.
    
 

### <a name="to-configure-authentication-for-the-web-application"></a>Настройка проверки подлинности для веб-приложения


1. Когда в службах IIS устанавливается новое приложение, его исходная конфигурация разрешает анонимный доступ. Однако почти все надстройки SharePoint с высоким уровнем доверия создаются таким образом, чтобы проверка подлинности пользователей была обязательной, поэтому конфигурацию необходимо изменить. В диспетчере IIS выделите веб-приложение в области **Подключения**. Это будет либо веб-сайт одного ранга с веб-сайтом по умолчанию, либо его дочерний сайт.
    
 
2. Дважды щелкните значок **Проверка подлинности** на центральной панели, чтобы открыть панель **Проверка подлинности**.
    
 
3. Выделите элемент **Анонимная проверка подлинности**, а затем в области **Действия** нажмите **Отключить**.
    
 
4. Выделите систему проверки подлинности, на которую рассчитано ваше веб-приложение, а затем в области **Действия** нажмите **Включить**.
    
    Если файлы TokenHelper и SharePointContext веб-приложения содержат сгенерированный код без изменений в разделах, связанных с проверкой подлинности пользователей, то веб-приложение использует **проверку подлинности Windows** и вам нужно выбрать этот вариант.
    
 
5. Если вы используете файлы со сгенерированным кодом, в которые не были внесены изменения, касающиеся проверки подлинности пользователей, вам также необходимо настроить поставщика проверки подлинности с помощью следующих действий:
    
      1. Выделите пункт **Проверка подлинности Windows** в области **Проверка подлинности**.
    
 
  2. Нажмите **Поставщики**.
    
 
  3. Убедитесь, что в диалоговом окне **Поставщики** пункт **NTLM** находится *выше* пункта **С согласованием**.
    
 
  4. Нажмите кнопку **ОК**.
    
 

### <a name="to-upload-and-install-the-sharepoint-add-in"></a>Отправка и установки надстройки SharePoint


1. Отправьте APP-файл пакета Надстройка SharePoint в каталог надстроек организации. (Надстройки SharePoint с высоким уровнем доверия нельзя распространять через Магазин Office.) Подробные сведения см. в статье  [Добавление надстроек в каталог надстроек](http://technet.microsoft.com/en-us/library/fp161234.aspx#AddApps).
    
 
2. Установите надстройку на любом веб-сайте в рамках одного родителя веб-приложения SharePoint, которое содержит каталог надстроек. Дополнительную информацию об отправке и установке Надстройка SharePoint можно узнать в статье  [Добавление надстроек SharePoint на сайт SharePoint](http://technet.microsoft.com/en-us/library/fp161231).
    
 

## <a name="additional-resources"></a>Дополнительные ресурсы
<a name="bk_addresources"> </a>


-  [Создание надстроек SharePoint с высоким уровнем доверия](create-high-trust-sharepoint-add-ins)
    
 
-  [Публикация надстроек SharePoint с помощью Visual Studio](publish-sharepoint-add-ins-by-using-visual-studio)
    
 
-  [Регистрация надстроек SharePoint 2013](register-sharepoint-add-ins-2013)
    
 
-  [Знакомство с созданием надстроек SharePoint с размещением у поставщика](get-started-creating-provider-hosted-sharepoint-add-ins)
    
 

