---
title: Устранение неполадок и отладка удаленного приемника событий в надстройке для SharePoint
description: Настройка среды разработки для отладки удаленных событий с помощью Visual Studio.
ms.date: 12/22/2017
ms.prod: sharepoint
ms.openlocfilehash: b6b34bef859eaaaa50361741220276a13c32d29e
ms.sourcegitcommit: c57fc0e802661b0771f8b022964b6956ab4f6caf
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/23/2017
---
# <a name="debug-and-troubleshoot-a-remote-event-receiver-in-a-sharepoint-add-in"></a>Устранение неполадок и отладка удаленного приемника событий в надстройке SharePoint

## <a name="configure-debugging-for-a-remote-sharepoint-test-site"></a>Настройка отладки для удаленного тестового сайта SharePoint

> [!NOTE] 
> Описанные в этом разделе действия применимы, только если Visual Studio и тестовый сайт SharePoint развернуты на разных компьютерах или если в качестве тестового сайта используется сайт разработчика SharePoint Online. Если SharePoint и Visual Studio развернуты на одном компьютере, пропустите этот раздел.

Если проект надстройки SharePoint в Visual Studio содержит удаленный приемник событий (RER) или приемник событий надстройки, то для отладки надстройки с помощью клавиши F5 нужно выполнить дополнительную быструю настройку свойств проекта. А для этого, в свою очередь, требуется настроить Azure. Повторять настройку Azure для каждого проекта, который содержит удаленный приемник событий или событие надстройки, не требуется. (Если надстройка содержит обработчик событий AppInstalled, она не запустится ни с помощью клавиши F5, ни с помощью клавиш CTRL+F5 [запуск без отладки], пока не будут выполнены настройки, описанные в этом разделе.)

### <a name="to-configure-azure"></a>Настройка Azure

1. Если у вас еще нет подписки Microsoft Azure, приобретите ее. Она входит в состав [подписки на Visual Studio](http://azure.microsoft.com/ru-RU/pricing/member-offers/msdn-benefits/).

2. Выполните действия, описанные в разделе [Создание пространства имен служебной шины](https://docs.microsoft.com/ru-RU/azure/service-bus-messaging/service-bus-resource-manager-overview).
    

### <a name="to-configure-the-sharepoint-add-in-project-in-visual-studio"></a>Настройка проекта надстройки SharePoint в Visual Studio

1. Вам потребуется последняя версия Инструментов разработчика Office для Visual Studio, поэтому [запустите установщик веб-платформы](http://aka.ms/OfficeDevToolsForVS2013) или [установщик Инструментов разработчика Office для Visual Studio 2015](http://aka.ms/OfficeDevToolsForVS2015).

2. Добавив удаленный приемник событий или обработчик событий надстройки в проект надстройки SharePoint в Visual Studio, щелкните правой кнопкой мыши проект в **обозревателе решений** и выберите **Свойства**.

3. На панели свойств откройте вкладку **SharePoint** и прокрутите вниз.

4. Установите флажок **Включить отладку через шину обслуживания Microsoft Azure**.

5. Укажите в текстовом поле полную строку подключения. Чтобы получить эту строку, выполните указанные ниже действия.
    
    1. Войдите на портал Azure и откройте вкладку **Service Bus**.

    2. Откройте пространство имен, созданное для отладки удаленного приемника событий и перейдите к строкам подключения. Пользовательский интерфейс портала Azure часто меняется. Если не удается найти строки подключения, см. [справку по порталу Azure](https://docs.microsoft.com/ru-RU/azure/).

    3. Скопируйте строку подключения **SAS**. Это строка, которую вы указываете в свойствах проекта Visual Studio.

В дальнейшем при создании проектов Надстройка SharePoint в Visual Studio эти сведения будут заполнены заранее, поэтому не потребуется каждый раз открывать портал Azure.


<a name="CreateRER"> </a>

## <a name="test-the-configuration"></a>Тестирование конфигурации

Чтобы убедиться, что вы можете выполнять отладку RER, выполните процедуры, описанные в этом разделе.

### <a name="to-create-a-remote-event-receiver-project"></a>Создание проекта приемника удаленных событий

1. В Visual Studio создайте надстройку SharePoint с размещением у поставщика. См. статью [Создание надстроек SharePoint, размещаемых у поставщика](get-started-creating-provider-hosted-sharepoint-add-ins.md).

2. В **обозревателе решений** выберите узел проекта надстройки.

3. В строке меню выберите **Проект** > **Добавить новый элемент**.

4. На панели **Шаблоны** выберите шаблон **Список**, а затем нажмите кнопку **Добавить**.

5. Нажмите **Готово**, чтобы добавить настраиваемый список по умолчанию в проект надстройки.

6. Добавьте еще один элемент в проект надстройки, выбрав шаблон **Удаленный приемник событий** на панели **Шаблоны**.

7. В поле **Имя** оставьте имя, заданное по умолчанию (RemoteEventReceiver1), и нажмите **Добавить**.

8. В списке **Тип приемника событий** выберите **События элемента списка**. В качестве источника события оставьте **List1** — список, который вы добавили на предыдущих этапах.

9. В списке **Обработать следующие события** выберите **Добавляется элемент** и нажмите **Готово**.
    
    Веб-сервис будет добавлен в веб-приложение для управления удаленным событием, которое вы указали. Приемник удаленных событий будет добавлен в Надстройка SharePoint. Он будет ссылаться на веб-службы и события элемента списка в файле Elements.xml приемника событий.

10. В проекте надстройки откройте файл AppManifest.xml.

11. Укажите страницу списка в качестве начальной: _AddInProjectName_/Lists/List1.

12. Замените _AddInProjectName_ именем проекта надстройки, например `SharePointAddIn4/Lists/List1`. В этом примере начальной страницей назначается страница списка. Но в типичной надстройке ссылка, скорее всего, будет указывать на ваш собственный пользовательский интерфейс на странице веб-проекта.
    
 

### <a name="to-run-and-test-event-handler-debugging"></a>Запуск и тестирование отладки обработчика событий

1. Если вы еще не сделали этого, выполните действия, описанные ранее в разделе **Настройка проекта надстройки SharePoint в Visual Studio** этой статьи.

2. В веб-проекте откройте службу удаленного приемника событий (RemoteEventReceiver1.svc), а затем добавьте точку останова в любую строку кода внутри метода `ProcessEvent()`.

3. Нажмите клавишу **F5** для запуска проекта.

4. Нажмите кнопку **+ Новый элемент**, чтобы добавить элемент в список.

5. Укажите название элемента, а затем выберите **Сохранить**. Будет достигнута точка останова, добавленная к обработчику удаленных событий и указывающая, что выполняется отладка обработчика удаленных событий.

6. Нажмите клавишу **F5**, чтобы продолжить выполнение проекта, а по завершении его работы остановите отладку.


<a name="RER_TurnOnOffNotificationsinRER"> </a>

## <a name="turn-onoff-the-notification-from-visual-studio-that-event-debugging-needs-to-be-configured"></a>Включение и отключение уведомлений от Visual Studio о необходимости настроить отладку событий

Если в проекте используется удаленное событие, а отладка удаленных событий не настроена, Visual Studio предлагает ее настроить (см. следующий рисунок). Чтобы это уведомление не отображалось, снимите флажок **Уведомлять меня, если отладка удаленных событий не настроена** на вкладке **SharePoint**.

**Уведомление об отладке удаленных событий**

![Уведомления в удаленных приемниках событий](../images/SP15Con_Remote_Event_Receivers_FAQ_fig3.png)

<a name="RER_HowDoIKnowWheteherMyServiceisHostedintheServiceBus"> </a>

## <a name="verify-that-your-service-is-hosted-in-the-service-bus"></a>Проверка размещения службы в служебной шине

Нажав клавишу F5 и установив доверие, перейдите к пространству имен служебной шины в браузере, например `http://mynamespace.servicebus.windows.net`, и вы увидите конечную точку в виде числа. На следующем рисунке показано, как выглядит страница, когда пространство имен *не* указано (то есть до нажатия клавиши F5).

**Просмотр пространства имен служебной шины**

![Просмотр пространства имен служебной шины](../images/SP15Con_Remote_Event_Receivers_FAQ_fig4.PNG)

<a name="RER_DoesNotHitTheBreakPoint"> </a>

## <a name="rer-does-not-hit-the-breakpoint"></a>Удаленный приемник событий не достигает точки останова

Удаленные события бывают синхронными и асинхронными. Если событие асинхронное, то для активации точки останова может потребоваться несколько секунд или больше времени.

## <a name="error-there-was-no-endpoint-listening"></a>Ошибка: "Прослушивание не выполняла ни одна конечная точка"

При выполнении обработчика в рабочей среде возникает следующая ошибка:

*"Ошибка вызова приемника удаленных событий. Сведения: прослушивание на `https://{domain}:nnnnn/{path}/AppEventReceiver.svc` не выполняла ни одна конечная точка, которая могла бы принять сообщение. Это могло быть вызвано неправильным адресом или действием SOAP".* (При этом _nnnnn_ является портом.)

SharePoint требует отсутствия явного порта в URL-адресе обработчика в рабочей среде. Это означает, что вам необходимо использовать либо порт 443 для HTTPS, что мы и рекомендуем, либо порт 80 для HTTP. 

## <a name="error-could-not-establish-trust-relationship-for-the-ssltls-secure-channel-with-authority"></a>Ошибка: "Не удалось установить доверительные отношения для защищенного канала SSL/TLS с полномочиями"

При выполнении обработчика в рабочей среде возникает следующая ошибка:

*"Ошибка вызова приемника удаленных событий. Ошибка: Не удалось установить доверительные отношения для защищенного канала SSL/TLS с полномочиями".*

Когда надстройка находится в SharePoint Online, но удаленный приемник событий расположен в локальной среде и использует HTTPS согласно нашим рекомендациям, сервер, на котором размещен приемник, не может использовать самозаверяющий сертификат в рабочей среде. Серверу необходим общепринятый сертификат от центра сертификации. Если надстройка находится в локальной ферме SharePoint, можно использовать самозаверяющие сертификаты.

## <a name="see-also"></a>Дополнительные ресурсы

-  [Обработка событий в надстройках SharePoint](handle-events-in-sharepoint-add-ins.md)
 

