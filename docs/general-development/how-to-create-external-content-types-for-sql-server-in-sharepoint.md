---
title: "Создание внешних типов контента для SQL Server в SharePoint"
ms.date: 09/25/2017
ms.prod: sharepoint
ms.assetid: 7fe2fbf0-546b-4a16-b02e-a0960bfb3842
ms.openlocfilehash: df39aa0e0f31f8252756b63b4d9ec2f2fcc83bc3
ms.sourcegitcommit: f6ea922341c38e700d0697961f8df9a454a03cba
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/15/2017
---
# <a name="create-external-content-types-for-sql-server-in-sharepoint"></a>Создание внешних типов контента для SQL Server в SharePoint

Узнайте, как создать внешний тип контента для SQL Server в SharePoint.

Создание внешнего типа контента — это ключевая задача при работе с внешними данными. Внешний тип контента содержит важную информацию о подключениях, доступе, методах операции, столбцах, фильтрах и других метаданных, которые используются для получения данных из внешнего источника данных.
  
    
    


## <a name="before-you-begin"></a>Перед началом работы
<a name="section1"> </a>

Работа с внешними данными требует выполнения нескольких предварительных задач, которые обеспечивают безопасный доступ к данным. Следующая информация поможет вам спланировать ваши дальнейшие действия. Кроме того, при возникновении проблем во время работы с внешними данными, эта информация поможет вам определить проблему. Чтобы получить доступ к внешним данным, вам или администратору необходимо выполнить следующие действия:
  
    
    
 **Подготовить SQL Server**. Администратор базы данных должен предоставить разрешения, чтобы убедиться, что доступ к данным предоставлен нужным пользователям и данные не попадут в чужие руки. Также он должен создать учетную запись SQL Server, которая имеет разрешения db_owner. Кроме того, администратор базы данных может создать специальные таблицы, представления, запросы, псевдонимы столбцов и так далее, чтобы ограничить результаты до необходимых и повысить производительность.
  
    
    
 **Настроить службы SharePoint**. Администратор должен активировать Службы Business Connectivity Services (BCS) и Служба Secure Store.
  
    
    
 **Настроить службу Secure Store**. Администратор должен определить наилучший режим доступа для внешнего источника данных, создать конечное приложение и задать учетные данные для конечного приложения.
  
    
    
 **Настроить службу подключения к бизнес-данным**. Администратор должен убедиться, что пользователь, создающий внешний тип данных, имеет разрешение на хранилище метаданных подключения к бизнес-данным (BDC) и что соответствующие пользователи имеют доступ к внешнему типу контента, на котором основан внешний список.
  
    
    
 **Убедиться, что Office 2013 готов к использованию.** Чтобы синхронизировать внешние данные с продуктами Office 2013, вы должны использовать Windows 7 или более поздние версии и убедиться, что параметр установки Office для Службы Business Connectivity Services (BCS) включен (по умолчанию). Этот параметр устанавливает Среда выполнения клиента Business Connectivity Services, который выполняет следующие действия: кэширует и синхронизирует внешние данные, сопоставляет бизнес-данные с внешними типами контента, отображает средство выбора внешних элементов в продуктах Office и запускает пользовательские решения внутри продуктов Office. Кроме того, на каждом клиентском компьютере должны быть установлены SQL Server Compact 4.0, .NET Framework 4 и службы данных WCF 5.0 для OData V3 (при необходимости вам автоматически будет предложено скачать программное обеспечение).
  
    
    

## <a name="define-general-information"></a>Определение общих сведений
<a name="section2"> </a>


1. Запустите Microsoft SharePoint Designer 2013.
    
  
2. Щелкните кнопку **Открыть сайт** и затем введите соответствующее имя сайта.
    
  
3. В области **Навигация** выберите в разделе **Объекты сайта** элемент **Внешние типы контента**.
    
    > **Примечание.** SharePoint Designer 2013 группирует внешние типы контента по пространству имен в начальном окне конструктора внешних типов контента. 
4. Чтобы открыть конструктор внешних типов контента, выберите на ленте **Внешний тип контента**.
    
  
5. На странице **Новый внешний тип контента** выполните следующие действия:
    
  - Радом с пунктом **Имя** щелкните пункт **Новый внешний тип контента**, а затем введите уникальное имя для этого внешнего типа контента.
    
  
  - Рядом с пунктом **Отображаемое имя** можете указать другое, более понятное имя.
    
  

## <a name="define-general-and-office-behaviors"></a>Определение общих параметров и параметров Office
<a name="section3"> </a>


1. В выпадающем списке **Тип элемента Microsoft Office** один из следующих типов:
    
  - **Универсальный список**. Выберите этот параметр для любого типа списка.
    
  
  - **Встреча, контакт, публикация или задача**. Выберите этот параметр, если вы создаете список, который ведет себя как элемент контакта, задачи, встречи или публикации для Outlook. Выбранный вами тип элемента Office определяет поведение Outlook, которое вы хотите прикрепить к внешнему типу контента. Например, внешний тип контента "Клиент" ведет себя так же, как собственный элемент "Контакт" в Outlook.
    
  
2. Убедитесь, что для параметра **Автономная синхронизация для внешнего списка** выбрано значение **Включено**, заданное по умолчанию.
    
    > **Примечание.** Если отключить этот параметр, команда SharePoint **Подключиться к Outlook** будет недоступна для внешнего списка.

> **Примечание.** Функция ферм и сайтов **Автономная синхронизация для внешних списков** также должна быть активна. По умолчанию эта функция включена на уровне фермы, но отключена на уровне сайта. 
  
    
    


## <a name="create-a-connection-to-the-external-data"></a>Создание подключения к внешним данным
<a name="section4"> </a>


1. Чтобы указать базу данных SQL Server для внешнего типа контента, нажмите пункт **Щелкните здесь для обнаружения внешних источников данных и определения операций**.
    
  
2. Щелкните **Добавить подключение**, выберите пункт **SQL Server** в диалоговом окне **Выбор типа внешнего источника данных**, а затем нажмите кнопку **ОК**.
    
  
3. В диалоговом окне **Подключение к серверу SQL Server** введите имя сервера, имя базы данных, описание (необязательно) и нажмите кнопку **ОК**.
    
  
4. Чтобы выбрать режим проверки подлинности, укажите один из следующих пунктов:
    
  - **Подключиться с удостоверением пользователя**. Используется режим сквозной проверки подлинности.
    
  
  - **Подключиться с олицетворенным удостоверением Windows**. Используется режим проверки подлинности учетных данных Windows.
    
  
  - **Подключиться с олицетворенным настраиваемым удостоверением**. Используется режим проверки подлинности учетных данных RDB.
    
  
5. В поле **Идентификатор приложения Secure Store** введите имя идентификатора конечного приложения, созданного в Служба Secure Store.
    
  
6. Нажмите кнопку **ОК**.
    
  
SharePoint Designer 2013 проверяет и тестирует сведения о подключении. Если появятся сообщения, то для продолжения вам необходимо будет их устранить.
  
    
    

## <a name="select-a-table-view-or-routine"></a>Выбор таблицы, представления или процедуры
<a name="section5"> </a>


1. В проводнике источника данных разверните узел базы данных, чтобы просмотреть содержащиеся там таблицы, представления и процедуры.
    
  
2. Выберите таблицу, представление или процедуру.
    
  

## <a name="define-operations"></a>Определение операций
<a name="section6"> </a>


1. В проводнике источника данных щелкните правой кнопкой мыши таблицу, представление или процедуру, а затем выберите одну из следующих команд:
    
  - **Создать все операции**. Определяет операции создания, удаления и чтения элемента, чтения списка и обновления элемента.
    
    > **Примечание.**
      > Команда **Создать все операции** доступна только для таблиц и представлений. Процедурам необходимы определенные операции.
  - **Новая операция чтения элемента**. Определяет операцию чтения элемента.
    
  
  - **Новая операция чтения списка**. Определяет операцию чтения списка.
    
  
  - **Новая операция обновления**. Определяет операцию обновления элемента.
    
  
  - **Новая операция удаления прочитанного**. Определяет операцию удаления элемента.
    
  
  - **Обновить**. Обновляет список таблиц, представление и процедур в проводнике источника данных.
    
  
2. Нажмите кнопку **Далее**.
    
  
 **Примечания**
  
    
    

- В представлениях, которые охватывают несколько таблиц, убедитесь, что поддерживаются операции записи. В противном случае в командах **Создать все операции** или **Новая операция обновления** может произойти сбой.
    
  
- Всегда определяйте как минимум команды **Новая операция чтения элемента** и **Новая операция чтения списка**, так как функции SharePoint, например внешние списки, зависят от них.
    
  
- Если таблица или представление не поддерживают некоторые операции, выберите конкретные операции вместо команды **Создать все операции**.
    
  

## <a name="add-columns"></a>Добавление столбцов
<a name="section7"> </a>


1. Чтобы указать столбцы, которые нужно отобразить из таблицы или представления, нажмите кнопку **Далее**.
    
  
2. В диалоговом окне **Параметры конфигурации** по умолчанию выбраны все столбцы (известные как **Элементы источника данных**). Чтобы удалить ненужные столбцы, снимите соответствующие флажки.
    
    > **Примечание.** В отличие от встроенного списка SharePoint, во внешнем списке невозможно изменить имя столбца. Вы можете использовать псевдоним столбца SQL, чтобы указать более понятное или краткое имя. 
3. Чтобы выбрать поле идентификатора, нажмите и выделите поле (как правило, с уникальным значением), а затем в разделе **Свойства** нажмите **Сопоставить с идентификатором**.
    
  

> **Важно!** Чтобы предотвратить обновление определенных полей, например поля идентификатора или первичного ключа, снимите флажок **Обязательно**, но установите флажок **Только для чтения**. Это необходимо для извлечения элементов, чтобы вы могли обновлять другие поля.
  
    
    

  
    
    


> **Совет.** Всегда внимательно читайте сообщения в области **Ошибки и предупреждения**. Они содержат полезные сведения о выполняемых действиях и возможных проблемах. Периодически открывайте область **Ошибки и предупреждения**, чтобы убедиться, что ошибок и предупреждений больше нет.
  
    
    


## <a name="map-outlook-fields"></a>Сопоставление полей Outlook
<a name="section8"> </a>

Если ваш внешний тип контента соответствует типу элемента Outlook, вы должны сопоставить одно или несколько полей из своего внешнего типа контента с полями элемента Outlook. При сопоставлении внешнего типа контента, например "Клиент", с типом элемента Outlook, например "Контакт", вы должны явно сопоставить отдельные поля из внешнего типа контента, например, "Фамилия клиента", "Имя клиента", "Адрес клиента" и "Телефон клиента" с соответствующими им полями элемента Outlook, например, "Имя", "Фамилия", "Рабочий адрес" и "Рабочий телефон" контакта.
  
    
    

- Для каждого поля выполните указанные ниже действия.
    
1. Щелкните в поле, чтобы выделить его.
    
  
2. В разделе **Свойства** нажмите стрелку вниз рядом с элементом **Свойство Office**, а затем выберите соответствующее поле. 
    
  

> **Примечание.** Сопоставлять все соответствующие поля необязательно. Однако поля, представленные в приведенной ниже таблице, должны быть сопоставлены. 
  
    
    


**Таблица. Тип элемента Outlook, сопоставленный с полем элемента Outlook**


|**Тип элемента Outlook**|**Поле элемента Outlook**|
|:-----|:-----|
|Контакт  <br/> |LastName  <br/> |
|Задача  <br/> |Subject  <br/> |
|Appointment  <br/> |Начало, окончание и тема  <br/> |
|Запись  <br/> |Subject  <br/> |
   
Несопоставленные поля в зависимости от номера отображаются в виде расширенных свойств следующим образом:
  
    
    

- **Смежное**. Прилагается к области формы в нижней части страницы по умолчанию для формы Outlook (от двух до пяти полей).
    
  
- **Отдельное**. Добавляется на форму Outlook в качестве новой страницы (от двух до пяти полей).
    
  

## <a name="set-up-the-external-item-picker-control"></a>Настройка элемента управления выбора внешних элементов
<a name="section9"> </a>

Средство управления выбора внешних элементов позволяет пользователям выбирать поля, например поле идентификатора или поле, содержащее уникальные значения, для удобного выбора элемента. Это средство управления доступно в SharePoint и продуктах Office 2013. Например, пользователи могут использовать его, чтобы выбрать элемент из внешнего списка клиентов, а Word 2013 позволяет использовать это средство управления с элементами управления контентом, которые связаны со столбцами внешних данных. Это хороший способ выбрать определенные столбцы, которые вы хотите отобразить в средстве управления выбора внешнего элемента, так как операция для показа всех столбцов, которая используется по умолчанию, в большинстве случаев не требуется.
  
    
    

1. Для каждого поля, которое вы хотите отобразить в средстве выбора внешнего элемента контента, щелкните и выделите поле, а затем в разделе **Свойства** поставьте флажок напротив пункта **Показать в средстве выбора**.
    
  
2. Нажмите кнопку **Далее**.
    
  

> **Примечание.** Все определенные вами фильтры отображаются в средстве выбора внешних элементов. Из средства выбора внешних элементов невозможно удалять определенные фильтры, но вы можете определить фильтр по умолчанию, выбрав параметр **Используется по умолчанию** в диалоговом окне **Конфигурация фильтра** при создании или изменении фильтра.
  
    
    


## <a name="define-filters"></a>Определение фильтров
<a name="section10"> </a>

Если вы не определили фильтр, внешний список возвратит все данные до предела регулирования Службы Business Connectivity Services (BCS) (по умолчанию это 2000 элементов) или все данные, которые определены в типе внешнего контента, если их количество меньше текущего значения предела регулирования. Кроме того, вся обработка результатов происходит в продукте SharePoint. Рекомендуется определить хотя бы один фильтр. В целом существует два типа фильтров, которые необходимо знать:
  
    
    

- **Фильтр источника данных**. Когда вы создаете фильтр типов внешнего контента, известный как фильтр источника данных, операция фильтрации происходит в пределах базы данных SQL Server. Это важно, когда вы работаете с большим количеством данных, так как вы можете разгрузить обработку из продуктов SharePoint во внешнюю базу данных и повысить производительность. После создания внешнего списка вы можете использовать фильтр источника данных, создав представление, которое определяет различные значения фильтров в разделе **Фильтр источника данных** на странице настроек **Представление списка**.
    
  
- **Фильтр SharePoint**. Пользователи по-прежнему могут фильтровать данные с помощью фильтра SharePoint, либо фильтром заголовков столбца, либо с помощью раздела **Фильтры** на странице настроек **Представление списка**. В этом случае операция фильтрации проходит в пределах продукта SharePoint, а не базы данных SQL Server.
    
  
Хорошая стратегия  создать набор представлений внешних списков, основанных на определенных фильтрах источников данных, который гарантирует, что большие объемы данных сначала будут отфильтрованы во внешнем источнике данных, а затем пользователи смогут отфильтровать и уточнить результаты с помощью фильтров SharePoint.
  
    
    
Вы можете создать несколько различных типов фильтров. Для каждого создаваемого фильтра необходимо выполнить следующее:
  
    
    

1. Выберите поле в разделе **Свойства** рядом с пунктом **Элемент источника данных**.
    
  
2. В разделе **Свойства** рядом с пунктом **Фильтр** нажмите ссылку **Щелкните, чтобы добавить**, чтобы открыть диалоговое окно **Конфигурация фильтра**.
    
  
3. Щелкните **Добавить параметр фильтра**.
    
  
4. В поле **Создать фильтр** введите имя фильтра.
    
  
5. В поле **Тип фильтра** выберите тип фильтра:
    
    
  
    
    
 **Сравнения**
  
    
    

    
    Фильтр сравнения ограничивает элементы, которые возвращаются в зависимости от условия (например, Штат = "Нью-Джерси"), и преобразуется в SQL-предложение WHERE.
    
1. В поле **Тип фильтра** выберите пункт **Сравнение**.
    
  
2. В поле **Оператор** выберите операцию.
    
  
3. Убедитесь, что в поле **Поле фильтра** выбрано необходимое для сравнения.
    
  
4. Если вводимые пользователем значения должны совпадать по регистру, выберите параметр **Учитывать регистр**.
    
  
5. Если при наличии нескольких совпадающих элементов в средстве выбора внешних элементов должен отображаться список возможных совпадений, установите флажок **Использовать для создания списка соответствий в средстве выбора внешних элементов**.
    
  
6. Нажмите кнопку **ОК**.
    
  
7.  В разделе **Свойства** рядом с полем **Значение по умолчанию** введите начальное значение, по которому будет производиться фильтрация в случае, если пользователь не введет значение. Если вы оставите это поле пустым, внешний список не отобразит никаких элементов.
    
  

    
  
    
    
 **Подстановочные знаки**
  
    
    

    
    Фильтр с подстановочными знаками ограничивает набор возвращаемых элементов в соответствии со строковым значением, которое указал пользователь (например, поле "Состояние" должно содержать значение "Новый"), и преобразуется в предложение SQL LIKE. Допустимые подстановочные знаки SQL Server: \* (звездочка) для сопоставления любого количества символов и \_ (подчеркивание) для сопоставления только одного символа. 
  
    
    

    
1. В поле **Тип фильтра** выберите пункт **С подстановочными знаками**.
    
  
2. В поле **Поле фильтра** выберите нужное.
    
  
3. Если вводимые пользователем значения должны совпадать по регистру, выберите параметр **Учитывать регистр**.
    
  
4. Если при наличии нескольких совпадающих элементов в средстве выбора внешних элементов должен отображаться список возможных совпадений, установите флажок **Использовать для создания списка соответствий в средстве выбора внешних элементов**.
    
  
5. Нажмите кнопку **ОК**.
    
  
6.  В разделе **Свойства** укажите для параметра **Значение по умолчанию** исходное значение, по которому следует фильтровать результаты, если пользователь не укажет значение. Если это значение не указано, во внешнем списке не будут отображаться элементы. Рекомендуем использовать по умолчанию символ \* (звездочку).
    
  

    
  
    
    
 **Ограничение**
  
    
    

    
    В большинстве случаев вы можете определить ограничивающий фильтр для операций чтения и чтения списка. Если вы не определите значение **Ограничения по умолчанию**, никакие данные не будут извлечены из внешнего источника данных. Убедитесь, что введенное вами значение по умолчанию для ограничивающего фильтра меньше 2000, так как регулирование Службы Business Connectivity Services (BCS) по умолчанию равно 2000 элементов. При необходимости вы можете увеличить данное значение.
    
1. В поле **Тип фильтра** выберите пункт **Ограничение**. 
    
  
2. В поле **Число** укажите число.
    
  
3. Если при наличии нескольких совпадающих элементов в средстве выбора внешних элементов должен отображаться список возможных совпадений, установите флажок **Использовать для создания списка соответствий в средстве выбора внешних элементов**.
    
  
4. В разделе **Свойства** рядом с полем **Значение по умолчанию** введите начальное значение, по которому будет производиться фильтрация в случае, если пользователь не введет значение. Если вы оставите это поле пустым, внешний список не отобразит никаких элементов.
    
  
5. Нажмите кнопку **ОК**. 
  
    
    

    
  

    > **Примечание.** Администратор базы данных SQL Server может создать специальные таблицы, представления, индексы и оптимизированные запросы, чтобы ограничить результаты до лишь необходимых данных и повысить производительность. 

    
  
    
    
 **Номер страницы**
  
    
    

    
    Используйте внешний тип контента "Номер страницы", чтобы заменить ограничение страниц SharePoint, определенных на странице **Представление списка** внешнего списка. Вот отличия:
    
  - Внешний тип контента "Номер страницы" сначала обрабатывает результаты в пределах базы данных SQL Server, а затем возвращает и отображает только то количество строк, которое определено значением "Размер страницы".
    
  
  - Ограничение страниц SharePoint возвращает все строки в "Значение по умолчанию" из базы данных SQL Server, а затем отображает количество строк, определенное значением ограничения страниц SharePoint на странице настроек **Представление списка**.
    
  

    Использование внешнего типа контента "Номер страницы" в целом более эффективно. Кроме того, значение **Порядок** помогает убедиться, что возвращено точное отображение результатов.
    
1. В поле **Тип фильтра** выберите пункт **Номер страницы**. 
    
  
2. В поле **Размер страницы** введите число.
    
  
3. В поле **Порядок** выберите направление сортировки.
    
  
4. Нажмите кнопку **ОК**. 
    
  
5. В разделе **Свойства** рядом с полем **Значение по умолчанию** введите начальное значение, по которому будет производиться фильтрация в случае, если пользователь не введет значение. Если вы оставите это поле пустым, внешний список не отобразит никаких элементов. 
  
    
    

    
  
6. Если вы хотите отобразить поле, но не изменять его, щелкните и выделите это поле, а затем в разделе **Свойства** установите флажок **Только для чтения**.
    
  
7. Если вы хотите убедиться, что поле всегда имеет значение созданного при его создании или изменении, щелкните и выделите это поле, а затем в разделе **Свойства** установите флажок **Обязательно**.
    
  
8. Чтобы предоставить описательное имя в средстве управления выбором внешнего элемента для имени **Элемента источника данных**, которое является производным от имени столбца SQL Server, щелкните и выделите поле, а затем введите имя в разделе **Свойства** в поле **Отображаемое имя**.
    
  
9. Чтобы определить значение по умолчанию для фильтра (которое также отображается в разделе **Фильтр источника данных** на странице настроек **Представление списка**), в разделе **Параметры фильтра** щелкните и выделите фильтр, а затем введите соответствующее значение в поле **Значение по умолчанию**. Если вы не введете значение, то при первом использовании фильтра не будут отображены никакие элементы.
    
  

## <a name="set-the-title-field-for-an-external-list"></a>Настройка поля "Заголовок" для внешнего списка
<a name="section11"> </a>


1. На ленте щелкните кнопку **Представление сводки**.
    
  
2. В разделе **Поля** выберите поле с помощью параметра **Имя поля**.
    
    > **Важно!** В общем случае рекомендуем задать для заголовка поля уникальное значение. Поле "Заголовок" используется для отображения списка или форм InfoPath. После установки значения в поле "Заголовок" его невозможно изменить. 
3. На ленте нажмите **Установить в качестве заголовка**.
    
  

## <a name="complete-the-external-content-type"></a>Завершение создания внешнего типа контента
<a name="section12"> </a>


- На панели быстрого доступа нажмите кнопку **Сохранить**. При этом определение внешнего типа контента сохраняется в хранилище метаданных службы подключения к бизнес-данным.
    
  

> **Примечание.** Для повышения производительности служба подключения к бизнес-данным кэширует все объекты в хранилище метаданных и обновляет изменения с помощью задания таймера, выполняемого каждую минуту. Чтобы изменения распространились на всех серверах в ферме, может потребоваться до одной минуты, но на том сервере, где вносится изменение, они применяются мгновенно. 
  
    
    

Теперь в продуктах SharePoint и Office 2013 можно использовать внешний тип контента.
  
    
    

## <a name="additional-resources"></a>Дополнительные ресурсы
<a name="AR"> </a>


-  [Внешние типы контента в SharePoint](external-content-types-in-sharepoint.md)
    
  
-  [Deploy a Business Connectivity Services on-premises solution in SharePoint](http://msdn.microsoft.com/library/4692ebba-90eb-4d72-ac12-e90c4d4ee7ae.aspx)
    
  
-  [Использование источников OData со службами Business Connectivity Services в SharePoint](using-odata-sources-with-business-connectivity-services-in-sharepoint.md)
    
  
-  [Configure the Secure Store Service in SharePoint](http://msdn.microsoft.com/library/29C0BC76-D835-401B-A2FB-ABB069E84125.aspx)
    
  

