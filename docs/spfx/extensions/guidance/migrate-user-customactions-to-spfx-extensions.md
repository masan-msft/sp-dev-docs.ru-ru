---
title: "Переход с элементов меню ECB и CustomAction на расширения SharePoint Framework"
ms.date: 12/19/2017
ms.prod: sharepoint
ms.openlocfilehash: 50540de75666a8a43697d1f31259713edc06108c
ms.sourcegitcommit: bf4bc1e80c6ef1a0ff479039ef9ae0ee84d5f6b4
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/19/2017
---
# <a name="migrating-user-customaction--ecb-menu-items-to-sharepoint-framework-extensions"></a>Переход с элементов меню ECB и CustomAction на расширения SharePoint Framework

SharePoint Framework — это новая модель, позволяющая создавать модификации для SharePoint. Если вы настраивали SharePoint с вовлечением дополнительных действий и меню ECB (Edit Control Block), используя SharePoint Feature Framework, вам может быть интересно узнать о преимуществах их переноса на новую платформу SharePoint Framework.

Сначала рассмотрим доступные разработчикам варианты для создания расширений SharePoint Framework.

* **Настройщик приложений**. Расширьте встроенный "современный" пользовательский интерфейс SharePoint Online, добавив пользовательские элементы HTML и клиентский код в заранее определенные заполнители на "современных" страницах. На момент написания этой статьи заполнители доступны в верхнем и нижнем колонтитулах каждой "современной" страницы.
* **Набор команд**. Позволяет добавлять пользовательские пункты меню ECB и настраиваемые кнопки на панель команд или в представление списка или библиотеки. С этими командами можно связать любое действие JavaScript (TypeScript).
* **Настройщик полей**. Настройте отображение поля в представлении списка, используя настраиваемые элементы HTML и клиентский код.

Выбор варианта зависит от цели настройки.
Например, **настройщики приложений** могут заменить собой дополнительные действия пользователя.
Кроме того, **наборы команд** могут заменить собой меню ECB.

## <a name="benefit-of-migrating-existing-sharepoint-feature-framework-customizations-to-the-sharepoint-framework"></a>Преимущество переноса в SharePoint Framework уже существующих модификаций SharePoint Feature Framework

При создании SharePoint Framework учитывались новые "современные" возможности SharePoint, доступные на "современных" сайтах групп и сайтах для общения, на любом устройстве и любой платформе.

### <a name="the-only-supported-way-of-customizing-no-script-modern-sites"></a>Единственный поддерживаемый способ настройки "современных" сайтов без скриптов 

Конечно, одно из основных преимуществ переноса старых модификаций, созданных с помощью SharePoint Feature Framework, в SharePoint Framework — то, что это единственный поддерживаемый способ настройки пользовательского интерфейса современных сайтов.
На "современных" сайтах включен флаг no-script, который блокирует выполнение встроенных в страницу скриптов, а также дополнительных действий пользователя, ссылающихся на внешний или встроенный код JavaScript.
Таким образом, старые дополнительные действия просто не работают в "современном" пользовательском интерфейсе. Кроме того, модификации ECB, созданные с помощью Feature Framework, очень ограничены. Например, определить можно только элементы ECB, не ссылающиеся на внешний файл JavaScript или не использующие встроенные вызовы JavaScript. Поэтому, если вы действительно хотите расширить "современный" пользовательский интерфейс, вам необходимо перейти на SharePoint Framework.

### <a name="easier-access-to-information-in-sharepoint-and-office-365"></a>Удобство доступа к данным в SharePoint и Office 365

Кроме того, следует учитывать, что в старой модели дополнительных действий пользователя и модификаций ECB было нелегко задействовать контент и данные SharePoint. Для этого нужно было использовать JSOM (клиентскую объектную модель SharePoint на JavaScript) или низкоуровневые REST API. Кроме того, полный набор служб Office 365 было практически невозможно задействовать без автономного использования ADAL.JS (библиотеки аутентификации Azure Active Directory для JavaScript) и пользовательского кода JavaScript.
Сегодня, используя платформу и расширения SharePoint Framework, очень просто задействовать как REST API SharePoint, так и Microsoft Graph.
Таким образом, теперь вы можете создавать более мощные решения, которые могут взаимодействовать с полным набором служб Microsoft Office 365.

## <a name="similarities-between-sharepoint-framework-solutions-and-sharepoint-feature-framework-customizations"></a>Сходства решений SharePoint Framework и модификаций SharePoint Feature Framework

Тем не менее, у дополнительных действий пользователя SharePoint Feature Framework, элементов ECB и модификаций SharePoint Feature Framework есть некоторые сходства. 

### <a name="provisioning-model"></a>Модель подготовки

Для расширений SharePoint Framework, а также для дополнительных действий пользователя или меню ECB используется XML-файл манифеста, написанный с помощью синтаксиса SharePoint Feature Framework. Таким образом, развертывание основано на одинаковых методах.

### <a name="run-as-a-part-of-the-page"></a>Выполнение как части страницы

Точно так же, как дополнительные действия пользователя и меню ECB SharePoint Feature Framework, расширения SharePoint Framework являются частью страницы. Благодаря этому у таких решений есть доступ к модели DOM страницы и возможность взаимодействовать с другими компонентами на этой странице. Кроме того, это помогает разработчикам создавать решения, которые адаптируются к различным форм-факторам, в которых может отображаться страница SharePoint, включая мобильное приложение SharePoint.
Так как расширения SharePoint Framework выполняются как часть страницы, другим элементам на странице доступны те же ресурсы, что и модификации. Это важно учитывать при создании решений, использующих неявный поток OAuth с маркерами доступа носителя, файлы cookie или хранилище браузера для хранения конфиденциальной информации. Так как расширения SharePoint Framework выполняются как часть страницы, другим элементам этой страницы также доступны все эти ресурсы.

### <a name="use-any-library-to-build-your-extensions"></a>Создание расширений с использованием любой библиотеки

При создании модификаций для страниц с вовлечением дополнительных действий вы могли использовать такие библиотеки, как jQuery и Knockout, чтобы модификации были более динамичными и лучше взаимодействовали с пользователем. При создании расширений SharePoint Framework вы можете совершенствовать свои решения, применяя любую клиентскую библиотеку, как и раньше. Еще одно преимущество SharePoint Framework — изоляция скрипта. Несмотря на то что веб-часть выполняется как часть страницы, ее скрипт упаковывается в виде модуля, который, к примеру, позволяет различным расширениям на одной странице использовать разные версии jQuery, не конфликтуя друг с другом. Благодаря этой полезной функции вы можете сосредоточиться на коммерческой ценности решения, а не на технических особенностях миграции и компромиссах, связанных с функциональностью.

### <a name="run-as-the-current-user"></a>Запуск от имени текущего пользователя

В модификациях, созданных с использованием дополнительных действий пользователя и меню ECB, для связи с SharePoint достаточно было вызвать API. Клиентское решение работало в браузере в контексте текущего пользователя, а благодаря автоматической отправке с запросом файла cookie для аутентификации решение могло подключаться к SharePoint напрямую. Для связи с SharePoint не требовалось дополнительной проверки подлинности, как, например, при использовании надстроек SharePoint. Такой же механизм применяется к модификациям на платформе SharePoint Framework, которые также работают в контексте текущего пользователя, поэтому для связи с SharePoint им не требуется дополнительных операций проверки подлинности.

Конечно, контекст безопасности будет определяться одним из подключенных пользователей, поэтому будьте осторожны при установке расширений SharePoint Framework в целевых семействах веб-сайтов.

### <a name="use-only-client-side-code"></a>Использование клиентского кода

Как расширения SharePoint Framework, так и дополнительные действия пользователя и меню ECB выполняются в браузере и могут содержать только клиентский код JavaScript. У клиентских решений есть ряд ограничений. Например, они не могут повышать разрешения в SharePoint и подключаться ко внешним API, не поддерживающим связь между источниками (CORS) и аутентификацию с помощью неявного потока OAuth. В таких случаях клиентское решение может использовать удаленный серверный API, чтобы выполнить необходимую операцию и вернуть результаты клиенту.

### <a name="hosting-model-self-consistent-and-based-on-office-365"></a>Модель размещения непротиворечива и основана на Office 365

Как расширения SharePoint Framework, так и дополнительные действия пользователя и меню ECB можно размещать в SharePoint Online, в сети доставки содержимого Office 365 (для этого не нужны внешние службы или среда внешнего размещения).

Хотя размещение решений SharePoint Framework в сети CDN имеет ряд преимуществ, оно необязательно, и вы можете разместить код решений в обычной библиотеке документов SharePoint. Пакеты SharePoint Framework (SPPKG-файлы), развернутые в каталоге приложений, задают URL-адрес, по которому SharePoint Framework может найти код решения. Этот URL-адрес может быть каким угодно при условии, что пользователь, просматривающий страницу с расширением, может скачать скрипт из указанного расположения.
Office 365 позволяет публиковать в сети CDN файлы из определенной библиотеки документов SharePoint. Общедоступные сети CDN Office 365 сочетают в себе преимущества использования сетей CDN и простоту размещения файлов с кодом в библиотеке документов SharePoint. Если общедоступность файлов с кодом не является проблемой для организации, рекомендуем использовать общедоступную сеть CDN Office 365.

## <a name="differences-between-sharepoint-framework-solutions-and-sharepoint-feature-framework-customizations"></a>Различия решений SharePoint Framework и модификаций SharePoint Feature Framework

Однако между двумя моделями разработки также существуют различия, которые необходимо учитывать при создании архитектуры решений.

### <a name="run-in-no-script-sites"></a>Работа на сайтах без скриптов

Решения SharePoint Framework, в том числе расширения, развертываются через каталог приложений с предварительным утверждением, поэтому на них не распространяются ограничения работы без скриптов. Эти решения работают на всех "современных" сайтах.

### <a name="pre-defined-set-of-extensibility-points"></a>Предопределенный набор точек расширяемости

Дополнительное действие пользователя может внедрять код JavaScript, который может обновлять или изменять модель DOM любой части страницы, а расширение SharePoint Framework, такое как настройщик приложений, может настраивать только верхний и нижний колонтитулы "современной" страницы (на момент написания этой статьи).

Теоретически вы можете создать настройщик приложений, который с помощью модели DOM полностью изменит структуру страницы, как было в случае дополнительных действий пользователя. Тем не менее, в SharePoint Framework доступен более структурированный и надежный подход к настройке SharePoint. SharePoint Framework содержит специальные обработчики и заполнители для настройки SharePoint. Используйте их, а не элементы DOM.

### <a name="use-typescript-for-building-more-robust-and-easier-to-maintain-solution"></a>Использование TypeScript для создания надежного и простого в обслуживании решения

При создании модификаций с вовлечением дополнительных действий пользователя и меню ECB разработчики часто использовали обычный код JavaScript. Зачастую такие решения не предусматривали наличия автоматических проверок, что могло приводить к ошибкам при рефакторинге.
SharePoint Framework позволяет разработчикам использовать систему типов TypeScript при создании решений. Благодаря системе типов вы можете находить ошибки во время разработки, а не во время выполнения. Кроме того, рефакторинг стал проще, так как TypeScript защищает изменения кода. Так как любой код JavaScript является допустимым кодом TypeScript, переход не вызовет особых затруднений. Вы можете перенести обычный код JavaScript в TypeScript, постепенно расширяя возможности поддержки решений.

### <a name="no-access-to-sharepoint-javascript-object-model-by-default"></a>Отсутствие доступа к объектной модели JavaScript SharePoint по умолчанию

При создании клиентских модификаций для классического пользовательского интерфейса SharePoint многие разработчики применяли объектную модель JavaScript (JSOM) для взаимодействия с SharePoint. Модель JSOM предоставляла функцию IntelliSense и удобный доступ к API SharePoint подобно клиентской объектной модели (CSOM). На классических страницах SharePoint основной компонент модели JSOM по умолчанию присутствовал на странице, а разработчики могли загружать дополнительные компоненты, например для взаимодействия со службой поиска SharePoint.
Современный пользовательский интерфейс SharePoint по умолчанию не включает модель SharePoint JSOM. Хотя разработчики могут загружать ее самостоятельно, рекомендуем использовать REST API или основную библиотеку JavaScript SharePoint PnP (JS PnP), которая использует REST API SharePoint на внутреннем уровне. Модель REST более универсальна и поддерживается в различных клиентских библиотеках, таких как jQuery, Angular и React.
Корпорация Майкрософт больше не занимается разработкой модели JSOM. Если вы предпочитаете работать с API, можете использовать библиотеку JS PnP, которая содержит удобный API и определения типов TypeScript.

## <a name="migrate-existing-customization-to-the-sharepoint-framework-extensions"></a>Перенос существующих модификаций в расширения SharePoint Framework

Перенос существующих модификаций в расширения SharePoint Framework дает ряд преимуществ как пользователям, так и разработчикам. Вы можете либо повторно использовать как можно больше существующих скриптов JavaScript, либо полностью переписать модификацию, используя TypeScript.

### <a name="reuse-existing-scripts"></a>Повторное использование существующих сценариев

При переносе существующих модификаций в расширения SharePoint Framework вы можете использовать существующие скрипты. Несмотря на то что платформа SharePoint Framework ориентирована на TypeScript, вы можете использовать обычный код JavaScript и постепенно преобразовывать его в TypeScript. Для краткосрочной поддержки определенного решения или в условиях ограниченного бюджета этого может быть достаточно.

Однако в решениях SharePoint Framework не всегда можно повторно использовать существующие скрипты. Например, учитывая разнообразие библиотек JavaScript, сложно сказать заранее, можно ли будет использовать существующие скрипты в решении SharePoint Framework или все-таки придется переписывать их. Единственный способ узнать это — пробовать перемещать разные компоненты в решение SharePoint Framework и проверять их работу.

### <a name="rewrite-the-customization"></a>Повторное создание модификации

Если вам нужны дополнительные возможности SharePoint Framework, долгосрочная поддержка решения или существующие скрипты невозможно использовать в SharePoint Framework, необходимо полностью переписать модификацию. Хотя это дороже, чем использовать существующие скрипты, в долгосрочной перспективе это более эффективно. Такое решение будет лучше работать, и его будет проще обслуживать и использовать.

Переписывая существующую модификацию для SharePoint Framework, для начала следует задуматься о необходимых функциях. Для реализации пользовательского интерфейса советуем использовать Office UI Fabric, чтобы решение выглядело как неотъемлемая часть SharePoint. 

## <a name="more-information"></a>Дополнительные сведения

Другие сведения о переходе с дополнительных действий пользователя и меню ECB на расширения SharePoint Framework приведены в следующих руководствах:

* [Переход с UserCustomAction на расширения SharePoint Framework](./migrate-from-usercustomactions-to-spfx-extensions.md);
* [Переход с меню Edit Control Block (ECB) на расширения SharePoint Framework](./migrate-from-ecb-to-spfx-extensions.md).