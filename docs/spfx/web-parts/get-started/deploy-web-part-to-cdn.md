---
title: "Развертывание клиентской веб-части SharePoint в CDN Azure"
description: "Узнайте, как создать образец веб-части и развернуть ее ресурсы в сети доставки содержимого Azure, а не использовать заданную по умолчанию сеть CDN Office 365 в качестве решения для размещения."
ms.date: 01/08/2018
ms.prod: sharepoint
ms.openlocfilehash: 4a2ab89f2eb24fbf318d880e1df07f4d51d45648
ms.sourcegitcommit: 6b547679670b719f2222f9709732382739956f90
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/18/2018
---
# <a name="deploy-your-sharepoint-client-side-web-part-to-azure-cdn"></a>Развертывание клиентской веб-части SharePoint в CDN Azure

Узнайте, как создать образец веб-части и развернуть ее ресурсы в сети доставки содержимого (CDN) Azure, а не использовать заданную по умолчанию сеть CDN Office 365 в качестве решения для размещения. Для развертывания ресурсов мы будем использовать учетную запись службы хранилища Azure, интегрированную с CDN. Инструменты сборки SharePoint Framework по умолчанию поддерживают развертывание в учетной записи службы хранилища Azure. Однако вы также можете вручную отправить файлы предпочитаемому поставщику CDN или в SharePoint.

> [!NOTE]
> Разместить ресурсы веб-части можно несколькими способами. Этот учебник описывает CDN Azure, но можно также использовать [сеть доставки содержимого Office 365](./hosting-webpart-from-office-365-cdn.md) или просто разместить активы в библиотеке SharePoint со своего клиента. Последний вариант предоставляет такие же возможности, но уступает сетям CDN в производительности. Ресурсы можно разместить в любом расположении, к которому пользователи могут получить доступ с помощью протокола HTTP.

## <a name="configure-an-azure-storage-account"></a>Как настроить учетную запись службы хранилища Azure

Чтобы настроить учетную запись хранения Azure и интегрировать ее с CDN, следуйте инструкциям в статье [Интеграция учетной записи хранения Azure с Azure CDN](https://docs.microsoft.com/ru-RU/azure/cdn/cdn-create-a-storage-account-with-cdn), а также подробным инструкциям в этой статье. 

### <a name="storage-account-name"></a>Имя учетной записи хранения

Это имя, используемое для создания учетной записи хранения, как описано в разделе [Шаг 1. Создание учетной записи хранения](https://docs.microsoft.com/ru-RU/azure/cdn/cdn-create-a-storage-account-with-cdn#step-1-create-a-storage-account).

Например, на приведенном ниже снимке экрана **spfxsamples** — это имя учетной записи хранения.

![Снимок экрана со страницей "Создание новой учетной записи хранения"](../../../images/deploy-create-storage-account.png)

При этом будет создана конечная точка **spfxsamples.blob.core.windows.net** для учетной записи хранения. 

> [!NOTE]
> Вам необходимо указать уникальное имя учетной записи хранения для своих проектов SharePoint Framework.

### <a name="blob-container-name"></a>Имя контейнера больших двоичных объектов

Создайте контейнер службы BLOB-объектов. Для этого перейдите на панель мониторинга учетной записи хранения.

Нажмите **+ Контейнер** и создайте контейнер со следующими параметрами:

* Имя: **azurehosted-webpart**
* Тип доступа: "Контейнер"

![Изображение с командой для создания контейнера BLOB-объектов](../../../images/deploy-option-blob-container.png)

### <a name="storage-account-access-key"></a>Ключ доступа к учетной записи хранения

На панели мониторинга учетной записи хранения нажмите **Ключ доступа** и скопируйте один из ключей доступа.

![Изображение с ключом доступа к учетной записи хранения](../../../images/deploy-storage-account-accesskey.png)

### <a name="cdn-profile-and-endpoint"></a>Профиль и конечная точка CDN

Создайте профиль CDN и свяжите конечную точку CDN с этим контейнером BLOB-объектов.

1. Создайте профиль CDN, как описано в разделе [Шаг 2. Включение сети CDN для учетной записи хранения](https://docs.microsoft.com/ru-RU/azure/cdn/cdn-create-a-storage-account-with-cdn#step-2-enable-cdn-for-the-storage-account) (прокрутите шаг 2 вниз до раздела **Создание профиля CDN**).

  Например, на следующем снимке экрана **spfxwebparts** — это имя профиля CDN.

  ![Снимок экрана при создании профиля CDN](../../../images/deploy-create-cdn-profile.png)

2. Создайте конечную точку CDN, как описано в разделе [Шаг 2. Включение сети CDN для учетной записи хранения](https://docs.microsoft.com/ru-RU/azure/cdn/cdn-create-a-storage-account-with-cdn#step-2-enable-cdn-for-the-storage-account). Будет создана конечная точка CDN со следующим URL-адресом: `http://spfxsamples.azureedge.net`

  Например, на следующем снимке экрана **spfxsamples** — это имя конечной точки, **Storage** — это тип источника, а **spfxsamples.blob.core.windows.net** — это учетная запись хранения.

  <img alt="Screenshot of create CDN endpoint" src="../../../images/deploy-create-cdn-endpoint.png" width="700">

Так как конечная точка CDN связана с учетной записью хранения, вы также можете получить доступ к контейнеру BLOB-объектов по следующему URL-адресу: `http://spfxsamples.azureedge.net/azurehosted-webpart/`

Но обратите внимание, что вы еще не развернули файлы.

## <a name="create-a-new-web-part-project"></a>Создание проекта веб-части

1. Создайте каталог проекта в удобном для вас расположении:

  ```
  md azurehosted-webpart
  ```

2. Перейдите к каталогу проекта:

  ```
  cd azurehosted-webpart
  ```

3. Создайте решение SharePoint Framework, запустив генератор Yeoman для SharePoint:

  ```
  yo @microsoft/sharepoint
  ```
    
4. Когда появится запрос, сделайте следующее:

  * Оставьте имя по умолчанию (**azurehosted-webpart**) для решения и нажмите клавишу ВВОД.
  * Выберите **SharePoint Online only (latest)** (Только SharePoint Online, последняя версия) и нажмите клавишу ВВОД.
  * Выберите вариант **Use the current folder** (Использовать текущую папку) для размещения файлов.
  * Введите **y**, чтобы выполнить развертывание на уровне клиента. При этом веб-часть станет доступна на всех сайтах сразу после развертывания. 
  * Выберите **WebPart** в качестве типа создаваемого клиентского компонента. 

5. Далее требуется указать информацию о веб-части:

  * Укажите **AzureCDN** в качестве имени веб-части и нажмите клавишу ВВОД.
  * Оставьте описание веб-части, заданное по умолчанию (**AzureCDN description**), и нажмите клавишу ВВОД.
  * Оставьте выбранным параметр **No JavaScript web framework** (Не использовать платформу веб-решений JavaScript) и нажмите клавишу ВВОД.

  ![Вопросы генератора Yeoman о новой веб-части](../../../images/cdn-azure-create-webpart-yo.png)

  После этого Yeoman формирует шаблоны файлов решения и устанавливает необходимые зависимости. Это может занять несколько минут. При этом Yeoman также включает в проект вашу веб-часть.

6. По завершении формирования шаблона заблокируйте версию зависимостей проекта, выполнив следующую команду:

  ```sh
  npm shrinkwrap
  ```

7. Введите следующую команду, чтобы открыть проект веб-части в Visual Studio Code:

  ```
  code .
  ```

## <a name="configure-the-solution-not-to-use-default-settings"></a>Изменение параметров решения, заданных по умолчанию

1. Откройте файл **package-solution.json** в папке **config**.

  Он используется для управления упаковкой решения.

2. Замените значение параметра `includeClientSideAssets` на **false**, чтобы клиентские ресурсы НЕ упаковывались в SPPKG-файл (это действие выполняется по умолчанию). Так как мы размещаем ресурсы из внешней сети доставки содержимого, нам не нужно включать их в пакет решения. Конфигурация должна выглядеть примерно так, как показано ниже.

  ``` json
  {
    "$schema": "https://dev.office.com/json-schemas/spfx-build/package-solution.schema.json",
    "solution": {
      "name": "azurehosted-webpart-client-side-solution",
      "id": "a4e95ed1-d096-4573-8a57-d0cc3b52da6a",
      "version": "1.0.0.0",
      "includeClientSideAssets": false,
      "skipFeatureDeployment": true
    },
    "paths": {
      "zippedPackage": "solution/azurehosted-webpart.sppkg"
    }
  }
  ```

  > [!NOTE]
  > Для параметра `skipFeatureDeployment` задано значение **true**, так как мы согласились на предложение генератора Yeoman выполнить развертывание на уровне клиента. Это означает, что вам НЕ требуется явно устанавливать решение на сайте, чтобы веб-часть стала доступна. Чтобы веб-часть была доступна на всех сайтах в определенном клиенте, достаточно развернуть и утвердить пакет решения в каталоге приложений клиента.


## <a name="configure-azure-storage-account-details"></a>Настройка сведений об учетной записи хранения Azure

1. Откройте файл **deploy-azure-storage.json** в папке **config**.

  Этот файл содержит сведения об учетной записи хранения Azure.

  ```json
  {
    "$schema": "https://dev.office.com/json-schemas/spfx-build/deploy-azure-storage.schema.json",
    "workingDir": "./temp/deploy/",
    "account": "<!-- STORAGE ACCOUNT NAME -->",
    "container": "azurehosted-webpart",
    "accessKey": "<!-- ACCESS KEY -->"
  }
  ```

2. Замените значения **account**, **container** и **accessKey** на имя учетной записи хранения, имя контейнера BLOB-объектов и ключ доступа к учетной записи хранения соответственно.

  **workingDir** — это каталог, в котором находятся ресурсы веб-части.

  В нашем примере для созданной ранее учетной записи хранения этот файл будет выглядеть так:

  ```json
  {
    "workingDir": "./temp/deploy/",
    "account": "spfxsamples",
    "container": "azurehosted-webpart",
    "accessKey": "q1UsGWocj+CnlLuv9ZpriOCj46ikgBbDBCaQ0FfE8+qKVbDTVSbRGj41avlG73rynbvKizZpIKK9XpnpA=="
  }
  ```

3. Сохраните файл.

## <a name="configure-the-web-part-to-load-from-cdn"></a>Настройка веб-части для загрузки из сети CDN

Чтобы веб-часть загружалась из сети CDN, необходимо сообщить ей путь к этой сети.

1. Переключитесь на Visual Studio Code и откройте файл **write-manifests.json** в папке **config**.

2. Введите базовый путь к сети CDN в свойстве **cdnBasePath**.

  ```json
  {
    "cdnBasePath": "<!-- PATH TO CDN -->"
  }
  ```

  В нашем примере для созданного ранее профиля CDN этот файл будет выглядеть следующим образом:

  ```json
  {
    "cdnBasePath": "https://spfxsamples.azureedge.net/azurehosted-webpart/"
  }
  ```

  > [!NOTE]
  > Базовый путь к сети CDN — это конечная точка CDN с контейнером BLOB-объектов.

3. Сохраните файл.


## <a name="prepare-the-web-part-assets-to-deploy"></a>Подготовка ресурсов веб-части к развертыванию

Прежде чем отправлять ресурсы в сеть CDN, их необходимо собрать.

1. Откройте консоль и выполните следующую задачу `gulp`:

  ```
  gulp bundle --ship
  ```

  При этом будут созданы сжатые ресурсы, необходимые для отправки поставщику CDN. Параметр `--ship` указывает средству сборки, что выполняется сборка для распространения. Вы также можете заметить, что в выходных данных инструментов сборки указан целевой объект сборки SHIP.

  ```
  Build target: SHIP
  [21:23:01] Using gulpfile ~/apps/azurehosted-webpart/gulpfile.js
  [21:23:01] Starting gulp
  [21:23:01] Starting 'default'...
  ```

  Сжатые ресурсы хранятся в каталоге `temp\deploy`.

## <a name="deploy-assets-to-azure-storage"></a>Развертывание ресурсов в службе хранилища Azure

1. Переключитесь на консоль для каталога проекта **azurehosted-webpart**.

2. Введите задачу gulp для развертывания ресурсов в учетной записи хранения:

  ```
  gulp deploy-azure-storage
  ```

  При этом пакет веб-части и другие ресурсы, например файлы JavaScript и CSS, будут развернуты в сети CDN.

## <a name="deploy-the-updated-package"></a>Развертывание обновленного пакета

### <a name="to-package-the-solution"></a>Упаковка решения

Так как мы изменили пакет веб-части, его необходимо заново развернуть в каталоге приложений. Мы использовали параметр **--ship**, чтобы создать сжатые ресурсы для распространения.

1. Переключитесь на консоль для каталога проекта **azurehosted-webpart**.

2. Выполните задачу gulp, чтобы упаковать клиентское решение (на этот раз с флагом `--ship`). При этом задача использует базовый путь к сети CDN, настроенный на предыдущем шаге:

  ```
  gulp package-solution --ship
  ```

  При этом в папке **sharepoint\solution** будет создан обновленный пакет клиентского решения.

### <a name="to-upload-to-your-app-catalog"></a>Отправка в каталог приложений

1. Отправьте или перетащите пакет клиентского решения в каталог приложений. Обратите внимание, что указан URL-адрес CDN Azure, заданный на предыдущих шагах. 

2. Установите флажок, чтобы это решение можно было автоматически развертывать на всех сайтах в организации.

  ![Снимок экрана с предложением доверять пакету клиентского решения](../../../images/cdn-azure-trust-hosted-app-catalog.png)

3. Нажмите кнопку **Развернуть**.

  Теперь в каталоге приложений есть пакет клиентского решения, в который загружен пакет веб-части из сети CDN.

## <a name="test-the-helloworld-web-part"></a>Тестирование веб-части HelloWorld

1. Перейдите на любой сайт SharePoint в клиенте и выберите **Добавить страницу** в меню со значком *шестеренки*.

2. **Отредактируйте** страницу и выберите веб-часть **AzureCDN** в средстве выбора веб-части, чтобы убедиться, что развертывание успешно выполнено.

  ![Снимок экрана с предложением доверять пакету клиентского решения](../../../images/cdn-azure-picker-selection-page.png)

3. Обратите внимание на то, что команда **gulp serve** не выполняется, поэтому никакие ресурсы не предоставляются из **localhost**. Контент предоставляется из CDN Azure. Вы также можете нажать клавишу F12 в браузере и убедиться, что CDN Azure отображается как один из источников ресурсов страницы.

  ![Источники с URL-адресом CDN Azure](../../../images/cdn-azure-sources-browser-dev-tools.png)

## <a name="deploy-to-other-cdns"></a>Развертывание в других сетях CDN

Чтобы развернуть ресурсы у предпочитаемого поставщика CDN, вы можете скопировать файлы из папки **temp\deploy**. Чтобы создать ресурсы для распространения, выполните команду gulp так же, как и ранее, указав параметр **--ship**:

```
gulp bundle --ship
```

Если обновлять **cdnBasePath** соответствующим образом, файлы будут загружаться правильно.

> [!NOTE]
> Если вы обнаружили ошибку в документации или SharePoint Framework, сообщите о ней разработчикам SharePoint, указав в [списке проблем для репозитория sp-dev-docs](https://github.com/SharePoint/sp-dev-docs/issues). Заранее спасибо!

## <a name="see-also"></a>См. также

- [Создание первой клиентской веб-части SharePoint](build-a-hello-world-web-part.md)