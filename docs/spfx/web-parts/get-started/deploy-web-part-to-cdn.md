---
title: "Развертывание клиентской веб-части SharePoint в CDN"
ms.date: 12/05/2017
ms.prod: sharepoint
ms.openlocfilehash: 5999958169ec6d94d5e8eca29a4d8458a6a77dea
ms.sourcegitcommit: 1f752afb40ff133e2fae14337e09392cc5d9d181
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/08/2017
---
# <a name="deploy-your-sharepoint-client-side-web-part-to-azure-cdn"></a>Развертывание клиентской веб-части SharePoint в CDN Azure

В этой статье вы можете создать образец веб-части и развернуть ее ресурсы в сети доставки содержимого Azure, а не использовать заданную по умолчанию сеть CDN Office 365 в качестве решения для размещения. Для развертывания ресурсов мы будем использовать учетную запись службы хранилища Azure, интегрированную с CDN. Инструменты сборки SharePoint Framework по умолчанию поддерживают развертывание в учетной записи службы хранилища Azure. Однако вы также можете вручную отправить файлы предпочитаемому поставщику CDN или в SharePoint.

> [!NOTE]
> Разместить ресурсы веб-части можно несколькими способами. Этот учебник описывает CDN Azure, но можно также использовать [сеть доставки содержимого Office 365](./hosting-webpart-from-office-365-cdn.md) или просто разместить активы в библиотеке SharePoint со своего клиента. Последний вариант тоже рабочий, но уступает в производительности сети доставки содержимого. Ресурсы можно разместить в любом расположении, к которому пользователи могут получить доступ с помощью протокола HTTP.

## <a name="configure-azure-storage-account"></a>Как настроить учетную запись службы хранилища Azure

Настройте учетную запись хранения Azure и интегрируйте ее с CDN.

Вы можете выполнить действия, описанные в статье [Интеграция учетной записи хранения с CDN](https://azure.microsoft.com/ru-RU/documentation/articles/cdn-create-a-storage-account-with-cdn/), а также подробные указания из этой статьи, чтобы создать учетную запись хранения Azure и интегрировать ее с CDN. Вам потребуются следующие сведения:

### <a name="storage-account-name"></a>Имя учетной записи хранения

Это имя, используемое для создания учетной записи хранения, как описано в разделе [Шаг 1. Создание учетной записи хранения](https://azure.microsoft.com/ru-RU/documentation/articles/cdn-create-a-storage-account-with-cdn/#step-1-create-a-storage-account).

Например, на приведенном ниже снимке экрана **spfxsamples** — это имя учетной записи хранения.

![Снимок экрана со страницей "Создание новой учетной записи хранения"](../../../images/deploy-create-storage-account.png)

При этом будет создана конечная точка **spfxsamples.blob.core.windows.net** для учетной записи хранения. 

> [!NOTE]
> Потребуется указать уникальное имя учетной записи хранения для своих проектов SharePoint Framework.

### <a name="blob-container-name"></a>Имя контейнера больших двоичных объектов

Создайте контейнер службы BLOB-объектов. Он будет доступен на панели мониторинга вашей учетной записи хранения.

Нажмите **+ Контейнер** и создайте контейнер со следующими параметрами:

* Имя: **azurehosted-webpart**
* Тип доступа: "Контейнер"

![Изображение с командой для создания контейнера BLOB-объектов](../../../images/deploy-option-blob-container.png)

### <a name="storage-account-access-key"></a>Ключ доступа к учетной записи хранения

На панели мониторинга учетной записи хранения нажмите **Ключ доступа** и скопируйте один из ключей доступа.

![Изображение с ключом доступа к учетной записи хранения](../../../images/deploy-storage-account-accesskey.png)

### <a name="cdn-profile-and-endpoint"></a>Профиль и конечная точка CDN

Создайте профиль CDN и свяжите конечную точку CDN с этим контейнером BLOB-объектов.

Создание профиля CDN описывается в разделе [Шаг 2. Создание нового профиля сети CDN](https://azure.microsoft.com/ru-RU/documentation/articles/cdn-create-a-storage-account-with-cdn/#step-2-create-a-new-cdn-profile).

Например, на следующем снимке экрана **spfxwebparts** — это имя профиля CDN.

![Снимок экрана при создании профиля CDN](../../../images/deploy-create-cdn-profile.png)

Создание конечной точки CDN описывается в разделе [Шаг 3. Создание новой конечной точки сети CDN](https://azure.microsoft.com/ru-RU/documentation/articles/cdn-create-a-storage-account-with-cdn/#step-3-create-a-new-cdn-endpoint).

Например, на следующем снимке экрана **spfxsamples** — это имя конечной точки, **Storage** — это тип источника, а **spfxsamples.blob.core.windows.net** — это учетная запись хранения.

![Снимок экрана при создании конечной точки CDN](../../../images/deploy-create-cdn-endpoint.png)

Конечная точка CDN будет создана со следующим URL-адресом: http://spfxsamples.azureedge.net

Так как конечная точка CDN связана с учетной записью хранения, вы также можете получить доступ к контейнеру больших двоичных объектов по следующему URL-адресу: http://spfxsamples.azureedge.net/azurehosted-webpart/

Но обратите внимание, что вы еще не развернули файлы.

## <a name="creating-a-new-web-part-project"></a>Создание проекта веб-части

Создайте каталог проекта в удобном для вас расположении:

```
md azurehosted-webpart
```

Перейдите к каталогу проекта:

```
cd azurehosted-webpart
```

Создайте решение SharePoint Framework, запустив генератор Yeoman для SharePoint:

```
yo @microsoft/sharepoint
```
    
Когда появится запрос:

* Оставьте имя по умолчанию (**azurehosted-webpart**) для решения и нажмите клавишу **ВВОД**.
* Выберите **SharePoint Online only (latest)** (Только SharePoint Online, последняя версия) и нажмите клавишу **ВВОД**.
* Выберите вариант **Use the current folder** (Использовать текущую папку) для размещения файлов.
* Введите **y**, чтобы выполнить развертывание на уровне клиента. При этом веб-часть станет доступна на всех сайтах сразу после развертывания. 
* Выберите **WebPart** в качестве типа создаваемого клиентского компонента. 

Далее вам потребуется указать определенные сведения о веб-части:

* Укажите **AzureCDN** в качестве имени веб-части и нажмите клавишу **ВВОД**.
* Оставьте в качестве описания веб-части вариант по умолчанию (**AzureCDN description**) и нажмите клавишу **ВВОД**.
* Оставьте выбранным параметр **No javascript web framework** (Не использовать платформу веб-решений на базе JavaScript) и нажмите клавишу **ВВОД**.

![Вопросы генератора Yeoman о новой веб-части](../../../images/cdn-azure-create-webpart-yo.png)

После этого Yeoman выполнит скаффолдинг файлов решения и установит требуемые зависимости. Это может занять несколько минут. При этом Yeoman также включит в проект вашу веб-часть.

После скаффолдинга заблокируйте версию зависимостей проекта, выполнив следующую команду:

```sh
npm shrinkwrap
```

Затем введите следующую команду, чтобы открыть проект веб-части в Visual Studio Code:

```
code .
```

## <a name="configure-solution-not-to-use-default-settings"></a>Изменение параметров решения, заданных по умолчанию

Откройте файл **deploy-azure-storage.json** в папке **config**.

Он используется для управления упаковкой решения.

Замените значение параметра `includeClientSideAssets` на **false**, чтобы клиентские ресурсы НЕ упаковывались в SPPKG-файл (это действие выполняется по умолчанию). Так как мы размещаем ресурсы из внешней сети доставки содержимого, нам не нужно включать их в пакет решения. Конфигурация должна выглядеть примерно так, как показано ниже.

``` json
{
  "$schema": "https://dev.office.com/json-schemas/spfx-build/package-solution.schema.json",
  "solution": {
    "name": "azurehosted-webpart-client-side-solution",
    "id": "a4e95ed1-d096-4573-8a57-d0cc3b52da6a",
    "version": "1.0.0.0",
    "includeClientSideAssets": false,
    "skipFeatureDeployment": true
  },
  "paths": {
    "zippedPackage": "solution/azurehosted-webpart.sppkg"
  }
}
```

> [!NOTE]
> Для параметра `skipFeatureDeployment` задано значение **true**, так как в ответ на предложение Yeoman выполнить развертывание на уровне клиента был выбран параметр "Y". Это означает, что вам НЕ требуется явно устанавливать решение на сайте, прежде чем веб-часть станет доступна. Чтобы веб-часть была доступна на всех сайтах в определенном клиенте, достаточно развернуть и утвердить пакет решения в каталоге приложений клиента.


## <a name="configure-azure-storage-account-details"></a>Настройка сведений об учетной записи службы хранилища Azure

Откройте файл **deploy-azure-storage.json** в папке **config**.

Этот файл содержит сведения об учетной записи службы хранилища Azure.

```json
{
  "$schema": "https://dev.office.com/json-schemas/spfx-build/deploy-azure-storage.schema.json",
  "workingDir": "./temp/deploy/",
  "account": "<!-- STORAGE ACCOUNT NAME -->",
  "container": "azurehosted-webpart",
  "accessKey": "<!-- ACCESS KEY -->"
}
```

Замените значения **account**, **container** и **accessKey** именем учетной записи хранения, именем контейнера BLOB-объектов и ключом доступа к учетной записи хранения соответственно.

**workingDir** — это каталог, в котором располагаются активы веб-части.

В нашем примере для созданной ранее учетной записи хранения этот файл будет выглядеть следующим образом:

```json
{
  "workingDir": "./temp/deploy/",
  "account": "spfxsamples",
  "container": "azurehosted-webpart",
  "accessKey": "q1UsGWocj+CnlLuv9ZpriOCj46ikgBbDBCaQ0FfE8+qKVbDTVSbRGj41avlG73rynbvKizZpIKK9XpnpA=="
}
```

Сохраните файл.

## <a name="configuring-web-part-to-load-from-cdn"></a>Настройка веб-части для загрузки из сети CDN

Чтобы веб-часть загружалась из сети CDN, необходимо сообщить ей путь к этой сети.

Переключитесь на Visual Studio Code и откройте файл **write-manifests.json** в папке **config**.

Введите базовый путь к сети CDN в свойстве **cdnBasePath**.

```json
{
  "cdnBasePath": "<!-- PATH TO CDN -->"
}
```

В нашем примере для созданного ранее профиля CDN этот файл будет выглядеть следующим образом:

```json
{
  "cdnBasePath": "https://spfxsamples.azureedge.net/azurehosted-webpart/"
}
```

> [!NOTE]
> Базовый путь к сети CDN — это конечная точка CDN с контейнером BLOB-объектов.

Сохраните файл.


## <a name="prepare-web-part-assets-to-deploy"></a>Подготовка активов веб-части к развертыванию

Прежде чем отправлять активы в сеть CDN, их необходимо собрать.

Переключитесь на консоль и выполните следующую задачу `gulp`:

```
gulp bundle --ship
```

При этом будут созданы сжатые активы, необходимые для отправки поставщику CDN. Параметр `--ship` указывает инструменту сборки, что выполняется сборка для распространения. Вы также можете заметить, что в выходных данных инструментов сборки указан целевой объект сборки SHIP.

```
Build target: SHIP
[21:23:01] Using gulpfile ~/apps/azurehosted-webpart/gulpfile.js
[21:23:01] Starting gulp
[21:23:01] Starting 'default'...
```

Сжатые активы хранятся в каталоге `temp\deploy`.

## <a name="deploy-assets-to-azure-storage"></a>Развертывание ресурсов в службе хранилища Azure

Переключитесь на консоль для каталога проекта **azurehosted-webpart**.

Введите задачу gulp для развертывания ресурсов в учетной записи хранения:

```
gulp deploy-azure-storage
```

При этом пакет веб-части и другие ресурсы, например файлы JavaScript и CSS, будут развернуты в сети CDN.

## <a name="deploy-the-updated-package"></a>Развертывание обновленного пакета

### <a name="package-the-solution"></a>Упаковка решения

Так как вы изменили пакет веб-части, его потребуется заново развернуть к каталоге приложений. Вы использовали **--ship**, чтобы создать минифицированные ресурсы для распространения.

Переключитесь на консоль для каталога проекта **azurehosted-webpart**.

Выполните задачу gulp, чтобы упаковать клиентское решение (на этот раз с флагом `--ship`). При этом задача использует базовый путь к сети CDN, настроенный на предыдущем шаге:

```
gulp package-solution --ship
```

При этом будет создан обновленный пакет клиентского решения в папке **sharepoint\solution**.

### <a name="upload-to-your-app-catalog"></a>Отправка в каталог приложений

Отправьте или перетащите пакет клиентского решения в каталог приложений. Обратите внимание на то, что указан URL-адрес CDN Azure, заданный на предыдущих этапах. 

**Установите флажок**, чтобы это решение можно было развертывать автоматически доступным на всех сайтах в организации.

![Снимок экрана с предложением доверять пакету клиентского решения](../../../images/cdn-azure-trust-hosted-app-catalog.png)

Нажмите кнопку **Развернуть**.

Теперь в каталоге приложений хранится пакет клиентского решения, в который был загружен пакет веб-части из сети CDN.

## <a name="test-the-helloworld-web-part"></a>Тестирование веб-части HelloWorld

Перейдите на любой сайт SharePoint в клиенте и выберите пункт **Добавить страницу** в меню со значком *шестеренки*.

**Отредактируйте** страницу и выберите веб-часть **AzureCDN** в средстве выбора веб-части, чтобы убедиться, что развертывание успешно выполнено.

![Снимок экрана с предложением доверять пакету клиентского решения](../../../images/cdn-azure-picker-selection-page.png)

Обратите внимание на то, что команда **gulp serve** не выполняется, поэтому никакие ресурсы не предоставляются из **localhost**. Контент предоставляется из CDN Azure. Вы также можете нажать клавишу F12 в браузере и убедиться, что CDN Azure отображается как один из источников ресурсов страницы.

![Источники с URL-адресом CDN Azure](../../../images/cdn-azure-sources-browser-dev-tools.png)

## <a name="deploying-to-other-cdns"></a>Развертывание в других сетях CDN

Чтобы развернуть ресурсы у предпочитаемого поставщика CDN, вы можете скопировать файлы из папки **temp\deploy**. Чтобы создать ресурсы для распространения, выполните команду gulp так же, как и ранее, указав параметр **--ship**:

```
gulp bundle --ship
```

Если вы обновляете **cdnBasePath** соответствующим образом, файлы загружаются правильно.

> [!NOTE]
> Если вы обнаружили ошибку в документации или SharePoint Framework, сообщите о ней разработчикам SharePoint, указав в [списке проблем для репозитория sp-dev-docs](https://github.com/SharePoint/sp-dev-docs/issues). Заранее спасибо!