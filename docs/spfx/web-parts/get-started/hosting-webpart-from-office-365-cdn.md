---
title: "Размещение клиентской веб-части в сети доставки содержимого Office 365 (Hello World, часть 4)"
description: "Простое решение для размещения ресурсов прямо в клиенте Office 365. В нем можно разместить любые статические ресурсы, используемые в SharePoint Online."
ms.date: 01/08/2018
ms.prod: sharepoint
ms.openlocfilehash: cfcb12bb5f0edbe8314df595629d71aabf50ed81
ms.sourcegitcommit: e157d51378190ddfed6394ba154ce66141c8ca33
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/19/2018
---
# <a name="host-your-client-side-web-part-from-office-365-cdn-hello-world-part-4"></a>Размещение клиентской веб-части в сети доставки содержимого Office 365 (Hello World, часть 4)

Сеть доставки содержимого Office 365 позволяет разместить ресурсы непосредственно в клиенте Office 365. В ней можно разместить любые статические ресурсы, используемые в SharePoint Online. 

> [!NOTE]
> Разместить ресурсы веб-части можно несколькими способами. В этом руководстве описана сеть CDN Office 365, но можно также использовать [сеть доставки содержимого Azure](./deploy-web-part-to-cdn.md) или просто разместить ресурсы в библиотеке SharePoint из своего клиента. Последний вариант предоставляет такие же возможности, но уступает сетям CDN в производительности. Ресурсы можно разместить в любом расположении, к которому пользователи могут получить доступ с помощью протокола HTTP(S).

> [!IMPORTANT]
> В этой статье упоминается атрибут `includeClientSideAssets`, который появился в SPFx 1.4. Эта версия не поддерживается в **SharePoint 2016 с пакетом дополнительных компонентов 2**. Если вы используете локальную конфигурацию, определите расположение CDN отдельно. Файлы JavaScript также можно размещать в централизованной библиотеке локальной среды SharePoint, к которой у пользователей есть доступ. Дополнительные рекомендации представлены в [руководстве, посвященном SharePoint 2016](../../sharepoint-2016-support.md).

Прежде чем приступать к работе, убедитесь, что выполнены следующие задачи:

* [Создание первой клиентской веб-части](./build-a-hello-world-web-part.md)
* [Подключение клиентской веб-части к SharePoint](./connect-to-sharepoint.md)
* [Развертывание клиентской веб-части на странице SharePoint](./serve-your-web-part-in-a-sharepoint-page.md)

Эти действия также показаны в видео на [канале SharePoint PnP в YouTube](https://www.youtube.com/watch?v=MEZMs8VMVQ0&list=PLR9nK3mnD-OXvSWvS2zglCzz4iplhVrKq).

<a href="https://www.youtube.com/watch?v=MEZMs8VMVQ0&list=PLR9nK3mnD-OXvSWvS2zglCzz4iplhVrKq">
<img src="../../../images/spfx-youtube-tutorial4.png" alt="Screenshot of the YouTube video player for this tutorial" />
</a>

## <a name="enable-cdn-in-your-office-365-tenant"></a>Включение сети доставки содержимого в клиенте Office 365

1. Скачайте последнюю версию командной консоли SharePoint Online на [сайте загрузки Майкрософт](https://www.microsoft.com/en-us/download/details.aspx?id=35588).

  > [!TIP]
  > Командную консоль SharePoint Online нельзя использовать на компьютерах без Windows. Однако вы можете управлять этими параметрами с помощью [интерфейса командной строки Office 365](https://sharepoint.github.io/office365-cli/).

2. Подключитесь к клиенту SharePoint Online с помощью сеанса PowerShell.

  ```powershell
  Connect-SPOService -Url https://contoso-admin.sharepoint.com
  ```

3. Чтобы узнать текущее состояние настроек общедоступной сети CDN на уровне клиента, поочередно выполните приведенные ниже команды. 


  ```powershell
  Get-SPOTenantCdnEnabled -CdnType Public
  Get-SPOTenantCdnOrigins -CdnType Public
  Get-SPOTenantCdnPolicies -CdnType Public
  ```

  Решения SharePoint Framework могут автоматически использовать общедоступную сеть CDN Office 365, если она включена в клиенте. Если сеть CDN включена, источник `*/CLIENTSIDEASSETS` автоматически добавляется как допустимый.

4. Включите общедоступную сеть доставки содержимого в клиенте.

  ```powershell
  Set-SPOTenantCdnEnabled -CdnType Public
  ```

5. Чтобы подтвердить настройки, выберите `Y` и нажмите клавишу ВВОД.

  ![Включение общедоступной сети доставки содержимого в клиенте](../../../images/cdn-enable-o365-public-cdn.png)

  Теперь в клиенте включена общедоступная сеть CDN с использованием разрешенной конфигурации типов файлов по умолчанию. Это означает, что поддерживаются следующие расширения: CSS, EOT, CSS, EOT, GIF, ICO, JPEG, JPG, JS, MAP, PNG, SVG, TTF и WOFF.

  Решения SharePoint Framework могут автоматически использовать общедоступную сеть CDN Office 365, если она включена в клиенте. Если сеть CDN включена, источник `*/CLIENTSIDEASSETS` автоматически добавляется как допустимый.

  > [!NOTE]
  > Если вы уже включали общедоступную сеть доставки содержимого Office 365, ее следует включить заново, чтобы запись `*/CLIENTSIDEASSETS` была добавлена как допустимый источник общедоступной сети CDN.

6. Вы можете проверить текущую конфигурацию конечных точек. Выполните следующую команду, чтобы получить список источников сетей CDN из клиента:

  ```powershell
  Get-SPOTenantCdnOrigins -CdnType Public
  ```

  Обратите внимание, что новый источник указан как допустимый источник CDN. Окончательная настройка источника займет приблизительно 15 минут, а мы пока можем создать тестовую веб-часть, которая будет размещена в источнике по завершении развертывания. 

  ![Список общедоступных источников в клиенте](../../../images/cdn-public-origins.png)

  > [!NOTE]
  > Если рядом с названием источника нет сообщения о *незавершенной настройке*, то он готов к использованию в клиенте. Это означает, что выполняется настройка SharePoint Online и системы CDN. 


## <a name="end-task-in-project-directory"></a>Завершение задачи в каталоге проекта

1. Откройте консоль и убедитесь, что по-прежнему выбран каталог проекта, который использовался для настройки проекта веб-части.

2. Завершите задачу `gulp serve` (если она выполняется), нажав клавиши CTRL+C, и убедитесь, что выбран каталог проекта:

  ```
  cd helloworld-webpart
  ```

## <a name="review-solution-settings"></a>Проверка параметров решения 

1. Откройте проект веб-части **HelloWorldWebPart** в Visual Studio Code или другой среде IDE.

2. Откройте файл **package-solution.json** в папке **config**.

  В файле **package-solution.json** определяются метаданные пакета, как показано в следующем фрагменте кода:

  ```json
  {
    "$schema": "https://dev.office.com/json-schemas/spfx-build/package-solution.schema.json",
    "solution": {
      "name": "helloworld-webpart-client-side-solution",
      "id": "4432f33b-5845-4ca0-827e-a8ae68c7b945",
      "version": "1.0.0.0",
      "includeClientSideAssets": true
    },
    "paths": {
      "zippedPackage": "solution/helloworld-webpart.sppkg"
    }
  }

  ```

По умолчанию для параметра **includeClientSideAssets** задано значение `true`. Это означает, что статические ресурсы автоматически упаковываются в *SPPKG*-файлы, а ресурсы не требуется отдельно размещать во внешней системе. 

Если *сеть доставки содержимого Office 365* включена, она используется автоматически с параметрами по умолчанию. Если *сеть доставки содержимого Office 365* не включена, ресурсы доставляются из семейства веб-сайтов с каталогом приложений. 

> [!NOTE]
> Начиная с SharePoint Framework версии 1.4, статические ресурсы по умолчанию упаковываются в SPPKG-файлы. При развертывании пакета в каталоге приложений ресурсы автоматически размещаются в сети CDN Office 365 (если она включена) или по URL-адресу каталога приложений. Эти действия можно изменить с помощью параметра `includeClientSideAssets` в файле `package-solution.json`.

## <a name="prepare-web-part-assets-to-deploy"></a>Подготовка ресурсов веб-части к развертыванию

1. Выполните приведенную ниже задачу, чтобы создать пакет решения. При этом будет выполнена сборка выпуска проекта с использованием динамической метки в качестве URL-адреса для размещения ресурсов. Этот URL-адрес автоматически обновляется в соответствии с параметрами CDN клиента.

  ```
  gulp bundle --ship
  ```

2. Выполните приведенную ниже задачу, чтобы упаковать решение. Эта команда создает обновленный пакет **helloworld-webpart.sppkg** в папке **sharepoint/solution**.

  ```
  gulp package-solution --ship
  ```

  > [!NOTE]
  > Если вам интересно, какие именно ресурсы упаковываются в SPPKG-файл, ознакомьтесь с содержимым папки **sharepoint/solution/debug**.

3. Добавьте или перетащите новый пакет клиентского решения в каталог приложений в клиенте. 

4. Так как вы уже развернули пакет, вам будет предложено заменить его. Нажмите **Заменить**.

  ![Переопределение существующего решения](../../../images/cdn-override-helloworld-webpart-package.png)

5. Обратите внимание, что в списке **доменов** указана среда *SharePoint Online*. Это вызвано тем, что контент доставляется либо из сети CDN Office 365, либо из каталога приложений (в зависимости от параметров клиента). Нажмите кнопку **Развернуть**.

  ![Всплывающее окно при установке решения SPFx в каталоге приложений](../../../images/cnd-trust-helloworld-webpart-solution.png)

6. Откройте сайт, где ранее было установлено решение **helloworld-webpart-client-side-solution**, или установите решение на новом сайте.

7. Когда решение будет установлено, в меню со значком *шестеренки* выберите **Добавление страницы**, затем в окне выбора веб-частей для современной страницы нажмите **HelloWorld**, чтобы добавить свою веб-часть на страницу.

  ![Веб-часть HelloWorld в средстве выбора веб-частей для современной страницы](../../../images/cdn-web-part-picker.png)

8. Обратите внимание: веб-часть отображается, несмотря на то что служба node.js не запущена локально. 

  ![Веб-часть HelloWorld на современной странице в режиме редактирования](../../../images/cdn-web-part-rendering.png)

9. Сохраните изменения на странице с веб-частью.

10. Нажмите клавишу **F12**, чтобы открыть инструменты разработчика.

11. Разверните узел **publiccdn.sharepointonline.com** в источнике и обратите внимание, что файл **hello-world-web-part** загружается с URL-адреса общедоступной сети доставки содержимого, динамически указывающего на библиотеку, расположенную в семействе веб-сайтов каталога приложений.

  ![Пакет веб-части HelloWorld из общедоступной сети CDN по указанному URL-адресу на вкладке "Источники" в области инструментов разработчика Chrome](../../../images/cdn-web-part-f12-source.png)

> [!NOTE]
> Если в вашем клиенте не включена сеть CDN, а в файле **package-solution.json** для параметра `includeClientSideAssets` задано значение `true`, то URL-адрес для загрузки ресурсов динамически обновляется и указывает непосредственно на папку ClientSideAssets, расположенную в семействе веб-сайтов с каталогом приложений. В данном случае используется URL-адрес `https://sppnp.microsoft.com/sites/apps/ClientSideAssets/`.

Поздравляем! Вы развернули веб-часть в SharePoint Online, автоматически разместив ее в сети доставки содержимого Office 365.

## <a name="next-steps"></a>Дальнейшие действия

Вы можете загрузить jQuery и jQuery UI, а затем собрать веб-часть jQuery Accordion. Дальнейшие указания см. в статье [Добавление элемента Accordion jQueryUI в клиентскую веб-часть SharePoint](./add-jqueryui-accordion-to-web-part.md).

> [!NOTE]
> Если вы обнаружили ошибку в документации или SharePoint Framework, сообщите о ней разработчикам SharePoint, указав в [списке проблем для репозитория sp-dev-docs](https://github.com/SharePoint/sp-dev-docs/issues). Заранее спасибо!

