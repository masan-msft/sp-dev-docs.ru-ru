---
title: "Оптимизация сборок SharePoint Framework для рабочей среды"
description: "Узнайте, чем отличаются отладочные и конечные сборки, а также как оптимизировать пакет для использования в рабочих средах."
ms.date: 02/02/2018
ms.prod: sharepoint
ms.openlocfilehash: 95bd3bc98c5a0bf509ffd3bf790d22a9d5e9ac93
ms.sourcegitcommit: 7a40bb847e8753810ab7f907d638f3cac022d444
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/05/2018
---
# <a name="optimize-sharepoint-framework-builds-for-production"></a>Оптимизация сборок SharePoint Framework для рабочей среды

При развертывании решений SharePoint Framework в рабочей среде следует всегда использовать оптимизированную конечную сборку проекта. В этой статье иллюстрируются основные отличия между отладочными и конечными сборками, а также показано, как оптимизировать пакет для использования в рабочих средах.

## <a name="use-release-builds-in-production"></a>Используйте конечные сборки в рабочей среде

При сборке проекта SharePoint Framework вы можете выбрать режим отладки или выпуска. По умолчанию проекты SharePoint Framework собираются в режиме отладки, что упрощает отладку кода. Но когда код готов и работает надлежащим образом, необходимо собрать его для выпуска, чтобы оптимизировать приложение для выполнения в рабочей среде.

Дополнительные сведения о сборке проекта в режиме выпуска см. в статье [Цепочка инструментов SharePoint Framework](./sharepoint-framework-toolchain.md).

Основное отличие между результатами сборки в режимах отладки и выпуска состоит в том, что размер пакета для выпуска значительно меньше, чем у аналогичного пакета для отладки. Чтобы увидеть разницу, сравните размеры проектов SharePoint Framework, собранных для отладки и выпуска, в веб-части на платформе Angular.

![Изображение с двумя окнами проводника, в которых выделены версии пакета для отладки и выпуска](../../images/guidance-productionbuilds-debug-vs-ship-bundle.png)

Версия пакета для отладки занимает 1255 КБ, а аналогичный пакет для выпуска — всего 177 КБ. Разница в размере между пакетами для отладки и выпуска зависит от того, какие библиотеки используются в проекте. Однако конечная сборка всегда будет значительно меньше отладочной, поэтому в рабочей среде всегда следует развертывать конечные сборки.

## <a name="dont-include-third-party-libraries-in-the-bundle"></a>Не включайте в пакет сторонние библиотеки

При сборке решений SharePoint Framework можно использовать множество готовых библиотек JavaScript для решения основных задач. Использование готовых библиотек позволяет успевать больше и сосредоточиться на конкретных задачах организации, а не на разработке стандартных функций.

По умолчанию, если в проекте есть ссылки на сторонние библиотеки, SharePoint Framework включает их в создаваемый пакет. В результате пользователям решения приходится скачивать одну и ту же библиотеку несколько раз (с каждым компонентом). Общий размер страницы значительно возрастает, а вместе с ним и время загрузки. Это портит впечатление от решения, особенно в медленных сетях.

![Средства разработчика в Microsoft Edge, где на вкладке "Сеть" показаны два загружаемых пакета веб-частей](../../images/guidance-productionbuilds-two-bundles-with-libraries.png)

Советуем загружать сторонние библиотеки со среды внешнего размещения: общедоступной сети CDN или среды, принадлежащей вашей организации. Это позволяет исключить библиотеку из пакета, значительно сокращая его размер. 

Кроме того, если среда, из которой загружается библиотека, оптимизирована для доставки статических ресурсов, пользователям решения достаточно будет скачать библиотеку всего один раз. При последующих запросах и даже при использовании решения спустя время веб-браузер будет использовать копию библиотеки из кэша, а не скачивать ее заново. В результате страница с решением будет загружаться значительно быстрее.

## <a name="verify-the-contents-of-your-bundle"></a>Проверка содержимого пакета

Чтобы получить представление о размере создаваемых пакетов, разверните конфигурацию Webpack в проекте или просмотрите статистику в SharePoint Framework.

Сначала установите пакет **webpack-bundle-analyzer** в проекте, выполнив в командной строке следующую команду:

```sh
npm install webpack-bundle-analyzer --save-dev
```

<br/>

Затем замените содержимое файла **gulpfile.js** в проекте следующим кодом:

```js
'use strict';

const gulp = require('gulp');
const path = require('path');
const build = require('@microsoft/sp-build-web');
const bundleAnalyzer = require('webpack-bundle-analyzer');

build.configureWebpack.mergeConfig({
  additionalConfiguration: (generatedConfiguration) => {
    const lastDirName = path.basename(__dirname);
    const dropPath = path.join(__dirname, 'temp', 'stats');
    generatedConfiguration.plugins.push(new bundleAnalyzer.BundleAnalyzerPlugin({
      openAnalyzer: false,
      analyzerMode: 'static',
      reportFilename: path.join(dropPath, `${lastDirName}.stats.html`),
      generateStatsFile: true,
      statsFilename: path.join(dropPath, `${lastDirName}.stats.json`),
      logLevel: 'error'
    }));

    return generatedConfiguration;
  }
});

build.initialize(gulp);
```

<br/>

При следующем использовании команды `gulp bundle` в папке **temp/stats** проекта будут сгенерированы файлы статистики. Один из этих файлов представляет собой диаграмму "дерево", на которой показаны различные скрипты, включенные в сгенерированный пакет. Вы можете найти эту визуализацию в файле **./temp/stats/[solution-name].stats.html**.

<br/>

<img alt="Webpack bundle analyzer treemap illustrating the contents of a sample SharePoint Framework bundle" src="../../images/guidance-productionbuilds-webpack-bundlestats-chart-angular.png" width="800">

Диаграмма "дерево" анализатора пакетов Webpack помогает убедиться, что созданный пакет не содержит лишних скриптов, и проверить, как включенные скрипты влияют на общий размер пакета. Помните, что отображаемый размер относится к отладочной сборке, а конечная сборка будет значительно меньше.

Более подробные сведения, используемые для создания визуализации, включены в файл **./dist/[solution-name].stats.json**. С помощью этого файла вы можете узнать, почему тот или иной скрипт был включен в пакет и используется ли он в нескольких пакетах. Эти сведения помогут вам оптимизировать пакеты и ускорить загрузку решения.

## <a name="choose-your-primary-client-side-library"></a>Выбор основной клиентской библиотеки

Если несколько компонентов на одной или нескольких страницах портала используют одну и ту же библиотеку, загружаемую с одного URL-адреса, веб-браузер использует ранее кэшированную копию, что ускоряет загрузку портала. 

Именно по этой причине важно оптимизировать использование библиотек и версий, а также источников, из которых они загружаются. Это относится не только к конкретному проекту, но и ко всей организации. Эти меры скажутся на производительности пользователей, работающих с разными приложениями, так как скорость загрузки увеличится. Использование уже загруженных ресурсов также позволяет ограничить нагрузку на сеть, освобождая пропускную способность для других целей.

Дополнительные сведения о работе с внешними библиотеками см. в статье [Использование существующих библиотек JavaScript в клиентских веб-частях SharePoint Frameworks](../web-parts/guidance/use-existing-javascript-libraries.md).

## <a name="reference-only-the-necessary-components"></a>Ссылайтесь только на необходимые компоненты

Иногда при работе с внешней библиотекой может быть необходима лишь небольшая ее часть. Включив всю библиотеку, вы увеличите размер пакета, замедлив его загрузку. Советуем загружать только необходимые части той или иной библиотеки.

В качестве примера возьмем библиотеку [Lodash](https://lodash.com). Lodash — это коллекция служебных программ, помогающих выполнять определенные операции в коде. Высока вероятность того, что при работе с Lodash вам потребуется лишь несколько отдельных методов, а не вся библиотека. 

Если ссылаться на всю библиотеку с помощью приведенного ниже кода, к неоптимизированному пакету добавится 527 КБ.

```typescript
import * as _ from 'lodash';
```

<br/>

<img alt="The complete Lodash library included in a bundle, highlighted in the Webpack bundle analyzer treemap" src="../../images/guidance-productionbuilds-import-lodash.png" width="800">

<br/>

Если же ссылаться только на определенный метод Lodash с помощью приведенного ниже кода, то к неоптимизированному пакету добавится только 45 КБ.

```typescript
const at: any = require('lodash/at');
```

<br/>

![Включенный в пакет метод Lodash, выделенный на диаграмме "дерево" анализатора пакетов Webpack](../../images/guidance-productionbuilds-import-lodash-at.png)

В случае библиотеки Lodash, как и с некоторыми другими библиотеками, у ссылок на отдельные методы есть свои недостатки. 

В настоящее время библиотека Lodash не поддерживает загрузку конкретных методов в проектах SharePoint Framework с помощью нотации **import**. Вместо этого необходимо использовать оператор **require**, не обеспечивающий такую же безопасность типов, как оператор **import**. Стоит ли загружать значительно больше кода для обеспечения дополнительной безопасности типов? Решать вам.

> [!NOTE] 
> Некоторые из методов Lodash включены в библиотеку **@microsoft/sp-lodash-subset**, входящую в состав SharePoint Framework. Прежде чем использовать Lodash, проверьте, нет ли нужного вам метода в библиотеке **@microsoft/sp-lodash-subset**. Она уже входит в состав SharePoint Framework, поэтому ее не требуется включать в пакет решения.

## <a name="see-also"></a>См. также

- [Обзор SharePoint Framework](../sharepoint-framework-overview.md)