---
title: "OneDrive для бизнеса настройки в объектная модель SharePoint"
ms.date: 11/03/2017
ms.openlocfilehash: 321dd53b1c8040318069edbbc4471bf47c27c7f2
ms.sourcegitcommit: 65e885f547ca9055617fe0871a13c7fc85086032
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/06/2017
---
<a name="onedrive-for-business-customization-in-the-sharepoint-add-in-model"></a><span data-ttu-id="7ef4a-102">OneDrive для бизнеса настройки в объектная модель SharePoint</span><span class="sxs-lookup"><span data-stu-id="7ef4a-102">OneDrive for Business customization in the SharePoint add-in model</span></span>
==================================================================

<a name="summary"></a><span data-ttu-id="7ef4a-103">Summary</span><span class="sxs-lookup"><span data-stu-id="7ef4a-103">Summary</span></span>
-------

<span data-ttu-id="7ef4a-104">Выбор подхода для настройки OneDrive для бизнеса сайтов в новой модели надстройки SharePoint отличаться от полного доверия кодом.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-104">The approach you take to customize OneDrive for Business sites in the new SharePoint Add-in model is different than it was with Full Trust Code.</span></span>  <span data-ttu-id="7ef4a-105">В типичных полного доверия кода (FTC) / сценарий решения фермы, задания таймера SharePoint были созданы с помощью объектной модели SharePoint Server со стороны кода, развернутые с помощью решений фермы и управления в веб-сайта центра администрирования SharePoint.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-105">In a typical Full Trust Code (FTC) / Farm Solution scenario, SharePoint Timer Jobs were created with the SharePoint Server Side Object Model code, deployed via Farm Solutions and managed in the SharePoint Central Administration web site.</span></span>  <span data-ttu-id="7ef4a-106">SharePoint обрабатывает планирование и выполнение задания таймера в этом сценарии.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-106">SharePoint handles both the scheduling and the execution of the timer job in this scenario.</span></span> 

<span data-ttu-id="7ef4a-107">В SharePoint надстройки модели сценарии задания таймера создаются и вне SharePoint.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-107">In an SharePoint Add-in model scenario, timer jobs are created and scheduled outside of SharePoint.</span></span>  <span data-ttu-id="7ef4a-108">SharePoint не отвечает за планирование и выполнение задания таймера в этом сценарии.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-108">SharePoint is not responsible for the scheduling or the execution of the timer job in this scenario.</span></span>

<a name="why-would-you-customize-onedrive-for-business-sites"></a><span data-ttu-id="7ef4a-109">Почему бы настроить OneDrive для бизнеса сайтов</span><span class="sxs-lookup"><span data-stu-id="7ef4a-109">Why would you customize OneDrive for Business sites?</span></span>
----------------------------------------------------
<span data-ttu-id="7ef4a-110">Существует множество различных аспектов на применение параметров к OneDrive для бизнеса (OD4B) сайтов.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-110">There are numerous different aspects on applying customization to OneDrive for Business (OD4B) sites.</span></span> <span data-ttu-id="7ef4a-111">Эти сайты определенно можно настроить параметры с момента их сайты SharePoint, но в то же время всегда необходимо учитывать влияние короткие и длинные терминов настройки.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-111">You certainly can customize these sites, since they are SharePoint sites, but at the same time you should always consider the short and long term impact of the customization.</span></span>

<a name="high-level-guidelines"></a><span data-ttu-id="7ef4a-112">Рекомендации по высокого уровня</span><span class="sxs-lookup"><span data-stu-id="7ef4a-112">High Level Guidelines</span></span>
---------------------

<span data-ttu-id="7ef4a-113">Как правило эскиз мы хотели бы предоставить со следующими рекомендациями высокого уровня для настройки сайтов OD4B.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-113">As a rule of a thumb, we would like to provide the following high level guidelines for customizing OD4B sites.</span></span>

- <span data-ttu-id="7ef4a-114">Применение фирменной настройки, с помощью Office 365 тем или модуль темы сайта SharePoint</span><span class="sxs-lookup"><span data-stu-id="7ef4a-114">Apply branding customization using Office 365 themes or SharePoint site theming engine</span></span>
- <span data-ttu-id="7ef4a-115">Обработчики темы, не достаточно, можно настроить некоторые параметры CSS с помощью альтернативного варианта CSS</span><span class="sxs-lookup"><span data-stu-id="7ef4a-115">If theme engines are not enough, you can adjust some CSS settings using alternate CSS option</span></span>
- <span data-ttu-id="7ef4a-116">Избегайте Настройка OD4B сайтов, с помощью настраиваемых главных страниц, так как это приведет к вам дополнительные долгосрочные затраты и проблемы, связанные с будущими обновлениями</span><span class="sxs-lookup"><span data-stu-id="7ef4a-116">Avoid customizing OD4B sites using custom master pages, since this will cause you additional long term costs and challenges with future updates</span></span>
    + <span data-ttu-id="7ef4a-117">В большинстве случаев можно достичь все распространенные сценарии фирменной настройки с тем и альтернативной таблицы CSS, поэтому это не действительно, ограничивающим фактором</span><span class="sxs-lookup"><span data-stu-id="7ef4a-117">In most of the cases, you can achieve all common branding scenarios with themes and alternate CSS, so this is not really that limiting factor</span></span>
    + <span data-ttu-id="7ef4a-118">Если вы решили использовать настраиваемые главные страницы, подготовленного для применения изменений на веб-сайты, когда основные функциональные обновления применяются к Office 365</span><span class="sxs-lookup"><span data-stu-id="7ef4a-118">If you chose to use custom master pages, be prepared on applying changes to the sites when major functional updates are applied to Office 365</span></span>
- <span data-ttu-id="7ef4a-119">Можно использовать JavaScript, внедрение для изменения или скрыть функциональные возможности на сайте</span><span class="sxs-lookup"><span data-stu-id="7ef4a-119">You can use JavaScript embedding to modify or hide functionality in the site</span></span>
- <span data-ttu-id="7ef4a-120">CSOM можно использовать для управления например языка и региональных параметров на сайтах OD4B (увидеть [новые интерфейсы API](http://blogs.msdn.com/b/vesku/archive/2014/12/15/latest-api-updates-in-client-side-object-model-dec-2014-cu-for-sp2013.aspx))</span><span class="sxs-lookup"><span data-stu-id="7ef4a-120">You can use CSOM to control for example language or regional settings in the OD4B sites (see [new APIs](http://blogs.msdn.com/b/vesku/archive/2014/12/15/latest-api-updates-in-client-side-object-model-dec-2014-cu-for-sp2013.aspx))</span></span>
- <span data-ttu-id="7ef4a-121">Мы не рекомендуем использования типов контента и столбцы сайта на сайтах OD4B, чтобы избежать проблем с обязательные поля или другие элементы, которые могут вызвать проблемы, возникающие при обычной варианты с сайтами, OD4B</span><span class="sxs-lookup"><span data-stu-id="7ef4a-121">We do not recommend usage of content types and site columns in OD4B sites to avoid challenges with the required fields or other elements, which could cause issues for normal use cases with OD4B sites</span></span>
    + <span data-ttu-id="7ef4a-122">Представить OD4B сайтов как для личного неструктурированных данных и документов.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-122">Think OD4B sites as for personal unstructured data and documents.</span></span> <span data-ttu-id="7ef4a-123">Сайты рабочих групп и совместной работы документа, а затем для данных компании и документов, где можно определенно использовать любые политики управления сведениями и метаданных.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-123">Team sites and collaboration sits are then for company data and documents where you can certainly use whatever information management policies and metadata you want.</span></span>

<span data-ttu-id="7ef4a-124">В сводке настройки определенно поддерживается в Office 365 и вы можно хранить в их использования с сайтами, OD4B.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-124">As a summary, customization is definitely supported in Office 365 and you can keep on using them with OD4B sites.</span></span> <span data-ttu-id="7ef4a-125">Только что действительно необходимо рассмотреть влияние на короткие и длинные терминов Перспектива обслуживания и настройки из эксплуатации.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-125">We just truly want to ensure that you consider the short and long term impact of the customization from operational and maintenance perspective.</span></span> <span data-ttu-id="7ef4a-126">Это не конкретно для SharePoint, а не как правило для построения решения любой ИТ с любой платформы.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-126">This is not really specific for SharePoint, rather a rule of thumb for any IT solution build with any platform.</span></span>

<span data-ttu-id="7ef4a-127">Ниже приведен пример OD4B узла, который был настроен с помощью выше рекомендаций.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-127">Here’s an example of OD4B site, which has been customized using above guidelines.</span></span> <span data-ttu-id="7ef4a-128">В этом случае конечный результат достигнут с тем Office 365, тему сайта и использование так называемое JavaScript, внедрение шаблон.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-128">In this case the end result has been achieved with combination of Office 365 themes, site theme and usage of so called JavaScript embedding pattern.</span></span>

![Представление по завершении работы пользовательского OD4B сайта.](media/Recipes/OD4BCustomization/OD4B-branded.png)

<a name="challenge-with-applying-onedrive-for-business-site-customizations"></a><span data-ttu-id="7ef4a-130">Вызов с применение OneDrive для настройки сайта бизнеса</span><span class="sxs-lookup"><span data-stu-id="7ef4a-130">Challenge with applying OneDrive for Business site customizations</span></span>
-----------------------------------------------------------------

<span data-ttu-id="7ef4a-131">Начнем с определения возможности проблемой и что мы пытаетесь решить здесь.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-131">Let’s start with defining what is the challenge and what are we trying to solve here.</span></span> <span data-ttu-id="7ef4a-132">Технически каждого OneDrive для бизнеса сайта в текущий момент использует идентичные архитектуры как личные или личные узлы, используемые в SharePoint 2007 или 2010 версии.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-132">Technically each OneDrive for Business site is currently using identical architecture as what the personal or my sites used  back in SharePoint 2007 or 2010 version.</span></span> <span data-ttu-id="7ef4a-133">Это означает, технически каждого OneDrive для бизнеса сайта является собственные семейства веб-сайтов и мы не можем любой централизованное расположение для применения фирменной настройки или другие настроек.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-133">This means that technically each OneDrive for Business site is their own site collection and we do not have any centralized location to apply branding or any other customizations.</span></span>

![Каждый OneDrive для бизнеса сайта — это собственный семейства сайтов в разделе личные управляемого пути и каждого URL-адреса создан на основе профилей пользователей.](media/Recipes/OD4BCustomization/OD4B-topolgy.png)

<span data-ttu-id="7ef4a-136">Классический решение, которое требуется применить необходимые настройки в OneDrive для бизнеса сайты (включая Мои или личные сайты) основана на [ассоциации возможности на уровне фермы](http://cks.codeplex.com/releases/view/2824).</span><span class="sxs-lookup"><span data-stu-id="7ef4a-136">Classic solution to apply needed configuration to the OneDrive for Business sites (including my or personal sites) was based on [feature stapling in farm level](http://cks.codeplex.com/releases/view/2824).</span></span> <span data-ttu-id="7ef4a-137">Это означает, что вы развернуть решение фермы в ферме SharePoint используется структура компонентов для связи вашего пользовательского компонента активируется при каждом создано личный сайт, которой затем отвечал применения необходимых настроек.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-137">This meant that you deployed farm solution to your SharePoint farm and used feature framework to associate your custom feature to be activated each time a my site is crated, which was then responsible of applying needed customizations.</span></span> <span data-ttu-id="7ef4a-138">Такой же подход не работает в Office 365, поскольку требуется следует развертывать решение фермы и это невозможно просто с сайтами на Office 365.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-138">This similar approach does not work in Office 365, since it requires farm solution to be deployed and that is simply impossible with Office 365 sites.</span></span> <span data-ttu-id="7ef4a-139">Поэтому мы должны выглядеть альтернативы для применения необходимые изменения на веб-сайты.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-139">Therefore we need to look alternatives to apply the needed changes to the sites.</span></span>

<span data-ttu-id="7ef4a-140">В Office 365 централизованного событие не возникает, который мы может присоединить наших пользовательского кода, чтобы при создании сайта OD4B.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-140">In Office 365 there is no centralized event raised, which we could attach our custom code to when OD4B site is created.</span></span> <span data-ttu-id="7ef4a-141">Это означает, что необходимо учитывать альтернативных решений будет весьма подходов модели приложения.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-141">This means that we need to think about alternative solutions, which is quite common with app model approaches.</span></span> <span data-ttu-id="7ef4a-142">Не войти на старой модели, подумайте, как добиться же конечный результат с помощью новые интерфейсы API и технологии.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-142">Do not get stuck on old models, think about how to achieve same end result using new APIs and technologies.</span></span> <span data-ttu-id="7ef4a-143">С точки зрения чисто требования, он не имеет значения как мы применить ее на веб-сайты, до тех пор, пока они применяются, поскольку не следует применять ассоциации возможности бизнес-требованиям, где о применении необходимо с помощью поддерживается независимо от существующих настроек Технические механизм.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-143">From pure requirement perspective, it does not really matter how we apply the customizations to the sites, as long as they are applied, since business requirement is not to use feature stapling, it’s about applying needed customizations using whatever supported technical mechanism.</span></span>

<a name="different-options-for-applying-customization"></a><span data-ttu-id="7ef4a-144">Различные варианты применения настройки</span><span class="sxs-lookup"><span data-stu-id="7ef4a-144">Different options for applying customization</span></span>
============================================

<span data-ttu-id="7ef4a-145">На практике у нас есть четыре различных механизмов для применения централизованного развертывания сайтов OD4B в Office 365.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-145">In practice we do have four different mechanisms to apply centralized customization to OD4B sites in the Office 365.</span></span> <span data-ttu-id="7ef4a-146">Кроме того, можно вручную вариант, пятый, но в случае необходимости сотни или тысячи OD4B сайтов, с помощью вручную параметры не действительно реалистичной параметр.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-146">You could also consider manual option as the fifth one, but in the case of having hundreds or thousands of OD4B sites, using manual options is not really a realistic option.</span></span> <span data-ttu-id="7ef4a-147">Вот различных параметрах, у нас есть.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-147">Here’s the different options we have.</span></span>

1. <span data-ttu-id="7ef4a-148">Office 365 набора параметров уровня (Office 365 темы и другие параметры)</span><span class="sxs-lookup"><span data-stu-id="7ef4a-148">Office 365 suite level settings (Office 365 themes and other settings)</span></span>
2. <span data-ttu-id="7ef4a-149">Веб-часть скрытые приложения с помощью контекста пользователя</span><span class="sxs-lookup"><span data-stu-id="7ef4a-149">Hidden app part with user context</span></span>
3. <span data-ttu-id="7ef4a-150">Предварительное создание и применение конфигурации</span><span class="sxs-lookup"><span data-stu-id="7ef4a-150">Pre-create and apply configuration</span></span>
4. <span data-ttu-id="7ef4a-151">Задание таймера удаленного, на основании изменения профиля пользователя</span><span class="sxs-lookup"><span data-stu-id="7ef4a-151">Remote timer job based on user profile updates</span></span>

<span data-ttu-id="7ef4a-152">Все параметры имеют преимущества и недостатки в их и правом параметр зависит от подробные бизнес-требования.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-152">Each of the options have advantages and disadvantages in them and the right option depends on your detailed business requirements.</span></span> <span data-ttu-id="7ef4a-153">Некоторые параметры применяются на уровне набора приложений Office 365, но часто может нужна некоторые дополнительные особенности, необходимых действительных настроек.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-153">Some of the settings you can also apply from the Office 365 suite level, but often you would be looking for some more specifics, so actual customizations are needed.</span></span> <span data-ttu-id="7ef4a-154">Очевидно, что все сводится на точное требования и вариантов анализа бизнеса на их влияние на короткие и длинные терминов.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-154">It obviously all comes down on exact requirements and business case analyses on their impact on short and long term.</span></span>

<a name="office-365-suite-level-settings"></a><span data-ttu-id="7ef4a-155">Параметры уровня набора приложений Office 365</span><span class="sxs-lookup"><span data-stu-id="7ef4a-155">Office 365 suite level settings</span></span>
-------------------------------

<span data-ttu-id="7ef4a-156">Office 365 — это не только SharePoint, как вы знаете.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-156">Office 365 is much more than just SharePoint, like you know.</span></span> <span data-ttu-id="7ef4a-157">Можно найти более дополнительные службы, которые не основаны на даже архитектуры SharePoint, как Delve, Yammer и многие предстоящие службы.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-157">You can find more and more additional services which are not based on even the SharePoint architecture, like Delve, Yammer and many upcoming services.</span></span> <span data-ttu-id="7ef4a-158">Это означает, что корпоративной фирменной символики и конфигурации не используется только для управления имеют на сайтах SharePoint, а мы следует подумать общий конечного пользователя взаимодействия и как мы предоставляем согласованные конфигурации пересекать различных служб.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-158">This means that the enterprise branding and configuration is not just about controlling what we have in the SharePoint sites, rather we should be thinking the overall end user experience and how we provide consistent configurations cross different services.</span></span>

<span data-ttu-id="7ef4a-159">Фирменная символика классический пример этим требованиям предприятия и для, у нас есть еще темы Office 365 введена, которую можно использовать для управления определенный уровень фирменной символики.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-159">Classic example of these enterprise requirements is branding and for that we have already Office 365 theming introduced, which can be used to control some level of branding.</span></span> <span data-ttu-id="7ef4a-160">У нас есть также других новыми возможностями, которые позволяют управлять вашего сайта управления и другие параметры из централизованное расположение за пределами параметры семейства сайтов, как предстоящие центре соответствия требованиям для Office 365, которая указана в настоящее время в [ Схема для Office 365](http://office.microsoft.com/en-us/products/office-365-roadmap-FX104343353.aspx).</span><span class="sxs-lookup"><span data-stu-id="7ef4a-160">We have also other upcoming features, which will help to control your site governance and other settings, from centralized location outside of the site collection settings, like the upcoming Compliance Center for Office 365, which is currently listed in the [Office 365 roadmap](http://office.microsoft.com/en-us/products/office-365-roadmap-FX104343353.aspx).</span></span>

<span data-ttu-id="7ef4a-161">На рисунке ниже показаны различные параметры на данный момент темы Office 365, который затем применяется на нескольких всех служб Office 365.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-161">Following picture shows the different settings right now for the Office 365 theming, which will be then applied cross all Office 365 services.</span></span>

![Сайт отображает Office 365, отображение вкладки настраиваемой темы, право управление пользовательских тем для вашей организации, Настройка Office 365 в соответствии с марки вашей организации.](media/Recipes/OD4BCustomization/O365-theme-settings.png)

<span data-ttu-id="7ef4a-164">Поскольку по умолчанию параметры темы Office 365, для управления панель набора OD4B сайта, вероятнее всего использовании этого параметра вместе с другими вариантами чтобы убедиться, что можно указать по крайней мере правом элементы фирменной настройки кросс-OD4B сайтов.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-164">Since by default Office 365 theme settings are for controlling OD4B site suite bar, you will most likely be using this options together with other options to ensure that you can provide at least the right branding elements cross your OD4B sites.</span></span> <span data-ttu-id="7ef4a-165">Обратите внимание на то, что при внесении изменений для примера настройки темы Office 365 в средство администрирования Office 365, занимает весьма много времени для получения параметров, примененных для сайтов OD4B, поэтому быть Терпение.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-165">Notice that when you change for example Office 365 theme settings in Office 365 admin tool, it does take a quite a long time to get the settings applied for OD4B sites, so be patience.</span></span>

<a name="hidden-app-part-with-user-context"></a><span data-ttu-id="7ef4a-166">Веб-часть скрытые приложения с помощью контекста пользователя</span><span class="sxs-lookup"><span data-stu-id="7ef4a-166">Hidden app part with user context</span></span>
---------------------------------

<span data-ttu-id="7ef4a-167">Это подход, в которых использование централизованного целевая страница по для начала необходимые настройки.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-167">This is an approach where use centralized landing page as the location for starting the needed customization process.</span></span> <span data-ttu-id="7ef4a-168">Это означает, что необходимо иметь один централизованное расположение, как страница переднего интрасети компании, где пользователи всегда Главная при открытии их браузера.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-168">This means that you would have to have one centralized location, like company intranet front page, where the users are always landing when they open up their browser.</span></span> <span data-ttu-id="7ef4a-169">Это очень типовой процесс с среднего и более крупным предприятиям где корпоративной целевая страница — это, затем управляются с помощью параметров групповой политики в AD.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-169">This is pretty typical process with midsized and larger enterprises where corporate landing page is then controlled using group policy settings in the AD.</span></span> <span data-ttu-id="7ef4a-170">Это гарантирует, что конечные пользователи не могут переопределить начальная страница по умолчанию браузеров домену компании.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-170">This will ensure that end users cannot override default welcome page of the company domain joined browsers.</span></span>

<span data-ttu-id="7ef4a-171">Когда пользователь попадает в интрасети, мы будет скрытым веб-части приложения в страницы, который будет запущен процесс настройки.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-171">When user arrives to the intranet, we will have hidden app part in the page, which will start the customization process.</span></span> <span data-ttu-id="7ef4a-172">Его можно фактически отвечает всей OD4B создания сайтов также, так как обычно пользователь должен будет узле OD4B времени, прежде чем будет запущен процесс создания сайта.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-172">It can actually be responsible of the whole OD4B site creation as well, since normally user would have to visit the OD4B site once time, before the site creation process will be started.</span></span> <span data-ttu-id="7ef4a-173">Веб-часть приложения скрытых фактически размещается на страницу с размещением у поставщика приложений, размещенных в Azure.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-173">Hidden app part is actually hosting a page from provider hosted app hosted in Azure.</span></span> <span data-ttu-id="7ef4a-174">На этой странице отвечает затем начальных процесс настройки.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-174">This page is then responsible of starting the customization process.</span></span>

<span data-ttu-id="7ef4a-175">Взглянем более подробно на логической структуры этого подхода.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-175">Let’s have a closer look on the logical design of this approach.</span></span>

![Схема для отображения отношений.](media/Recipes/OD4BCustomization/hidden-app-part-logical-diagram.png)

1. <span data-ttu-id="7ef4a-181">Поместите веб-часть приложения скрытых централизованного сайт, где будет располагаться конечных пользователей.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-181">Place hidden app part to centralized site where end users will land.</span></span> <span data-ttu-id="7ef4a-182">Обычно это на первой странице корпоративной интрасети.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-182">Typically this is the corporate intranet front page.</span></span>
2. <span data-ttu-id="7ef4a-183">Веб-часть приложения размещается на страницу с размещением у поставщика приложений, где в кода на стороне сервера мы начать процесс настройки, добавив необходимые метаданные в очередь хранилища azure.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-183">App part is hosting a page from provider hosted app, where in the server side code we initiate the customization process by adding needed metadata to the azure storage queue.</span></span> <span data-ttu-id="7ef4a-184">Это означает, что только будет получать запрос настройки на этой странице, но фактически не применяется все изменения для хранения обычных времени обработки.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-184">This means that this page will only receive the customization request, but will not actually apply any changes to keep the processing time normal.</span></span>
3. <span data-ttu-id="7ef4a-185">Это очереди azure хранения, который будет получать сообщений в очередь для обработки.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-185">This is the actual azure storage queue, which will receive the messages to queue for processing.</span></span> <span data-ttu-id="7ef4a-186">На первой странице интрасети остается таким образом, мы может обрабатывать настройки асинхронно управление процесса, чтобы он не имеет значения как долго конечного пользователя.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-186">This way we can handle the customization controlling process asynchronously so that it does not really matter how long end user will stay on the front page of the Intranet.</span></span> <span data-ttu-id="7ef4a-187">Если процесс настройки может быть синхронные, мы бы зависит от конечного пользователя для оставьте браузер открытым на странице переднего интрасети только после завершения выполнения страницы.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-187">If the customization process would be synchronous, we would be dependent on end user to keep the browser open in the Intranet front page until page execution is finalized.</span></span> <span data-ttu-id="7ef4a-188">Это не будет определенно оптимальной и была проблемой с [исходной OD4B процессе настройки](http://blogs.msdn.com/b/vesku/archive/2013/11/25/office365-apply-automatically-custom-branding-to-personal-site-skydrive-pro.aspx), которых я блоге во время отказа.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-188">This would not definitely be optimal and it was the challenge with the [original OD4B customization process](http://blogs.msdn.com/b/vesku/archive/2013/11/25/office365-apply-automatically-custom-branding-to-personal-site-skydrive-pro.aspx), which I blogged while back.</span></span>
4. <span data-ttu-id="7ef4a-189">WebJob подключен к выполните очереди хранилища, который вызывается, когда новый элемент ставится в очередь хранилища.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-189">WebJob hooked to follow the storage queue, which is called when new item is placed to the storage queue.</span></span> <span data-ttu-id="7ef4a-190">В этом WebJob будет получать необходимые параметры и метаданные из сообщения в очереди для доступа к коллекции правом сайта.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-190">This WebJob will receive the needed parameters and metadata from the queued message to access right site collection.</span></span> <span data-ttu-id="7ef4a-191">WebJob с помощью приложения только маркеров и предоставлены необходимые разрешения для работы с семейств веб-сайтов на уровне клиента.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-191">WebJob is using app only token and have been granted the needed permissions to manipulate site collections in the tenant level.</span></span>
5. <span data-ttu-id="7ef4a-192">Действительных настроек, примененные по одному на сайты тем пользователям, у которых посетите страницу переднего интрасети для начала процесса.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-192">Actual customizations are applied one-by-one to those people’s sites who visit the intranet front page to start the process.</span></span>
<span data-ttu-id="7ef4a-193">Это определенно самый надежный процесс становится правой конфигураций на сайтах OD4B.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-193">This is definitely the most reliable process of ensuring that there’s right configurations in the OD4B sites.</span></span> <span data-ttu-id="7ef4a-194">Логика настройки управления версиями можно легко добавить к процессу, который также применяет все необходимые обновления сайтов OD4B, при необходимости обновления и посещении на первой странице интрасети следующий раз.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-194">You can easily add customization versioning logic to the process, which is also applying any needed updates to the OD4B sites, when there is an update needed and user visits the Intranet front page next time.</span></span> <span data-ttu-id="7ef4a-195">Этот параметр, однако требуют наличия этого централизованное расположение, где главная конечных пользователей.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-195">This option does however require that you have that centralized location where your end users are landing.</span></span>

<span data-ttu-id="7ef4a-196">Если вы знакомы классический моделей разработки SharePoint с решениями для фермы, это очень аналогичный процесс как один раз, выполнение задания таймера.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-196">If you are familiar of classic SharePoint development models with farm solutions, this is pretty similar process as one time executing timer jobs.</span></span>

<a name="pre-create-and-apply-configuration"></a><span data-ttu-id="7ef4a-197">Предварительное создание и применение конфигурации</span><span class="sxs-lookup"><span data-stu-id="7ef4a-197">Pre-create and apply configuration</span></span>
----------------------------------

<span data-ttu-id="7ef4a-198">Этот параметр использует перед созданием сайтов OD4B перед пользователи будут получать доступ к их.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-198">This option relies on the pre-creation of the OD4B sites before users will access them.</span></span> <span data-ttu-id="7ef4a-199">Это можно сделать с помощью [относительно новых API](https://github.com/SharePoint/PnP/tree/master/Samples/Provisioning.OneDriveProvisioning) содержащей "мне нравится" нет на месте для создания сайтов OD4B для конкретных пользователей в процесс пакетной обработки с помощью CSOM или REST.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-199">This can be achieved by using [relatively new API](https://github.com/SharePoint/PnP/tree/master/Samples/Provisioning.OneDriveProvisioning) which provides us away to create OD4B sites for specific users in batch process, using either CSOM or REST.</span></span> <span data-ttu-id="7ef4a-200">Требуется код может запускаться с помощью скрипта PowerShell или путем написания фактический код, который вызывает API удаленного.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-200">Needed code can be initiated using a PowerShell script or by writing actual code which is calling the remote APIs.</span></span>

![Администраторы используют, предварительное создание и настройка для создания сайта OD4B.](media/Recipes/OD4BCustomization/pre-create-and-apply.png)

1. <span data-ttu-id="7ef4a-202">Администратор с помощью удаленного создания API-интерфейсы для создания сайтов OD4B для пользователей и применяет необходимых настроек сайтов OD4B как часть процесса скрипта.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-202">Administrator is using the remote creation APIs to create OD4B sites for users and is applying the needed customizations to the OD4B sites as part of the script process.</span></span>
2. <span data-ttu-id="7ef4a-203">Фактический OD4B сайтов создаются в Office 365 для конкретных пользователей и связанных профилей</span><span class="sxs-lookup"><span data-stu-id="7ef4a-203">Actual OD4B sites are created to the Office 365 for specific users and associated to their user profiles</span></span>

<span data-ttu-id="7ef4a-204">В некотором смысле это действительно надежный процесс, но необходимо управлять новых лиц и обновления «вручную» которого означает больше работы, затем с помощью подхода *веб-части скрытых приложения* .</span><span class="sxs-lookup"><span data-stu-id="7ef4a-204">In some sense this is also really reliable process, but you would have to manage new persons and updates “manually”, which could mean more work then using the *hidden app part* approach.</span></span> <span data-ttu-id="7ef4a-205">Это определенно допустимый подход, который может быть съемки и особенно полезна, если выполняется миграция некоторые другие решения для OD4B общего доступа к файлам и хотите избежать необходимости конечных пользователей для доступа к сайту OD4B один раз, до начала создания сайтов фактических данных.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-205">This is definitely valid approach which can be taken and especially useful if you are migrating from some other file sharing solution to the OD4B and want to avoid the need of end users to access the OD4B site once, before actuals site creation is started.</span></span>

<a name="remote-timer-job-based-on-user-profile-updates"></a><span data-ttu-id="7ef4a-206">Задание таймера удаленного, на основании изменения профиля пользователя</span><span class="sxs-lookup"><span data-stu-id="7ef4a-206">Remote timer job based on user profile updates</span></span>
----------------------------------------------

<span data-ttu-id="7ef4a-207">Этот подход означает, что сканирования через профилей пользователей для проверки, для которого был создан сайт OD4B, а затем применять изменения на веб-сайты, при необходимости.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-207">This approach means scanning through user profiles for checking to whom the OD4B site has been created and then apply the changes to the sites as needed.</span></span> <span data-ttu-id="7ef4a-208">Это означает, что запланированное задание под управлением за пределами SharePoint, которое будет периодически проверить состояние и выполнить необходимые настройки.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-208">This would mean scheduled job running outside of the SharePoint, which will periodically check the status and perform needed customizations.</span></span> <span data-ttu-id="7ef4a-209">Запланированное задание может быть работает как WebJob в Azure или просто сценарий PowerShell, запланированного в планировщик windows.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-209">Scheduled job could be running as a WebJob in Azure or as simple as PowerShell script scheduled in your own windows scheduler.</span></span> <span data-ttu-id="7ef4a-210">Очевидно, что масштаб развертывания имеет огромную воздействия на выбранный флажок.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-210">Obviously the scale of the deployment has huge impact on the chosen scheduling option.</span></span>

![Задание таймера удаленного использует, цикл по семейств веб-сайтов, для настройки каждого сайта.](media/Recipes/OD4BCustomization/remote-timer-job.png)

1. <span data-ttu-id="7ef4a-212">Запланированная задача инициируется которого будут получать доступ к профилям пользователей, для проверки того, кто имеет сайта OD4B подготовить к работе</span><span class="sxs-lookup"><span data-stu-id="7ef4a-212">Scheduled task is initiated which will access user profiles of the users for checking who has OD4B site provisioned</span></span>
2. <span data-ttu-id="7ef4a-213">Фактические сайты, настроенный с одной основанных на требованиях бизнеса</span><span class="sxs-lookup"><span data-stu-id="7ef4a-213">Actual sites are customized one-by-one based on the business requirements</span></span>

<span data-ttu-id="7ef4a-214">Одним из ключевых недостатков этого параметра является, что четко возможны ситуации, в котором пользователь может получить доступ сайты OD4B до применения настроек.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-214">One of the key downsides of this option is that there can clearly be a situations where user can access the OD4B sites before the customizations have been applied.</span></span> <span data-ttu-id="7ef4a-215">В то же время этот параметр используется интересных дополнительный компонент для других параметры, чтобы убедиться, что конечные пользователи не были изменены любые необходимые параметры на сайтах или для проверки содержимого узла OD4B коммерческим политик компании.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-215">At the same time this option is interesting add-on for other options to ensure that end users have not changed any of the required settings on the sites or to check that the OD4B site content aligns with the company policies.</span></span>

<a name="enhanced-app-part-based-customization"></a><span data-ttu-id="7ef4a-216">Веб-часть расширенного приложения на основе настройки</span><span class="sxs-lookup"><span data-stu-id="7ef4a-216">Enhanced app part based customization</span></span>
-------------------------------------

<span data-ttu-id="7ef4a-217">Здесь более подробное описание расширенные приложения части на основе настроек, в которой кажется необходимые настройки сайтов OD4B типичный подход для применения и управления ими.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-217">Here's more detailed description of enhanced app part based customizations, which seems to be the typical approach for applying and managing needed customizations to the OD4B sites.</span></span> <span data-ttu-id="7ef4a-218">Исходного кода и Дополнительные сведения об этом решении доступен из [руководство и рекомендации и шаблоны для разработчиков Office 365](http://aka.ms/officedevpnp).</span><span class="sxs-lookup"><span data-stu-id="7ef4a-218">Source code and additional details on this solution is available from the [Office 365 Developer Patterns and Practices guidance](http://aka.ms/officedevpnp).</span></span>

<span data-ttu-id="7ef4a-219">Фактические логической структуры следует подход часть скрытые приложения, упоминалось ранее в [этой записи блога](http://blogs.msdn.com/b/vesku/archive/2013/11/25/office365-apply-automatically-custom-branding-to-personal-site-skydrive-pro.aspx).</span><span class="sxs-lookup"><span data-stu-id="7ef4a-219">Actual logical design follows the hidden app part approach, mentioned before in [this blog post](http://blogs.msdn.com/b/vesku/archive/2013/11/25/office365-apply-automatically-custom-branding-to-personal-site-skydrive-pro.aspx).</span></span> <span data-ttu-id="7ef4a-220">Это означает, что подразумевается, что централизованного интрасети в среде office 365, где размещен веб-части необходимые приложения и будет, что главная конечных пользователей для этой страницы при открытии их браузера.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-220">This means that the assumption is that you have centralized Intranet in the office 365 environment where you can put the needed app part and that the end users will be landing to this welcome page when they open up their browser.</span></span> <span data-ttu-id="7ef4a-221">Чаще всего у каждого браузера компании же домашней страницы, задаются с помощью групповой политики, чтобы конечные пользователи всегда начинается из одного расположения централизованного при открытии их браузера.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-221">It is common that each company browser will have same home page set using group policies, so that end users will always start from one centralized location when they open up their browser.</span></span> <span data-ttu-id="7ef4a-222">Это расположение, где находится веб-часть приложения, который может иметь значение размера как 0 пиксель ширины и высоты.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-222">This is the location where you’d put app part, which can be set to be sized as 0 pixel width and height.</span></span> <span data-ttu-id="7ef4a-223">Здесь суть использовать контекст конечного пользователя для выполнения веб-части приложения, который содержит страницу из надстройки размещением у поставщика.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-223">Key point here is that you use the end user context to execute the app part, which contains page from the provider hosted add-in.</span></span>

<span data-ttu-id="7ef4a-224">**Рекомендации по оптимизации и обслуживание производительности**</span><span class="sxs-lookup"><span data-stu-id="7ef4a-224">**Performance optimization and maintenance considerations**</span></span>

<span data-ttu-id="7ef4a-225">Поскольку эта веб-часть приложения будет выполняться каждый раз пользователь перемещает к началу страницы интрасети, необходимо учитывать влияет на производительность this или как сделать кода для эффективной работы и ключевые элементы выполнение кода, когда это действительно необходимо выполнять только.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-225">Since this app part will be executed each time user lands to front page of the intranet, we need to consider the performance impact of this or how to make the code to work efficiently and only perform key parts of the code executions when truly needed.</span></span> <span data-ttu-id="7ef4a-226">Во-вторых оптимизации также является где мы поместить фактические ресурсы, которые используются в каждой из этих сайтах.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-226">Second optimization consideration is also where do we place actual assets which are used in each of the sites.</span></span> <span data-ttu-id="7ef4a-227">Это довольно типичные задачи к решению с копирование настроек.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-227">These are pretty typical challenges to tackle with any customizations.</span></span> <span data-ttu-id="7ef4a-228">Ниже приведен список short факторы, которые рассматриваются в реализации модели приложения.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-228">Here’s short list of things to concentrate in app model implementations.</span></span>

- <span data-ttu-id="7ef4a-229">Расположение средств – централизованного сети (CDN) решение, в каждом семействе сайтов или в корневого семейства веб-сайтов?</span><span class="sxs-lookup"><span data-stu-id="7ef4a-229">Location of the assets – centralized content delivery network (CDN) solution, in each site collection or in root site collection?</span></span>
- <span data-ttu-id="7ef4a-230">Обновление скорости активами или как убедиться, что независимо от того, кэширование браузера на стороне клиента мы можно убедитесь, что мы выполнения последних версий скриптов (JavaScript) или отображение последние версии изображений?</span><span class="sxs-lookup"><span data-stu-id="7ef4a-230">Refresh rate of the assets or how to ensure that regardless of client side browser caching we can ensure that we execute latest versions of the scripts (JavaScript) or show the latest versions of the images?</span></span>
- <span data-ttu-id="7ef4a-231">Сокращение выполнения кода, чтобы избежать лишних нагрузку так, чтобы служба Office 365 и Azure</span><span class="sxs-lookup"><span data-stu-id="7ef4a-231">Reduced execution of code to avoid unnecessary load to Azure and Office 365 service</span></span>
- <span data-ttu-id="7ef4a-232">Версия настройки, применяемые к OD4B сайта</span><span class="sxs-lookup"><span data-stu-id="7ef4a-232">Version customizations which are applied to OD4B site</span></span>

<span data-ttu-id="7ef4a-233">**Расположение активами**</span><span class="sxs-lookup"><span data-stu-id="7ef4a-233">**Location of the assets**</span></span>

<span data-ttu-id="7ef4a-234">Существует несколько различных решений для этого.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-234">There are few different solutions for this.</span></span> <span data-ttu-id="7ef4a-235">В коде ссылку примере мы используем внедрения JavaScript в каждой из OD4B-сайтов для обеспечения компании сообщение политики и удаление возможность создания sub-сайтов (или скрыть ссылку).</span><span class="sxs-lookup"><span data-stu-id="7ef4a-235">In the reference code example we use JavaScript embedding in each of the OD4B sites to provide company policy message and to remove the possibility to create sub sites (or hide the link).</span></span> <span data-ttu-id="7ef4a-236">В этом конкретного решения мы Отправка нужный файл JavaScript для корневого семейства сайтов onedrive для бизнеса адрес схемы и напрямую из этого одного расположения в отдельных сайтов OD4B мы ссылку на этот файл.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-236">In this particular solution we are uploading the needed JavaScript file to root site collection of the OneDrive for Business address scheme and we reference that file directly from that one location in the individual OD4B sites.</span></span> <span data-ttu-id="7ef4a-237">Это означает, что имеется только одного расположения для обслуживания и обновления файла JavaScript, при необходимости все изменения.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-237">This means that you only have one location to maintain and update the JavaScript file, if any changes are needed.</span></span>

<span data-ttu-id="7ef4a-238">В этом Эталонная реализация мы фактически также обновить файл при каждом выполнении WebJob, которой определенно не требуется, но пример кода был должен быть рабочее так же легко, без любые дополнительные действия и возможные.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-238">In this reference implementation we actually also refresh this file each time the WebJob is executed, which is certainly not needed, but sample code was meant to be working as easily without any additional steps and possible.</span></span> <span data-ttu-id="7ef4a-239">Точно так же вы отправляете файл JavaScript вручную для корневого семейства веб-сайтов, а затем задайте ссылки, из него.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-239">Just as well you could upload the JavaScript file manually to root site collection and then reference that from there.</span></span> <span data-ttu-id="7ef4a-240">Альтернативного решения можно также использовать некоторые CND для хранения нужный файл или ссылки JavaScript из приложения с размещением у поставщика стороны.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-240">Alternative solution would be also to use some CND to store the needed file or reference JavaScript from the provider hosted app side.</span></span> <span data-ttu-id="7ef4a-241">Если у вас есть только одну копию файла, будут иметь</span><span class="sxs-lookup"><span data-stu-id="7ef4a-241">As long as you have only one copy of the file, you will have</span></span>

![Каждый OneDrive для бизнеса сайта — это собственный семейства сайтов в разделе личные управляемого пути и каждого URL-адреса создан на основе профилей пользователей.](media/Recipes/OD4BCustomization/asset-locations.png)

<span data-ttu-id="7ef4a-244">**Кэширование запросов и способы устранения, на стороне клиента**</span><span class="sxs-lookup"><span data-stu-id="7ef4a-244">**Client side caching challenge and how to solve that**</span></span>

<span data-ttu-id="7ef4a-245">Одной из проблем с реализацией на основе JavaScript на стороне клиента — кэширование.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-245">One of the challenges with JavaScript based implementation is client side caching.</span></span> <span data-ttu-id="7ef4a-246">Когда браузеры будет загрузить используемые файлы JavaScript, они будут кэширование эти файлы для сокращения объема загруженного активов для следующих запросов.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-246">When browsers will download used JavaScript files, they will cache those files to reduce the amount of downloaded assets for following requests.</span></span> <span data-ttu-id="7ef4a-247">Это очень полезно с точки зрения оптимизации производительности, но вызывает сложную задачу, когда необходимо обновить файл JavaScript.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-247">This is great from performance optimization perspective, but causes a challenge when we need to update the JavaScript file.</span></span> <span data-ttu-id="7ef4a-248">В наихудшем случай кэшированный файл JavaScript приведет к исключения с другими обновлениями, представленной в обновленной версии.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-248">In worst case scenario, cached JavaScript file will cause exceptions with other updates introduced with updated versions.</span></span>

<span data-ttu-id="7ef4a-249">Чтобы удалить эту проблему, можно начать, с помощью атрибута версии с помощью JavaScript URL-адрес ссылки.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-249">To remove this issue, we can start using revision attribute with JavaScript URL reference.</span></span> <span data-ttu-id="7ef4a-250">Когда мы связать пользовательского настраиваемого действия на сайте OD4B, мы включить URL-адрес JavaScript, чтобы уникальный идентификатор GUID в URL-адрес.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-250">When we associate user custom action to the OD4B site, we include the URL of the JavaScript to have unique GUID in the URL.</span></span> <span data-ttu-id="7ef4a-251">Ниже приведен пример ссылку, которая будет указывать на корневой сайт семейства веб-сайтов.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-251">Here’s example of the reference which will be pointing to the root site of the site collection.</span></span> <span data-ttu-id="7ef4a-252">Обратите внимание на то дополнительный идентификатор GUID, который был добавлен после атрибута rev в URL-адрес.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-252">Notice the additional GUID which has been added after the rev attribute in the URL.</span></span> <span data-ttu-id="7ef4a-253">Каждом выполнении настройщика для отдельного сайта OD4B, этот атрибут будет обновления.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-253">Each time the customizer will be executed for particular OD4B site, this attribute will be update.</span></span> <span data-ttu-id="7ef4a-254">На практике это означает, что этот файл JavaScript помещена в браузере до новой версии добавлен OD4B сайт, который будет изменять URL-адрес и поэтому браузера будет загрузить новую версию и кэширование, после следующего обновления.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-254">In practice this means that JavaScript file is cached to browser until there is a new version added to OD4B site, which will change the URL and therefore browser will download the new version and will cache that after the next update.</span></span>

- <span data-ttu-id="7ef4a-255">/OneDriveCustomization/OneDriveConfiguration.js?Rev=4bb89029e7ba470e893170d4cba7de00</span><span class="sxs-lookup"><span data-stu-id="7ef4a-255">/OneDriveCustomization/OneDriveConfiguration.js?rev=4bb89029e7ba470e893170d4cba7de00</span></span>

<span data-ttu-id="7ef4a-256">Ниже приведен код, который используется для формирования URL-адреса JavaScript для дополнительного действия пользователя.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-256">Here’s the code which is used to generate the JavaScript URL for the user custom action.</span></span>
    
    /// <summary>
    /// Just to build the JS path which can be then pointed to the OneDrive site.
    /// </summary>
    /// <returns></returns>
    public string BuildJavaScriptUrl(string siteUrl)
    {
        // Solve root site collection URL
        Uri url = new Uri(siteUrl);
        string scenarioUrl = String.Format("{0}://{1}:{2}/{3}", 
                               url.Scheme, url.DnsSafeHost, 
                               url.Port, JSLocationFolderName);
       // Unique rev generated each time JS is added, so that we force browsers to 
       // refresh JS file wiht latest version
       string revision = Guid.NewGuid().ToString().Replace("-", "");
       return string.Format("{0}/{1}?rev={2}", scenarioUrl, JSFileName, revision);
    }

<span data-ttu-id="7ef4a-257">**Сокращение выполнение кода**</span><span class="sxs-lookup"><span data-stu-id="7ef4a-257">**Reduced execution of code**</span></span>

<span data-ttu-id="7ef4a-258">Так как этот процесс основан на скрытых часть приложения на первой странице интрасети, он означает, что код будет выполняться каждый раз пользователь будет обновлять их браузера или они перейти на страницу.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-258">Since this process is based on having hidden app part on the front page of the Intranet, it will mean that the code will be executed each time user will refresh their browser or they move to the page.</span></span> <span data-ttu-id="7ef4a-259">Поскольку эта страница переднего часто настройке в качестве домашней страницы по умолчанию браузера для корпоративных пользователей, код будет выполняться каждый раз при запуске сеанса браузера.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-259">Since this front page is often set as the default browser home page for the corporate users, code would be executed each time a browser session is started.</span></span>

<span data-ttu-id="7ef4a-260">Поскольку мы тем не менее не обновлять процедура в первую очередь обновления настроек, применяемые к сайтам OD4B, что часто нет действительно точки запуск всей настройки.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-260">Since we do not however update the customizations which are applied to the OD4B sites that often, there’s really no point starting the whole customization update process in first place.</span></span> <span data-ttu-id="7ef4a-261">В этом случае мы сократить использования очередей хранения и выполнение задания web, который будет снизить расходы, связанные с размещением у поставщика приложения стороны, поскольку мы не будет использоваться как объем ресурсов ЦП и другие ресурсы, в нашем разработки.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-261">By doing this, we reduce the usage of the storage queues and the web job execution, which will directly reduce the costs associated on the provider hosted app side, since we will not use as much CPU and other resources in our design.</span></span>

<span data-ttu-id="7ef4a-262">Убедитесь, что наш обработка не выполняется на каждый запрос проще использовать классический браузер файла cookie, где будут храниться определенный файл cookie в клиентском браузере с помощью определенного срока.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-262">Easiest way to ensure that our processing is not performed in each request is to use classic browser cookie approach, where we will store specific cookie to client browser with specific life time.</span></span> <span data-ttu-id="7ef4a-263">Проверьте наличие этот файл cookie, мы можно пропустить выполнение, пока не истек файл cookie и тогда мы повторно проверьте состояние фактический настройки на веб-сайтах OD4B.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-263">By checking this cookie existence, we can skip the execution, until the cookie has been expired and that’s when we re-check the actual customization status in the OD4B sites.</span></span>

<span data-ttu-id="7ef4a-264">Вот, что у нас есть в метод load страницы для веб-части приложения.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-264">Here’s what we have in the page load method for the app part.</span></span> <span data-ttu-id="7ef4a-265">Этот вызов метода будет проверять наличие файла cookie, и если файл cookie существует, мы пропустит фактический бизнес код до выполнения снова необходимые.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-265">This method call will check existence of the cookie and if the cookie does exist, we will skip the actual business code until execution is again needed.</span></span>

    // Check if we should skip this check. We do this only once per hour to avoid 
    // perf issues and there's really no point even hitting the user profile 
    // in every request.
    if (CookieCheckSkip())
        return;

<span data-ttu-id="7ef4a-266">Фактический файл cookie состояния и параметров файла cookie выполняется следующим образом.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-266">Actual cookie status and setting of the cookie is done as follows.</span></span>

    /// <summary>
    /// Checks if we need to execute the code customization code again. 
    /// Timer set to 60 minutes to avoid constant execution of the code for nothing.
    /// </summary>
    /// <returns></returns>
    private bool CookieCheckSkip()
    {
        // Get cookie from the current request.
        HttpCookie cookie = Request.Cookies.Get("OneDriveCustomizerCheck");
    
       // Check if cookie exists in the current request.
       if (cookie == null)
       {
           // Create cookie.
           cookie = new HttpCookie("OneDriveCustomizerCheck");
           // Set value of cookie to current date time.
           cookie.Value = DateTime.Now.ToString();
           // Set cookie to expire in 60 minutes.
           cookie.Expires = DateTime.Now.AddMinutes(60);
           // Insert the cookie in the current HttpResponse.
           Response.Cookies.Add(cookie);
           // Output debugging information
           WriteDebugInformationIfNeeded(
               string.Format(@"Cookie did not exist, adding new cookie with {0} 
                               as expiration. Execute code.",
                               cookie.Expires));
           // Since cookie did not existed, let's execute the code, 
           // so skip is false.
           return false;
       }
       else
       {
           // Output debugging information
           WriteDebugInformationIfNeeded(string.Format(@"Cookie did existed, 
                                       with {0} as expiration. Skipping code.", 
                                       cookie.Expires));
           //  Since cookie did existed, let's skip the code
           return true;
       }
    }

<span data-ttu-id="7ef4a-267">При наличии внимательно на код на странице частей приложения вы увидите, при каждом вызове, что мы проверьте existences OD4B сайта для конечного пользователя.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-267">If you have a closer look on the code in the app part page, you’ll see that in every call we do check the existences of the OD4B site for the end user.</span></span> <span data-ttu-id="7ef4a-268">Поскольку только можно, обратившись к профиля пользователя, код будет иметь влияние на производительность.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-268">Since this can be only done by accessing user profile, code will have impact on the performance.</span></span> <span data-ttu-id="7ef4a-269">С помощью выше файл cookie для проверки, мы можно улучшить взаимодействия конечного пользователя, и мы избежать обращения к службе профилей пользователей постоянно без фактические требования.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-269">By using the above cookie check, we can make the end user experience better and we avoid hitting the user profile service constantly without actual requirements.</span></span> <span data-ttu-id="7ef4a-270">Также рекомендуется Обратите внимание на то, что мы размещен этот файл cookie для проверки в качестве первого шага в метод *Page_Load* , чтобы мы пропустить все обработки при необходимости.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-270">It’s also good to notice that we have placed that cookie check as the first step in the *Page_Load* method, so that we skip all processing, if needed.</span></span> <span data-ttu-id="7ef4a-271">Здесь приводится краткое фрагмент метод *Page_Load* из *Customizer.aspx* для отображения кода процесса.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-271">Here’s a short snippet from the *Page_Load* method from the *Customizer.aspx* to show the code process.</span></span> 

    protected void Page_Load(object sender, EventArgs e)
    {
        // Check if we should skip this check. We do this only once per hour to avoid 
        // perf issues and there's really no point even hitting the user profile 
        // in every request.
        if (CookieCheckSkip())
            return;
     
        var spContext = 
           SharePointContextProvider.Current.GetSharePointContext(Context);
       using (ClientContext clientContext = 
           spContext.CreateUserClientContextForSPHost())
       {
           // Get user profile
           ProfileLoader loader = ProfileLoader.GetProfileLoader(clientContext);
           UserProfile profile = loader.GetUserProfile();
           Microsoft.SharePoint.Client.Site personalSite = profile.PersonalSite;
    
           clientContext.Load(profile, prof => prof.AccountName);
           clientContext.Load(personalSite);
           clientContext.ExecuteQuery();
    
           // Let's check if the site already exists
           if (personalSite.ServerObjectIsNull.Value)
           {

<span data-ttu-id="7ef4a-272">**Версия настройки, применяемые к OD4B сайта**</span><span class="sxs-lookup"><span data-stu-id="7ef4a-272">**Version customizations which are applied to OD4B site**</span></span>

<span data-ttu-id="7ef4a-273">Второй уровень оптимизации на наш код обработки осуществляется управление версиями специально настроек, которые мы развертывание на веб-сайты OD4B.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-273">Second level of optimization on our code processing is done by versioning specifically the customizations which we deploy to the OD4B sites.</span></span> <span data-ttu-id="7ef4a-274">Это означает, что мы хранения версии настройки в контейнер свойств сайта OD4B и только обновления файлы и ресурсы при необходимости.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-274">What this means is that we store the version of the customizations to the OD4B site property bag and only update the files and assets if needed.</span></span> <span data-ttu-id="7ef4a-275">Это означает, что в ходе выполнения WebJob мы сравнения в настоящее время версии настройки в OD4B до версии, который мы о развертывании и только в том случае, если не существует на сайте OD4B odes версии центра развертывания мы Загрузите необходимые ресурсы и применить другие параметры.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-275">This means that in the WebJob execution we compare the currently customization version in OD4B to the version which we are about to deploy and only if the customization version odes not exist in the OD4B site, we upload the needed assets and apply other settings.</span></span>

<span data-ttu-id="7ef4a-276">Такой подход будет также значительно сократить необходимые ресурсы из Microsoft Azure, поскольку мы избежать обновления или выполнение кода фактический настройки, если не требуется.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-276">This approach will also significantly reduce the needed resources from Microsoft Azure, since we avoid refreshing or executing actual customization code when it’s not needed.</span></span> <span data-ttu-id="7ef4a-277">Это означает, что сокращение расходов на загрузку ЦП и другие использования ресурсов в Microsoft Azure и менее запросы к Office 365.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-277">This means reduction on the CPU and other resource usage in the Microsoft Azure and less requests towards Office 365.</span></span>

<span data-ttu-id="7ef4a-278">Все настройки логики хранится в это пример находится в метод *ApplySiteConfiguration* в классе *OD4B.Configuration.Async.Common.SiteModificationManager* .</span><span class="sxs-lookup"><span data-stu-id="7ef4a-278">All customization logic is stored in this sample is located in *ApplySiteConfiguration* method at *OD4B.Configuration.Async.Common.SiteModificationManager* class.</span></span> <span data-ttu-id="7ef4a-279">Этот метод также вызывается WebJob с правом параметрами, чтобы начать процесс настройки.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-279">This method is also called by the WebJob with right parameters to start the customization process.</span></span> <span data-ttu-id="7ef4a-280">Прежде чем мы фактически выполнять любые операции, выполняется проверка, значения контейнера свойств с помощью ключа «Contoso_OneDriveVersion» и выполнение только будет продолжена, если текущая версия на сайте меньше, чем версия, которая планируется применить.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-280">Before we actually perform any operations, we are checking property bag value with a key of ‘Contoso_OneDriveVersion’ and execution will only continue if current version in the site is lower than the version which we are planning to apply.</span></span>  <span data-ttu-id="7ef4a-281">Вот фактический код, который использует [компонент PnP ядро Microsoft Office](https://github.com/SharePoint/PnP-Sites-Core/tree/master/Core) для упрощения кода.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-281">Here’s the actual code which is using [Office PnP Core component](https://github.com/SharePoint/PnP-Sites-Core/tree/master/Core) to simplify the code.</span></span>

    // Check current site configuration status - is it already in right version?
    if (ctx.Web.GetPropertyBagValueInt(
        SiteModificationManager.OneDriveMarkerBagID, 0) 
        < SiteModificationManager.BrandingVersion)
    {

<span data-ttu-id="7ef4a-282">При настройке применяется к сайту, будут заданы версии применяемые настройки в контейнер свойств для выполнения следующей.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-282">When customization is applied to the site, we will set the applied customization version to the property bag for following execution.</span></span>

    // Save current branding applied indicator to site
    ctx.Web.SetPropertyBagValue(SiteModificationManager.OneDriveMarkerBagID, SiteModificationManager.BrandingVersion);

<span data-ttu-id="7ef4a-283">Это относительно простой процесс, но значительно сократить необходимые ресурсы с Azure, и уменьшает unnecesasrey удаленных операций к Office 365, который будет влиять на производительность положительное.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-283">This is relatively simple process, but will significantly reduce the required resources from Azure and will also reduce unnecesasrey remote operations towards Office 365, which will have positive performance impact.</span></span>

<a name="needed-configuration-in-azure"></a><span data-ttu-id="7ef4a-284">Необходимые настройки в Azure</span><span class="sxs-lookup"><span data-stu-id="7ef4a-284">Needed configuration in Azure</span></span>
-----------------------------

<span data-ttu-id="7ef4a-285">Ключевые требования для правильной работы в этом примере — это, что вы создали служба хранилища данных Azure и обновления строки подключения к хранилищу соответствующим образом для проектов, который они используются.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-285">Key requirement for this sample to work properly is that you have created Azure Storage Data Service and you have updated storage connection strings accordingly for the projects, which are using them.</span></span> <span data-ttu-id="7ef4a-286">Позволяет создать как служба хранилища с Azure администрирования портала (manage.windowssazure.com), выбрав **новые –> Data Services –> хранения –> быстрое создание**.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-286">You can simply create as storage service from the Azure administration portal (manage.windowssazure.com), by selecting **New –> Data Services –> Storage –> Quick Create**.</span></span> <span data-ttu-id="7ef4a-287">После этого только нужно определить, местоположение и некоторые другие настройки и имеется достаточно просто.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-287">After this you will just need to define name, location and few other settings and you are good to go.</span></span>

![Параметры быстрого создания: URL-адрес имеет значение myveryownstorage, расположение/сходства группы задано значение Западная США, подписки задано значение MSDN Ultimate и репликации задано значение географически избыточных.](media/Recipes/OD4BCustomization/azure-config-1.png)

<span data-ttu-id="7ef4a-289">При создании хранилища необходимо перейти и скопируйте ключ, который необходим для строки подключения.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-289">When storage has been created, you need to go and copy the key which is needed for the connection string.</span></span> <span data-ttu-id="7ef4a-290">При перемещении страница сведений о хранилище можно получить доступ к основные сведения, нажав кнопку «*Управления ключами доступа*» в нижней части страницы.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-290">When you move to the storage detail page, you can access key information by clicking “*Manage Access Keys*”  from the bottom of the page.</span></span>

![Ссылки на управление сочетания клавиш, будет выделена в нижней части страницы.](media/Recipes/OD4BCustomization/azure-config-2.png)

<span data-ttu-id="7ef4a-292">Необходимо обновить файл App.config для следующих проекты в решении Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-292">You will need to update App.config file for following projects in the Visual Studio solution.</span></span> <span data-ttu-id="7ef4a-293">Каждый из проектов являются более подробное описание описано далее в этой записи блога.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-293">Each of the projects are more detailed explained later in this blog post.</span></span>

<span data-ttu-id="7ef4a-294">OD4B. Configuration.Async.WebJob OD4B. Проект Configuration.Async.Console.SendMessage WebJob имеет два ключи, которые могут обновляться для указания на то же подключение и SendMessage имеет только один ключ для обновления.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-294">OD4B.Configuration.Async.WebJob OD4B.Configuration.Async.Console.SendMessage WebJob project has two keys, which can be updated to point to the same connection and the SendMessage has only one key to update.</span></span>

![Файл App.config открыт в Visual Studio в элементе appSettings.](media/Recipes/OD4BCustomization/app-config.png)

<a name="reference-solution-structure"></a><span data-ttu-id="7ef4a-299">Справочник по структура решения</span><span class="sxs-lookup"><span data-stu-id="7ef4a-299">Reference solution structure</span></span>
----------------------------

<span data-ttu-id="7ef4a-300">В этом Visual Studio, решение состоит из довольно много решений, но каждый из них имеет довольно разумных причин он там был.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-300">This Visual Studio solution consists from quite a few solutions, but each of them have pretty reasonable reason to be there.</span></span> <span data-ttu-id="7ef4a-301">Здесь приводится введение в каждый из проектов в решение и почему они существует, или они являются для.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-301">Here’s introduction to each of the projects in the solution and why they exists or what they are for.</span></span>

![В обозревателе решений отображаются папку с именем следуют шесть проектов, которые ниже подробно описаны в документации.](media/Recipes/OD4BCustomization/solution-explorer.png)

<span data-ttu-id="7ef4a-303">**OD4B. Configuration.Async**</span><span class="sxs-lookup"><span data-stu-id="7ef4a-303">**OD4B.Configuration.Async**</span></span>

<span data-ttu-id="7ef4a-304">Это фактический проекта приложения SharePoint, которой будут представлены размещением у поставщика приложений для SharePoint и запрашивает, необходимых разрешениях.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-304">This is the actual SharePoint app project, which will introduce the provider hosted app to SharePoint and will ask the needed permissions.</span></span> <span data-ttu-id="7ef4a-305">Обратите внимание, что несмотря на то, что мы фактически не выполняйте операции уровня клиента из приложения часть его self, просим довольно высокого разрешения для надстройки.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-305">Notice that even though we do not actually perform tenant level operations from the app part it self, we are asking pretty high permissions for the add-in.</span></span> <span data-ttu-id="7ef4a-306">Это так, как мы используем же идентификатор клиента и секрет из этого файла приложения в нашем WebJob выполнения.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-306">This is because we will use the same  client ID and secret from this app file in our WebJob execution.</span></span> <span data-ttu-id="7ef4a-307">Этим способом, вам не нужно вручную зарегистрировать идентификатор приложения и секрет к SharePoint, мы довольно просто используйте же идентификатора и секрета перекрестные решения.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-307">Using this approach, you do not have to manually register app id and secret to the SharePoint, we rather just use the same identifier and secret cross solution.</span></span>

![Список разрешений: область клиент имеет разрешение Полный доступ.](media/Recipes/OD4BCustomization/app-permissions.png)

<span data-ttu-id="7ef4a-311">Этот проект также содержит часть определения приложения, который затем развертываются на хост-сайт.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-311">This project also contains the app part definition which will be then deployed to the host web.</span></span>

<span data-ttu-id="7ef4a-312">**OD4B.Configuration.Async.Common**</span><span class="sxs-lookup"><span data-stu-id="7ef4a-312">**OD4B.Configuration.Async.Common**</span></span>

<span data-ttu-id="7ef4a-313">Этот проект содержит все фактические бизнес-логики и общий код кросс-проекты как определение для данных объекта, которое будет произведен для хранения очередей и фактических бизнес-логики для настройки сайтов OD4B.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-313">This project contains all the actual business logic and shared code cross projects, like the definition for the data object which is placed to the storage queue and the actual business logic to customize OD4B sites.</span></span> <span data-ttu-id="7ef4a-314">Причина для размещения кода в здесь — просто предоставляет простой способ разработки и тестирования операций при создании проекта.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-314">Reason to place code in here is simply for giving us easier way to develop and test the operations when the project is created.</span></span> <span data-ttu-id="7ef4a-315">Как с Общая разработка не следует помещать действительно вашего кода бизнес-логики непосредственно к WebJob или веб-часть приложения, а для поиска, в бизнес-логики уровень для упрощения тестирования и кода повторного использования.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-315">Like with general development, you should not really place your business logic code directly to the WebJob or to app part, rather to locate that in business logic layer for easier testing and code reuse.</span></span>

<span data-ttu-id="7ef4a-316">Все фактические операции к сайтам OD4B, находятся в класс *OD4B.Configuration.Async.Common.SiteModificationManager* .</span><span class="sxs-lookup"><span data-stu-id="7ef4a-316">All the actual operations towards the OD4B sites are located in *OD4B.Configuration.Async.Common.SiteModificationManager* class.</span></span>

<span data-ttu-id="7ef4a-317">**OD4B. Configuration.Async.Console.Reset**</span><span class="sxs-lookup"><span data-stu-id="7ef4a-317">**OD4B.Configuration.Async.Console.Reset**</span></span>

<span data-ttu-id="7ef4a-318">Этот проект является наших тестирования и отладки проект для действительных настроек.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-318">This project is our test and debugging project for the actual customizations.</span></span> <span data-ttu-id="7ef4a-319">Его можно использовать для вручную применить ее желаемую на любой сайт OD4B.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-319">It can be used to manually apply the wanted customizations to any OD4B site.</span></span> <span data-ttu-id="7ef4a-320">Во время разработки этот проект был тестирования проекта для тестирования в процессе настройки перед его был подключен к WebJob.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-320">During development time this project was our testing project to test the customization process before it was hooked to the WebJob.</span></span> <span data-ttu-id="7ef4a-321">Проекта также используется для сброса настроек из любого сайта OD4B демонстрации или тестирования.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-321">Project can be also used to reset customizations from any OD4B site for demonstration or testing purposes.</span></span> <span data-ttu-id="7ef4a-322">Так как фактический бизнес-логики, находится в проект common, этот проект будут использовать один и тот же класс *SiteModificationManager* от остальных Применение или сброс настроек на этих сайтах.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-322">Since actual business logic is located in the common project, this project will use the same *SiteModificationManager* class as the others to apply or reset customizations from the sites.</span></span>

<span data-ttu-id="7ef4a-323">При проверке настроек можно просто изменить код в метод Main между применить и Reset, чтобы изменить желаемую операции.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-323">When you test the customizations, you can simply change the code in the Main method between Apply and Reset to change the wanted operation.</span></span>

    static void Main(string[] args)
    {
     
        Uri url = 
            new Uri("https://vesaj-my.sharepoint.com/personal/vesaj_veskuonline_com");
     
            //get the new site collection
        string realm = TokenHelper.GetRealmFromTargetUrl(url);
        var token = TokenHelper.GetAppOnlyAccessToken(
                       TokenHelper.SharePointPrincipal, 
                       url.Authority, realm).AccessToken;
       using (var ctx = 
           TokenHelper.GetClientContextWithAccessToken(url.ToString(), 
           token))
       {
           // Uncomment the one you need for testing/reset
           // Apply(ctx, url);
           Reset(ctx);
       }
    }

<span data-ttu-id="7ef4a-324">Обратите внимание, что необходимо убедиться, что идентификатор приложения и секрет для этого проекта в файле app.config соответствующих те, которые вы предоставили необходимые разрешения для вашего клиента.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-324">Notice that you will need to ensure that app id and secret for this project in the app.config are matching the ones you gave needed permissions to your tenant.</span></span> <span data-ttu-id="7ef4a-325">Можно легко выполнять проекта, щелкните правой кнопкой мыши проект и выбор **Отладка — запустить новый экземпляр**, таким образом, можно просматривать фактический код, который является выполняется построчно.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-325">You can easily execute the project by right clicking the project and choosing **Debug – Start New Instance**, so that you can walk the actual code which is executed line by line.</span></span>

<span data-ttu-id="7ef4a-326">**OD4B. Configuration.Async.Console.SendMessage**</span><span class="sxs-lookup"><span data-stu-id="7ef4a-326">**OD4B.Configuration.Async.Console.SendMessage**</span></span>

<span data-ttu-id="7ef4a-327">Этот проект был добавлен в решение, которое требуется проверить очередь механизм хранения перед он был подключен к веб-части приложения.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-327">This project was added to the solution to test the storage queue mechanism before it was hooked to the app part.</span></span> <span data-ttu-id="7ef4a-328">Проект может использоваться с передавать процесс части приложения для добавления новых сообщений в очередь хранилища.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-328">Project can be used to by pass the app part process for adding new messages to the storage queue.</span></span> <span data-ttu-id="7ef4a-329">Обратите внимание, что необходимо обновить строку подключения очереди хранилища соответствующим образом в файле app.config, чтобы сделать проект работать должным образом.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-329">Notice that you will need to update the storage queue connection string accordingly in the app.config to make the project work properly.</span></span>

<span data-ttu-id="7ef4a-330">Можно легко выполнять проекта, щелкните правой кнопкой мыши проект и выбор отладка — запустить новый экземпляр таким образом, можно просматривать фактический код, который является выполняется построчно.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-330">You can easily execute the project by right clicking the project and choosing Debug – Start New Instance, so that you can walk the actual code which is executed line by line.</span></span>

<span data-ttu-id="7ef4a-331">**OD4B. Configuration.Async.WebJob**</span><span class="sxs-lookup"><span data-stu-id="7ef4a-331">**OD4B.Configuration.Async.WebJob**</span></span>

<span data-ttu-id="7ef4a-332">Это фактический WebJob проект, который был создан с помощью шаблона проекта WebJob, введенные в Visual Studio 2013 обновлений 4.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-332">This is the actual WebJob project, which was created using WebJob project template, introduced in the Visual Studio 2013 Update 4.</span></span> <span data-ttu-id="7ef4a-333">Этот шаблон упрощает создание проектов WebJob путем добавления правом ссылки на месте, а также приводится автоматизации замечательно развертывания с поддержкой вправо для проекта.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-333">This template makes it easier to create WebJob projects by adding right references in place and it also provides nice deployment automation with right click support for the project.</span></span> <span data-ttu-id="7ef4a-334">Можно просто развертывание первоначальной версии или нового проекта в Azure, щелкните правой кнопкой мыши и выбрав опубликовать как задание Web Azure...</span><span class="sxs-lookup"><span data-stu-id="7ef4a-334">You can simply deploy initial version or new version of the project to the Azure by right clicking and selecting Publish as Azure Web Job…</span></span> <span data-ttu-id="7ef4a-335">которого будет открыть мастер опубликования.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-335">which will open up the publishing wizard.</span></span>

![Диалоговое окно Публикация веб-сайта отображается и отображает вкладку подключение. В поле сервер содержит значение vesaj-od4bconf.scm.azurewebsites.net:443, в поле имя узла содержит значение vesaj-0d4bconf, исправленный в поле имя пользователя, в поле пароль скрывается, установлен флажок Сохранить пароль, а URL-адрес назначения поле содержит значения http://vesaj-od4bconf.azurewebsites.net.](media/Recipes/OD4BCustomization/publish-to-azure.png)

<span data-ttu-id="7ef4a-337">В этом WebJob создается как непрерывная WebJob, который необходим для обработки на основе очереди.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-337">This WebJob is created as a continuous WebJob, which is needed for the queue based processing.</span></span> <span data-ttu-id="7ef4a-338">Это означает, что в методе Main мы только процесс выполнение непрерывного следующим образом.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-338">This means that in the Main method, we only set the process to be executing continuous like follows.</span></span>

    class Program
    {
        // Please set the following connection strings in app.config for this 
        // WebJob to run: AzureWebJobsDashboard and AzureWebJobsStorage
        static void Main()
        {
            var host = new JobHost();
            // The following code ensures that the WebJob will be 
            // running continuously
           host.RunAndBlock();
       }
    }

<span data-ttu-id="7ef4a-339">Обработка очереди — простой с WebJobs.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-339">Actual queue processing is really easy with WebJobs.</span></span> <span data-ttu-id="7ef4a-340">Только, что для этого необходимо — для установки атрибутов вправо для метода и убедитесь, что соответствующим образом обновлены строки подключения Azure хранилища в файле конфигурации приложения и соответствующие хранилища очереди создания в Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-340">Only thing we need to do is to set the right attributes for the method and to ensure that the Azure storage connection strings in the app config are updated accordingly and matching the storage queue’s you have created to Microsoft Azure.</span></span> <span data-ttu-id="7ef4a-341">Ниже приведен метод *ProcessQueueMessage* из класса functions.cs.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-341">Following is the *ProcessQueueMessage* method from the functions.cs class.</span></span> <span data-ttu-id="7ef4a-342">Обратите внимание на то, как использовать приложение только маркеров модели для доступа к SharePoint из WebJob.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-342">Notice how we use the App Only token model to access the SharePoint from the WebJob.</span></span> <span data-ttu-id="7ef4a-343">Чтобы выполнить эту операцию, необходимо убедиться, что были скопированы правом кода и секрета приложения в app.config проекта.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-343">To make this work, you will need to ensure that you have copied the right app id and secret to the app.config of the project.</span></span> <span data-ttu-id="7ef4a-344">Фактические бизнес-логика находится в классе *SiteModificationManager* , мы просто вызовите, с правом клиентского контекста и параметры.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-344">Actual business logic is located in the *SiteModificationManager* class, so we just call that with the right client context and parameters.</span></span>

    // This function will get triggered/executed when a new message is written 
    // on an Azure Queue called queue.
    public static void ProcessQueueMessage(
        [QueueTrigger(SiteModificationManager.StorageQueueName)] 
        SiteModificationData request, TextWriter log)
    {
        Uri url = new Uri(request.SiteUrl);
     
        //Connect to the OD4B site sing App Only access
       string realm = TokenHelper.GetRealmFromTargetUrl(url);
       var token = TokenHelper.GetAppOnlyAccessToken(
           TokenHelper.SharePointPrincipal, url.Authority, realm).AccessToken;
    
       using (var ctx = TokenHelper.GetClientContextWithAccessToken(
           url.ToString(), token))
       {
           // Set configuration object properly for setting the config
           SiteModificationConfig config = new SiteModificationConfig()
           {
               SiteUrl = url.ToString(),
               JSFile = Path.Combine(Environment.GetEnvironmentVariable
                   ("WEBROOT_PATH"), "Resources\\OneDriveConfiguration.js"),
               ThemeName = "Garage",
               ThemeColorFile = Path.Combine(Environment.GetEnvironmentVariable
                   ("WEBROOT_PATH"), "Resources\\Themes\\Garage\\garagewhite.spcolor"),
               ThemeBGFile = Path.Combine(Environment.GetEnvironmentVariable
                   ("WEBROOT_PATH"), "Resources\\Themes\\Garage\\garagebg.jpg"),
               ThemeFontFile = "" // Ignored in this case, but could be also obviously set
           };
    
           new SiteModificationManager().ApplySiteConfiguration(ctx, config);
       }
    }

<span data-ttu-id="7ef4a-345">Что еще надо отметить — это, необходимо убедиться, что свойство *Copy Local* свойство ссылки на сборку SharePoint CSOM для проекта, чтобы все зависимые сборки должным образом копируются в Azure при развертывании задания web .</span><span class="sxs-lookup"><span data-stu-id="7ef4a-345">Other thing worth noticing is that you will need to ensure that you have set the *Copy Local* property for the SharePoint CSOM assembly references property for the project, so that all dependent assemblies are properly copied to Azure when you deploy the web job.</span></span> <span data-ttu-id="7ef4a-346">Это просто так как эти сборки не находится в обычном Azure веб-сайта по умолчанию, поэтому назначить этому свойству *значение True*, будет гарантирует, что эти сборки копируются в облако также.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-346">This is simply because these assemblies are not located in normal Azure web site by default, so by setting this property *True*, you will ensure that the referenced assemblies are copied to cloud as well.</span></span>

<span data-ttu-id="7ef4a-347">**OD4B. Configuration.AsyncWeb**</span><span class="sxs-lookup"><span data-stu-id="7ef4a-347">**OD4B.Configuration.AsyncWeb**</span></span>

<span data-ttu-id="7ef4a-348">Это фактический размещением у поставщика приложения, которая размещается в Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-348">This is the actual provider hosted app which is hosted in Microsoft Azure.</span></span> <span data-ttu-id="7ef4a-349">Он содержит страницы, laded веб-части приложения, который размещается на первой странице интрасети.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-349">It contains the page laded to the app part, which is placed on the front page of the intranet.</span></span> <span data-ttu-id="7ef4a-350">Страница Default.aspx этого приложения фактически не содержит какие-либо операции, показывает, содержит сведения о том, как использовать приложение.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-350">Default.aspx page of this app does not actually contain any operations, it shows provides details on how to use the app.</span></span>

<span data-ttu-id="7ef4a-351">*Обратите внимание на то. Если будет зачастую сталкиваются с необходимостью отказ в разрешении проблемы, связанные с WebJob или приложение доступ только к в целом, убедитесь в том, что обновления клиента кода и секрета приложения в файле app.config в соответствие со значениями в файл web.config из этого проекта. Visual Studio можно изменить эти значения в определенных ситуациях.*</span><span class="sxs-lookup"><span data-stu-id="7ef4a-351">*Notice. If you will face permission denied issues with the WebJob or app only access in general, make sure that you have updated app client id and secret in the app.config to match the values in the web.config from this project. Visual Studio can change these values in certain scenarios.*</span></span> 

<a name="queue-processing-in-webjob"></a><span data-ttu-id="7ef4a-352">Очередь обработки в WebJob</span><span class="sxs-lookup"><span data-stu-id="7ef4a-352">Queue processing in WebJob</span></span>
--------------------------

<span data-ttu-id="7ef4a-353">С помощью хранилища очередей прост действительно с помощью интерфейсов API, доступные из Azure.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-353">Using the storage queues is really straight forward with the APIs available from Azure.</span></span> <span data-ttu-id="7ef4a-354">— Это самый простой способ начать использование пакетов Nuget «*Windows Azure хранилища*», который будет связать все необходимые интерфейсы API и других пакетов в проект.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-354">Easiest way to get started is to use the '*Windows Azure Storage*' Nuget package, which will associate all needed APIs and other packages to your project.</span></span> <span data-ttu-id="7ef4a-355">После добавления этого пакета Nuget просто воспользоваться хранилища очереди API-интерфейсы для обработки.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-355">After you have added this Nuget package, you can simply start using the storage queue APIs for the processing.</span></span> <span data-ttu-id="7ef4a-356">Ниже приведен фрагмент из *OD4B. Configuration.Async.Common* проекта (AddConfigRequestToQueue метод в классе SiteModificationManager), который содержит код обработки очереди сообщений и использования из множество проектов (отмеченными упрощения разработки Отладка).</span><span class="sxs-lookup"><span data-stu-id="7ef4a-356">Following is snippet from the *OD4B.Configuration.Async.Common* project (AddConfigRequestToQueue method in SiteModificationManager class), which contains actual queue message handling code and is used from numerous projects (provided easier development time debugging).</span></span>

    public void AddConfigRequestToQueue(
                string account, string siteUrl, string storageConnectionString)
    {
        CloudStorageAccount storageAccount = 
                            CloudStorageAccount.Parse(storageConnectionString);
     
        // Get queue... create if does not exist.
        CloudQueueClient queueClient = storageAccount.CreateCloudQueueClient();
        CloudQueue queue = 
           queueClient.GetQueueReference(SiteModificationManager.StorageQueueName);
       queue.CreateIfNotExists();
    
       // Pass in data for modification
       var newSiteConfigRequest = new SiteModificationData()
       {
           AccountId = account,
           SiteUrl = siteUrl
       };
    
       // Add entry to queue
       queue.AddMessage(
           new CloudQueueMessage(
               JsonConvert.SerializeObject(newSiteConfigRequest)));
    }

<span data-ttu-id="7ef4a-357">В этом случае обработки очереди было выполнено с WebJob проекта.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-357">Actual queue processing in this case was done with the WebJob project.</span></span> <span data-ttu-id="7ef4a-358">В случае WebJob можно просто использовать определенные атрибуты для автоматизации обработки очереди.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-358">In the case of WebJob, we can simply use specific attributes to automate the queue handling.</span></span> <span data-ttu-id="7ef4a-359">Только, необходимо убедитесь в том, что это, что мы используем же хранилища строки и постановки в очередь имя подключения и отправки и получения части.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-359">Only thing we need to make sure is that we are using same storage connection string and queue name in both sending and receiving part.</span></span>

    // This function will get triggered/executed when a new message is written 
    // on an Azure Queue called queue.
    public static void ProcessQueueMessage(
        [QueueTrigger(SiteModificationManager.StorageQueueName)] 
        SiteModificationData request, TextWriter log)
    {
        Uri url = new Uri(request.SiteUrl);

<span data-ttu-id="7ef4a-360">Действительно не получает более простой способ.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-360">It really does not get easier than this.</span></span> <span data-ttu-id="7ef4a-361">Обратите внимание на то, что мы используем *SiteModificationManager.StorageQueueName* в обе стороны чтобы гарантировать, что имя очереди соответствие.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-361">Notice that we use *SiteModificationManager.StorageQueueName* in both sides to ensure that the queue name is matching.</span></span>

<span data-ttu-id="7ef4a-362">**Применение фактический конфигураций к сайту**</span><span class="sxs-lookup"><span data-stu-id="7ef4a-362">**Apply actual configurations to the site**</span></span>

<span data-ttu-id="7ef4a-363">В этой реализации ссылку выполняются после настройки для каждого сайта OD4B.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-363">In this reference implementations we are performing following customizations to each of the OD4B sites.</span></span>

- <span data-ttu-id="7ef4a-364">Добавление сообщения политики компании, которое отображается все время на сайтах OD4B</span><span class="sxs-lookup"><span data-stu-id="7ef4a-364">Add company policy message which is shown all the time in the OD4B sites</span></span>
- <span data-ttu-id="7ef4a-365">Скрыть Создание sub сайта ссылку со страницы контента сайта</span><span class="sxs-lookup"><span data-stu-id="7ef4a-365">Hide create sub site link option from site content page</span></span>
- <span data-ttu-id="7ef4a-366">Применение пользовательской темы к сайту OD4B в соответствии с фирменной символики компании</span><span class="sxs-lookup"><span data-stu-id="7ef4a-366">Apply custom theme to the OD4B site to match company branding</span></span>

<span data-ttu-id="7ef4a-367">Политика компании и скрытие ссылку Создать sub сайтов являются достигнуть с помощью поэтому вызов JavaScript, внедрение шаблон, где мы Добавление пользовательского настраиваемого действия на уровне сайта со ссылкой на конкретных файл JavaScript, который затем выполняется в каждом запросе страницы.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-367">Company policy and hiding the create sub site link are being achieved using so called JavaScript embedding pattern where we add custom user action to the site level with reference to specific JavaScript file, which is then being executed in every page request.</span></span> <span data-ttu-id="7ef4a-368">Это означает, что мы можно управлять с помощью технологий со стороны клиента путем добавления, удаления или обновления любой элемент в любую страницу обработки страницы.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-368">This means that we can control the page processing using client side technologies by adding, removing or updating any element in any page.</span></span> <span data-ttu-id="7ef4a-369">Применение этого подхода необходимо перечислить настраиваемой главной страницы, что может привести к "мне нравится" более значительные затраты на техническое обслуживание конечном счете, особенно если необходимые изменения довольно минимальны.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-369">Using this approach we do not need to introduce a custom master page, which could cause us more significant long term maintenance costs, especially if the needed changes are pretty minimal.</span></span>

<span data-ttu-id="7ef4a-370">Второй операции с помощью пользовательских тем требуется мы загрузки некоторых дополнительных файлов на сайт и задайте его тем для использования в качестве параметров темы.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-370">Second operation with the custom themes require that we upload some additional files to the site and then set those to be used as theme settings.</span></span> <span data-ttu-id="7ef4a-371">Мы строго CSOM передачи используйте все необходимые файлы на веб-сайты во избежание любой будущем со связями элемент framework компонента.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-371">We do use strictly CSOM to upload all needed files to the sites to avoid any future complications with feature framework element associations.</span></span> <span data-ttu-id="7ef4a-372">С момента отправки файла в SharePoint, с помощью CSOM действительно простой, это определенно это самый простой способ выполнения автоматизации и не требуется для выполнения любой зависимости конкретных настроек xml для изолированных решений. Вот метод настройки фактических сайта от класса OD4B.Configuration.Async.Common.SiteModificationManager.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-372">Since uploading a file to the SharePoint using the CSOM is really simple, this is definitely the easiest way to perform the automation and you do not needed to worry about any xml specific configurations dependency to Sandbox solutions.Here’s the actual site configuration method from OD4B.Configuration.Async.Common.SiteModificationManager class.</span></span> <span data-ttu-id="7ef4a-373">Обратите внимание на то, что мы используем Office 365 для разработчиков PnP компонент основной для упрощения некоторые необходимые операции.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-373">Notice that we use the Office 365 Developer PnP core component to simplify some of the needed operations.</span></span>

<span data-ttu-id="7ef4a-374">Рекомендуется также Обратите внимание, что действительно загружаем новой версии JS для корневого семейства веб-сайтов каждый раз личного сайта OD4B настройки.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-374">It is also good to notice that we do indeed upload new version of the JS to root site collection each time we customization personal OD4B site.</span></span> <span data-ttu-id="7ef4a-375">Это определенно не оптимальным решением, а не существует для простоты целей для этого решения Справочник по.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-375">This is definitely not optimal solution, it’s rather there for simplicity purposes for this reference solution.</span></span> <span data-ttu-id="7ef4a-376">Может рекомендуется добавить эту операцию отправки файла JavaScript событие установленные приложения, таким образом, чтобы он выполняется только один раз при установке приложения, но в этом случае необходимо выполнить дополнительные действия с обновлений на JS-файла.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-376">You could consider adding that JavaScript file upload operation to app Installed event, so that it’s only done once when app is installed, but in that case you would have to do some additional work with any updates on that JS file.</span></span>

    // This function will get triggered/executed when a new message is written 
    // on an Azure Queue called queue.
    public static void ProcessQueueMessage(
        [QueueTrigger(SiteModificationManager.StorageQueueName)] 
        SiteModificationData request, TextWriter log)
    {
        Uri url = new Uri(request.SiteUrl);
     
        //Connect to the OD4B site using App Only token
       string realm = TokenHelper.GetRealmFromTargetUrl(url);
       var token = TokenHelper.GetAppOnlyAccessToken(
           TokenHelper.SharePointPrincipal, url.Authority, realm).AccessToken;
    
       using (var ctx = TokenHelper.GetClientContextWithAccessToken(
           url.ToString(), token))
       {
           // Set configuration object properly for setting the config
           SiteModificationConfig config = new SiteModificationConfig()
           {
               SiteUrl = url.ToString(),
               JSFile = Path.Combine(Environment.GetEnvironmentVariable
                   ("WEBROOT_PATH"), "Resources\\OneDriveConfiguration.js"),
               ThemeName = "Garage",
               ThemeColorFile = 
                   Path.Combine(Environment.GetEnvironmentVariable
                   ("WEBROOT_PATH"), "Resources\\Themes\\Garage\\garagewhite.spcolor"),
               ThemeBGFile = 
                   Path.Combine(Environment.GetEnvironmentVariable
                   ("WEBROOT_PATH"), "Resources\\Themes\\Garage\\garagebg.jpg"),
               ThemeFontFile = "" // Ignored in this case, but could be also set
           };
    
           new SiteModificationManager().ApplySiteConfiguration(ctx, config);
       }
    }

<span data-ttu-id="7ef4a-377">Очевидно, что необходимые операции выполняются сильно зависит от потребностей бизнеса.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-377">Obviously the needed operations are highly dependent on your business requirements.</span></span> <span data-ttu-id="7ef4a-378">Можно найти несколько разных шаблонов и операции с [Office 365 для разработчиков шаблоны и рекомендации](http://aka.ms/officedevpnp)на основе подходов к CSOM.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-378">You can find multiple different patterns and approaches with CSOM based operations from the [Office 365 Developer Patterns and Practices](http://aka.ms/officedevpnp).</span></span>

<a name="additional-notes-on-webjob-based-solutions"></a><span data-ttu-id="7ef4a-379">Дополнительные замечания о решениях на базе WebJob</span><span class="sxs-lookup"><span data-stu-id="7ef4a-379">Additional notes on WebJob based solutions</span></span>
==========================================

<span data-ttu-id="7ef4a-380">Вот несколько Дополнительные примечания, связанные с на разработку WebJob в Azure.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-380">Here’s few additional notes related on WebJob development in Azure.</span></span> <span data-ttu-id="7ef4a-381">Это очень эффективным методом которого будет определенно широко используются на нескольких настроек Office 365.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-381">This is extremely powerful technique which will be definitely used widely cross Office 365 customizations.</span></span> <span data-ttu-id="7ef4a-382">Конечно, вы увидите новые и расширенные решения на основе технологии WebJob в Office 365 для разработчиков шаблонов & Practices программы также добавляется.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-382">You will certainly see new and enhanced solutions based on the WebJob technology be added to the Office 365 Developer Patterns & Practices program as well.</span></span>

<a name="debugging-webjob-and-customization-process"></a><span data-ttu-id="7ef4a-383">Отладка процесса WebJob и параметры настройки</span><span class="sxs-lookup"><span data-stu-id="7ef4a-383">Debugging WebJob and customization process</span></span>
------------------------------------------

<span data-ttu-id="7ef4a-384">Один из рекомендуемые методы для кода в общем найдите фактические операции за пределами окончательный выполняющийся процесс, а необходимые таким образом, вы можете первого сосредоточены на тестирования кода легко просто с помощью консольного приложения или для примера с тестовых проектов в Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-384">One of the good practices for your code in general is to locate the actual operations outside of the actual final executing process, so that you can first concentrate on testing needed code easily simply by using console application or for example with test projects in the Visual Studio.</span></span> <span data-ttu-id="7ef4a-385">Таким образом, можно гарантировать, что фактический бизнес-логики полностью функциональные возможности перед фактически зондами, в последнем процесс, в данном случае означает WebJob.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-385">This way you can ensure that the actual business logic is fully functionality before you actually hook that to the final process, in this case meaning the WebJob.</span></span> <span data-ttu-id="7ef4a-386">В данном случае решение ссылку описано бизнес код в класс OD4B.Configuration.Async.Common.SiteModificationManager и, который вызывается из различных мест.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-386">In this reference solution case we placed all the business code to the OD4B.Configuration.Async.Common.SiteModificationManager class and we call that from numerous locations.</span></span>

<span data-ttu-id="7ef4a-387">Это означает, что во время разработки можно использовать OD4B. Configuration.Async.Console.Reset консольного приложения для тестирования и сброс настроек столько раз, сколько требуется узлов убедитесь, что бизнес-логика полностью сплошной.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-387">This meant that during development time we could use OD4B.Configuration.Async.Console.Reset console application to test and reset the customizations as many times as needed from the sites to ensure that business logic is fully solid.</span></span> <span data-ttu-id="7ef4a-388">Это действительно никак не связан с помощью модели надстройки SharePoint или Azure разработки, по разработке вместо практические пошаговые независимо от того, какие технологии использовать.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-388">This really has nothing to do with SharePoint Add-in model or Azure development, rather practical step-by-step development practices regardless of what technology you use.</span></span> <span data-ttu-id="7ef4a-389">Периоды времени, когда я была динамика в Специалист по сертификации обучение SharePoint, я ссылается на этот как [метод NKOTB](https://www.youtube.com/watch?v=iCrargw1rrM), но это не Стандартные термины отрасли :-)</span><span class="sxs-lookup"><span data-stu-id="7ef4a-389">During times when I was a speaker in the MCM for SharePoint certification training I was referring to this as the [NKOTB method](https://www.youtube.com/watch?v=iCrargw1rrM), but that’s not really a industry standard terminology :-)</span></span>

<span data-ttu-id="7ef4a-390">Одно из замечательных улучшения с точки зрения отладки для WebJobs была введена в Visual Studio 2014 обновлений 4.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-390">One of the great improvements from the debugging perspective for the WebJobs was introduced in the Visual Studio 2014 Update 4.</span></span> <span data-ttu-id="7ef4a-391">С помощью новых подключений Azure и шаблоны проектов можно выполнить удаленная отладка с WebJob в Azure со стороны.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-391">With the newly introduced Azure connections and project templates, you can actually do remote debugging with WebJob running in the Azure side.</span></span> <span data-ttu-id="7ef4a-392">Необходимо развернуть WebJob в Azure и после, можно начать сеанс отладки, справа щелкните WebJob экземпляра в *Обозревателе серверов* и выберите *Присоединение отладчика* в контекстном меню.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-392">You will need to deploy the WebJob to the Azure and after that you can start the debugging session by right clicking WebJob instance from the *Server Explorer* and choose *Attach Debugger* from the context menu.</span></span>

![В обозревателе серверов расширена вложенных объектов веб-сайтов, vesaj-od4bconf WebJobs, непрерывно, OD4BConfigurationAsyncWebJob.](media/Recipes/OD4BCustomization/server-explorer.png)

<span data-ttu-id="7ef4a-395">Имеется даже инженер-испытатель для отправки правильно форматированных сообщений в очередь в решении ссылку.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-395">There’s even a tester for sending rightly formatted messages to the queue in the reference solution.</span></span> <span data-ttu-id="7ef4a-396">*OD4B. Configuration.Async.Console.SendMessage* проект был создан просто, чтобы иметь возможность отладки процесса WebJob без риска для развертывания веб-части приложения в любом месте.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-396">*OD4B.Configuration.Async.Console.SendMessage* project was created simply to have the opportunity to debug the WebJob process without being forced to deploy the app part to anywhere.</span></span> <span data-ttu-id="7ef4a-397">Это был получен еще раз на отладки и тестирования пошаговые весь процесс.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-397">This came back again on debugging and testing the whole process step-by-step.</span></span>

<a name="webjob-environment-variables"></a><span data-ttu-id="7ef4a-398">Переменные среды WebJob</span><span class="sxs-lookup"><span data-stu-id="7ef4a-398">WebJob environment variables</span></span>
----------------------------

<span data-ttu-id="7ef4a-399">Одно из интересных аспектов WebJobs, что они выполняются от имени Azure веб-сайтов, но место их выполнения отличается от обычных веб-сайтов в Azure.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-399">One of the interesting things about the WebJobs are that they are running under a Azure web sites, but their execution location is slightly different than normal web sites in Azure.</span></span> <span data-ttu-id="7ef4a-400">Я понимаю с этой —, что при развертывании дополнительных файлов или средств вместе с WebJob Azure возникновения проблемы, связанные с Если предполагается, что можно ссылаться на эти ресурсы, непосредственно с использованием классической относительных путей в коде WebJob.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-400">What I mean with this is that if you deploy any additional files or assets together with the WebJob to the Azure, you might run into challenges if you assume that you can reference those assets directly using classic relative paths in the WebJob code.</span></span>

<span data-ttu-id="7ef4a-401">В этом случае имеется один файл JavaScript и несколько файлов для пользовательской темы, которые были развернуты для веб-сайта Azure, поэтому может будут загружаться на сайты SharePoint, при необходимости.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-401">In this case we had one JavaScript file and few files for the custom theme, which were deployed to the Azure web site, so that they could be uploaded to the SharePoint sites as needed.</span></span> <span data-ttu-id="7ef4a-402">Для просмотра этих файлов в Azure расширение филиала файлы в разделе определенного веб-сайта.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-402">You can see those files in the Azure if you extend the Files branch under specific web site.</span></span>

![В обозревателе серверов при развертывании вложенных объектов веб-сайтов, vesaj od4bconf, файлы, ресурсы, тем, видео и отображение файлов в папке «видео».](media/Recipes/OD4BCustomization/azure-web-site.png)

<span data-ttu-id="7ef4a-404">Обычно в Azure веб-сайтов можно было ссылаться на эти файлы, с помощью следующего формата</span><span class="sxs-lookup"><span data-stu-id="7ef4a-404">Typically in Azure web sites, you could reference to those files by using following format</span></span>

    string path = HostingEnvironment.MapPath(
        string.Format("~/{0}", "Resources/OneDriveConfiguration.js"));

<span data-ttu-id="7ef4a-405">Поскольку WebJobs тем не менее, выполняются в другую папку, а не в контексте служб IIS, над ссылку на файл не будет работать, поскольку сопоставление произойдет сбой в контексте процесса WebJob.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-405">Since WebJobs are however executed in different location and not in the context of IIS, above reference to file would not work, since mapping would fail from the context of the WebJob process.</span></span> <span data-ttu-id="7ef4a-406">Здесь указывается, где может помочь WebJob определенные переменные среды.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-406">This is where WebJob specific environment variables can help.</span></span>  <span data-ttu-id="7ef4a-407">В случае решение ссылку мы использовали переменную заданной среды WebJob WEBROOT_PATH для получения доступа для папки, связанной веб-сайта.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-407">In the reference solution case, we used WebJob specific environment variable WEBROOT_PATH to gain access on the associated web site folder.</span></span>

    string jsFile = Path.Combine(
        Environment.GetEnvironmentVariable("WEBROOT_PATH"), 
        "Resources\\OneDriveConfiguration.js");

<span data-ttu-id="7ef4a-408">Существует также несколько переменные среды для WebJobs, которая может помочь.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-408">There are also few other environment variables for WebJobs, which might help you.</span></span> <span data-ttu-id="7ef4a-409">Чтобы проверить переменные разные среды, с помощью кода и в репозиториев для [этой](https://gist.github.com/sayedihashimi/831d8883cdf1d23823f3)хороший ссылки.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-409">You can check the different environment variables using code and there’s good references in the GitHub for [this](https://gist.github.com/sayedihashimi/831d8883cdf1d23823f3).</span></span>

<a name="video-demonstrating-the-solution-and-the-actions"></a><span data-ttu-id="7ef4a-410">Видеоролик, демонстрирующий решения и действия</span><span class="sxs-lookup"><span data-stu-id="7ef4a-410">Video demonstrating the solution and the actions</span></span>
================================================

<span data-ttu-id="7ef4a-411">[Вот видео](http://video.ch9.ms/ch9/053b/3496f324-dc88-4e1f-937f-e1a177fc053b/OD4BCustomizer_high.mp4) отображение решения на практике, включая описание структуры решения и как будет использовать его в среде Office 365 для изменения OneDrive для бизнеса сайтов.</span><span class="sxs-lookup"><span data-stu-id="7ef4a-411">[Here’s a video](http://video.ch9.ms/ch9/053b/3496f324-dc88-4e1f-937f-e1a177fc053b/OD4BCustomizer_high.mp4) showing the solution in practice, including explanation of the solution structures and how you would use it in your Office 365 environment to modify OneDrive for Business sites.</span></span>

<a name="related-links"></a><span data-ttu-id="7ef4a-412">Ссылки по теме</span><span class="sxs-lookup"><span data-stu-id="7ef4a-412">Related links</span></span>
=============
- [<span data-ttu-id="7ef4a-413">Настройка OneDrive для бизнеса фирменного стиля сайтов</span><span class="sxs-lookup"><span data-stu-id="7ef4a-413">Customize OneDrive for Business site branding</span></span>](Customization-Options-For-OD4B-Sites.md)
- <span data-ttu-id="7ef4a-414">Руководств по [http://aka.ms/OfficeDevPnPGuidance](http://aka.ms/OfficeDevPnPGuidance "Руководств")</span><span class="sxs-lookup"><span data-stu-id="7ef4a-414">Guidance articles at [http://aka.ms/OfficeDevPnPGuidance](http://aka.ms/OfficeDevPnPGuidance "Guidance Articles")</span></span>
- <span data-ttu-id="7ef4a-415">Справочные материалы в библиотеке MSDN по [http://aka.ms/OfficeDevPnPMSDN](http://aka.ms/OfficeDevPnPMSDN "Справочные материалы в библиотеке MSDN")</span><span class="sxs-lookup"><span data-stu-id="7ef4a-415">References in MSDN at [http://aka.ms/OfficeDevPnPMSDN](http://aka.ms/OfficeDevPnPMSDN "References in MSDN")</span></span>
- <span data-ttu-id="7ef4a-416">Видеозаписи по [http://aka.ms/OfficeDevPnPVideos](http://aka.ms/OfficeDevPnPVideos "видео")</span><span class="sxs-lookup"><span data-stu-id="7ef4a-416">Videos at [http://aka.ms/OfficeDevPnPVideos](http://aka.ms/OfficeDevPnPVideos "Videos")</span></span>

<a name="related-pnp-samples"></a><span data-ttu-id="7ef4a-417">Примеры связанных с ними PnP</span><span class="sxs-lookup"><span data-stu-id="7ef4a-417">Related PnP samples</span></span>
===================

- [<span data-ttu-id="7ef4a-418">OD4B. Configuration.Async (O365 PnP образец)</span><span class="sxs-lookup"><span data-stu-id="7ef4a-418">OD4B.Configuration.Async (O365 PnP Sample)</span></span>](https://github.com/SharePoint/PnP/tree/master/Solutions/OD4B.Configuration.Async)
- [<span data-ttu-id="7ef4a-419">Provisioning.OneDriveProvisioning (O365 PnP образец)</span><span class="sxs-lookup"><span data-stu-id="7ef4a-419">Provisioning.OneDriveProvisioning (O365 PnP Sample)</span></span>](https://github.com/SharePoint/PnP/tree/master/Samples/Provisioning.OneDriveProvisioning)
- [<span data-ttu-id="7ef4a-420">Компонент основной PnP Office</span><span class="sxs-lookup"><span data-stu-id="7ef4a-420">Office PnP Core component</span></span>](https://github.com/SharePoint/PnP-Sites-Core/tree/master/Core)
- <span data-ttu-id="7ef4a-421">Примеры и содержимое в https://github.com/SharePoint/PnP</span><span class="sxs-lookup"><span data-stu-id="7ef4a-421">Samples and content at https://github.com/SharePoint/PnP</span></span>

<a name="applies-to"></a><span data-ttu-id="7ef4a-422">Применимо к</span><span class="sxs-lookup"><span data-stu-id="7ef4a-422">Applies to</span></span>
==========
- <span data-ttu-id="7ef4a-423">Office 365 нескольких клиентов (MT)</span><span class="sxs-lookup"><span data-stu-id="7ef4a-423">Office 365 Multi Tenant (MT)</span></span>
- <span data-ttu-id="7ef4a-424">Office 365 выделенных (D) *частично*</span><span class="sxs-lookup"><span data-stu-id="7ef4a-424">Office 365 Dedicated (D) *partly*</span></span>
- <span data-ttu-id="7ef4a-425">SharePoint 2013 в локальной — *частично*</span><span class="sxs-lookup"><span data-stu-id="7ef4a-425">SharePoint 2013 on-premises – *partly*</span></span>

<span data-ttu-id="7ef4a-426">*Шаблоны для выделенных и локальной идентичны с помощью надстройки SharePoint методики модели, но возможных технологий, которые могут использоваться отличаются.*</span><span class="sxs-lookup"><span data-stu-id="7ef4a-426">*Patterns for dedicated and on-premises are identical with SharePoint Add-in model techniques, but there are differences on the possible technologies that can be used.*</span></span>
